(function(){var b=this;var e=e||{};e.WEBGL_RENDERER=0;e.CANVAS_RENDERER=1;e.VERSION="v1.5.2";e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};e.INTERACTION_FREQUENCY=30;e.AUTO_PREVENT_DEFAULT=true;e.RAD_TO_DEG=180/Math.PI;e.DEG_TO_RAD=Math.PI/180;e.Point=function(f,g){this.x=f||0;this.y=g||0};e.Point.prototype.clone=function(){return new e.Point(this.x,this.y)};e.Point.prototype.constructor=e.Point;e.Point.prototype.set=function(f,g){this.x=f||0;this.y=g||((g!==0)?this.x:0)};e.Rectangle=function(g,i,h,f){this.x=g||0;this.y=i||0;this.width=h||0;this.height=f||0};e.Rectangle.prototype.clone=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)};e.Rectangle.prototype.contains=function(f,i){if(this.width<=0||this.height<=0){return false}var g=this.x;if(f>=g&&f<=g+this.width){var h=this.y;if(i>=h&&i<=h+this.height){return true}}return false};e.Rectangle.prototype.constructor=e.Rectangle;e.EmptyRectangle=new e.Rectangle(0,0,0,0);e.Polygon=function(h){if(!(h instanceof Array)){h=Array.prototype.slice.call(arguments)}if(typeof h[0]==="number"){var j=[];for(var g=0,f=h.length;g<f;g+=2){j.push(new e.Point(h[g],h[g+1]))}h=j}this.points=h};e.Polygon.prototype.clone=function(){var g=[];for(var f=0;f<this.points.length;f++){g.push(this.points[f].clone())}return new e.Polygon(g)};e.Polygon.prototype.contains=function(q,p){var h=false;for(var m=0,l=this.points.length-1;m<this.points.length;l=m++){var o=this.points[m].x,k=this.points[m].y,n=this.points[l].x,g=this.points[l].y,f=((k>p)!==(g>p))&&(q<(n-o)*(p-k)/(g-k)+o);if(f){h=!h}}return h};e.Polygon.prototype.constructor=e.Polygon;e.Circle=function(g,h,f){this.x=g||0;this.y=h||0;this.radius=f||0};e.Circle.prototype.clone=function(){return new e.Circle(this.x,this.y,this.radius)};e.Circle.prototype.contains=function(f,j){if(this.radius<=0){return false}var i=(this.x-f),h=(this.y-j),g=this.radius*this.radius;i*=i;h*=h;return(i+h<=g)};e.Circle.prototype.constructor=e.Circle;e.Ellipse=function(g,i,h,f){this.x=g||0;this.y=i||0;this.width=h||0;this.height=f||0};e.Ellipse.prototype.clone=function(){return new e.Ellipse(this.x,this.y,this.width,this.height)};e.Ellipse.prototype.contains=function(g,i){if(this.width<=0||this.height<=0){return false}var h=((g-this.x)/this.width),f=((i-this.y)/this.height);h*=h;f*=f;return(h+f<=1)};e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)};e.Ellipse.prototype.constructor=e.Ellipse;e.determineMatrixArrayType=function(){return(typeof Float32Array!=="undefined")?Float32Array:Array};e.Matrix2=e.determineMatrixArrayType();e.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};e.Matrix.prototype.fromArray=function(f){this.a=f[0];this.b=f[1];this.c=f[3];this.d=f[4];this.tx=f[2];this.ty=f[5]};e.Matrix.prototype.toArray=function(f){if(!this.array){this.array=new Float32Array(9)}var g=this.array;if(f){this.array[0]=this.a;this.array[1]=this.c;this.array[2]=0;this.array[3]=this.b;this.array[4]=this.d;this.array[5]=0;this.array[6]=this.tx;this.array[7]=this.ty;this.array[8]=1}else{this.array[0]=this.a;this.array[1]=this.b;this.array[2]=this.tx;this.array[3]=this.c;this.array[4]=this.d;this.array[5]=this.ty;this.array[6]=0;this.array[7]=0;this.array[8]=1}return g};e.identityMatrix=new e.Matrix();e.DisplayObject=function(){this.position=new e.Point();this.scale=new e.Point(1,1);this.pivot=new e.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.buttonMode=false;this.renderable=false;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=false;this.defaultCursor="pointer";this.worldTransform=new e.Matrix();this.color=[];this.dynamic=true;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new e.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};e.DisplayObject.prototype.constructor=e.DisplayObject;e.DisplayObject.prototype.setInteractive=function(f){this.interactive=f};Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(f){this._interactive=f;if(this.stage){this.stage.dirty=true}}});Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var f=this;do{if(!f.visible){return false}f=f.parent}while(f);return true}});Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(f){if(this._mask){this._mask.isMask=false}this._mask=f;if(this._mask){this._mask.isMask=true}}});Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(k){if(k){var h=[];for(var g=0;g<k.length;g++){var l=k[g].passes;for(var f=0;f<l.length;f++){h.push(l[f])}}this._filterBlock={target:this,filterPasses:h}}this._filters=k}});Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(f){if(this._cacheAsBitmap===f){return}if(f){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=f}});e.DisplayObject.prototype.updateTransform=function(){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}var i=this.parent.worldTransform;var f=this.worldTransform;var p=this.pivot.x;var o=this.pivot.y;var l=this._cr*this.scale.x,k=-this._sr*this.scale.y,s=this._sr*this.scale.x,r=this._cr*this.scale.y,j=this.position.x-l*p-o*k,q=this.position.y-r*o-p*s,n=i.a,m=i.b,h=i.c,g=i.d;f.a=n*l+m*s;f.b=n*k+m*r;f.tx=n*j+m*q+i.tx;f.c=h*l+g*s;f.d=h*k+g*r;f.ty=h*j+g*q+i.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};e.DisplayObject.prototype.getBounds=function(f){f=f;return e.EmptyRectangle};e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)};e.DisplayObject.prototype.setStageReference=function(f){this.stage=f;if(this._interactive){this.stage.dirty=true}};e.DisplayObject.prototype.generateTexture=function(h){var g=this.getLocalBounds();var f=new e.RenderTexture(g.width|0,g.height|0,h);f.render(this,new e.Point(-g.x,-g.y));return f};e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};e.DisplayObject.prototype._renderCachedSprite=function(f){if(f.gl){e.Sprite.prototype._renderWebGL.call(this._cachedSprite,f)}else{e.Sprite.prototype._renderCanvas.call(this._cachedSprite,f)}};e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=false;var h=this.getLocalBounds();if(!this._cachedSprite){var f=new e.RenderTexture(h.width|0,h.height|0);this._cachedSprite=new e.Sprite(f);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(h.width|0,h.height|0)}var g=this._filters;this._filters=null;this._cachedSprite.filters=g;this._cachedSprite.texture.render(this,new e.Point(-h.x,-h.y));this._cachedSprite.anchor.x=-(h.x/h.width);this._cachedSprite.anchor.y=-(h.y/h.height);this._filters=g;this._cacheAsBitmap=true};e.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null};e.DisplayObject.prototype._renderWebGL=function(f){f=f};e.DisplayObject.prototype._renderCanvas=function(f){f=f};Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(f){this.position.x=f}});Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(f){this.position.y=f}});e.DisplayObjectContainer=function(){e.DisplayObject.call(this);this.children=[]};e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype);e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer;e.DisplayObjectContainer.prototype.addChild=function(f){this.addChildAt(f,this.children.length)};e.DisplayObjectContainer.prototype.addChildAt=function(g,f){if(f>=0&&f<=this.children.length){if(g.parent){g.parent.removeChild(g)}g.parent=this;this.children.splice(f,0,g);if(this.stage){g.setStageReference(this.stage)}}else{throw new Error(g+" The index "+f+" supplied is out of bounds "+this.children.length)}};e.DisplayObjectContainer.prototype.swapChildren=function(i,f){if(i===f){return}var h=this.children.indexOf(i);var g=this.children.indexOf(f);if(h<0||g<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[h]=f;this.children[g]=i};e.DisplayObjectContainer.prototype.getChildAt=function(f){if(f>=0&&f<this.children.length){return this.children[f]}else{throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}};e.DisplayObjectContainer.prototype.removeChild=function(f){return this.removeChildAt(this.children.indexOf(f))};e.DisplayObjectContainer.prototype.removeChildAt=function(f){var g=this.getChildAt(f);if(this.stage){g.removeStageReference()}g.parent=undefined;this.children.splice(f,1);return g};e.DisplayObjectContainer.prototype.removeChildren=function(k,l){var j=k||0;var f=typeof l==="number"?l:this.children.length;var g=f-j;if(g>0&&g<=f){var m=this.children.splice(j,g);for(var h=0;h<m.length;h++){var n=m[h];if(this.stage){n.removeStageReference()}n.parent=undefined}return m}else{throw new Error("Range Error, numeric values are outside the acceptable range")}};e.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}e.DisplayObject.prototype.updateTransform.call(this);if(this._cacheAsBitmap){return}for(var g=0,f=this.children.length;g<f;g++){this.children[g].updateTransform()}};e.DisplayObjectContainer.prototype.getBounds=function(s){if(this.children.length===0){return e.EmptyRectangle}if(s){var r=this.worldTransform;this.worldTransform=s;this.updateTransform();this.worldTransform=r}var n=Infinity;var m=Infinity;var h=-Infinity;var g=-Infinity;var o;var u;var t;var k=false;for(var q=0,p=this.children.length;q<p;q++){var l=this.children[q];if(!l.visible){continue}k=true;o=this.children[q].getBounds(s);n=n<o.x?n:o.x;m=m<o.y?m:o.y;u=o.width+o.x;t=o.height+o.y;h=h>u?h:u;g=g>t?g:t}if(!k){return e.EmptyRectangle}var f=this._bounds;f.x=n;f.y=m;f.width=h-n;f.height=g-m;return f};e.DisplayObjectContainer.prototype.getLocalBounds=function(){var f=this.worldTransform;this.worldTransform=e.identityMatrix;for(var h=0,g=this.children.length;h<g;h++){this.children[h].updateTransform()}var k=this.getBounds();this.worldTransform=f;return k};e.DisplayObjectContainer.prototype.setStageReference=function(g){this.stage=g;if(this._interactive){this.stage.dirty=true}for(var h=0,f=this.children.length;h<f;h++){var k=this.children[h];k.setStageReference(g)}};e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var g=0,f=this.children.length;g<f;g++){var h=this.children[g];h.removeStageReference()}if(this._interactive){this.stage.dirty=true}this.stage=null};e.DisplayObjectContainer.prototype._renderWebGL=function(h){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(h);return}var g,f;if(this._mask||this._filters){if(this._mask){h.spriteBatch.stop();h.maskManager.pushMask(this.mask,h);h.spriteBatch.start()}if(this._filters){h.spriteBatch.flush();h.filterManager.pushFilter(this._filterBlock)}for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop();if(this._filters){h.filterManager.popFilter()}if(this._mask){h.maskManager.popMask(h)}h.spriteBatch.start()}else{for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}}};e.DisplayObjectContainer.prototype._renderCanvas=function(h){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(h);return}if(this._mask){h.maskManager.pushMask(this._mask,h.context)}for(var g=0,f=this.children.length;g<f;g++){var k=this.children[g];k._renderCanvas(h)}if(this._mask){h.maskManager.popMask(h.context)}};e.Sprite=function(f){e.DisplayObjectContainer.call(this);this.anchor=new e.Point();this.texture=f;this._width=0;this._height=0;this.tint=16777215;this.blendMode=e.blendModes.NORMAL;if(f.baseTexture.hasLoaded){this.onTextureUpdate()}else{this.onTextureUpdateBind=this.onTextureUpdate.bind(this);this.texture.addEventListener("update",this.onTextureUpdateBind)}this.renderable=true};e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Sprite.prototype.constructor=e.Sprite;Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(f){this.scale.x=f/this.texture.frame.width;this._width=f}});Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(f){this.scale.y=f/this.texture.frame.height;this._height=f}});e.Sprite.prototype.setTexture=function(f){if(this.texture.baseTexture!==f.baseTexture){this.textureChange=true;this.texture=f}else{this.texture=f}this.cachedTint=16777215;this.updateFrame=true};e.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}this.updateFrame=true};e.Sprite.prototype.getBounds=function(s){var p=this.texture.frame.width;var o=this.texture.frame.height;var n=p*(1-this.anchor.x);var m=p*-this.anchor.x;var l=o*(1-this.anchor.y);var k=o*-this.anchor.y;var q=s||this.worldTransform;var E=q.a;var C=q.c;var B=q.b;var z=q.d;var F=q.tx;var D=q.ty;var v=E*m+B*k+F;var i=z*k+C*m+D;var u=E*n+B*k+F;var h=z*k+C*n+D;var t=E*n+B*l+F;var g=z*l+C*n+D;var r=E*m+B*l+F;var f=z*l+C*m+D;var y=-Infinity;var w=-Infinity;var A=Infinity;var x=Infinity;A=v<A?v:A;A=u<A?u:A;A=t<A?t:A;A=r<A?r:A;x=i<x?i:x;x=h<x?h:x;x=g<x?g:x;x=f<x?f:x;y=v>y?v:y;y=u>y?u:y;y=t>y?t:y;y=r>y?r:y;w=i>w?i:w;w=h>w?h:w;w=g>w?g:w;w=f>w?f:w;var j=this._bounds;j.x=A;j.width=y-A;j.y=x;j.height=w-x;this._currentBounds=j;return j};e.Sprite.prototype._renderWebGL=function(k){if(!this.visible||this.alpha<=0){return}var h,g;if(this._mask||this._filters){var f=k.spriteBatch;if(this._mask){f.stop();k.maskManager.pushMask(this.mask,k);f.start()}if(this._filters){f.flush();k.filterManager.pushFilter(this._filterBlock)}f.render(this);for(h=0,g=this.children.length;h<g;h++){this.children[h]._renderWebGL(k)}f.stop();if(this._filters){k.filterManager.popFilter()}if(this._mask){k.maskManager.popMask(k)}f.start()}else{k.spriteBatch.render(this);for(h=0,g=this.children.length;h<g;h++){this.children[h]._renderWebGL(k)}}};e.Sprite.prototype._renderCanvas=function(p){if(this.visible===false||this.alpha===0){return}var h=this.texture.frame;var f=p.context;var o=this.texture;if(this.blendMode!==p.currentBlendMode){p.currentBlendMode=this.blendMode;f.globalCompositeOperation=e.blendModesCanvas[p.currentBlendMode]}if(this._mask){p.maskManager.pushMask(this._mask,p.context)}if(h&&h.width&&h.height&&o.baseTexture.source){f.globalAlpha=this.worldAlpha;var k=this.worldTransform;if(p.roundPixels){f.setTransform(k.a,k.c,k.b,k.d,k.tx|0,k.ty|0)}else{f.setTransform(k.a,k.c,k.b,k.d,k.tx,k.ty)}if(p.smoothProperty&&p.scaleMode!==this.texture.baseTexture.scaleMode){p.scaleMode=this.texture.baseTexture.scaleMode;f[p.smoothProperty]=(p.scaleMode===e.scaleModes.LINEAR)}if(this.tint!==16777215){if(this.cachedTint!==this.tint){if(!o.baseTexture.hasLoaded){return}this.cachedTint=this.tint;this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)}f.drawImage(this.tintedTexture,0,0,h.width,h.height,(this.anchor.x)*-h.width,(this.anchor.y)*-h.height,h.width,h.height)}else{if(o.trim){var l=o.trim;f.drawImage(this.texture.baseTexture.source,h.x,h.y,h.width,h.height,l.x-this.anchor.x*l.width,l.y-this.anchor.y*l.height,h.width,h.height)}else{f.drawImage(this.texture.baseTexture.source,h.x,h.y,h.width,h.height,(this.anchor.x)*-h.width,(this.anchor.y)*-h.height,h.width,h.height)}}}for(var n=0,m=this.children.length;n<m;n++){var g=this.children[n];g._renderCanvas(p)}if(this._mask){p.maskManager.popMask(p.context)}};e.Sprite.fromFrame=function(g){var f=e.TextureCache[g];if(!f){throw new Error('The frameId "'+g+'" does not exist in the texture cache'+this)}return new e.Sprite(f)};e.Sprite.fromImage=function(g,f,h){var i=e.Texture.fromImage(g,f,h);return new e.Sprite(i)};e.SpriteBatch=function(f){e.DisplayObjectContainer.call(this);this.textureThing=f;this.ready=false};e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype);e.SpriteBatch.constructor=e.SpriteBatch;e.SpriteBatch.prototype.initWebGL=function(f){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(f);this.ready=true};e.SpriteBatch.prototype.updateTransform=function(){e.DisplayObject.prototype.updateTransform.call(this)};e.SpriteBatch.prototype._renderWebGL=function(f){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.initWebGL(f.gl)}f.spriteBatch.stop();f.shaderManager.activateShader(f.shaderManager.fastShader);this.fastSpriteBatch.begin(this,f);this.fastSpriteBatch.render(this);f.shaderManager.activateShader(f.shaderManager.defaultShader);f.spriteBatch.start()};e.SpriteBatch.prototype._renderCanvas=function(o){var f=o.context;f.globalAlpha=this.worldAlpha;e.DisplayObject.prototype.updateTransform.call(this);var j=this.worldTransform;var n=true;for(var k=0;k<this.children.length;k++){var g=this.children[k];if(!g.visible){continue}var m=g.texture;var h=m.frame;f.globalAlpha=this.worldAlpha*g.alpha;if(g.rotation%(Math.PI*2)===0){if(n){f.setTransform(j.a,j.c,j.b,j.d,j.tx,j.ty);n=false}f.drawImage(m.baseTexture.source,h.x,h.y,h.width,h.height,((g.anchor.x)*(-h.width*g.scale.x)+g.position.x+0.5)|0,((g.anchor.y)*(-h.height*g.scale.y)+g.position.y+0.5)|0,h.width*g.scale.x,h.height*g.scale.y)}else{if(!n){n=true}e.DisplayObject.prototype.updateTransform.call(g);var l=g.worldTransform;if(o.roundPixels){f.setTransform(l.a,l.c,l.b,l.d,l.tx|0,l.ty|0)}else{f.setTransform(l.a,l.c,l.b,l.d,l.tx,l.ty)}f.drawImage(m.baseTexture.source,h.x,h.y,h.width,h.height,((g.anchor.x)*(-h.width)+0.5)|0,((g.anchor.y)*(-h.height)+0.5)|0,h.width,h.height)}}};e.AbstractFilter=function(g,f){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=f||{};this.fragmentSrc=g||[]};e.FilterBlock=function(){this.visible=true;this.renderable=true};e.Text=function(g,f){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");e.Sprite.call(this,e.Texture.fromCanvas(this.canvas));this.setText(g);this.setStyle(f);this.updateText();this.dirty=false};e.Text.prototype=Object.create(e.Sprite.prototype);e.Text.prototype.constructor=e.Text;e.Text.prototype.setStyle=function(f){f=f||{};f.font=f.font||"bold 20pt Arial";f.fill=f.fill||"black";f.align=f.align||"left";f.stroke=f.stroke||"black";f.strokeThickness=f.strokeThickness||0;f.wordWrap=f.wordWrap||false;f.wordWrapWidth=f.wordWrapWidth||100;f.wordWrapWidth=f.wordWrapWidth||100;f.dropShadow=f.dropShadow||false;f.dropShadowAngle=f.dropShadowAngle||Math.PI/6;f.dropShadowDistance=f.dropShadowDistance||4;f.dropShadowColor=f.dropShadowColor||"black";this.style=f;this.dirty=true};e.Text.prototype.setText=function(f){this.text=f.toString()||" ";this.dirty=true};e.Text.prototype.updateText=function(){this.context.font=this.style.font;var l=this.text;if(this.style.wordWrap){l=this.wordWrap(this.text)}var r=l.split(/(?:\r\n|\r|\n)/);var k=[];var s=0;for(var m=0;m<r.length;m++){var n=this.context.measureText(r[m]).width;k[m]=n;s=Math.max(s,n)}var h=s+this.style.strokeThickness;if(this.style.dropShadow){h+=this.style.dropShadowDistance}this.canvas.width=h+this.context.lineWidth;var p=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;var q=p*r.length;if(this.style.dropShadow){q+=this.style.dropShadowDistance}this.canvas.height=q;if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var j;var g;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var o=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance;var f=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(m=0;m<r.length;m++){j=this.style.strokeThickness/2;g=this.style.strokeThickness/2+m*p;if(this.style.align==="right"){j+=s-k[m]}else{if(this.style.align==="center"){j+=(s-k[m])/2}}if(this.style.fill){this.context.fillText(r[m],j+o,g+f)}}}this.context.fillStyle=this.style.fill;for(m=0;m<r.length;m++){j=this.style.strokeThickness/2;g=this.style.strokeThickness/2+m*p;if(this.style.align==="right"){j+=s-k[m]}else{if(this.style.align==="center"){j+=(s-k[m])/2}}if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(r[m],j,g)}if(this.style.fill){this.context.fillText(r[m],j,g)}}this.updateTexture()};e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.frame.width=this.canvas.width;this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=true};e.Text.prototype._renderWebGL=function(f){if(this.requiresUpdate){this.requiresUpdate=false;e.updateWebGLTexture(this.texture.baseTexture,f.gl)}e.Sprite.prototype._renderWebGL.call(this,f)};e.Text.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=false}e.Sprite.prototype.updateTransform.call(this)};e.Text.prototype.determineFontHeight=function(j){var g=e.Text.heightCache[j];if(!g){var f=document.getElementsByTagName("body")[0];var i=document.createElement("div");var h=document.createTextNode("M");i.appendChild(h);i.setAttribute("style",j+";position:absolute;top:0;left:0");f.appendChild(i);g=i.offsetHeight;e.Text.heightCache[j]=g;f.removeChild(i)}return g};e.Text.prototype.wordWrap=function(m){var p="";var o=m.split("\n");for(var h=0;h<o.length;h++){var g=this.style.wordWrapWidth;var l=o[h].split(" ");for(var f=0;f<l.length;f++){var n=this.context.measureText(l[f]).width;var k=n+this.context.measureText(" ").width;if(f===0||k>g){if(f>0){p+="\n"}p+=l[f];g=this.style.wordWrapWidth-n}else{g-=k;p+=" "+l[f]}}if(h<o.length-1){p+="\n"}}return p};e.Text.prototype.destroy=function(f){if(f){this.texture.destroy()}};e.Text.heightCache={};e.BitmapText=function(g,f){e.DisplayObjectContainer.call(this);this._pool=[];this.setText(g);this.setStyle(f);this.updateText();this.dirty=false};e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype);e.BitmapText.prototype.constructor=e.BitmapText;e.BitmapText.prototype.setText=function(f){this.text=f||" ";this.dirty=true};e.BitmapText.prototype.setStyle=function(g){g=g||{};g.align=g.align||"left";this.style=g;var f=g.font.split(" ");this.fontName=f[f.length-1];this.fontSize=f.length>=2?parseInt(f[f.length-2],10):e.BitmapText.fonts[this.fontName].size;this.dirty=true;this.tint=g.tint};e.BitmapText.prototype.updateText=function(){var u=e.BitmapText.fonts[this.fontName];var l=new e.Point();var m=null;var p=[];var q=0;var x=[];var o=0;var v=this.fontSize/u.size;for(var s=0;s<this.text.length;s++){var g=this.text.charCodeAt(s);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(s))){x.push(l.x);q=Math.max(q,l.x);o++;l.x=0;l.y+=u.lineHeight;m=null;continue}var f=u.chars[g];if(!f){continue}if(m&&f[m]){l.x+=f.kerning[m]}p.push({texture:f.texture,line:o,charCode:g,position:new e.Point(l.x+f.xOffset,l.y+f.yOffset)});l.x+=f.xAdvance;m=g}x.push(l.x);q=Math.max(q,l.x);var r=[];for(s=0;s<=o;s++){var w=0;if(this.style.align==="right"){w=q-x[s]}else{if(this.style.align==="center"){w=(q-x[s])/2}}r.push(w)}var h=this.children.length;var j=p.length;var n=this.tint||16777215;for(s=0;s<j;s++){var t=s<h?this.children[s]:this._pool.pop();if(t){t.setTexture(p[s].texture)}else{t=new e.Sprite(p[s].texture)}t.position.x=(p[s].position.x+r[p[s].line])*v;t.position.y=p[s].position.y*v;t.scale.x=t.scale.y=v;t.tint=n;if(!t.parent){this.addChild(t)}}while(this.children.length>j){var k=this.getChildAt(this.children.length-1);this._pool.push(k);this.removeChild(k)}this.textWidth=q*v;this.textHeight=(l.y+u.lineHeight)*v};e.BitmapText.prototype.updateTransform=function(){if(this.dirty){this.updateText();this.dirty=false}e.DisplayObjectContainer.prototype.updateTransform.call(this)};e.BitmapText.fonts={};e.Stage=function(f){e.DisplayObjectContainer.call(this);this.worldTransform=new e.Matrix();this.interactive=true;this.interactionManager=new e.InteractionManager(this);this.dirty=true;this.stage=this;this.stage.hitArea=new e.Rectangle(0,0,100000,100000);this.setBackgroundColor(f)};e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Stage.prototype.constructor=e.Stage;e.Stage.prototype.setInteractionDelegate=function(f){this.interactionManager.setTargetDomElement(f)};e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var g=0,f=this.children.length;g<f;g++){this.children[g].updateTransform()}if(this.dirty){this.dirty=false;this.interactionManager.dirty=true}if(this.interactive){this.interactionManager.update()}};e.Stage.prototype.setBackgroundColor=function(f){this.backgroundColor=f||0;this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var g=this.backgroundColor.toString(16);g="000000".substr(0,6-g.length)+g;this.backgroundColorString="#"+g};e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};var c=0;var d=["ms","moz","webkit","o"];for(var a=0;a<d.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[d[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[d[a]+"CancelAnimationFrame"]||window[d[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(i){var f=new Date().getTime();var g=Math.max(0,16-(f-c));var h=window.setTimeout(function(){i(f+g)},g);c=f+g;return h}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(f){clearTimeout(f)}}window.requestAnimFrame=window.requestAnimationFrame;e.hex2rgb=function(f){return[(f>>16&255)/255,(f>>8&255)/255,(f&255)/255]};e.rgb2hex=function(f){return((f[0]*255<<16)+(f[1]*255<<8)+f[2]*255)};if(typeof Function.prototype.bind!=="function"){Function.prototype.bind=(function(){var f=Array.prototype.slice;return function(g){var j=this,k=f.call(arguments,1);if(typeof j!=="function"){throw new TypeError()}function h(){var l=k.concat(f.call(arguments));j.apply(this instanceof h?this:g,l)}h.prototype=(function i(l){if(l){i.prototype=l}if(!(this instanceof i)){return new i()}})(j.prototype);return h}})()}e.AjaxRequest=function(){var f=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(window.ActiveXObject){for(var g=0;g<f.length;g++){try{return new window.ActiveXObject(f[g])}catch(h){}}}else{if(window.XMLHttpRequest){return new window.XMLHttpRequest()}else{return false}}};e.canUseNewCanvasBlendModes=function(){var f=document.createElement("canvas");f.width=1;f.height=1;var g=f.getContext("2d");g.fillStyle="#000";g.fillRect(0,0,1,1);g.globalCompositeOperation="multiply";g.fillStyle="#fff";g.fillRect(0,0,1,1);return g.getImageData(0,0,1,1).data[0]===0};e.getNextPowerOfTwo=function(g){if(g>0&&(g&(g-1))===0){return g}else{var f=1;while(f<g){f<<=1}return f}};e.EventTarget=function(){var f={};this.addEventListener=this.on=function(g,h){if(f[g]===undefined){f[g]=[]}if(f[g].indexOf(h)===-1){f[g].push(h)}};this.dispatchEvent=this.emit=function(j){if(!f[j.type]||!f[j.type].length){return}for(var h=0,g=f[j.type].length;h<g;h++){f[j.type][h](j)}};this.removeEventListener=this.off=function(h,i){var g=f[h].indexOf(i);if(g!==-1){f[h].splice(g,1)}};this.removeAllEventListeners=function(h){var g=f[h];if(g){g.length=0}}};e.PolyK={};e.PolyK.Triangulate=function(o){var B=true;var q=o.length>>1;if(q<3){return[]}var y=[];var m=[];for(var w=0;w<q;w++){m.push(w)}w=0;var t=q;while(t>3){var u=m[(w+0)%t];var s=m[(w+1)%t];var r=m[(w+2)%t];var l=o[2*u],h=o[2*u+1];var z=o[2*s],x=o[2*s+1];var g=o[2*r],f=o[2*r+1];var k=false;if(e.PolyK._convex(l,h,z,x,g,f,B)){k=true;for(var v=0;v<t;v++){var A=m[v];if(A===u||A===s||A===r){continue}if(e.PolyK._PointInTriangle(o[2*A],o[2*A+1],l,h,z,x,g,f)){k=false;break}}}if(k){y.push(u,s,r);m.splice((w+1)%t,1);t--;w=0}else{if(w++>3*t){if(B){y=[];m=[];for(w=0;w<q;w++){m.push(w)}w=0;t=q;B=false}else{window.console.log("PIXI Warning: shape too complex to fill");return[]}}}}y.push(m[0],m[1],m[2]);return y};e.PolyK._PointInTriangle=function(t,s,p,o,C,B,l,j){var i=l-p;var h=j-o;var n=C-p;var m=B-o;var A=t-p;var y=s-o;var z=i*i+h*h;var x=i*n+h*m;var w=i*A+h*y;var g=n*n+m*m;var f=n*A+m*y;var k=1/(z*g-x*x);var r=(g*w-x*f)*k;var q=(z*f-x*w)*k;return(r>=0)&&(q>=0)&&(r+q<1)};e.PolyK._convex=function(i,h,k,j,f,l,g){return((h-j)*(f-k)+(k-i)*(l-j)>=0)===g};e.initDefaultShaders=function(){};e.CompileVertexShader=function(g,f){return e._CompileShader(g,f,g.VERTEX_SHADER)};e.CompileFragmentShader=function(g,f){return e._CompileShader(g,f,g.FRAGMENT_SHADER)};e._CompileShader=function(j,i,h){var g=i.join("\n");var f=j.createShader(h);j.shaderSource(f,g);j.compileShader(f);if(!j.getShaderParameter(f,j.COMPILE_STATUS)){window.console.log(j.getShaderInfoLog(f));return null}return f};e.compileProgram=function(j,f,h){var g=e.CompileFragmentShader(j,h);var i=e.CompileVertexShader(j,f);var k=j.createProgram();j.attachShader(k,i);j.attachShader(k,g);j.linkProgram(k);if(!j.getProgramParameter(k,j.LINK_STATUS)){window.console.log("Could not initialise shaders")}return k};e.PixiShader=function(f){this.gl=f;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};e.PixiShader.prototype.init=function(){var h=this.gl;var f=e.compileProgram(h,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);h.useProgram(f);this.uSampler=h.getUniformLocation(f,"uSampler");this.projectionVector=h.getUniformLocation(f,"projectionVector");this.offsetVector=h.getUniformLocation(f,"offsetVector");this.dimensions=h.getUniformLocation(f,"dimensions");this.aVertexPosition=h.getAttribLocation(f,"aVertexPosition");this.aTextureCoord=h.getAttribLocation(f,"aTextureCoord");this.colorAttribute=h.getAttribLocation(f,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var g in this.uniforms){this.uniforms[g].uniformLocation=h.getUniformLocation(f,g)}this.initUniforms();this.program=f};e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var i=this.gl;var f;for(var g in this.uniforms){f=this.uniforms[g];var h=f.type;if(h==="sampler2D"){f._init=false;if(f.value!==null){this.initSampler2D(f)}}else{if(h==="mat2"||h==="mat3"||h==="mat4"){f.glMatrix=true;f.glValueLength=1;if(h==="mat2"){f.glFunc=i.uniformMatrix2fv}else{if(h==="mat3"){f.glFunc=i.uniformMatrix3fv}else{if(h==="mat4"){f.glFunc=i.uniformMatrix4fv}}}}else{f.glFunc=i["uniform"+h];if(h==="2f"||h==="2i"){f.glValueLength=2}else{if(h==="3f"||h==="3i"){f.glValueLength=3}else{if(h==="4f"||h==="4i"){f.glValueLength=4}else{f.glValueLength=1}}}}}}};e.PixiShader.prototype.initSampler2D=function(h){if(!h.value||!h.value.baseTexture||!h.value.baseTexture.hasLoaded){return}var m=this.gl;m.activeTexture(m["TEXTURE"+this.textureCount]);m.bindTexture(m.TEXTURE_2D,h.value.baseTexture._glTextures[m.id]);if(h.textureData){var k=h.textureData;var o=(k.magFilter)?k.magFilter:m.LINEAR;var g=(k.minFilter)?k.minFilter:m.LINEAR;var l=(k.wrapS)?k.wrapS:m.CLAMP_TO_EDGE;var j=(k.wrapT)?k.wrapT:m.CLAMP_TO_EDGE;var n=(k.luminance)?m.LUMINANCE:m.RGBA;if(k.repeat){l=m.REPEAT;j=m.REPEAT}m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,!!k.flipY);if(k.width){var f=(k.width)?k.width:512;var p=(k.height)?k.height:2;var i=(k.border)?k.border:0;m.texImage2D(m.TEXTURE_2D,0,n,f,p,i,n,m.UNSIGNED_BYTE,null)}else{m.texImage2D(m.TEXTURE_2D,0,n,m.RGBA,m.UNSIGNED_BYTE,h.value.baseTexture.source)}m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,g);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,j)}m.uniform1i(h.uniformLocation,this.textureCount);h._init=true;this.textureCount++};e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var f;var h=this.gl;for(var g in this.uniforms){f=this.uniforms[g];if(f.glValueLength===1){if(f.glMatrix===true){f.glFunc.call(h,f.uniformLocation,f.transpose,f.value)}else{f.glFunc.call(h,f.uniformLocation,f.value)}}else{if(f.glValueLength===2){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y)}else{if(f.glValueLength===3){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z)}else{if(f.glValueLength===4){f.glFunc.call(h,f.uniformLocation,f.value.x,f.value.y,f.value.z,f.value.w)}else{if(f.type==="sampler2D"){if(f._init){h.activeTexture(h["TEXTURE"+this.textureCount]);h.bindTexture(h.TEXTURE_2D,f.value.baseTexture._glTextures[h.id]||e.createWebGLTexture(f.value.baseTexture,h));h.uniform1i(f.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(f)}}}}}}}};e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"];e.PixiFastShader=function(f){this.gl=f;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};e.PixiFastShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.uSampler=g.getUniformLocation(f,"uSampler");this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.dimensions=g.getUniformLocation(f,"dimensions");this.uMatrix=g.getUniformLocation(f,"uMatrix");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.aPositionCoord=g.getAttribLocation(f,"aPositionCoord");this.aScale=g.getAttribLocation(f,"aScale");this.aRotation=g.getAttribLocation(f,"aRotation");this.aTextureCoord=g.getAttribLocation(f,"aTextureCoord");this.colorAttribute=g.getAttribLocation(f,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=f};e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};e.StripShader=function(){this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","uniform vec2 offsetVector;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]};e.StripShader.prototype.init=function(){var g=e.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.uSampler=g.getUniformLocation(f,"uSampler");this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.colorAttribute=g.getAttribLocation(f,"aColor");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.aTextureCoord=g.getAttribLocation(f,"aTextureCoord");this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.PrimitiveShader=function(f){this.gl=f;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};e.PrimitiveShader.prototype.init=function(){var g=this.gl;var f=e.compileProgram(g,this.vertexSrc,this.fragmentSrc);g.useProgram(f);this.projectionVector=g.getUniformLocation(f,"projectionVector");this.offsetVector=g.getUniformLocation(f,"offsetVector");this.tintColor=g.getUniformLocation(f,"tint");this.aVertexPosition=g.getAttribLocation(f,"aVertexPosition");this.colorAttribute=g.getAttribLocation(f,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=g.getUniformLocation(f,"translationMatrix");this.alpha=g.getUniformLocation(f,"alpha");this.program=f};e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};e.WebGLGraphics=function(){};e.WebGLGraphics.renderGraphics=function(g,j){var l=j.gl;var f=j.projection,k=j.offset,h=j.shaderManager.primitiveShader;if(!g._webGL[l.id]){g._webGL[l.id]={points:[],indices:[],lastIndex:0,buffer:l.createBuffer(),indexBuffer:l.createBuffer()}}var i=g._webGL[l.id];if(g.dirty){g.dirty=false;if(g.clearDirty){g.clearDirty=false;i.lastIndex=0;i.points=[];i.indices=[]}e.WebGLGraphics.updateGraphics(g,l)}j.shaderManager.activatePrimitiveShader();l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA);l.uniformMatrix3fv(h.translationMatrix,false,g.worldTransform.toArray(true));l.uniform2f(h.projectionVector,f.x,-f.y);l.uniform2f(h.offsetVector,-k.x,-k.y);l.uniform3fv(h.tintColor,e.hex2rgb(g.tint));l.uniform1f(h.alpha,g.worldAlpha);l.bindBuffer(l.ARRAY_BUFFER,i.buffer);l.vertexAttribPointer(h.aVertexPosition,2,l.FLOAT,false,4*6,0);l.vertexAttribPointer(h.colorAttribute,4,l.FLOAT,false,4*6,2*4);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i.indexBuffer);l.drawElements(l.TRIANGLE_STRIP,i.indices.length,l.UNSIGNED_SHORT,0);j.shaderManager.deactivatePrimitiveShader()};e.WebGLGraphics.updateGraphics=function(f,k){var j=f._webGL[k.id];for(var g=j.lastIndex;g<f.graphicsData.length;g++){var h=f.graphicsData[g];if(h.type===e.Graphics.POLY){if(h.fill){if(h.points.length>3){e.WebGLGraphics.buildPoly(h,j)}}if(h.lineWidth>0){e.WebGLGraphics.buildLine(h,j)}}else{if(h.type===e.Graphics.RECT){e.WebGLGraphics.buildRectangle(h,j)}else{if(h.type===e.Graphics.CIRC||h.type===e.Graphics.ELIP){e.WebGLGraphics.buildCircle(h,j)}}}}j.lastIndex=f.graphicsData.length;j.glPoints=new Float32Array(j.points);k.bindBuffer(k.ARRAY_BUFFER,j.buffer);k.bufferData(k.ARRAY_BUFFER,j.glPoints,k.STATIC_DRAW);j.glIndicies=new Uint16Array(j.indices);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,j.indexBuffer);k.bufferData(k.ELEMENT_ARRAY_BUFFER,j.glIndicies,k.STATIC_DRAW)};e.WebGLGraphics.buildRectangle=function(w,l){var j=w.points;var s=j[0];var q=j[1];var h=j[2];var v=j[3];if(w.fill){var k=e.hex2rgb(w.fillColor);var i=w.fillAlpha;var f=k[0]*i;var m=k[1]*i;var p=k[2]*i;var t=l.points;var u=l.indices;var o=t.length/6;t.push(s,q);t.push(f,m,p,i);t.push(s+h,q);t.push(f,m,p,i);t.push(s,q+v);t.push(f,m,p,i);t.push(s+h,q+v);t.push(f,m,p,i);u.push(o,o,o+1,o+2,o+3,o+3)}if(w.lineWidth){var n=w.points;w.points=[s,q,s+h,q,s+h,q+v,s,q+v,s,q];e.WebGLGraphics.buildLine(w,l);w.points=n}};e.WebGLGraphics.buildCircle=function(o,C){var k=o.points;var n=k[0];var m=k[1];var t=k[2];var s=k[3];var p=40;var z=(Math.PI*2)/p;var v=0;if(o.fill){var u=e.hex2rgb(o.fillColor);var h=o.fillAlpha;var q=u[0]*h;var w=u[1]*h;var A=u[2]*h;var B=C.points;var j=C.indices;var f=B.length/6;j.push(f);for(v=0;v<p+1;v++){B.push(n,m,q,w,A,h);B.push(n+Math.sin(z*v)*t,m+Math.cos(z*v)*s,q,w,A,h);j.push(f++,f++)}j.push(f-1)}if(o.lineWidth){var l=o.points;o.points=[];for(v=0;v<p+1;v++){o.points.push(n+Math.sin(z*v)*t,m+Math.cos(z*v)*s)}e.WebGLGraphics.buildLine(o,C);o.points=l}};e.WebGLGraphics.buildLine=function(V,F){var R=0;var I=V.points;if(I.length===0){return}if(V.lineWidth%2){for(R=0;R<I.length;R++){I[R]+=0.5}}var w=new e.Point(I[0],I[1]);var o=new e.Point(I[I.length-2],I[I.length-1]);if(w.x===o.x&&w.y===o.y){I.pop();I.pop();o=new e.Point(I[I.length-2],I[I.length-1]);var y=o.x+(w.x-o.x)*0.5;var v=o.y+(w.y-o.y)*0.5;I.unshift(y,v);I.push(y,v)}var S=F.points;var m=F.indices;var x=I.length/2;var u=I.length;var U=S.length/6;var f=V.lineWidth/2;var H=e.hex2rgb(V.lineColor);var Q=V.lineAlpha;var N=H[0]*Q;var T=H[1]*Q;var W=H[2]*Q;var t,s,K,J,C,B,l,k;var M,L,A,z,j,h;var P,G,q,O,E,p;var X,D,n;K=I[0];J=I[1];C=I[2];B=I[3];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;S.push(K-M,J-L,N,T,W,Q);S.push(K+M,J+L,N,T,W,Q);for(R=1;R<x-1;R++){K=I[(R-1)*2];J=I[(R-1)*2+1];C=I[(R)*2];B=I[(R)*2+1];l=I[(R+1)*2];k=I[(R+1)*2+1];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;A=-(B-k);z=C-l;n=Math.sqrt(A*A+z*z);A/=n;z/=n;A*=f;z*=f;P=(-L+J)-(-L+B);G=(-M+C)-(-M+K);q=(-M+K)*(-L+B)-(-M+C)*(-L+J);O=(-z+k)-(-z+B);E=(-A+C)-(-A+l);p=(-A+l)*(-z+B)-(-A+C)*(-z+k);X=P*E-O*G;if(Math.abs(X)<0.1){X+=10.1;S.push(C-M,B-L,N,T,W,Q);S.push(C+M,B+L,N,T,W,Q);continue}t=(G*p-E*q)/X;s=(O*q-P*p)/X;D=(t-C)*(t-C)+(s-B)+(s-B);if(D>140*140){j=M-A;h=L-z;n=Math.sqrt(j*j+h*h);j/=n;h/=n;j*=f;h*=f;S.push(C-j,B-h);S.push(N,T,W,Q);S.push(C+j,B+h);S.push(N,T,W,Q);S.push(C-j,B-h);S.push(N,T,W,Q);u++}else{S.push(t,s);S.push(N,T,W,Q);S.push(C-(t-C),B-(s-B));S.push(N,T,W,Q)}}K=I[(x-2)*2];J=I[(x-2)*2+1];C=I[(x-1)*2];B=I[(x-1)*2+1];M=-(J-B);L=K-C;n=Math.sqrt(M*M+L*L);M/=n;L/=n;M*=f;L*=f;S.push(C-M,B-L);S.push(N,T,W,Q);S.push(C+M,B+L);S.push(N,T,W,Q);m.push(U);for(R=0;R<u;R++){m.push(U++)}m.push(U-1)};e.WebGLGraphics.buildPoly=function(v,n){var t=v.points;if(t.length<6){return}var s=n.points;var u=n.indices;var h=t.length/2;var l=e.hex2rgb(v.fillColor);var k=v.fillAlpha;var f=l[0]*k;var o=l[1]*k;var q=l[2]*k;var j=e.PolyK.Triangulate(t);var p=s.length/6;var m=0;for(m=0;m<j.length;m+=3){u.push(j[m]+p);u.push(j[m]+p);u.push(j[m+1]+p);u.push(j[m+2]+p);u.push(j[m+2]+p)}for(m=0;m<h;m++){s.push(t[m*2],t[m*2+1],f,o,q,k)}};e.glContexts=[];e.WebGLRenderer=function(i,f,h,m,g){if(!e.defaultRenderer){e.defaultRenderer=this}this.type=e.WEBGL_RENDERER;this.transparent=!!m;this.width=i||800;this.height=f||600;this.view=h||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,false);this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,false);this.options={alpha:this.transparent,antialias:!!g,premultipliedAlpha:!!m,stencil:true};try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(k){try{this.gl=this.view.getContext("webgl",this.options)}catch(j){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var l=this.gl;this.glContextId=l.id=e.WebGLRenderer.glContextId++;e.glContexts[this.glContextId]=l;if(!e.blendModesWebGL){e.blendModesWebGL=[];e.blendModesWebGL[e.blendModes.NORMAL]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.ADD]=[l.SRC_ALPHA,l.DST_ALPHA];e.blendModesWebGL[e.blendModes.MULTIPLY]=[l.DST_COLOR,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SCREEN]=[l.SRC_ALPHA,l.ONE];e.blendModesWebGL[e.blendModes.OVERLAY]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DARKEN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LIGHTEN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR_BURN]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.DIFFERENCE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.EXCLUSION]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.HUE]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.SATURATION]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.COLOR]=[l.ONE,l.ONE_MINUS_SRC_ALPHA];e.blendModesWebGL[e.blendModes.LUMINOSITY]=[l.ONE,l.ONE_MINUS_SRC_ALPHA]}this.projection=new e.Point();this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new e.Point(0,0);this.resize(this.width,this.height);this.contextLost=false;this.shaderManager=new e.WebGLShaderManager(l);this.spriteBatch=new e.WebGLSpriteBatch(l);this.maskManager=new e.WebGLMaskManager(l);this.filterManager=new e.WebGLFilterManager(l,this.transparent);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.renderer=this;l.useProgram(this.shaderManager.defaultShader.program);l.disable(l.DEPTH_TEST);l.disable(l.CULL_FACE);l.enable(l.BLEND);l.colorMask(true,true,true,this.transparent)};e.WebGLRenderer.prototype.constructor=e.WebGLRenderer;e.WebGLRenderer.prototype.render=function(f){if(this.contextLost){return}if(this.__stage!==f){if(f.interactive){f.interactionManager.removeEvents()}this.__stage=f}e.WebGLRenderer.updateTextures();f.updateTransform();if(f._interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}var g=this.gl;g.viewport(0,0,this.width,this.height);g.bindFramebuffer(g.FRAMEBUFFER,null);if(this.transparent){g.clearColor(0,0,0,0)}else{g.clearColor(f.backgroundColorSplit[0],f.backgroundColorSplit[1],f.backgroundColorSplit[2],1)}g.clear(g.COLOR_BUFFER_BIT);this.renderDisplayObject(f,this.projection);if(f.interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}else{if(f._interactiveEventsAdded){f._interactiveEventsAdded=false;f.interactionManager.setTarget(this)}}};e.WebGLRenderer.prototype.renderDisplayObject=function(h,f,g){this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=f;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,g);h._renderWebGL(this.renderSession);this.spriteBatch.end()};e.WebGLRenderer.updateTextures=function(){var f=0;for(f=0;f<e.Texture.frameUpdates.length;f++){e.WebGLRenderer.updateTextureFrame(e.Texture.frameUpdates[f])}for(f=0;f<e.texturesToDestroy.length;f++){e.WebGLRenderer.destroyTexture(e.texturesToDestroy[f])}e.texturesToUpdate.length=0;e.texturesToDestroy.length=0;e.Texture.frameUpdates.length=0};e.WebGLRenderer.destroyTexture=function(h){for(var g=h._glTextures.length-1;g>=0;g--){var f=h._glTextures[g];var j=e.glContexts[g];if(j&&f){j.deleteTexture(f)}}h._glTextures.length=0};e.WebGLRenderer.updateTextureFrame=function(f){f.updateFrame=false;f._updateWebGLuvs()};e.WebGLRenderer.prototype.resize=function(g,f){this.width=g;this.height=f;this.view.width=g;this.view.height=f;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};e.createWebGLTexture=function(f,g){if(f.hasLoaded){f._glTextures[g.id]=g.createTexture();g.bindTexture(g.TEXTURE_2D,f._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);if(!f._powerOf2){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)}g.bindTexture(g.TEXTURE_2D,null)}return f._glTextures[g.id]};e.updateWebGLTexture=function(f,g){if(f._glTextures[g.id]){g.bindTexture(g.TEXTURE_2D,f._glTextures[g.id]);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f.source);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f.scaleMode===e.scaleModes.LINEAR?g.LINEAR:g.NEAREST);if(!f._powerOf2){g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)}else{g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT)}g.bindTexture(g.TEXTURE_2D,null)}};e.WebGLRenderer.prototype.handleContextLost=function(f){f.preventDefault();this.contextLost=true};e.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(i){try{this.gl=this.view.getContext("webgl",this.options)}catch(h){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var j=this.gl;j.id=e.WebGLRenderer.glContextId++;this.shaderManager.setContext(j);this.spriteBatch.setContext(j);this.maskManager.setContext(j);this.filterManager.setContext(j);this.renderSession.gl=this.gl;j.disable(j.DEPTH_TEST);j.disable(j.CULL_FACE);j.enable(j.BLEND);j.colorMask(true,true,true,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(var f in e.TextureCache){var g=e.TextureCache[f].baseTexture;g._glTextures=[]}this.contextLost=false};e.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);e.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};e.WebGLRenderer.glContextId=0;e.WebGLMaskManager=function(f){this.maskStack=[];this.maskPosition=0;this.setContext(f)};e.WebGLMaskManager.prototype.setContext=function(f){this.gl=f};e.WebGLMaskManager.prototype.pushMask=function(g,f){var h=this.gl;if(this.maskStack.length===0){h.enable(h.STENCIL_TEST);h.stencilFunc(h.ALWAYS,1,1)}this.maskStack.push(g);h.colorMask(false,false,false,false);h.stencilOp(h.KEEP,h.KEEP,h.INCR);e.WebGLGraphics.renderGraphics(g,f);h.colorMask(true,true,true,true);h.stencilFunc(h.NOTEQUAL,0,this.maskStack.length);h.stencilOp(h.KEEP,h.KEEP,h.KEEP)};e.WebGLMaskManager.prototype.popMask=function(f){var h=this.gl;var g=this.maskStack.pop();if(g){h.colorMask(false,false,false,false);h.stencilOp(h.KEEP,h.KEEP,h.DECR);e.WebGLGraphics.renderGraphics(g,f);h.colorMask(true,true,true,true);h.stencilFunc(h.NOTEQUAL,0,this.maskStack.length);h.stencilOp(h.KEEP,h.KEEP,h.KEEP)}if(this.maskStack.length===0){h.disable(h.STENCIL_TEST)}};e.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null;this.gl=null};e.WebGLShaderManager=function(g){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var f=0;f<this.maxAttibs;f++){this.attribState[f]=false}this.setContext(g)};e.WebGLShaderManager.prototype.setContext=function(f){this.gl=f;this.primitiveShader=new e.PrimitiveShader(f);this.defaultShader=new e.PixiShader(f);this.fastShader=new e.PixiFastShader(f);this.activateShader(this.defaultShader)};e.WebGLShaderManager.prototype.setAttribs=function(j){var g;for(g=0;g<this.tempAttribState.length;g++){this.tempAttribState[g]=false}for(g=0;g<j.length;g++){var f=j[g];this.tempAttribState[f]=true}var h=this.gl;for(g=0;g<this.attribState.length;g++){if(this.attribState[g]!==this.tempAttribState[g]){this.attribState[g]=this.tempAttribState[g];if(this.tempAttribState[g]){h.enableVertexAttribArray(g)}else{h.disableVertexAttribArray(g)}}}};e.WebGLShaderManager.prototype.activateShader=function(f){this.currentShader=f;this.gl.useProgram(f.program);this.setAttribs(f.attributes)};e.WebGLShaderManager.prototype.activatePrimitiveShader=function(){var f=this.gl;f.useProgram(this.primitiveShader.program);this.setAttribs(this.primitiveShader.attributes)};e.WebGLShaderManager.prototype.deactivatePrimitiveShader=function(){var f=this.gl;f.useProgram(this.defaultShader.program);this.setAttribs(this.defaultShader.attributes)};e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.gl=null};e.WebGLSpriteBatch=function(l){this.vertSize=6;this.size=2000;var f=this.size*4*this.vertSize;var k=this.size*6;this.vertices=new Float32Array(f);this.indices=new Uint16Array(k);this.lastIndexCount=0;for(var h=0,g=0;h<k;h+=6,g+=4){this.indices[h+0]=g+0;this.indices[h+1]=g+1;this.indices[h+2]=g+2;this.indices[h+3]=g+0;this.indices[h+4]=g+2;this.indices[h+5]=g+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(l)};e.WebGLSpriteBatch.prototype.setContext=function(f){this.gl=f;this.vertexBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indices,f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertices,f.DYNAMIC_DRAW);this.currentBlendMode=99999};e.WebGLSpriteBatch.prototype.begin=function(f){this.renderSession=f;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};e.WebGLSpriteBatch.prototype.end=function(){this.flush()};e.WebGLSpriteBatch.prototype.render=function(r){var q=r.texture;if(q.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=q.baseTexture}if(r.blendMode!==this.currentBlendMode){this.setBlendMode(r.blendMode)}var n=r._uvs||r.texture._uvs;if(!n){return}var i=r.worldAlpha;var k=r.tint;var g=this.vertices;var h=r.anchor.x;var f=r.anchor.y;var p,o,m,l;if(r.texture.trim){var t=r.texture.trim;o=t.x-h*t.width;p=o+q.frame.width;l=t.y-f*t.height;m=l+q.frame.height}else{p=(q.frame.width)*(1-h);o=(q.frame.width)*-h;m=q.frame.height*(1-f);l=q.frame.height*-f}var j=this.currentBatchSize*4*this.vertSize;var s=r.worldTransform;var z=s.a;var x=s.c;var v=s.b;var u=s.d;var y=s.tx;var w=s.ty;g[j++]=z*o+v*l+y;g[j++]=u*l+x*o+w;g[j++]=n.x0;g[j++]=n.y0;g[j++]=i;g[j++]=k;g[j++]=z*p+v*l+y;g[j++]=u*l+x*p+w;g[j++]=n.x1;g[j++]=n.y1;g[j++]=i;g[j++]=k;g[j++]=z*p+v*m+y;g[j++]=u*m+x*p+w;g[j++]=n.x2;g[j++]=n.y2;g[j++]=i;g[j++]=k;g[j++]=z*o+v*m+y;g[j++]=u*m+x*o+w;g[j++]=n.x3;g[j++]=n.y3;g[j++]=i;g[j++]=k;this.currentBatchSize++};e.WebGLSpriteBatch.prototype.renderTilingSprite=function(h){var r=h.tilingTexture;if(r.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=r.baseTexture}if(h.blendMode!==this.currentBlendMode){this.setBlendMode(h.blendMode)}if(!h._uvs){h._uvs=new e.TextureUvs()}var o=h._uvs;h.tilePosition.x%=r.baseTexture.width*h.tileScaleOffset.x;h.tilePosition.y%=r.baseTexture.height*h.tileScaleOffset.y;var w=h.tilePosition.x/(r.baseTexture.width*h.tileScaleOffset.x);var v=h.tilePosition.y/(r.baseTexture.height*h.tileScaleOffset.y);var C=(h.width/r.baseTexture.width)/(h.tileScale.x*h.tileScaleOffset.x);var z=(h.height/r.baseTexture.height)/(h.tileScale.y*h.tileScaleOffset.y);o.x0=0-w;o.y0=0-v;o.x1=(1*C)-w;o.y1=0-v;o.x2=(1*C)-w;o.y2=(1*z)-v;o.x3=0-w;o.y3=(1*z)-v;var j=h.worldAlpha;var l=h.tint;var g=this.vertices;var t=h.width;var s=h.height;var i=h.anchor.x;var f=h.anchor.y;var q=t*(1-i);var p=t*-i;var n=s*(1-f);var m=s*-f;var k=this.currentBatchSize*4*this.vertSize;var u=h.worldTransform;var E=u.a;var B=u.c;var y=u.b;var x=u.d;var D=u.tx;var A=u.ty;g[k++]=E*p+y*m+D;g[k++]=x*m+B*p+A;g[k++]=o.x0;g[k++]=o.y0;g[k++]=j;g[k++]=l;g[k++]=E*q+y*m+D;g[k++]=x*m+B*q+A;g[k++]=o.x1;g[k++]=o.y1;g[k++]=j;g[k++]=l;g[k++]=E*q+y*n+D;g[k++]=x*n+B*q+A;g[k++]=o.x2;g[k++]=o.y2;g[k++]=j;g[k++]=l;g[k++]=E*p+y*n+D;g[k++]=x*n+B*p+A;g[k++]=o.x3;g[k++]=o.y3;g[k++]=j;g[k++]=l;this.currentBatchSize++};e.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var g=this.gl;g.bindTexture(g.TEXTURE_2D,this.currentBaseTexture._glTextures[g.id]||e.createWebGLTexture(this.currentBaseTexture,g));if(this.currentBatchSize>(this.size*0.5)){g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices)}else{var f=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);g.bufferSubData(g.ARRAY_BUFFER,0,f)}g.drawElements(g.TRIANGLES,this.currentBatchSize*6,g.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};e.WebGLSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLSpriteBatch.prototype.start=function(){var h=this.gl;h.activeTexture(h.TEXTURE0);h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=this.renderSession.projection;h.uniform2f(this.shader.projectionVector,f.x,f.y);var g=this.vertSize*4;h.vertexAttribPointer(this.shader.aVertexPosition,2,h.FLOAT,false,g,0);h.vertexAttribPointer(this.shader.aTextureCoord,2,h.FLOAT,false,g,2*4);h.vertexAttribPointer(this.shader.colorAttribute,2,h.FLOAT,false,g,4*4);if(this.currentBlendMode!==e.blendModes.NORMAL){this.setBlendMode(e.blendModes.NORMAL)}};e.WebGLSpriteBatch.prototype.setBlendMode=function(f){this.flush();this.currentBlendMode=f;var g=e.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(g[0],g[1])};e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};e.WebGLFastSpriteBatch=function(l){this.vertSize=10;this.maxSize=6000;this.size=this.maxSize;var f=this.size*4*this.vertSize;var k=this.maxSize*6;this.vertices=new Float32Array(f);this.indices=new Uint16Array(k);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var h=0,g=0;h<k;h+=6,g+=4){this.indices[h+0]=g+0;this.indices[h+1]=g+1;this.indices[h+2]=g+2;this.indices[h+3]=g+0;this.indices[h+4]=g+2;this.indices[h+5]=g+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(l)};e.WebGLFastSpriteBatch.prototype.setContext=function(f){this.gl=f;this.vertexBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indices,f.STATIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertices,f.DYNAMIC_DRAW);this.currentBlendMode=99999};e.WebGLFastSpriteBatch.prototype.begin=function(f,g){this.renderSession=g;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=f.worldTransform.toArray(true);this.start()};e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.render=function(f){var l=f.children;var k=l[0];if(!k.texture._uvs){return}this.currentBaseTexture=k.texture.baseTexture;if(k.blendMode!==this.currentBlendMode){this.setBlendMode(k.blendMode)}for(var h=0,g=l.length;h<g;h++){this.renderSprite(l[h])}this.flush()};e.WebGLFastSpriteBatch.prototype.renderSprite=function(o){if(!o.visible){return}if(o.texture.baseTexture!==this.currentBaseTexture){this.flush();this.currentBaseTexture=o.texture.baseTexture;if(!o.texture._uvs){return}}var i,g=this.vertices,f,p,k,j,n,m,l;i=o.texture._uvs;f=o.texture.frame.width;p=o.texture.frame.height;if(o.texture.trim){var h=o.texture.trim;j=h.x-o.anchor.x*h.width;k=j+o.texture.frame.width;m=h.y-o.anchor.y*h.height;n=m+o.texture.frame.height}else{k=(o.texture.frame.width)*(1-o.anchor.x);j=(o.texture.frame.width)*-o.anchor.x;n=o.texture.frame.height*(1-o.anchor.y);m=o.texture.frame.height*-o.anchor.y}l=this.currentBatchSize*4*this.vertSize;g[l++]=j;g[l++]=m;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x0;g[l++]=i.y1;g[l++]=o.alpha;g[l++]=k;g[l++]=m;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x1;g[l++]=i.y1;g[l++]=o.alpha;g[l++]=k;g[l++]=n;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x2;g[l++]=i.y2;g[l++]=o.alpha;g[l++]=j;g[l++]=n;g[l++]=o.position.x;g[l++]=o.position.y;g[l++]=o.scale.x;g[l++]=o.scale.y;g[l++]=o.rotation;g[l++]=i.x3;g[l++]=i.y3;g[l++]=o.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};e.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var g=this.gl;if(!this.currentBaseTexture._glTextures[g.id]){e.createWebGLTexture(this.currentBaseTexture,g)}g.bindTexture(g.TEXTURE_2D,this.currentBaseTexture._glTextures[g.id]);if(this.currentBatchSize>(this.size*0.5)){g.bufferSubData(g.ARRAY_BUFFER,0,this.vertices)}else{var f=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);g.bufferSubData(g.ARRAY_BUFFER,0,f)}g.drawElements(g.TRIANGLES,this.currentBatchSize*6,g.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};e.WebGLFastSpriteBatch.prototype.start=function(){var h=this.gl;h.activeTexture(h.TEXTURE0);h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=this.renderSession.projection;h.uniform2f(this.shader.projectionVector,f.x,f.y);h.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var g=this.vertSize*4;h.vertexAttribPointer(this.shader.aVertexPosition,2,h.FLOAT,false,g,0);h.vertexAttribPointer(this.shader.aPositionCoord,2,h.FLOAT,false,g,2*4);h.vertexAttribPointer(this.shader.aScale,2,h.FLOAT,false,g,4*4);h.vertexAttribPointer(this.shader.aRotation,1,h.FLOAT,false,g,6*4);h.vertexAttribPointer(this.shader.aTextureCoord,2,h.FLOAT,false,g,7*4);h.vertexAttribPointer(this.shader.colorAttribute,1,h.FLOAT,false,g,9*4);if(this.currentBlendMode!==e.blendModes.NORMAL){this.setBlendMode(e.blendModes.NORMAL)}};e.WebGLFastSpriteBatch.prototype.setBlendMode=function(f){this.flush();this.currentBlendMode=f;var g=e.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(g[0],g[1])};e.WebGLFilterManager=function(g,f){this.transparent=f;this.filterStack=[];this.offsetX=0;this.offsetY=0;this.setContext(g)};e.WebGLFilterManager.prototype.setContext=function(f){this.gl=f;this.texturePool=[];this.initShaderBuffers()};e.WebGLFilterManager.prototype.begin=function(h,g){this.renderSession=h;this.defaultShader=h.shaderManager.defaultShader;var f=this.renderSession.projection;this.width=f.x*2;this.height=-f.y*2;this.buffer=g};e.WebGLFilterManager.prototype.pushFilter=function(g){var m=this.gl;var f=this.renderSession.projection;var l=this.renderSession.offset;g._filterArea=g.target.filterArea||g.target.getBounds();this.filterStack.push(g);var h=g.filterPasses[0];this.offsetX+=g._filterArea.x;this.offsetY+=g._filterArea.y;var i=this.texturePool.pop();if(!i){i=new e.FilterTexture(this.gl,this.width,this.height)}else{i.resize(this.width,this.height)}m.bindTexture(m.TEXTURE_2D,i.texture);var j=g._filterArea;var k=h.padding;j.x-=k;j.y-=k;j.width+=k*2;j.height+=k*2;if(j.x<0){j.x=0}if(j.width>this.width){j.width=this.width}if(j.y<0){j.y=0}if(j.height>this.height){j.height=this.height}m.bindFramebuffer(m.FRAMEBUFFER,i.frameBuffer);m.viewport(0,0,j.width,j.height);f.x=j.width/2;f.y=-j.height/2;l.x=-j.x;l.y=-j.y;m.uniform2f(this.defaultShader.projectionVector,j.width/2,-j.height/2);m.uniform2f(this.defaultShader.offsetVector,-j.x,-j.y);m.colorMask(true,true,true,true);m.clearColor(0,0,0,0);m.clear(m.COLOR_BUFFER_BIT);g._glFilterTexture=i};e.WebGLFilterManager.prototype.popFilter=function(){var s=this.gl;var p=this.filterStack.pop();var A=p._filterArea;var n=p._glFilterTexture;var B=this.renderSession.projection;var j=this.renderSession.offset;if(p.filterPasses.length>1){s.viewport(0,0,A.width,A.height);s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=A.height;this.vertexArray[2]=A.width;this.vertexArray[3]=A.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=A.width;this.vertexArray[7]=0;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);var u=n;var g=this.texturePool.pop();if(!g){g=new e.FilterTexture(this.gl,this.width,this.height)}g.resize(this.width,this.height);s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.clear(s.COLOR_BUFFER_BIT);s.disable(s.BLEND);for(var t=0;t<p.filterPasses.length-1;t++){var h=p.filterPasses[t];s.bindFramebuffer(s.FRAMEBUFFER,g.frameBuffer);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,u.texture);this.applyFilterPass(h,A,A.width,A.height);var z=u;u=g;g=z}s.enable(s.BLEND);n=u;this.texturePool.push(g)}var m=p.filterPasses[p.filterPasses.length-1];this.offsetX-=A.x;this.offsetY-=A.y;var q=this.width;var o=this.height;var w=0;var v=0;var r=this.buffer;if(this.filterStack.length===0){s.colorMask(true,true,true,true)}else{var f=this.filterStack[this.filterStack.length-1];A=f._filterArea;q=A.width;o=A.height;w=A.x;v=A.y;r=f._glFilterTexture.frameBuffer}B.x=q/2;B.y=-o/2;j.x=w;j.y=v;A=p._filterArea;var l=A.x-w;var k=A.y-v;s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=l;this.vertexArray[1]=k+A.height;this.vertexArray[2]=l+A.width;this.vertexArray[3]=k+A.height;this.vertexArray[4]=l;this.vertexArray[5]=k;this.vertexArray[6]=l+A.width;this.vertexArray[7]=k;s.bufferSubData(s.ARRAY_BUFFER,0,this.vertexArray);s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=A.width/this.width;this.uvArray[5]=A.height/this.height;this.uvArray[6]=A.width/this.width;this.uvArray[7]=A.height/this.height;s.bufferSubData(s.ARRAY_BUFFER,0,this.uvArray);s.viewport(0,0,q,o);s.bindFramebuffer(s.FRAMEBUFFER,r);s.activeTexture(s.TEXTURE0);s.bindTexture(s.TEXTURE_2D,n.texture);this.applyFilterPass(m,A,q,o);s.useProgram(this.defaultShader.program);s.uniform2f(this.defaultShader.projectionVector,q/2,-o/2);s.uniform2f(this.defaultShader.offsetVector,-w,-v);this.texturePool.push(n);p._glFilterTexture=null};e.WebGLFilterManager.prototype.applyFilterPass=function(h,j,g,f){var k=this.gl;var i=h.shaders[k.id];if(!i){i=new e.PixiShader(k);i.fragmentSrc=h.fragmentSrc;i.uniforms=h.uniforms;i.init();h.shaders[k.id]=i}k.useProgram(i.program);k.uniform2f(i.projectionVector,g/2,-f/2);k.uniform2f(i.offsetVector,0,0);if(h.uniforms.dimensions){h.uniforms.dimensions.value[0]=this.width;h.uniforms.dimensions.value[1]=this.height;h.uniforms.dimensions.value[2]=this.vertexArray[0];h.uniforms.dimensions.value[3]=this.vertexArray[5]}i.syncUniforms();k.bindBuffer(k.ARRAY_BUFFER,this.vertexBuffer);k.vertexAttribPointer(i.aVertexPosition,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.uvBuffer);k.vertexAttribPointer(i.aTextureCoord,2,k.FLOAT,false,0,0);k.bindBuffer(k.ARRAY_BUFFER,this.colorBuffer);k.vertexAttribPointer(i.colorAttribute,2,k.FLOAT,false,0,0);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.indexBuffer);k.drawElements(k.TRIANGLES,6,k.UNSIGNED_SHORT,0);this.renderSession.drawCount++};e.WebGLFilterManager.prototype.initShaderBuffers=function(){var f=this.gl;this.vertexBuffer=f.createBuffer();this.uvBuffer=f.createBuffer();this.colorBuffer=f.createBuffer();this.indexBuffer=f.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.bufferData(f.ARRAY_BUFFER,this.vertexArray,f.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.bufferData(f.ARRAY_BUFFER,this.uvArray,f.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.bufferData(f.ARRAY_BUFFER,this.colorArray,f.STATIC_DRAW);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),f.STATIC_DRAW)};e.WebGLFilterManager.prototype.destroy=function(){var g=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var f=0;f<this.texturePool.length;f++){this.texturePool.destroy()}this.texturePool=null;g.deleteBuffer(this.vertexBuffer);g.deleteBuffer(this.uvBuffer);g.deleteBuffer(this.colorBuffer);g.deleteBuffer(this.indexBuffer)};e.FilterTexture=function(i,h,f,g){this.gl=i;this.frameBuffer=i.createFramebuffer();this.texture=i.createTexture();g=g||e.scaleModes.DEFAULT;i.bindTexture(i.TEXTURE_2D,this.texture);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,g===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,g===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer);i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer);i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0);this.renderBuffer=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,this.renderBuffer);this.resize(h,f)};e.FilterTexture.prototype.clear=function(){var f=this.gl;f.clearColor(0,0,0,0);f.clear(f.COLOR_BUFFER_BIT)};e.FilterTexture.prototype.resize=function(g,f){if(this.width===g&&this.height===f){return}this.width=g;this.height=f;var h=this.gl;h.bindTexture(h.TEXTURE_2D,this.texture);h.texImage2D(h.TEXTURE_2D,0,h.RGBA,g,f,0,h.RGBA,h.UNSIGNED_BYTE,null);h.bindRenderbuffer(h.RENDERBUFFER,this.renderBuffer);h.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,g,f)};e.FilterTexture.prototype.destroy=function(){var f=this.gl;f.deleteFramebuffer(this.frameBuffer);f.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};e.CanvasMaskManager=function(){};e.CanvasMaskManager.prototype.pushMask=function(i,h){h.save();var f=i.alpha;var g=i.worldTransform;h.setTransform(g.a,g.c,g.b,g.d,g.tx,g.ty);e.CanvasGraphics.renderGraphicsMask(i,h);h.clip();i.worldAlpha=f};e.CanvasMaskManager.prototype.popMask=function(f){f.restore()};e.CanvasTinter=function(){};e.CanvasTinter.getTintedTexture=function(i,f){var k=i.texture;f=e.CanvasTinter.roundColor(f);var j="#"+("00000"+(f|0).toString(16)).substr(-6);k.tintCache=k.tintCache||{};if(k.tintCache[j]){return k.tintCache[j]}var g=e.CanvasTinter.canvas||document.createElement("canvas");e.CanvasTinter.tintMethod(k,f,g);if(e.CanvasTinter.convertTintToImage){var h=new Image();h.src=g.toDataURL();k.tintCache[j]=h}else{k.tintCache[j]=g;e.CanvasTinter.canvas=null}return g};e.CanvasTinter.tintWithMultiply=function(i,f,g){var h=g.getContext("2d");var j=i.frame;g.width=j.width;g.height=j.height;h.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6);h.fillRect(0,0,j.width,j.height);h.globalCompositeOperation="multiply";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height);h.globalCompositeOperation="destination-atop";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height)};e.CanvasTinter.tintWithOverlay=function(i,f,g){var h=g.getContext("2d");var j=i.frame;g.width=j.width;g.height=j.height;h.globalCompositeOperation="copy";h.fillStyle="#"+("00000"+(f|0).toString(16)).substr(-6);h.fillRect(0,0,j.width,j.height);h.globalCompositeOperation="destination-atop";h.drawImage(i.baseTexture.source,j.x,j.y,j.width,j.height,0,0,j.width,j.height)};e.CanvasTinter.tintWithPerPixel=function(q,n,l){var j=l.getContext("2d");var k=q.frame;l.width=k.width;l.height=k.height;j.globalCompositeOperation="copy";j.drawImage(q.baseTexture.source,k.x,k.y,k.width,k.height,0,0,k.width,k.height);var h=e.hex2rgb(n);var f=h[0],p=h[1],s=h[2];var t=j.getImageData(0,0,k.width,k.height);var m=t.data;for(var o=0;o<m.length;o+=4){m[o+0]*=f;m[o+1]*=p;m[o+2]*=s}j.putImageData(t,0,0)};e.CanvasTinter.roundColor=function(f){var g=e.CanvasTinter.cacheStepsPerColorChannel;var h=e.hex2rgb(f);h[0]=Math.min(255,(h[0]/g)*g);h[1]=Math.min(255,(h[1]/g)*g);h[2]=Math.min(255,(h[2]/g)*g);return e.rgb2hex(h)};e.CanvasTinter.cacheStepsPerColorChannel=8;e.CanvasTinter.convertTintToImage=false;e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes();e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel;e.CanvasRenderer=function(h,f,g,i){e.defaultRenderer=e.defaultRenderer||this;this.type=e.CANVAS_RENDERER;this.clearBeforeRender=true;this.roundPixels=false;this.transparent=!!i;if(!e.blendModesCanvas){e.blendModesCanvas=[];if(e.canUseNewCanvasBlendModes()){e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply";e.blendModesCanvas[e.blendModes.SCREEN]="screen";e.blendModesCanvas[e.blendModes.OVERLAY]="overlay";e.blendModesCanvas[e.blendModes.DARKEN]="darken";e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge";e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light";e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference";e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion";e.blendModesCanvas[e.blendModes.HUE]="hue";e.blendModesCanvas[e.blendModes.SATURATION]="saturation";e.blendModesCanvas[e.blendModes.COLOR]="color";e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"}else{e.blendModesCanvas[e.blendModes.NORMAL]="source-over";e.blendModesCanvas[e.blendModes.ADD]="lighter";e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over";e.blendModesCanvas[e.blendModes.SCREEN]="source-over";e.blendModesCanvas[e.blendModes.OVERLAY]="source-over";e.blendModesCanvas[e.blendModes.DARKEN]="source-over";e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over";e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over";e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over";e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over";e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over";e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over";e.blendModesCanvas[e.blendModes.HUE]="source-over";e.blendModesCanvas[e.blendModes.SATURATION]="source-over";e.blendModesCanvas[e.blendModes.COLOR]="source-over";e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"}}this.width=h||800;this.height=f||600;this.view=g||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new e.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null};if("imageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="imageSmoothingEnabled"}else{if("webkitImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="webkitImageSmoothingEnabled"}else{if("mozImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="mozImageSmoothingEnabled"}else{if("oImageSmoothingEnabled" in this.context){this.renderSession.smoothProperty="oImageSmoothingEnabled"}}}}};e.CanvasRenderer.prototype.constructor=e.CanvasRenderer;e.CanvasRenderer.prototype.render=function(f){e.texturesToUpdate.length=0;e.texturesToDestroy.length=0;f.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;if(!this.transparent&&this.clearBeforeRender){this.context.fillStyle=f.backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}else{if(this.transparent&&this.clearBeforeRender){this.context.clearRect(0,0,this.width,this.height)}}this.renderDisplayObject(f);if(f.interactive){if(!f._interactiveEventsAdded){f._interactiveEventsAdded=true;f.interactionManager.setTarget(this)}}if(e.Texture.frameUpdates.length>0){e.Texture.frameUpdates.length=0}};e.CanvasRenderer.prototype.resize=function(g,f){this.width=g;this.height=f;this.view.width=g;this.view.height=f};e.CanvasRenderer.prototype.renderDisplayObject=function(g,f){this.renderSession.context=f||this.context;g._renderCanvas(this.renderSession)};e.CanvasRenderer.prototype.renderStripFlat=function(g){var h=this.context;var k=g.verticies;var l=k.length/2;this.count++;h.beginPath();for(var n=1;n<l-2;n++){var o=n*2;var m=k[o],j=k[o+2],f=k[o+4];var r=k[o+1],q=k[o+3],p=k[o+5];h.moveTo(m,r);h.lineTo(j,q);h.lineTo(f,p)}h.fillStyle="#FF0000";h.fill();h.closePath()};e.CanvasRenderer.prototype.renderStrip=function(x){var k=this.context;var j=x.verticies;var w=x.uvs;var o=j.length/2;this.count++;for(var y=1;y<o-2;y++){var q=y*2;var E=j[q],D=j[q+2],B=j[q+4];var n=j[q+1],m=j[q+3],h=j[q+5];var C=w[q]*x.texture.width,A=w[q+2]*x.texture.width,z=w[q+4]*x.texture.width;var l=w[q+1]*x.texture.height,g=w[q+3]*x.texture.height,f=w[q+5]*x.texture.height;k.save();k.beginPath();k.moveTo(E,n);k.lineTo(D,m);k.lineTo(B,h);k.closePath();k.clip();var F=C*g+l*z+A*f-g*z-l*A-C*f;var v=E*g+l*B+D*f-g*B-l*D-E*f;var u=C*D+E*z+A*B-D*z-E*A-C*B;var t=C*g*B+l*D*z+E*A*f-E*g*z-l*A*B-C*D*f;var s=n*g+l*h+m*f-g*h-l*m-n*f;var r=C*m+n*z+A*h-m*z-n*A-C*h;var p=C*g*h+l*m*z+n*A*f-n*g*z-l*A*h-C*m*f;k.transform(v/F,s/F,u/F,r/F,t/F,p/F);k.drawImage(x.texture.baseTexture.source,0,0);k.restore()}};e.CanvasBuffer=function(g,f){this.width=g;this.height=f;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=g;this.canvas.height=f};e.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};e.CanvasBuffer.prototype.resize=function(g,f){this.width=this.canvas.width=g;this.height=this.canvas.height=f};e.CanvasGraphics=function(){};e.CanvasGraphics.renderGraphics=function(C,g){var t=C.worldAlpha;var u="";for(var A=0;A<C.graphicsData.length;A++){var E=C.graphicsData[A];var z=E.points;g.strokeStyle=u="#"+("00000"+(E.lineColor|0).toString(16)).substr(-6);g.lineWidth=E.lineWidth;if(E.type===e.Graphics.POLY){g.beginPath();g.moveTo(z[0],z[1]);for(var v=1;v<z.length/2;v++){g.lineTo(z[v*2],z[v*2+1])}if(z[0]===z[z.length-2]&&z[1]===z[z.length-1]){g.closePath()}if(E.fill){g.globalAlpha=E.fillAlpha*t;g.fillStyle=u="#"+("00000"+(E.fillColor|0).toString(16)).substr(-6);g.fill()}if(E.lineWidth){g.globalAlpha=E.lineAlpha*t;g.stroke()}}else{if(E.type===e.Graphics.RECT){if(E.fillColor||E.fillColor===0){g.globalAlpha=E.fillAlpha*t;g.fillStyle=u="#"+("00000"+(E.fillColor|0).toString(16)).substr(-6);g.fillRect(z[0],z[1],z[2],z[3])}if(E.lineWidth){g.globalAlpha=E.lineAlpha*t;g.strokeRect(z[0],z[1],z[2],z[3])}}else{if(E.type===e.Graphics.CIRC){g.beginPath();g.arc(z[0],z[1],z[2],0,2*Math.PI);g.closePath();if(E.fill){g.globalAlpha=E.fillAlpha*t;g.fillStyle=u="#"+("00000"+(E.fillColor|0).toString(16)).substr(-6);g.fill()}if(E.lineWidth){g.globalAlpha=E.lineAlpha*t;g.stroke()}}else{if(E.type===e.Graphics.ELIP){var p=E.points;var o=p[2]*2;var B=p[3]*2;var n=p[0]-o/2;var m=p[1]-B/2;g.beginPath();var q=0.5522848,l=(o/2)*q,k=(B/2)*q,s=n+o,f=m+B,r=n+o/2,D=m+B/2;g.moveTo(n,D);g.bezierCurveTo(n,D-k,r-l,m,r,m);g.bezierCurveTo(r+l,m,s,D-k,s,D);g.bezierCurveTo(s,D+k,r+l,f,r,f);g.bezierCurveTo(r-l,f,n,D+k,n,D);g.closePath();if(E.fill){g.globalAlpha=E.fillAlpha*t;g.fillStyle=u="#"+("00000"+(E.fillColor|0).toString(16)).substr(-6);g.fill()}if(E.lineWidth){g.globalAlpha=E.lineAlpha*t;g.stroke()}}}}}}};e.CanvasGraphics.renderGraphicsMask=function(B,g){var z=B.graphicsData.length;if(z===0){return}if(z>1){z=1;window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")}for(var v=0;v<1;v++){var D=B.graphicsData[v];var u=D.points;if(D.type===e.Graphics.POLY){g.beginPath();g.moveTo(u[0],u[1]);for(var t=1;t<u.length/2;t++){g.lineTo(u[t*2],u[t*2+1])}if(u[0]===u[u.length-2]&&u[1]===u[u.length-1]){g.closePath()}}else{if(D.type===e.Graphics.RECT){g.beginPath();g.rect(u[0],u[1],u[2],u[3]);g.closePath()}else{if(D.type===e.Graphics.CIRC){g.beginPath();g.arc(u[0],u[1],u[2],0,2*Math.PI);g.closePath()}else{if(D.type===e.Graphics.ELIP){var p=D.points;var o=p[2]*2;var A=p[3]*2;var n=p[0]-o/2;var m=p[1]-A/2;g.beginPath();var q=0.5522848,l=(o/2)*q,k=(A/2)*q,s=n+o,f=m+A,r=n+o/2,C=m+A/2;g.moveTo(n,C);g.bezierCurveTo(n,C-k,r-l,m,r,m);g.bezierCurveTo(r+l,m,s,C-k,s,C);g.bezierCurveTo(s,C+k,r+l,f,r,f);g.bezierCurveTo(r-l,f,n,C+k,n,C);g.closePath()}}}}}};e.Graphics=function(){e.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=e.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=false;this.bounds=null;this.boundsPadding=10};e.Graphics.prototype=Object.create(e.DisplayObjectContainer.prototype);e.Graphics.prototype.constructor=e.Graphics;Object.defineProperty(e.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(f){this._cacheAsBitmap=f;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite();this.dirty=true}}});e.Graphics.prototype.lineStyle=function(f,g,h){if(!this.currentPath.points.length){this.graphicsData.pop()}this.lineWidth=f||0;this.lineColor=g||0;this.lineAlpha=(arguments.length<3)?1:h;this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:e.Graphics.POLY};this.graphicsData.push(this.currentPath);return this};e.Graphics.prototype.moveTo=function(f,g){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:e.Graphics.POLY};this.currentPath.points.push(f,g);this.graphicsData.push(this.currentPath);return this};e.Graphics.prototype.lineTo=function(f,g){this.currentPath.points.push(f,g);this.dirty=true;return this};e.Graphics.prototype.beginFill=function(f,g){this.filling=true;this.fillColor=f||0;this.fillAlpha=(arguments.length<2)?1:g;return this};e.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};e.Graphics.prototype.drawRect=function(g,i,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,i,h,f],type:e.Graphics.RECT};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.drawCircle=function(g,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,h,f,f],type:e.Graphics.CIRC};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.drawEllipse=function(g,i,h,f){if(!this.currentPath.points.length){this.graphicsData.pop()}this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[g,i,h,f],type:e.Graphics.ELIP};this.graphicsData.push(this.currentPath);this.dirty=true;return this};e.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];this.bounds=null;return this};e.Graphics.prototype.generateTexture=function(){var h=this.getBounds();var f=new e.CanvasBuffer(h.width,h.height);var g=e.Texture.fromCanvas(f.canvas);f.context.translate(-h.x,-h.y);e.CanvasGraphics.renderGraphics(this,f.context);return g};e.Graphics.prototype._renderWebGL=function(h){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty){this._generateCachedSprite();e.updateWebGLTexture(this._cachedSprite.texture.baseTexture,h.gl);this.dirty=false}this._cachedSprite.alpha=this.alpha;e.Sprite.prototype._renderWebGL.call(this._cachedSprite,h);return}else{h.spriteBatch.stop();if(this._mask){h.maskManager.pushMask(this.mask,h)}if(this._filters){h.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==h.spriteBatch.currentBlendMode){h.spriteBatch.currentBlendMode=this.blendMode;var k=e.blendModesWebGL[h.spriteBatch.currentBlendMode];h.spriteBatch.gl.blendFunc(k[0],k[1])}e.WebGLGraphics.renderGraphics(this,h);if(this.children.length){h.spriteBatch.start();for(var g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop()}if(this._filters){h.filterManager.popFilter()}if(this._mask){h.maskManager.popMask(h)}h.drawCount++;h.spriteBatch.start()}};e.Graphics.prototype._renderCanvas=function(l){if(this.visible===false||this.alpha===0||this.isMask===true){return}var k=l.context;var g=this.worldTransform;if(this.blendMode!==l.currentBlendMode){l.currentBlendMode=this.blendMode;k.globalCompositeOperation=e.blendModesCanvas[l.currentBlendMode]}k.setTransform(g.a,g.c,g.b,g.d,g.tx,g.ty);e.CanvasGraphics.renderGraphics(this,k);for(var h=0,f=this.children.length;h<f;h++){this.children[h]._renderCanvas(l)}};e.Graphics.prototype.getBounds=function(q){if(!this.bounds){this.updateBounds()}var n=this.bounds.x;var m=this.bounds.width+this.bounds.x;var l=this.bounds.y;var k=this.bounds.height+this.bounds.y;var o=q||this.worldTransform;var C=o.a;var A=o.c;var z=o.b;var x=o.d;var D=o.tx;var B=o.ty;var t=C*m+z*k+D;var i=x*k+A*m+B;var s=C*n+z*k+D;var h=x*k+A*n+B;var r=C*n+z*l+D;var g=x*l+A*n+B;var p=C*m+z*l+D;var f=x*l+A*m+B;var w=t;var u=i;var y=t;var v=i;y=s<y?s:y;y=r<y?r:y;y=p<y?p:y;v=h<v?h:v;v=g<v?g:v;v=f<v?f:v;w=s>w?s:w;w=r>w?r:w;w=p>w?p:w;u=h>u?h:u;u=g>u?g:u;u=f>u?f:u;var j=this._bounds;j.x=y;j.width=w-y;j.y=v;j.height=u-v;return j};e.Graphics.prototype.updateBounds=function(){var l=Infinity;var g=-Infinity;var k=Infinity;var f=-Infinity;var z,u,s,v,p;for(var o=0;o<this.graphicsData.length;o++){var n=this.graphicsData[o];var r=n.type;var q=n.lineWidth;z=n.points;if(r===e.Graphics.RECT){u=z[0]-q/2;s=z[1]-q/2;v=z[2]+q;p=z[3]+q;l=u<l?u:l;g=u+v>g?u+v:g;k=s<k?u:k;f=s+p>f?s+p:f}else{if(r===e.Graphics.CIRC||r===e.Graphics.ELIP){u=z[0];s=z[1];v=z[2]+q/2;p=z[3]+q/2;l=u-v<l?u-v:l;g=u+v>g?u+v:g;k=s-p<k?s-p:k;f=s+p>f?s+p:f}else{for(var m=0;m<z.length;m+=2){u=z[m];s=z[m+1];l=u-q<l?u-q:l;g=u+q>g?u+q:g;k=s-q<k?s-q:k;f=s+q>f?s+q:f}}}}var t=this.boundsPadding;this.bounds=new e.Rectangle(l-t,k-t,(g-l)+t*2,(f-k)+t*2)};e.Graphics.prototype._generateCachedSprite=function(){var h=this.getLocalBounds();if(!this._cachedSprite){var f=new e.CanvasBuffer(h.width,h.height);var g=e.Texture.fromCanvas(f.canvas);this._cachedSprite=new e.Sprite(g);this._cachedSprite.buffer=f;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(h.width,h.height)}this._cachedSprite.anchor.x=-(h.x/h.width);this._cachedSprite.anchor.y=-(h.y/h.height);this._cachedSprite.buffer.context.translate(-h.x,-h.y);e.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};e.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};e.Graphics.POLY=0;e.Graphics.RECT=1;e.Graphics.CIRC=2;e.Graphics.ELIP=3;e.TilingSprite=function(h,g,f){e.Sprite.call(this,h);this.width=g||100;this.height=f||100;this.tileScale=new e.Point(1,1);this.tileScaleOffset=new e.Point(1,1);this.tilePosition=new e.Point(0,0);this.renderable=true;this.tint=16777215;this.blendMode=e.blendModes.NORMAL};e.TilingSprite.prototype=Object.create(e.Sprite.prototype);e.TilingSprite.prototype.constructor=e.TilingSprite;Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(f){this._width=f}});Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(f){this._height=f}});e.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=true};e.TilingSprite.prototype.setTexture=function(f){if(this.texture===f){return}this.texture=f;this.refreshTexture=true;this.cachedTint=16777215};e.TilingSprite.prototype._renderWebGL=function(h){if(this.visible===false||this.alpha===0){return}var g,f;if(this.mask){h.spriteBatch.stop();h.maskManager.pushMask(this.mask,h);h.spriteBatch.start()}if(this.filters){h.spriteBatch.flush();h.filterManager.pushFilter(this._filterBlock)}if(!this.tilingTexture||this.refreshTexture){this.generateTilingTexture(true);if(this.tilingTexture&&this.tilingTexture.needsUpdate){e.updateWebGLTexture(this.tilingTexture.baseTexture,h.gl);this.tilingTexture.needsUpdate=false}}else{h.spriteBatch.renderTilingSprite(this)}for(g=0,f=this.children.length;g<f;g++){this.children[g]._renderWebGL(h)}h.spriteBatch.stop();if(this.filters){h.filterManager.popFilter()}if(this.mask){h.maskManager.popMask(h)}h.spriteBatch.start()};e.TilingSprite.prototype._renderCanvas=function(j){if(this.visible===false||this.alpha===0){return}var i=j.context;if(this._mask){j.maskManager.pushMask(this._mask,i)}i.globalAlpha=this.worldAlpha;var h=this.worldTransform;i.setTransform(h.a,h.c,h.b,h.d,h.tx,h.ty);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(false);if(this.tilingTexture){this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}if(this.blendMode!==j.currentBlendMode){j.currentBlendMode=this.blendMode;i.globalCompositeOperation=e.blendModesCanvas[j.currentBlendMode]}i.beginPath();var f=this.tilePosition;var g=this.tileScale;f.x%=this.tilingTexture.baseTexture.width;f.y%=this.tilingTexture.baseTexture.height;i.scale(g.x,g.y);i.translate(f.x,f.y);i.fillStyle=this.__tilePattern;i.fillRect(-f.x+(this.anchor.x*-this._width),-f.y+(this.anchor.y*-this._height),this._width/g.x,this._height/g.y);i.scale(1/g.x,1/g.y);i.translate(-f.x,-f.y);i.closePath();if(this._mask){j.maskManager.popMask(j.context)}};e.TilingSprite.prototype.getBounds=function(){var p=this._width;var o=this._height;var n=p*(1-this.anchor.x);var m=p*-this.anchor.x;var l=o*(1-this.anchor.y);var k=o*-this.anchor.y;var q=this.worldTransform;var D=q.a;var B=q.c;var A=q.b;var y=q.d;var E=q.tx;var C=q.ty;var u=D*m+A*k+E;var i=y*k+B*m+C;var t=D*n+A*k+E;var h=y*k+B*n+C;var s=D*n+A*l+E;var g=y*l+B*n+C;var r=D*m+A*l+E;var f=y*l+B*m+C;var x=-Infinity;var v=-Infinity;var z=Infinity;var w=Infinity;z=u<z?u:z;z=t<z?t:z;z=s<z?s:z;z=r<z?r:z;w=i<w?i:w;w=h<w?h:w;w=g<w?g:w;w=f<w?f:w;x=u>x?u:x;x=t>x?t:x;x=s>x?s:x;x=r>x?r:x;v=i>v?i:v;v=h>v?h:v;v=g>v?g:v;v=f>v?f:v;var j=this._bounds;j.x=z;j.width=x-z;j.y=w;j.height=v-w;this._currentBounds=j;return j};e.TilingSprite.prototype.generateTilingTexture=function(n){var j=this.texture;if(!j.baseTexture.hasLoaded){return}var f=j.baseTexture;var h=j.frame;var l,i;var g=h.width!==f.width||h.height!==f.height;var k=false;if(!n){if(g){l=h.width;i=h.height;k=true}}else{l=e.getNextPowerOfTwo(h.width);i=e.getNextPowerOfTwo(h.height);if(h.width!==l&&h.height!==i){k=true}}if(k){var m;if(this.tilingTexture&&this.tilingTexture.isTiling){m=this.tilingTexture.canvasBuffer;m.resize(l,i);this.tilingTexture.baseTexture.width=l;this.tilingTexture.baseTexture.height=i;this.tilingTexture.needsUpdate=true}else{m=new e.CanvasBuffer(l,i);this.tilingTexture=e.Texture.fromCanvas(m.canvas);this.tilingTexture.canvasBuffer=m;this.tilingTexture.isTiling=true}m.context.drawImage(j.baseTexture.source,h.x,h.y,h.width,h.height,0,0,l,i);this.tileScaleOffset.x=h.width/l;this.tileScaleOffset.y=h.height/i}else{if(this.tilingTexture&&this.tilingTexture.isTiling){this.tilingTexture.destroy(true)}this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=j}this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};e.BaseTextureCache={};e.texturesToUpdate=[];e.texturesToDestroy=[];e.BaseTextureCacheIdGenerator=0;e.BaseTexture=function(h,g){e.EventTarget.call(this);this.width=100;this.height=100;this.scaleMode=g||e.scaleModes.DEFAULT;this.hasLoaded=false;this.source=h;this.id=e.BaseTextureCacheIdGenerator++;this._glTextures=[];if(!h){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.width;this.height=this.source.height;e.texturesToUpdate.push(this)}else{var f=this;this.source.onload=function(){f.hasLoaded=true;f.width=f.source.width;f.height=f.source.height;e.texturesToUpdate.push(f);f.dispatchEvent({type:"loaded",content:f})}}this.imageUrl=null;this._powerOf2=false};e.BaseTexture.prototype.constructor=e.BaseTexture;e.BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete e.BaseTextureCache[this.imageUrl];this.imageUrl=null;this.source.src=null}this.source=null;e.texturesToDestroy.push(this)};e.BaseTexture.prototype.updateSourceImage=function(f){this.hasLoaded=false;this.source.src=null;this.source.src=f};e.BaseTexture.fromImage=function(g,f,h){var i=e.BaseTextureCache[g];if(f===undefined&&g.indexOf("data:")===-1){f=true}if(!i){var j=new Image();if(f){j.crossOrigin=""}j.src=g;i=new e.BaseTexture(j,h);i.imageUrl=g;e.BaseTextureCache[g]=i}return i};e.BaseTexture.fromCanvas=function(f,g){if(!f._pixiId){f._pixiId="canvas_"+e.TextureCacheIdGenerator++}var h=e.BaseTextureCache[f._pixiId];if(!h){h=new e.BaseTexture(f,g);e.BaseTextureCache[f._pixiId]=h}return h};e.TextureCache={};e.FrameCache={};e.TextureCacheIdGenerator=0;e.Texture=function(g,h){e.EventTarget.call(this);if(!h){this.noFrame=true;h=new e.Rectangle(0,0,1,1)}if(g instanceof e.Texture){g=g.baseTexture}this.baseTexture=g;this.frame=h;this.trim=null;this.scope=this;this._uvs=null;if(g.hasLoaded){if(this.noFrame){h=new e.Rectangle(0,0,g.width,g.height)}this.setFrame(h)}else{var f=this;g.addEventListener("loaded",function(){f.onBaseTextureLoaded()})}};e.Texture.prototype.constructor=e.Texture;e.Texture.prototype.onBaseTextureLoaded=function(){var f=this.baseTexture;f.removeEventListener("loaded",this.onLoaded);if(this.noFrame){this.frame=new e.Rectangle(0,0,f.width,f.height)}this.setFrame(this.frame);this.scope.dispatchEvent({type:"update",content:this})};e.Texture.prototype.destroy=function(f){if(f){this.baseTexture.destroy()}};e.Texture.prototype.setFrame=function(f){this.frame=f;this.width=f.width;this.height=f.height;if(f.x+f.width>this.baseTexture.width||f.y+f.height>this.baseTexture.height){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.updateFrame=true;e.Texture.frameUpdates.push(this)};e.Texture.prototype._updateWebGLuvs=function(){if(!this._uvs){this._uvs=new e.TextureUvs()}var h=this.frame;var f=this.baseTexture.width;var g=this.baseTexture.height;this._uvs.x0=h.x/f;this._uvs.y0=h.y/g;this._uvs.x1=(h.x+h.width)/f;this._uvs.y1=h.y/g;this._uvs.x2=(h.x+h.width)/f;this._uvs.y2=(h.y+h.height)/g;this._uvs.x3=h.x/f;this._uvs.y3=(h.y+h.height)/g};e.Texture.fromImage=function(g,f,h){var i=e.TextureCache[g];if(!i){i=new e.Texture(e.BaseTexture.fromImage(g,f,h));e.TextureCache[g]=i}return i};e.Texture.fromFrame=function(g){var f=e.TextureCache[g];if(!f){throw new Error('The frameId "'+g+'" does not exist in the texture cache ')}return f};e.Texture.fromCanvas=function(f,g){var h=e.BaseTexture.fromCanvas(f,g);return new e.Texture(h)};e.Texture.addTextureToCache=function(f,g){e.TextureCache[g]=f};e.Texture.removeTextureFromCache=function(g){var f=e.TextureCache[g];delete e.TextureCache[g];delete e.BaseTextureCache[g];return f};e.Texture.frameUpdates=[];e.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y4=0};e.RenderTexture=function(h,f,i,g){e.EventTarget.call(this);this.width=h||100;this.height=f||100;this.frame=new e.Rectangle(0,0,this.width,this.height);this.baseTexture=new e.BaseTexture();this.baseTexture.width=this.width;this.baseTexture.height=this.height;this.baseTexture._glTextures=[];this.baseTexture.scaleMode=g||e.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;this.renderer=i||e.defaultRenderer;if(this.renderer.type===e.WEBGL_RENDERER){var j=this.renderer.gl;this.textureBuffer=new e.FilterTexture(j,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[j.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new e.Point(this.width/2,-this.height/2)}else{this.render=this.renderCanvas;this.textureBuffer=new e.CanvasBuffer(this.width,this.height);this.baseTexture.source=this.textureBuffer.canvas}e.Texture.frameUpdates.push(this)};e.RenderTexture.prototype=Object.create(e.Texture.prototype);e.RenderTexture.prototype.constructor=e.RenderTexture;e.RenderTexture.prototype.resize=function(h,f,g){if(h===this.width&&f===this.height){return}this.width=h;this.height=f;this.frame.width=this.width;this.frame.height=this.height;if(g){this.baseTexture.width=this.width;this.baseTexture.height=this.height}if(this.renderer.type===e.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}this.textureBuffer.resize(this.width,this.height)};e.RenderTexture.prototype.clear=function(){if(this.renderer.type===e.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};e.RenderTexture.prototype.renderWebGL=function(o,g,f){var n=this.renderer.gl;n.colorMask(true,true,true,true);n.viewport(0,0,this.width,this.height);n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(f){this.textureBuffer.clear()}var l=o.children;var m=o.worldTransform;o.worldTransform=e.RenderTexture.tempMatrix;o.worldTransform.d=-1;o.worldTransform.ty=this.projection.y*-2;if(g){o.worldTransform.tx=g.x;o.worldTransform.ty-=g.y}for(var k=0,h=l.length;k<h;k++){l[k].updateTransform()}e.WebGLRenderer.updateTextures();this.renderer.renderDisplayObject(o,this.projection,this.textureBuffer.frameBuffer);o.worldTransform=m};e.RenderTexture.prototype.renderCanvas=function(o,g,f){var m=o.children;var n=o.worldTransform;o.worldTransform=e.RenderTexture.tempMatrix;if(g){o.worldTransform.tx=g.x;o.worldTransform.ty=g.y}for(var l=0,h=m.length;l<h;l++){m[l].updateTransform()}if(f){this.textureBuffer.clear()}var k=this.textureBuffer.context;this.renderer.renderDisplayObject(o,k);k.setTransform(1,0,0,1,0,0);o.worldTransform=n};e.RenderTexture.tempMatrix=new e.Matrix();if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=e}exports.PIXI=e}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return b.PIXI=e})())}else{b.PIXI=e}}}).call(this);(function(){var a=this;var d=navigator.userAgent.indexOf("Firefox/")!=-1;var b=b||{VERSION:"2.0.5",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};PIXI.InteractionManager=PIXI.InteractionManager||function(){};b.Utils={transposeArray:function(h){var e=new Array(h[0].length);for(var g=0;g<h[0].length;g++){e[g]=new Array(h.length-1);for(var f=h.length-1;f>-1;f--){e[g][f]=h[f][g]}}return e},rotateArray:function(e,g){if(typeof g!=="string"){g=((g%360)+360)%360}if(g===90||g===-270||g==="rotateLeft"){e=b.Utils.transposeArray(e);e=e.reverse()}else{if(g===-90||g===270||g==="rotateRight"){e=e.reverse();e=b.Utils.transposeArray(e)}else{if(Math.abs(g)===180||g==="rotate180"){for(var f=0;f<e.length;f++){e[f].reverse()}e=e.reverse()}}}return e},parseDimension:function(g,i){var h=0;var e=0;if(typeof g==="string"){if(g.substr(-1)==="%"){h=parseInt(g,10)/100;if(i===0){e=window.innerWidth*h}else{e=window.innerHeight*h}}else{e=parseInt(g,10)}}else{e=g}return e},shuffle:function(h){for(var g=h.length-1;g>0;g--){var f=Math.floor(Math.random()*(g+1));var e=h[g];h[g]=h[f];h[f]=e}return h},pad:function(k,e,j,f){if(typeof(e)=="undefined"){var e=0}if(typeof(j)=="undefined"){var j=" "}if(typeof(f)=="undefined"){var f=3}var h=0;if(e+1>=k.length){switch(f){case 1:k=new Array(e+1-k.length).join(j)+k;break;case 3:var g=Math.ceil((h=e-k.length)/2);var i=h-g;k=new Array(i+1).join(j)+k+new Array(g+1).join(j);break;default:k=k+new Array(e+1-k.length).join(j);break}}return k},isPlainObject:function(g){if(typeof(g)!=="object"||g.nodeType||g===g.window){return false}try{if(g.constructor&&!({}).hasOwnProperty.call(g.constructor.prototype,"isPrototypeOf")){return false}}catch(f){return false}return true},extend:function(){var o,g,e,f,l,m,k=arguments[0]||{},j=1,h=arguments.length,n=false;if(typeof k==="boolean"){n=k;k=arguments[1]||{};j=2}if(h===j){k=this;--j}for(;j<h;j++){if((o=arguments[j])!=null){for(g in o){e=k[g];f=o[g];if(k===f){continue}if(n&&f&&(b.Utils.isPlainObject(f)||(l=Array.isArray(f)))){if(l){l=false;m=e&&Array.isArray(e)?e:[]}else{m=e&&b.Utils.isPlainObject(e)?e:{}}k[g]=b.Utils.extend(n,m,f)}else{if(f!==undefined){k[g]=f}}}}}return k}};if(typeof Function.prototype.bind!="function"){Function.prototype.bind=(function(){var e=Array.prototype.slice;return function(f){var i=this,j=e.call(arguments,1);if(typeof i!="function"){throw new TypeError()}function g(){var k=j.concat(e.call(arguments));i.apply(this instanceof g?this:f,k)}g.prototype=(function h(k){if(k){h.prototype=k}if(!(this instanceof h)){return new h}})(i.prototype);return g}})()}if(!Array.isArray){Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(g){if(this===void 0||this===null){throw new TypeError()}var j=Object(this);var e=j.length>>>0;if(typeof g!=="function"){throw new TypeError()}var f=arguments.length>=2?arguments[1]:void 0;for(var h=0;h<e;h++){if(h in j){g.call(f,j[h],h,j)}}}}if(typeof window.Uint32Array!=="function"){var c=function(e){var f=new Array();window[e]=function(g){if(typeof(g)==="number"){Array.call(this,g);this.length=g;for(var h=0;h<this.length;h++){this[h]=0}}else{Array.call(this,g.length);this.length=g.length;for(var h=0;h<this.length;h++){this[h]=g[h]}}};window[e].prototype=f;window[e].constructor=window[e]};c("Uint32Array");c("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}b.Circle=function(e,g,f){e=e||0;g=g||0;f=f||0;this.x=e;this.y=g;this._diameter=f;if(f>0){this._radius=f*0.5}else{this._radius=0}};b.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},setTo:function(e,g,f){this.x=e;this.y=g;this._diameter=f;this._radius=f*0.5;return this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){e.x=this.x;e.y=this.y;e.diameter=this._diameter;return e},distance:function(f,e){if(typeof e==="undefined"){e=false}if(e){return b.Math.distanceRounded(this.x,this.y,f.x,f.y)}else{return b.Math.distance(this.x,this.y,f.x,f.y)}},clone:function(e){if(typeof e==="undefined"){e=new b.Circle(this.x,this.y,this.diameter)}else{e.setTo(this.x,this.y,this.diameter)}return e},contains:function(e,f){return b.Circle.contains(this,e,f)},circumferencePoint:function(g,f,e){return b.Circle.circumferencePoint(this,g,f,e)},offset:function(f,e){this.x+=f;this.y+=e;return this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};b.Circle.prototype.constructor=b.Circle;Object.defineProperty(b.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){if(e>0){this._diameter=e;this._radius=e*0.5}}});Object.defineProperty(b.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){if(e>0){this._radius=e;this._diameter=e*2}}});Object.defineProperty(b.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){if(e>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-e}}});Object.defineProperty(b.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){if(e<this.x){this._radius=0;this._diameter=0}else{this.radius=e-this.x}}});Object.defineProperty(b.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){if(e>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-e}}});Object.defineProperty(b.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){if(e<this.y){this._radius=0;this._diameter=0}else{this.radius=e-this.y}}});Object.defineProperty(b.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(b.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(e){if(e===true){this.setTo(0,0,0)}}});b.Circle.contains=function(g,e,i){if(g.radius>0&&e>=g.left&&e<=g.right&&i>=g.top&&i<=g.bottom){var h=(g.x-e)*(g.x-e);var f=(g.y-i)*(g.y-i);return(h+f)<=(g.radius*g.radius)}else{return false}};b.Circle.equals=function(f,e){return(f.x==e.x&&f.y==e.y&&f.diameter==e.diameter)};b.Circle.intersects=function(f,e){return(b.Math.distance(f.x,f.y,e.x,e.y)<=(f.radius+e.radius))};b.Circle.circumferencePoint=function(e,h,g,f){if(typeof g==="undefined"){g=false}if(typeof f==="undefined"){f=new b.Point()}if(g===true){h=b.Math.degToRad(h)}f.x=e.x+e.radius*Math.cos(h);f.y=e.y+e.radius*Math.sin(h);return f};b.Circle.intersectsRectangle=function(o,f){var i=Math.abs(o.x-f.x-f.halfWidth);var n=f.halfWidth+o.radius;if(i>n){return false}var h=Math.abs(o.y-f.y-f.halfHeight);var l=f.halfHeight+o.radius;if(h>l){return false}if(i<=f.halfWidth||h<=f.halfHeight){return true}var j=i-f.halfWidth;var g=h-f.halfHeight;var m=j*j;var e=g*g;var k=o.radius*o.radius;return m+e<=k};PIXI.Circle=b.Circle;b.Point=function(e,f){e=e||0;f=f||0;this.x=e;this.y=f};b.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(e,f){this.x=e||0;this.y=f||((f!==0)?this.x:0);return this},set:function(e,f){this.x=e||0;this.y=f||((f!==0)?this.x:0);return this},add:function(e,f){this.x+=e;this.y+=f;return this},subtract:function(e,f){this.x-=e;this.y-=f;return this},multiply:function(e,f){this.x*=e;this.y*=f;return this},divide:function(e,f){this.x/=e;this.y/=f;return this},clampX:function(f,e){this.x=b.Math.clamp(this.x,f,e);return this},clampY:function(f,e){this.y=b.Math.clamp(this.y,f,e);return this},clamp:function(f,e){this.x=b.Math.clamp(this.x,f,e);this.y=b.Math.clamp(this.y,f,e);return this},clone:function(e){if(typeof e==="undefined"){e=new b.Point(this.x,this.y)}else{e.setTo(this.x,this.y)}return e},copyTo:function(e){e.x=this.x;e.y=this.y;return e},distance:function(f,e){return b.Point.distance(this,f,e)},equals:function(e){return(e.x===this.x&&e.y===this.y)},angle:function(e,f){if(typeof f==="undefined"){f=false}if(f){return b.Math.radToDeg(Math.atan2(e.y-this.y,e.x-this.x))}else{return Math.atan2(e.y-this.y,e.x-this.x)}},angleSq:function(e){return this.subtract(e).angle(e.subtract(this))},rotate:function(e,i,g,f,h){return b.Point.rotate(this,e,i,g,f,h)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(e){return this.normalize().multiply(e,e)},normalize:function(){if(!this.isZero()){var e=this.getMagnitude();this.x/=e;this.y/=e}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(e){return((this.x*e.x)+(this.y*e.y))},cross:function(e){return((this.x*e.y)-(this.y*e.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};b.Point.prototype.constructor=b.Point;b.Point.add=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}g.x=f.x+e.x;g.y=f.y+e.y;return g};b.Point.subtract=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}g.x=f.x-e.x;g.y=f.y-e.y;return g};b.Point.multiply=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}g.x=f.x*e.x;g.y=f.y*e.y;return g};b.Point.divide=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}g.x=f.x/e.x;g.y=f.y/e.y;return g};b.Point.equals=function(f,e){return(f.x===e.x&&f.y===e.y)};b.Point.angle=function(f,e){return Math.atan2(f.y-e.y,f.x-e.x)};b.Point.angleSq=function(f,e){return f.subtract(e).angle(e.subtract(f))};b.Point.negative=function(e,f){if(typeof f==="undefined"){f=new b.Point()}return f.setTo(-e.x,-e.y)};b.Point.multiplyAdd=function(f,e,h,g){if(typeof g==="undefined"){g=new b.Point()}return g.setTo(f.x+e.x*h,f.y+e.y*h)};b.Point.interpolate=function(g,e,i,h){if(typeof h==="undefined"){h=new b.Point()}return h.setTo(g.x+(e.x-g.x)*i,g.y+(e.y-g.y)*i)};b.Point.perp=function(e,f){if(typeof f==="undefined"){f=new b.Point()}return f.setTo(-e.y,e.x)};b.Point.rperp=function(e,f){if(typeof f==="undefined"){f=new b.Point()}return f.setTo(e.y,-e.x)};b.Point.distance=function(f,e,g){if(typeof g==="undefined"){g=false}if(g){return b.Math.distanceRounded(f.x,f.y,e.x,e.y)}else{return b.Math.distance(f.x,f.y,e.x,e.y)}};b.Point.project=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}var h=f.dot(e)/e.getMagnitudeSq();if(h!==0){g.setTo(h*e.x,h*e.y)}return g};b.Point.projectUnit=function(f,e,g){if(typeof g==="undefined"){g=new b.Point()}var h=f.dot(e);if(h!==0){g.setTo(h*e.x,h*e.y)}return g};b.Point.normalRightHand=function(e,f){if(typeof f==="undefined"){f=new b.Point()}return f.setTo(e.y*-1,e.x)};b.Point.normalize=function(f,g){if(typeof g==="undefined"){g=new b.Point()}var e=f.getMagnitude();if(e!==0){g.setTo(f.x/e,f.y/e)}return g};b.Point.rotate=function(f,e,j,h,g,i){g=g||false;i=i||null;if(g){h=b.Math.degToRad(h)}if(i===null){i=Math.sqrt(((e-f.x)*(e-f.x))+((j-f.y)*(j-f.y)))}return f.setTo(e+i*Math.cos(h),j+i*Math.sin(h))};b.Point.centroid=function(g,e){if(typeof e==="undefined"){e=new b.Point()}if(Object.prototype.toString.call(g)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var h=g.length;if(h<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(h===1){e.copyFrom(g[0]);return e}for(var f=0;f<h;f++){b.Point.add(e,g[f],e)}e.divide(h,h);return e};PIXI.Point=b.Point;b.Rectangle=function(f,h,g,e){f=f||0;h=h||0;g=g||0;e=e||0;this.x=f;this.y=h;this.width=g;this.height=e};b.Rectangle.prototype={offset:function(f,e){this.x+=f;this.y+=e;return this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(f,h,g,e){this.x=f;this.y=h;this.width=g;this.height=e;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){e.x=this.x;e.y=this.y;e.width=this.width;e.height=this.height;return e},inflate:function(f,e){return b.Rectangle.inflate(this,f,e)},size:function(e){return b.Rectangle.size(this,e)},clone:function(e){return b.Rectangle.clone(this,e)},contains:function(e,f){return b.Rectangle.contains(this,e,f)},containsRect:function(e){return b.Rectangle.containsRect(this,e)},equals:function(e){return b.Rectangle.equals(this,e)},intersection:function(e,f){return b.Rectangle.intersection(this,e,f)},intersects:function(e,f){return b.Rectangle.intersects(this,e,f)},intersectsRaw:function(i,g,h,f,e){return b.Rectangle.intersectsRaw(this,i,g,h,f,e)},union:function(e,f){return b.Rectangle.union(this,e,f)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(b.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(b.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(b.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){if(e<=this.y){this.height=0}else{this.height=(this.y-e)}}});Object.defineProperty(b.Rectangle.prototype,"bottomRight",{get:function(){return new b.Point(this.right,this.bottom)},set:function(e){this.right=e.x;this.bottom=e.y}});Object.defineProperty(b.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){if(e>=this.right){this.width=0}else{this.width=this.right-e}this.x=e}});Object.defineProperty(b.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){if(e<=this.x){this.width=0}else{this.width=this.x+e}}});Object.defineProperty(b.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(b.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(b.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}});Object.defineProperty(b.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}});Object.defineProperty(b.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){if(e>=this.bottom){this.height=0;this.y=e}else{this.height=(this.bottom-e)}}});Object.defineProperty(b.Rectangle.prototype,"topLeft",{get:function(){return new b.Point(this.x,this.y)},set:function(e){this.x=e.x;this.y=e.y}});Object.defineProperty(b.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(e){if(e===true){this.setTo(0,0,0,0)}}});b.Rectangle.prototype.constructor=b.Rectangle;b.Rectangle.inflate=function(f,g,e){f.x-=g;f.width+=2*g;f.y-=e;f.height+=2*e;return f};b.Rectangle.inflatePoint=function(f,e){return b.Rectangle.inflate(f,e.x,e.y)};b.Rectangle.size=function(e,f){if(typeof f==="undefined"){f=new b.Point(e.width,e.height)}else{f.setTo(e.width,e.height)}return f};b.Rectangle.clone=function(e,f){if(typeof f==="undefined"){f=new b.Rectangle(e.x,e.y,e.width,e.height)}else{f.setTo(e.x,e.y,e.width,e.height)}return f};b.Rectangle.contains=function(f,e,g){if(f.width<=0||f.height<=0){return false}return(e>=f.x&&e<=f.right&&g>=f.y&&g<=f.bottom)};b.Rectangle.containsRaw=function(h,g,i,f,e,j){return(e>=h&&e<=(h+i)&&j>=g&&j<=(g+f))};b.Rectangle.containsPoint=function(f,e){return b.Rectangle.contains(f,e.x,e.y)};b.Rectangle.containsRect=function(f,e){if(f.volume>e.volume){return false}return(f.x>=e.x&&f.y>=e.y&&f.right<=e.right&&f.bottom<=e.bottom)};b.Rectangle.equals=function(f,e){return(f.x==e.x&&f.y==e.y&&f.width==e.width&&f.height==e.height)};b.Rectangle.intersection=function(f,e,g){if(typeof g==="undefined"){g=new b.Rectangle()}if(b.Rectangle.intersects(f,e)){g.x=Math.max(f.x,e.x);g.y=Math.max(f.y,e.y);g.width=Math.min(f.right,e.right)-g.x;g.height=Math.min(f.bottom,e.bottom)-g.y}return g};b.Rectangle.intersects=function(f,e){if(f.width<=0||f.height<=0||e.width<=0||e.height<=0){return false}return !(f.right<e.x||f.bottom<e.y||f.x>e.right||f.y>e.bottom)};b.Rectangle.intersectsRaw=function(e,j,h,i,g,f){if(typeof f==="undefined"){f=0}return !(j>e.right+f||h<e.left-f||i>e.bottom+f||g<e.top-f)};b.Rectangle.union=function(f,e,g){if(typeof g==="undefined"){g=new b.Rectangle()}return g.setTo(Math.min(f.x,e.x),Math.min(f.y,e.y),Math.max(f.right,e.right)-Math.min(f.left,e.left),Math.max(f.bottom,e.bottom)-Math.min(f.top,e.top))};PIXI.Rectangle=b.Rectangle;PIXI.EmptyRectangle=new b.Rectangle(0,0,0,0);b.Line=function(f,h,e,g){f=f||0;h=h||0;e=e||0;g=g||0;this.start=new b.Point(f,h);this.end=new b.Point(e,g)};b.Line.prototype={setTo:function(f,h,e,g){this.start.setTo(f,h);this.end.setTo(e,g);return this},fromSprite:function(f,g,e){if(typeof e==="undefined"){e=false}if(e){return this.setTo(f.center.x,f.center.y,g.center.x,g.center.y)}else{return this.setTo(f.x,f.y,g.x,g.y)}},intersects:function(f,g,e){return b.Line.intersectsPoints(this.start,this.end,f.start,f.end,g,e)},pointOnLine:function(e,f){return((e-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(f-this.start.y))},pointOnSegment:function(f,j){var g=Math.min(this.start.x,this.end.x);var i=Math.max(this.start.x,this.end.x);var e=Math.min(this.start.y,this.end.y);var h=Math.max(this.start.y,this.end.y);return(this.pointOnLine(f,j)&&(f>=g&&f<=i)&&(j>=e&&j<=h))},coordinatesOnLine:function(k,j){if(typeof k==="undefined"){k=1}if(typeof j==="undefined"){j=[]}var f=Math.round(this.start.x);var p=Math.round(this.start.y);var e=Math.round(this.end.x);var n=Math.round(this.end.y);var r=Math.abs(e-f);var q=Math.abs(n-p);var o=(f<e)?1:-1;var m=(p<n)?1:-1;var g=r-q;j.push([f,p]);var h=1;while(!((f==e)&&(p==n))){var l=g<<1;if(l>-q){g-=q;f+=o}if(l<r){g+=r;p+=m}if(h%k===0){j.push([f,p])}h++}return j}};Object.defineProperty(b.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(b.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(b.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(b.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(b.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(b.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});b.Line.intersectsPoints=function(r,p,m,l,n,s){if(typeof n==="undefined"){n=true}if(typeof s==="undefined"){s=new b.Point()}var h=p.y-r.y;var g=l.y-m.y;var q=r.x-p.x;var o=m.x-l.x;var j=(p.x*r.y)-(r.x*p.y);var i=(l.x*m.y)-(m.x*l.y);var k=(h*o)-(g*q);if(k===0){return null}s.x=((q*i)-(o*j))/k;s.y=((g*j)-(h*i))/k;if(n){if(s.x<Math.min(r.x,p.x)||s.x>Math.max(r.x,p.x)||s.y<Math.min(r.y,p.y)||s.y>Math.max(r.y,p.y)||s.x<Math.min(m.x,l.x)||s.x>Math.max(m.x,l.x)||s.y<Math.min(m.y,l.y)||s.y>Math.max(m.y,l.y)){return null}}return s};b.Line.intersects=function(g,f,h,e){return b.Line.intersectsPoints(g.start,g.end,f.start,f.end,h,e)};b.Ellipse=function(f,h,g,e){this.type=b.ELLIPSE;f=f||0;h=h||0;g=g||0;e=e||0;this.x=f;this.y=h;this.width=g;this.height=e};b.Ellipse.prototype={setTo:function(f,h,g,e){this.x=f;this.y=h;this.width=g;this.height=e;return this},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){e.x=this.x;e.y=this.y;e.width=this.width;e.height=this.height;return e},clone:function(e){if(typeof e==="undefined"){e=new b.Ellipse(this.x,this.y,this.width,this.height)}else{e.setTo(this.x,this.y,this.width,this.height)}return e},contains:function(e,f){return b.Ellipse.contains(this,e,f)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};b.Ellipse.prototype.constructor=b.Ellipse;Object.defineProperty(b.Ellipse.prototype,"left",{get:function(){return this.x},set:function(e){this.x=e}});Object.defineProperty(b.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(e){if(e<this.x){this.width=0}else{this.width=this.x+e}}});Object.defineProperty(b.Ellipse.prototype,"top",{get:function(){return this.y},set:function(e){this.y=e}});Object.defineProperty(b.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){if(e<this.y){this.height=0}else{this.height=this.y+e}}});Object.defineProperty(b.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(e){if(e===true){this.setTo(0,0,0,0)}}});b.Ellipse.contains=function(h,f,i){if(h.width<=0||h.height<=0){return false}var g=((f-h.x)/h.width)-0.5;var e=((i-h.y)/h.height)-0.5;g*=g;e*=e;return(g+e<0.25)};b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)};PIXI.Ellipse=b.Ellipse;b.Polygon=function(g){this.type=b.POLYGON;if(!(g instanceof Array)){g=Array.prototype.slice.call(arguments)}if(typeof g[0]==="number"){var h=[];for(var f=0,e=g.length;f<e;f+=2){h.push(new b.Point(g[f],g[f+1]))}g=h}this._points=g};b.Polygon.prototype={clone:function(){var f=[];for(var e=0;e<this.points.length;e++){f.push(this.points[e].clone())}return new b.Polygon(f)},contains:function(p,o){var g=false;for(var l=0,k=this.points.length-1;l<this.points.length;k=l++){var n=this.points[l].x;var h=this.points[l].y;var m=this.points[k].x;var f=this.points[k].y;var e=((h>o)!==(f>o))&&(p<(m-n)*(o-h)/(f-h)+n);if(e){g=!g}}return g}};b.Polygon.prototype.constructor=b.Polygon;Object.defineProperty(b.Polygon.prototype,"points",{get:function(){return this._points},set:function(g){if(!(g instanceof Array)){g=Array.prototype.slice.call(arguments)}if(typeof g[0]==="number"){var h=[];for(var f=0,e=g.length;f<e;f+=2){h.push(new b.Point(g[f],g[f+1]))}g=h}this._points=g}});Object.defineProperty(b.Polygon.prototype,"area",{get:function(){var l;var k;var e;var g;var f;var j=Number.MAX_VALUE;var h=0;for(f=0;f<this.points.length;f++){if(this.points[f].y<j){j=this.points[f].y}}for(f=0;f<this.points.length;f++){l=this.points[f];if(f===this.points.length-1){k=this.points[0]}else{k=this.points[f+1]}e=((l.y-j)+(k.y-j))/2;g=l.x-k.x;h+=e*g}return h}});PIXI.Polygon=b.Polygon;b.Camera=function(g,j,f,i,h,e){this.game=g;this.world=g.world;this.id=0;this.view=new b.Rectangle(f,i,h,e);this.screenView=new b.Rectangle(f,i,h,e);this.bounds=new b.Rectangle(f,i,h,e);this.deadzone=null;this.visible=true;this.atLimit={x:false,y:false};this.target=null;this._edge=0;this.displayObject=null;this.scale=null};b.Camera.FOLLOW_LOCKON=0;b.Camera.FOLLOW_PLATFORMER=1;b.Camera.FOLLOW_TOPDOWN=2;b.Camera.FOLLOW_TOPDOWN_TIGHT=3;b.Camera.prototype={follow:function(j,g){if(typeof g==="undefined"){g=b.Camera.FOLLOW_LOCKON}this.target=j;var i;switch(g){case b.Camera.FOLLOW_PLATFORMER:var e=this.width/8;var f=this.height/3;this.deadzone=new b.Rectangle((this.width-e)/2,(this.height-f)/2-f*0.25,e,f);break;case b.Camera.FOLLOW_TOPDOWN:i=Math.max(this.width,this.height)/4;this.deadzone=new b.Rectangle((this.width-i)/2,(this.height-i)/2,i,i);break;case b.Camera.FOLLOW_TOPDOWN_TIGHT:i=Math.max(this.width,this.height)/8;this.deadzone=new b.Rectangle((this.width-i)/2,(this.height-i)/2,i,i);break;case b.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(e){this.setPosition(Math.round(e.x-this.view.halfWidth),Math.round(e.y-this.view.halfHeight))},focusOnXY:function(e,f){this.setPosition(Math.round(e-this.view.halfWidth),Math.round(f-this.view.halfHeight))},update:function(){if(this.target){this.updateTarget()}if(this.bounds){this.checkBounds()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){if(this.deadzone){this._edge=this.target.x-this.deadzone.x;if(this.view.x>this._edge){this.view.x=this._edge}this._edge=this.target.x+this.target.width-this.deadzone.x-this.deadzone.width;if(this.view.x<this._edge){this.view.x=this._edge}this._edge=this.target.y-this.deadzone.y;if(this.view.y>this._edge){this.view.y=this._edge}this._edge=this.target.y+this.target.height-this.deadzone.y-this.deadzone.height;if(this.view.y<this._edge){this.view.y=this._edge}}else{this.focusOnXY(this.target.x,this.target.y)}},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;if(this.view.x<=this.bounds.x){this.atLimit.x=true;this.view.x=this.bounds.x}if(this.view.right>=this.bounds.right){this.atLimit.x=true;this.view.x=this.bounds.right-this.width}if(this.view.y<=this.bounds.top){this.atLimit.y=true;this.view.y=this.bounds.top}if(this.view.bottom>=this.bounds.bottom){this.atLimit.y=true;this.view.y=this.bounds.bottom-this.height}this.view.floor()},setPosition:function(e,f){this.view.x=e;this.view.y=f;if(this.bounds){this.checkBounds()}},setSize:function(f,e){this.view.width=f;this.view.height=e},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};b.Camera.prototype.constructor=b.Camera;Object.defineProperty(b.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e;if(this.bounds){this.checkBounds()}}});Object.defineProperty(b.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e;if(this.bounds){this.checkBounds()}}});Object.defineProperty(b.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}});Object.defineProperty(b.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}});b.State=function(){this.game=null;this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};b.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};b.State.prototype.constructor=b.State;b.StateManager=function(f,e){this.game=f;this.states={};this._pendingState=null;if(typeof e!=="undefined"&&e!==null){this._pendingState=e}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};b.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this.game.load.onLoadComplete.add(this.loadComplete,this);if(this._pendingState!==null){if(typeof this._pendingState==="string"){this.start(this._pendingState,false,false)}else{this.add("default",this._pendingState,true)}}},add:function(f,g,e){if(typeof e==="undefined"){e=false}var h;if(g instanceof b.State){h=g}else{if(typeof g==="object"){h=g;h.game=this.game}else{if(typeof g==="function"){h=new g(this.game)}}}this.states[f]=h;if(e){if(this.game.isBooted){this.start(f)}else{this._pendingState=f}}return h},remove:function(e){if(this.current===e){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[e]},start:function(f,e,g){if(typeof e==="undefined"){e=true}if(typeof g==="undefined"){g=false}if(this.checkState(f)){this._pendingState=f;this._clearWorld=e;this._clearCache=g;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(e,f){if(typeof e==="undefined"){e=true}if(typeof f==="undefined"){f=false}this._pendingState=this.current;this._clearWorld=e;this._clearCache=f;if(arguments.length>2){this._args=Array.prototype.splice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){if(this.current){this.onShutDownCallback.call(this.callbackContext,this.game);this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();if(this._clearWorld){this.game.world.shutdown();if(this._clearCache===true){this.game.cache.destroy()}}}this.setCurrentState(this._pendingState);if(this.onPreloadCallback){this.game.load.reset();this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}if(this.current===this._pendingState){this._pendingState=null}}},checkState:function(e){if(this.states[e]){var f=false;if(this.states[e]["preload"]){f=true}if(this.states[e]["create"]){f=true}if(this.states[e]["update"]){f=true}if(this.states[e]["render"]){f=true}if(f===false){console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}return true}else{console.warn("Phaser.StateManager - No state found with the key: "+e);return false}},link:function(e){this.states[e].game=this.game;this.states[e].add=this.game.add;this.states[e].make=this.game.make;this.states[e].camera=this.game.camera;this.states[e].cache=this.game.cache;this.states[e].input=this.game.input;this.states[e].load=this.game.load;this.states[e].math=this.game.math;this.states[e].sound=this.game.sound;this.states[e].scale=this.game.scale;this.states[e].state=this;this.states[e].stage=this.game.stage;this.states[e].time=this.game.time;this.states[e].tweens=this.game.tweens;this.states[e].world=this.game.world;this.states[e].particles=this.game.particles;this.states[e].rnd=this.game.rnd;this.states[e].physics=this.game.physics},setCurrentState:function(e){this.callbackContext=this.states[e];this.link(e);this.onInitCallback=this.states[e]["init"]||this.dummy;this.onPreloadCallback=this.states[e]["preload"]||null;this.onLoadRenderCallback=this.states[e]["loadRender"]||null;this.onLoadUpdateCallback=this.states[e]["loadUpdate"]||null;this.onCreateCallback=this.states[e]["create"]||null;this.onUpdateCallback=this.states[e]["update"]||null;this.onPreRenderCallback=this.states[e]["preRender"]||null;this.onRenderCallback=this.states[e]["render"]||null;this.onPausedCallback=this.states[e]["paused"]||null;this.onResumedCallback=this.states[e]["resumed"]||null;this.onPauseUpdateCallback=this.states[e]["pauseUpdate"]||null;this.onShutDownCallback=this.states[e]["shutdown"]||this.dummy;this.current=e;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);this._args=[]},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created&&this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created&&this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(){if(this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game)}},render:function(){if(this._created&&this.onRenderCallback){if(this.game.renderType===b.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0)}this.onRenderCallback.call(this.callbackContext,this.game);if(this.game.renderType===b.CANVAS){this.game.context.restore()}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null}};b.StateManager.prototype.constructor=b.StateManager;b.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};b.LinkedList.prototype={add:function(e){if(this.total===0&&this.first===null&&this.last===null){this.first=e;this.last=e;this.next=e;e.prev=this;this.total++;return e}this.last.next=e;e.prev=this.last;this.last=e;this.total++;return e},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(e){if(this.total===1){this.reset();e.next=e.prev=null;return}if(e===this.first){this.first=this.first.next}else{if(e===this.last){this.last=this.last.prev}}if(e.prev){e.prev.next=e.next}if(e.next){e.next.prev=e.prev}e.next=e.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(f){if(!this.first||!this.last){return}var e=this.first;do{if(e&&e[f]){e[f].call(e)}e=e.next}while(e!=this.last.next)}};b.LinkedList.prototype.constructor=b.LinkedList;b.ArrayList=function(){this.total=0;this.position=0;this.list=[]};b.ArrayList.prototype={add:function(e){if(!this.exists(e)){this.list.push(e);this.total++}return e},getIndex:function(e){return this.list.indexOf(e)},exists:function(e){return(this.list.indexOf(e)>-1)},reset:function(){this.list.length=0;this.total=0},remove:function(f){var e=this.list.indexOf(f);if(e>-1){this.list.splice(e,1);this.total--;return f}},callAll:function(g){var e=Array.prototype.splice.call(arguments,1);var f=this.list.length;while(f--){if(this.list[f]&&this.list[f][g]){this.list[f][g].apply(this.list[f],e)}}}};Object.defineProperty(b.ArrayList.prototype,"first",{get:function(){this.position=0;if(this.total>0){return this.list[0]}else{return null}}});Object.defineProperty(b.ArrayList.prototype,"next",{get:function(){if(this.position<this.total){this.position++;return this.list[this.position]}else{return null}}});b.ArrayList.prototype.constructor=b.ArrayList;b.Signal=function(){this._bindings=[];this._prevParams=null;var e=this;this.dispatch=function(){b.Signal.prototype.dispatch.apply(e,arguments)}};b.Signal.prototype={memorize:false,_shouldPropagate:true,active:true,validateListener:function(e,f){if(typeof e!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",f))}},_registerListener:function(i,g,h,f){var e=this._indexOfListener(i,h),j;if(e!==-1){j=this._bindings[e];if(j.isOnce()!==g){throw new Error("You cannot add"+(g?"":"Once")+"() then add"+(!g?"":"Once")+"() the same listener without removing the relationship first.")}}else{j=new b.SignalBinding(this,i,g,h,f);this._addBinding(j)}if(this.memorize&&this._prevParams){j.execute(this._prevParams)}return j},_addBinding:function(e){var f=this._bindings.length;do{--f}while(this._bindings[f]&&e._priority<=this._bindings[f]._priority);this._bindings.splice(f+1,0,e)},_indexOfListener:function(f,e){var h=this._bindings.length,g;while(h--){g=this._bindings[h];if(g._listener===f&&g.context===e){return h}}return -1},has:function(f,e){return this._indexOfListener(f,e)!==-1},add:function(g,f,e){this.validateListener(g,"add");return this._registerListener(g,false,f,e)},addOnce:function(g,f,e){this.validateListener(g,"addOnce");return this._registerListener(g,true,f,e)},remove:function(g,f){this.validateListener(g,"remove");var e=this._indexOfListener(g,f);if(e!==-1){this._bindings[e]._destroy();this._bindings.splice(e,1)}return g},removeAll:function(){var e=this._bindings.length;while(e--){this._bindings[e]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active){return}var e=Array.prototype.slice.call(arguments);var g=this._bindings.length;var f;if(this.memorize){this._prevParams=e}if(!g){return}f=this._bindings.slice();this._shouldPropagate=true;do{g--}while(f[g]&&this._shouldPropagate&&f[g].execute(e)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};b.Signal.prototype.constructor=b.Signal;b.SignalBinding=function(i,h,f,g,e){this._listener=h;this._isOnce=f;this.context=g;this._signal=i;this._priority=e||0};b.SignalBinding.prototype={active:true,params:null,execute:function(e){var g,f;if(this.active&&!!this._listener){f=this.params?this.params.concat(e):e;g=this._listener.apply(this.context,f);if(this._isOnce){this.detach()}}return g},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};b.SignalBinding.prototype.constructor=b.SignalBinding;b.Filter=function(f,e,g){this.game=f;this.type=b.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}};this.fragmentSrc=g||[]};b.Filter.prototype={init:function(){},setResolution:function(f,e){this.uniforms.resolution.value.x=f;this.uniforms.resolution.value.y=e},update:function(e){if(typeof e!=="undefined"){if(e.x>0){this.uniforms.mouse.x=e.x.toFixed(2)}if(e.y>0){this.uniforms.mouse.y=e.y.toFixed(2)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};b.Filter.prototype.constructor=b.Filter;Object.defineProperty(b.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(e){this.uniforms.resolution.value.x=e}});Object.defineProperty(b.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(e){this.uniforms.resolution.value.y=e}});b.Plugin=function(e,f){if(typeof f==="undefined"){f=null}this.game=e;this.parent=f;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};b.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};b.Plugin.prototype.constructor=b.Plugin;b.PluginManager=function(e){this.game=e;this.plugins=[];this._len=0;this._i=0};b.PluginManager.prototype={add:function(g){var f=Array.prototype.splice.call(arguments,1);var e=false;if(typeof g==="function"){g=new g(this.game,this)}else{g.game=this.game;g.parent=this}if(typeof g.preUpdate==="function"){g.hasPreUpdate=true;e=true}if(typeof g.update==="function"){g.hasUpdate=true;e=true}if(typeof g.postUpdate==="function"){g.hasPostUpdate=true;e=true}if(typeof g.render==="function"){g.hasRender=true;e=true}if(typeof g.postRender==="function"){g.hasPostRender=true;e=true}if(e){if(g.hasPreUpdate||g.hasUpdate||g.hasPostUpdate){g.active=true}if(g.hasRender||g.hasPostRender){g.visible=true}this._len=this.plugins.push(g);if(typeof g.init==="function"){g.init.apply(g,f)}return g}else{return null}},remove:function(e){this._i=this._len;while(this._i--){if(this.plugins[this._i]===e){e.destroy();this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};b.PluginManager.prototype.constructor=b.PluginManager;b.Stage=function(f,g,e){this.game=f;this.offset=new b.Point();this.bounds=new b.Rectangle(0,0,g,e);PIXI.Stage.call(this,0,false);this.name="_stage_root";this.interactive=false;this.disableVisibilityChange=false;this.checkOffsetInterval=2500;this.exists=true;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._nextOffsetCheck=0;this._backgroundColor=0;if(f.config){this.parseConfig(f.config)}else{this.game.canvas=b.Canvas.create(g,e);this.game.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}};b.Stage.prototype=Object.create(PIXI.Stage.prototype);b.Stage.prototype.constructor=b.Stage;b.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;var e=this.children.length;for(var f=0;f<e;f++){this.children[f].preUpdate()}};b.Stage.prototype.update=function(){var e=this.children.length;while(e--){this.children[e].update()}};b.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate();this.game.world.camera.update();var e=this.children.length;while(e--){if(this.children[e]!==this.game.world.camera.target){this.children[e].postUpdate()}}}else{this.game.world.camera.update();var e=this.children.length;while(e--){this.children[e].postUpdate()}}if(this.checkOffsetInterval!==false){if(this.game.time.now>this._nextOffsetCheck){b.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.x=this.offset.x;this.bounds.y=this.offset.y;this._nextOffsetCheck=this.game.time.now+this.checkOffsetInterval}}};b.Stage.prototype.parseConfig=function(e){if(e.canvasID){this.game.canvas=b.Canvas.create(this.game.width,this.game.height,e.canvasID)}else{this.game.canvas=b.Canvas.create(this.game.width,this.game.height)}if(e.canvasStyle){this.game.canvas.stlye=e.canvasStyle}else{this.game.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(e.checkOffsetInterval){this.checkOffsetInterval=e.checkOffsetInterval}if(e.disableVisibilityChange){this.disableVisibilityChange=e.disableVisibilityChange}if(e.fullScreenScaleMode){this.fullScreenScaleMode=e.fullScreenScaleMode}if(e.scaleMode){this.scaleMode=e.scaleMode}if(e.backgroundColor){this.backgroundColor=e.backgroundColor}};b.Stage.prototype.boot=function(){b.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.game.width,this.game.height);var e=this;this._onChange=function(f){return e.visibilityChange(f)};b.Canvas.setUserSelect(this.game.canvas,"none");b.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};b.Stage.prototype.checkVisibility=function(){if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{this._hiddenVar=null}}}}if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=this._onChange;window.onpageshow=this._onChange;window.onblur=this._onChange;window.onfocus=this._onChange};b.Stage.prototype.visibilityChange=function(e){if(this.disableVisibilityChange){return}if(e.type==="pagehide"||e.type==="blur"||e.type==="pageshow"||e.type==="focus"){if(e.type==="pagehide"||e.type==="blur"){this.game.focusLoss(e)}else{if(e.type==="pageshow"||e.type==="focus"){this.game.focusGain(e)}}return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden){this.game.gamePaused(e)}else{this.game.gameResumed(e)}};b.Stage.prototype.setBackgroundColor=function(e){if(typeof e==="string"){var f=b.Color.hexToColor(e);this._backgroundColor=b.Color.getColor(f.r,f.g,f.b)}else{var f=b.Color.getRGB(e);this._backgroundColor=e}this.backgroundColorSplit=[f.r/255,f.g/255,f.b/255];this.backgroundColorString=b.Color.RGBtoString(f.r,f.g,f.b,255,"#")};Object.defineProperty(b.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){if(!this.game.transparent){this.setBackgroundColor(e)}}});Object.defineProperty(b.Stage.prototype,"smoothed",{get:function(){return !PIXI.scaleModes.LINEAR},set:function(e){if(e){PIXI.scaleModes.LINEAR=0}else{PIXI.scaleModes.LINEAR=1}}});b.Group=function(f,i,g,e,j,h){if(typeof e==="undefined"){e=false}if(typeof j==="undefined"){j=false}if(typeof h==="undefined"){h=b.Physics.ARCADE}this.game=f;if(typeof i==="undefined"){i=f.world}this.name=g||"group";PIXI.DisplayObjectContainer.call(this);if(e){this.game.stage.addChild(this)}else{if(i){i.addChild(this)}}this.z=0;this.type=b.GROUP;this.alive=true;this.exists=true;this.classType=b.Sprite;this.scale=new b.Point(1,1);this.cursor=null;this.cameraOffset=new b.Point();this.enableBody=j;this.enableBodyDebug=false;this.physicsBodyType=h;this._sortProperty="z";this._cache=[0,0,0,0,1,0,1,0,0,0]};b.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);b.Group.prototype.constructor=b.Group;b.Group.RETURN_NONE=0;b.Group.RETURN_TOTAL=1;b.Group.RETURN_CHILD=2;b.Group.SORT_ASCENDING=-1;b.Group.SORT_DESCENDING=1;b.Group.prototype.add=function(e){if(e.parent!==this){if(this.enableBody){this.game.physics.enable(e,this.physicsBodyType)}this.addChild(e);e.z=this.children.length;if(e.events){e.events.onAddedToGroup.dispatch(e,this)}if(this.cursor===null){this.cursor=e}}return e};b.Group.prototype.addAt=function(f,e){if(f.parent!==this){if(this.enableBody){this.game.physics.enable(f,this.physicsBodyType)}this.addChildAt(f,e);this.updateZ();if(f.events){f.events.onAddedToGroup.dispatch(f,this)}if(this.cursor===null){this.cursor=f}}return f};b.Group.prototype.getAt=function(e){if(e<0||e>=this.children.length){return -1}else{return this.getChildAt(e)}};b.Group.prototype.create=function(e,j,f,h,g){if(typeof g==="undefined"){g=true}var i=new this.classType(this.game,e,j,f,h);if(this.enableBody){this.game.physics.enable(i,this.physicsBodyType)}i.exists=g;i.visible=g;i.alive=g;this.addChild(i);i.z=this.children.length;if(i.events){i.events.onAddedToGroup.dispatch(i,this)}if(this.cursor===null){this.cursor=i}return i};b.Group.prototype.createMultiple=function(h,f,j,g){if(typeof g==="undefined"){g=false}for(var e=0;e<h;e++){this.create(0,0,f,j,g)}};b.Group.prototype.updateZ=function(){var e=this.children.length;while(e--){this.children[e].z=e}};b.Group.prototype.resetCursor=function(e){if(typeof e==="undefined"){e=0}if(e>this.children.length-1){e=0}if(this.cursor){this._cache[8]=e;this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.next=function(){if(this.cursor){if(this._cache[8]>=this.children.length-1){this._cache[8]=0}else{this._cache[8]++}this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.previous=function(){if(this.cursor){if(this._cache[8]===0){this._cache[8]=this.children.length-1}else{this._cache[8]--}this.cursor=this.children[this._cache[8]];return this.cursor}};b.Group.prototype.swap=function(g,f){var e=this.swapChildren(g,f);if(e){this.updateZ()}return e};b.Group.prototype.bringToTop=function(e){if(e.parent===this&&this.getIndex(e)<this.children.length){this.remove(e);this.add(e)}return e};b.Group.prototype.sendToBack=function(e){if(e.parent===this&&this.getIndex(e)>0){this.remove(e);this.addAt(e,0)}return e};b.Group.prototype.moveUp=function(g){if(g.parent===this&&this.getIndex(g)<this.children.length-1){var f=this.getIndex(g);var e=this.getAt(f+1);if(e){this.swap(g,e)}}return g};b.Group.prototype.moveDown=function(g){if(g.parent===this&&this.getIndex(g)>0){var f=this.getIndex(g);var e=this.getAt(f-1);if(e){this.swap(g,e)}}return g};b.Group.prototype.xy=function(f,e,g){if(f<0||f>this.children.length){return -1}else{this.getChildAt(f).x=e;this.getChildAt(f).y=g}};b.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};b.Group.prototype.getIndex=function(e){return this.children.indexOf(e)};b.Group.prototype.replace=function(h,e){var g=this.getIndex(h);if(g!==-1){if(e.parent!==undefined){e.events.onRemovedFromGroup.dispatch(e,this);e.parent.removeChild(e);if(e.parent instanceof b.Group){e.parent.updateZ()}}var f=h;this.remove(f);this.addAt(e,g);return f}};b.Group.prototype.hasProperty=function(g,f){var e=f.length;if(e===1&&f[0] in g){return true}else{if(e===2&&f[0] in g&&f[1] in g[f[0]]){return true}else{if(e===3&&f[0] in g&&f[1] in g[f[0]]&&f[2] in g[f[0]][f[1]]){return true}else{if(e===4&&f[0] in g&&f[1] in g[f[0]]&&f[2] in g[f[0]][f[1]]&&f[3] in g[f[0]][f[1]][f[2]]){return true}}}}return false};b.Group.prototype.setProperty=function(j,g,i,f,h){if(typeof h==="undefined"){h=false}f=f||0;if(!this.hasProperty(j,g)&&(!h||f>0)){return false}var e=g.length;if(e===1){if(f===0){j[g[0]]=i}else{if(f==1){j[g[0]]+=i}else{if(f==2){j[g[0]]-=i}else{if(f==3){j[g[0]]*=i}else{if(f==4){j[g[0]]/=i}}}}}}else{if(e===2){if(f===0){j[g[0]][g[1]]=i}else{if(f==1){j[g[0]][g[1]]+=i}else{if(f==2){j[g[0]][g[1]]-=i}else{if(f==3){j[g[0]][g[1]]*=i}else{if(f==4){j[g[0]][g[1]]/=i}}}}}}else{if(e===3){if(f===0){j[g[0]][g[1]][g[2]]=i}else{if(f==1){j[g[0]][g[1]][g[2]]+=i}else{if(f==2){j[g[0]][g[1]][g[2]]-=i}else{if(f==3){j[g[0]][g[1]][g[2]]*=i}else{if(f==4){j[g[0]][g[1]][g[2]]/=i}}}}}}else{if(e===4){if(f===0){j[g[0]][g[1]][g[2]][g[3]]=i}else{if(f==1){j[g[0]][g[1]][g[2]][g[3]]+=i}else{if(f==2){j[g[0]][g[1]][g[2]][g[3]]-=i}else{if(f==3){j[g[0]][g[1]][g[2]][g[3]]*=i}else{if(f==4){j[g[0]][g[1]][g[2]][g[3]]/=i}}}}}}}}}return true};b.Group.prototype.set=function(k,g,i,f,j,e,h){if(typeof h==="undefined"){h=false}g=g.split(".");if(typeof f==="undefined"){f=false}if(typeof j==="undefined"){j=false}if((f===false||(f&&k.alive))&&(j===false||(j&&k.visible))){return this.setProperty(k,g,i,e,h)}};b.Group.prototype.setAll=function(j,l,g,m,f,k){if(typeof g==="undefined"){g=false}if(typeof m==="undefined"){m=false}if(typeof k==="undefined"){k=false}j=j.split(".");f=f||0;for(var h=0,e=this.children.length;h<e;h++){if((!g||(g&&this.children[h].alive))&&(!m||(m&&this.children[h].visible))){this.setProperty(this.children[h],j,l,f,k)}}};b.Group.prototype.setAllChildren=function(j,l,g,m,f,k){if(typeof g==="undefined"){g=false}if(typeof m==="undefined"){m=false}if(typeof k==="undefined"){k=false}f=f||0;for(var h=0,e=this.children.length;h<e;h++){if((!g||(g&&this.children[h].alive))&&(!m||(m&&this.children[h].visible))){if(this.children[h] instanceof b.Group){this.children[h].setAllChildren(j,l,g,m,f,k)}else{this.setProperty(this.children[h],j.split("."),l,f,k)}}}};b.Group.prototype.addAll=function(g,f,e,h){this.setAll(g,f,e,h,1)};b.Group.prototype.subAll=function(g,f,e,h){this.setAll(g,f,e,h,2)};b.Group.prototype.multiplyAll=function(g,f,e,h){this.setAll(g,f,e,h,3)};b.Group.prototype.divideAll=function(g,f,e,h){this.setAll(g,f,e,h,4)};b.Group.prototype.callAllExists=function(j,h){var f=Array.prototype.splice.call(arguments,2);for(var g=0,e=this.children.length;g<e;g++){if(this.children[g].exists===h&&this.children[g][j]){this.children[g][j].apply(this.children[g],f)}}};b.Group.prototype.callbackFromArray=function(g,f,e){if(e==1){if(g[f[0]]){return g[f[0]]}}else{if(e==2){if(g[f[0]][f[1]]){return g[f[0]][f[1]]}}else{if(e==3){if(g[f[0]][f[1]][f[2]]){return g[f[0]][f[1]][f[2]]}}else{if(e==4){if(g[f[0]][f[1]][f[2]][f[3]]){return g[f[0]][f[1]][f[2]][f[3]]}}else{if(g[f]){return g[f]}}}}}return false};b.Group.prototype.callAll=function(e,f){if(typeof e==="undefined"){return}e=e.split(".");var j=e.length;if(typeof f==="undefined"||f===null||f===""){f=null}else{if(typeof f==="string"){f=f.split(".");var g=f.length}}var m=Array.prototype.splice.call(arguments,2);var n=null;var h=null;for(var k=0,l=this.children.length;k<l;k++){n=this.callbackFromArray(this.children[k],e,j);if(f&&n){h=this.callbackFromArray(this.children[k],f,g);if(n){n.apply(h,m)}}else{if(n){n.apply(this.children[k],m)}}}};b.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}var e=this.children.length;while(e--){this.children[e].preUpdate()}return true};b.Group.prototype.update=function(){var e=this.children.length;while(e--){this.children[e].update()}};b.Group.prototype.postUpdate=function(){if(this._cache[7]===1){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}var e=this.children.length;while(e--){this.children[e].postUpdate()}};b.Group.prototype.forEach=function(k,f,j){if(typeof j==="undefined"){j=false}var g=Array.prototype.splice.call(arguments,3);g.unshift(null);for(var h=0,e=this.children.length;h<e;h++){if(!j||(j&&this.children[h].exists)){g[0]=this.children[h];k.apply(f,g)}}};b.Group.prototype.forEachExists=function(g,e){var f=Array.prototype.splice.call(arguments,2);f.unshift(null);this.iterate("exists",true,b.Group.RETURN_TOTAL,g,e,f)};b.Group.prototype.forEachAlive=function(g,e){var f=Array.prototype.splice.call(arguments,2);f.unshift(null);this.iterate("alive",true,b.Group.RETURN_TOTAL,g,e,f)};b.Group.prototype.forEachDead=function(g,e){var f=Array.prototype.splice.call(arguments,2);f.unshift(null);this.iterate("alive",false,b.Group.RETURN_TOTAL,g,e,f)};b.Group.prototype.sort=function(f,e){if(this.children.length<2){return}if(typeof f==="undefined"){f="z"}if(typeof e==="undefined"){e=b.Group.SORT_ASCENDING}this._sortProperty=f;if(e===b.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};b.Group.prototype.customSort=function(e,f){if(this.children.length<2){return}this.children.sort(e.bind(f));this.updateZ()};b.Group.prototype.ascendingSortHandler=function(f,e){if(f[this._sortProperty]<e[this._sortProperty]){return -1}else{if(f[this._sortProperty]>e[this._sortProperty]){return 1}else{if(f.z<e.z){return -1}else{return 1}}}};b.Group.prototype.descendingSortHandler=function(f,e){if(f[this._sortProperty]<e[this._sortProperty]){return 1}else{if(f[this._sortProperty]>e[this._sortProperty]){return -1}else{return 0}}};b.Group.prototype.iterate=function(m,l,h,n,e,j){if(h===b.Group.RETURN_TOTAL&&this.children.length===0){return 0}if(typeof n==="undefined"){n=false}var k=0;for(var f=0,g=this.children.length;f<g;f++){if(this.children[f][m]===l){k++;if(n){j[0]=this.children[f];n.apply(e,j)}if(h===b.Group.RETURN_CHILD){return this.children[f]}}}if(h===b.Group.RETURN_TOTAL){return k}else{if(h===b.Group.RETURN_CHILD){return null}}};b.Group.prototype.getFirstExists=function(e){if(typeof e!=="boolean"){e=true}return this.iterate("exists",e,b.Group.RETURN_CHILD)};b.Group.prototype.getFirstAlive=function(){return this.iterate("alive",true,b.Group.RETURN_CHILD)};b.Group.prototype.getFirstDead=function(){return this.iterate("alive",false,b.Group.RETURN_CHILD)};b.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};b.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};b.Group.prototype.countLiving=function(){return this.iterate("alive",true,b.Group.RETURN_TOTAL)};b.Group.prototype.countDead=function(){return this.iterate("alive",false,b.Group.RETURN_TOTAL)};b.Group.prototype.getRandom=function(f,e){if(this.children.length===0){return null}f=f||0;e=e||this.children.length;return this.game.math.getRandom(this.children,f,e)};b.Group.prototype.remove=function(g,e){if(typeof e==="undefined"){e=false}if(this.children.length===0||this.children.indexOf(g)===-1){return false}if(g.events&&!g.destroyPhase){g.events.onRemovedFromGroup.dispatch(g,this)}var f=this.removeChild(g);this.updateZ();if(this.cursor===g){this.next()}if(e&&f){f.destroy(true)}return true};b.Group.prototype.removeAll=function(e){if(typeof e==="undefined"){e=false}if(this.children.length===0){return}do{if(this.children[0].events){this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this)}var f=this.removeChild(this.children[0]);if(e&&f){f.destroy(true)}}while(this.children.length>0);this.cursor=null};b.Group.prototype.removeBetween=function(j,g,f){if(typeof g==="undefined"){g=this.children.length}if(typeof f==="undefined"){f=false}if(this.children.length===0){return}if(j>g||j<0||g>this.children.length){return false}var e=g;while(e>=j){if(this.children[e].events){this.children[e].events.onRemovedFromGroup.dispatch(this.children[e],this)}var h=this.removeChild(this.children[e]);if(f&&h){h.destroy(true)}if(this.cursor===this.children[e]){this.cursor=null}e--}this.updateZ()};b.Group.prototype.destroy=function(f,e){if(this.game===null){return}if(typeof f==="undefined"){f=true}if(typeof e==="undefined"){e=false}this.removeAll(f);this.cursor=null;if(!e){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(b.Group.prototype,"total",{get:function(){return this.iterate("exists",true,b.Group.RETURN_TOTAL)}});Object.defineProperty(b.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(b.Group.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(e){this.rotation=b.Math.degToRad(e)}});Object.defineProperty(b.Group.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});b.World=function(e){b.Group.call(this,e,null,"__world",false);this.bounds=new b.Rectangle(0,0,e.width,e.height);this.camera=null};b.World.prototype=Object.create(b.Group.prototype);b.World.prototype.constructor=b.World;b.World.prototype.boot=function(){this.camera=new b.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};b.World.prototype.setBounds=function(f,h,g,e){if(g<this.game.width){g=this.game.width}if(e<this.game.height){e=this.game.height}this.bounds.setTo(f,h,g,e);if(this.camera.bounds){this.camera.bounds.setTo(f,h,g,e)}this.game.physics.setBoundsToWorld()};b.World.prototype.shutdown=function(){this.destroy(true,true)};b.World.prototype.wrap=function(f,g,e){if(typeof g==="undefined"){g=0}if(typeof e==="undefined"){e=false}if(!e){if(f.x+g<this.bounds.x){f.x=this.bounds.right+g}else{if(f.x-g>this.bounds.right){f.x=this.bounds.left-g}}if(f.y+g<this.bounds.top){f.y=this.bounds.bottom+g}else{if(f.y-g>this.bounds.bottom){f.y=this.bounds.top-g}}}else{f.getBounds();if(f._currentBounds.right<this.bounds.x){f.x=this.bounds.right}else{if(f._currentBounds.x>this.bounds.right){f.x=this.bounds.left}}if(f._currentBounds.bottom<this.bounds.top){f.y=this.bounds.bottom}else{if(f._currentBounds.top>this.bounds.bottom){f.y=this.bounds.top}}}};Object.defineProperty(b.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){this.bounds.width=e}});Object.defineProperty(b.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){this.bounds.height=e}});Object.defineProperty(b.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(b.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(b.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.integerInRange(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}});Object.defineProperty(b.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.integerInRange(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}});b.ScaleManager=function(f,g,e){this.game=f;this.width=g;this.height=e;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this.pageAlignHorizontally=false;this.pageAlignVertically=false;this.maxIterations=5;this.orientationSprite=null;this.enterLandscape=new b.Signal();this.enterPortrait=new b.Signal();this.enterIncorrectOrientation=new b.Signal();this.leaveIncorrectOrientation=new b.Signal();this.hasResized=new b.Signal();this.fullScreenTarget=this.game.canvas;this.enterFullScreen=new b.Signal();this.leaveFullScreen=new b.Signal();this.orientation=0;if(window.orientation){this.orientation=window.orientation}else{if(window.outerWidth>window.outerHeight){this.orientation=90}}this.scaleFactor=new b.Point(1,1);this.scaleFactorInversed=new b.Point(1,1);this.margin=new b.Point(0,0);this.bounds=new b.Rectangle(0,0,g,e);this.aspectRatio=0;this.sourceAspectRatio=g/e;this.event=null;this.scaleMode=b.ScaleManager.NO_SCALE;this.fullScreenScaleMode=b.ScaleManager.NO_SCALE;this._startHeight=0;this._width=0;this._height=0;this._check=null;var h=this;window.addEventListener("orientationchange",function(i){return h.checkOrientation(i)},false);window.addEventListener("resize",function(i){return h.checkResize(i)},false);document.addEventListener("webkitfullscreenchange",function(i){return h.fullScreenChange(i)},false);document.addEventListener("mozfullscreenchange",function(i){return h.fullScreenChange(i)},false);document.addEventListener("fullscreenchange",function(i){return h.fullScreenChange(i)},false)};b.ScaleManager.EXACT_FIT=0;b.ScaleManager.NO_SCALE=1;b.ScaleManager.SHOW_ALL=2;b.ScaleManager.prototype={startFullScreen:function(e){if(this.isFullScreen||!this.game.device.fullscreen){return}if(typeof e!=="undefined"&&this.game.renderType===b.CANVAS){this.game.stage.smoothed=e}this._width=this.width;this._height=this.height;if(this.game.device.fullscreenKeyboard){this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{this.fullScreenTarget[this.game.device.requestFullscreen]()}},stopFullScreen:function(){this.fullScreenTarget[this.game.device.cancelFullscreen]()},fullScreenChange:function(e){this.event=e;if(this.isFullScreen){if(this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT){this.fullScreenTarget.style.width="100%";this.fullScreenTarget.style.height="100%";this.width=window.outerWidth;this.height=window.outerHeight;this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.checkResize()}else{if(this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll();this.refresh()}}this.enterFullScreen.dispatch(this.width,this.height)}else{this.fullScreenTarget.style.width=this.game.width+"px";this.fullScreenTarget.style.height=this.game.height+"px";this.width=this._width;this.height=this._height;this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.leaveFullScreen.dispatch(this.width,this.height)}},forceOrientation:function(f,e,g){if(typeof e==="undefined"){e=false}this.forceLandscape=f;this.forcePortrait=e;if(typeof g!=="undefined"){if(g===null||this.game.cache.checkImageKey(g)===false){g="__default"}this.orientationSprite=new b.Image(this.game,this.game.width/2,this.game.height/2,PIXI.TextureCache[g]);this.orientationSprite.anchor.set(0.5);this.checkOrientationState();if(this.incorrectOrientation){this.orientationSprite.visible=true;this.game.world.visible=false}else{this.orientationSprite.visible=false;this.game.world.visible=true}this.game.stage.addChild(this.orientationSprite)}},checkOrientationState:function(){if(this.incorrectOrientation){if((this.forceLandscape&&window.innerWidth>window.innerHeight)||(this.forcePortrait&&window.innerHeight>window.innerWidth)){this.incorrectOrientation=false;this.leaveIncorrectOrientation.dispatch();if(this.orientationSprite){this.orientationSprite.visible=false;this.game.world.visible=true}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}}}else{if((this.forceLandscape&&window.innerWidth<window.innerHeight)||(this.forcePortrait&&window.innerHeight<window.innerWidth)){this.incorrectOrientation=true;this.enterIncorrectOrientation.dispatch();if(this.orientationSprite&&this.orientationSprite.visible===false){this.orientationSprite.visible=true;this.game.world.visible=false}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}}}},checkOrientation:function(e){this.event=e;this.orientation=window.orientation;if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}},checkResize:function(e){this.event=e;if(window.outerWidth>window.outerHeight){this.orientation=90}else{this.orientation=0}if(this.isLandscape){this.enterLandscape.dispatch(this.orientation,true,false)}else{this.enterPortrait.dispatch(this.orientation,false,true)}if(this.scaleMode!==b.ScaleManager.NO_SCALE){this.refresh()}this.checkOrientationState()},refresh:function(){if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}if(this._check===null&&this.maxIterations>0){this._iterations=this.maxIterations;var e=this;this._check=window.setInterval(function(){return e.setScreenSize()},10);this.setScreenSize()}},setScreenSize:function(e){if(typeof e==="undefined"){e=false}if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){window.scrollTo(0,1)}else{window.scrollTo(0,0)}}this._iterations--;if(e||window.innerHeight>this._startHeight||this._iterations<0){document.documentElement.style.minHeight=window.innerHeight+"px";if(this.incorrectOrientation){this.setMaximum()}else{if(!this.isFullScreen){if(this.scaleMode===b.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(this.scaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll()}}}else{if(this.fullScreenScaleMode===b.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(this.fullScreenScaleMode===b.ScaleManager.SHOW_ALL){this.setShowAll()}}}}this.setSize();clearInterval(this._check);this._check=null}},setSize:function(){if(!this.incorrectOrientation){if(this.maxWidth&&this.width>this.maxWidth){this.width=this.maxWidth}if(this.maxHeight&&this.height>this.maxHeight){this.height=this.maxHeight}if(this.minWidth&&this.width<this.minWidth){this.width=this.minWidth}if(this.minHeight&&this.height<this.minHeight){this.height=this.minHeight}}this.game.canvas.style.width=this.width+"px";this.game.canvas.style.height=this.height+"px";this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);if(this.pageAlignHorizontally){if(this.width<window.innerWidth&&!this.incorrectOrientation){this.margin.x=Math.round((window.innerWidth-this.width)/2);this.game.canvas.style.marginLeft=this.margin.x+"px"}else{this.margin.x=0;this.game.canvas.style.marginLeft="0px"}}if(this.pageAlignVertically){if(this.height<window.innerHeight&&!this.incorrectOrientation){this.margin.y=Math.round((window.innerHeight-this.height)/2);this.game.canvas.style.marginTop=this.margin.y+"px"}else{this.margin.y=0;this.game.canvas.style.marginTop="0px"}}b.Canvas.getOffset(this.game.canvas,this.game.stage.offset);this.bounds.setTo(this.game.stage.offset.x,this.game.stage.offset.y,this.width,this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.hasResized.dispatch(this.width,this.height);this.checkOrientationState()},setMaximum:function(){this.width=window.innerWidth;this.height=window.innerHeight},setShowAll:function(){var e=Math.min((window.innerHeight/this.game.height),(window.innerWidth/this.game.width));this.width=Math.round(this.game.width*e);this.height=Math.round(this.game.height*e)},setExactFit:function(){var e=window.innerWidth;var f=window.innerHeight;if(this.maxWidth&&e>this.maxWidth){this.width=this.maxWidth}else{this.width=e}if(this.maxHeight&&f>this.maxHeight){this.height=this.maxHeight}else{this.height=f}}};b.ScaleManager.prototype.constructor=b.ScaleManager;Object.defineProperty(b.ScaleManager.prototype,"isFullScreen",{get:function(){return(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)}});Object.defineProperty(b.ScaleManager.prototype,"isPortrait",{get:function(){return(this.orientation===0||this.orientation===180)}});Object.defineProperty(b.ScaleManager.prototype,"isLandscape",{get:function(){return(this.orientation===90||this.orientation===-90)}});b.Game=function(f,k,i,j,e,m,l,h){this.id=b.GAMES.push(this)-1;this.config=null;this.physicsConfig=h;this.parent="";this.width=800;this.height=600;this.transparent=false;this.antialias=true;this.renderer=null;this.renderType=b.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null;this.device=null;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{if(typeof f!=="undefined"){this.width=f}if(typeof k!=="undefined"){this.height=k}if(typeof i!=="undefined"){this.renderer=i;this.renderType=i}if(typeof j!=="undefined"){this.parent=j}if(typeof m!=="undefined"){this.transparent=m}if(typeof l!=="undefined"){this.antialias=l}this.rnd=new b.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new b.StateManager(this,e)}var g=this;this._onBoot=function(){return g.boot()};if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(this._onBoot,0)}else{document.addEventListener("DOMContentLoaded",this._onBoot,false);window.addEventListener("load",this._onBoot,false)}return this};b.Game.prototype={parseConfig:function(f){this.config=f;if(f.width){this.width=b.Utils.parseDimension(f.width,0)}if(f.height){this.height=b.Utils.parseDimension(f.height,1)}if(f.renderer){this.renderer=f.renderer;this.renderType=f.renderer}if(f.parent){this.parent=f.parent}if(f.transparent){this.transparent=f.transparent}if(f.antialias){this.antialias=f.antialias}if(f.physicsConfig){this.physicsConfig=f.physicsConfig}var e=[(Date.now()*Math.random()).toString()];if(f.seed){e=f.seed}this.rnd=new b.RandomDataGenerator(e);var g=null;if(f.state){g=f.state}this.state=new b.StateManager(this,g)},boot:function(){if(this.isBooted){return}if(!document.body){window.setTimeout(this._onBoot,20)}else{document.removeEventListener("DOMContentLoaded",this._onBoot);window.removeEventListener("load",this._onBoot);this.onPause=new b.Signal();this.onResume=new b.Signal();this.onBlur=new b.Signal();this.onFocus=new b.Signal();this.isBooted=true;this.device=new b.Device(this);this.math=b.Math;this.stage=new b.Stage(this,this.width,this.height);this.scale=new b.ScaleManager(this,this.width,this.height);this.setUpRenderer();this.device.checkFullScreenSupport();this.world=new b.World(this);this.add=new b.GameObjectFactory(this);this.make=new b.GameObjectCreator(this);this.cache=new b.Cache(this);this.load=new b.Loader(this);this.time=new b.Time(this);this.tweens=new b.TweenManager(this);this.input=new b.Input(this);this.sound=new b.SoundManager(this);this.physics=new b.Physics(this,this.physicsConfig);this.particles=new b.Particles(this);this.plugins=new b.PluginManager(this);this.net=new b.Net(this);this.debug=new b.Utils.Debug(this);this.scratch=new b.BitmapData(this,"__root",1024,1024);this.time.boot();this.stage.boot();this.world.boot();this.input.boot();this.sound.boot();this.state.boot();this.debug.boot();this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new b.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new b.RequestAnimationFrame(this,false)}this.raf.start()}},showDebugHeader:function(){var f=b.VERSION;var j="Canvas";var e="HTML Audio";var k=1;if(this.renderType===b.WEBGL){j="WebGL";k++}else{if(this.renderType==b.HEADLESS){j="Headless"}}if(this.device.webAudio){e="WebAudio";k++}if(this.device.chrome){var g=["%c %c %c Phaser v"+f+" - "+j+" - "+e+"  %c %c  http://phaser.io  %c %c ♥%c♥%c♥ ","background: #0cf300","background: #00bc17","color: #ffffff; background: #00711f;","background: #00bc17","background: #0cf300","background: #00bc17"];for(var h=0;h<3;h++){if(h<k){g.push("color: #ff2424; background: #fff")}else{g.push("color: #959595; background: #fff")}}console.log.apply(console,g)}else{if(window.console){console.log("Phaser v"+f+" - Renderer: "+j+" - Audio: "+e+" - http://phaser.io")}}},setUpRenderer:function(){if(this.device.trident){this.renderType=b.CANVAS}if(this.renderType===b.HEADLESS||this.renderType===b.CANVAS||(this.renderType===b.AUTO&&this.device.webGL===false)){if(this.device.canvas){if(this.renderType===b.AUTO){this.renderType=b.CANVAS}this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.canvas,this.transparent);this.context=this.renderer.context}else{throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=b.WEBGL;this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias);this.context=null}if(this.renderType!==b.HEADLESS){this.stage.smoothed=this.antialias;b.Canvas.addToDOM(this.canvas,this.parent,true);b.Canvas.setTouchAction(this.canvas)}},update:function(e){this.time.update(e);if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.debug.preUpdate();this.physics.preUpdate();this.state.preUpdate();this.plugins.preUpdate();this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.state.pauseUpdate();this.debug.preUpdate()}if(this.renderType!=b.HEADLESS){this.renderer.render(this.stage);this.plugins.render();this.state.render();this.plugins.postRender()}},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.input.destroy();this.state.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=false},gamePaused:function(e){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.setMute();this.onPause.dispatch(e)}},gameResumed:function(e){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.unsetMute();this.onResume.dispatch(e)}},focusLoss:function(e){this.onBlur.dispatch(e);this.gamePaused(e)},focusGain:function(e){this.onFocus.dispatch(e);this.gameResumed(e)}};b.Game.prototype.constructor=b.Game;Object.defineProperty(b.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){if(e===true){if(this._paused===false){this._paused=true;this._codePaused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}}else{if(this._paused){this._paused=false;this._codePaused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}}}});b.Input=function(e){this.game=e;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.disabled=false;this.multiInputOverride=b.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=10;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new b.ArrayList();this._localPoint=new b.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};b.Input.MOUSE_OVERRIDES_TOUCH=0;b.Input.TOUCH_OVERRIDES_MOUSE=1;b.Input.MOUSE_TOUCH_COMBINE=2;b.Input.prototype={boot:function(){this.mousePointer=new b.Pointer(this.game,0);this.pointer1=new b.Pointer(this.game,1);this.pointer2=new b.Pointer(this.game,2);this.mouse=new b.Mouse(this.game);this.keyboard=new b.Keyboard(this.game);this.touch=new b.Touch(this.game);this.mspointer=new b.MSPointer(this.game);this.gamepad=new b.Gamepad(this.game);this.onDown=new b.Signal();this.onUp=new b.Signal();this.onTap=new b.Signal();this.onHold=new b.Signal();this.scale=new b.Point(1,1);this.speed=new b.Point();this.position=new b.Point();this._oldPosition=new b.Point();this.circle=new b.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.keyboard.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true},destroy:function(){this.mouse.stop();this.keyboard.stop();this.touch.stop();this.mspointer.stop();this.gamepad.stop();this.moveCallbacks=[];this.moveCallback=null},setMoveCallback:function(f,e){this.moveCallback=f;this.moveCallbackContext=e},addMoveCallback:function(f,e){return this.moveCallbacks.push({callback:f,context:e})-1},deleteMoveCallback:function(e){if(this.moveCallbacks[e]){this.moveCallbacks.splice(e,1)}},addPointer:function(){var f=0;for(var e=10;e>0;e--){if(this["pointer"+e]===null){f=e}}if(f===0){console.warn("You can only have 10 Pointer objects");return null}else{this["pointer"+f]=new b.Pointer(this.game,f);return this["pointer"+f]}},update:function(){this.keyboard.update();if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad.active){this.gamepad.update()}this.pointer1.update();this.pointer2.update();if(this.pointer3){this.pointer3.update()}if(this.pointer4){this.pointer4.update()}if(this.pointer5){this.pointer5.update()}if(this.pointer6){this.pointer6.update()}if(this.pointer7){this.pointer7.update()}if(this.pointer8){this.pointer8.update()}if(this.pointer9){this.pointer9.update()}if(this.pointer10){this.pointer10.update()}this._pollCounter=0},reset:function(f){if(!this.game.isBooted||this.resetLocked){return}if(typeof f==="undefined"){f=false}this.keyboard.reset(f);this.mousePointer.reset();this.gamepad.reset();for(var e=1;e<=10;e++){if(this["pointer"+e]){this["pointer"+e].reset()}}this.currentPointers=0;if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(f){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new b.Signal();this.onUp=new b.Signal();this.onTap=new b.Signal();this.onHold=new b.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(e,f){this._oldPosition.setTo(e,f);this.speed.setTo(0,0)},startPointer:function(f){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers){return null}if(this.pointer1.active===false){return this.pointer1.start(f)}else{if(this.pointer2.active===false){return this.pointer2.start(f)}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].active===false){return this["pointer"+e].start(f)}}}}return null},updatePointer:function(f){if(this.pointer1.active&&this.pointer1.identifier==f.identifier){return this.pointer1.move(f)}else{if(this.pointer2.active&&this.pointer2.identifier==f.identifier){return this.pointer2.move(f)}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].active&&this["pointer"+e].identifier==f.identifier){return this["pointer"+e].move(f)}}}}return null},stopPointer:function(f){if(this.pointer1.active&&this.pointer1.identifier==f.identifier){return this.pointer1.stop(f)}else{if(this.pointer2.active&&this.pointer2.identifier==f.identifier){return this.pointer2.stop(f)}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].active&&this["pointer"+e].identifier==f.identifier){return this["pointer"+e].stop(f)}}}}return null},getPointer:function(f){f=f||false;if(this.pointer1.active==f){return this.pointer1}else{if(this.pointer2.active==f){return this.pointer2}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].active==f){return this["pointer"+e]}}}}return null},getPointerFromIdentifier:function(e){if(this.pointer1.identifier===e){return this.pointer1}else{if(this.pointer2.identifier===e){return this.pointer2}else{for(var f=3;f<=10;f++){if(this["pointer"+f]&&this["pointer"+f].identifier===e){return this["pointer"+f]}}}}return null},getPointerFromId:function(f){if(this.pointer1.pointerId===f){return this.pointer1}else{if(this.pointer2.pointerId===f){return this.pointer2}else{for(var e=3;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].pointerId===f){return this["pointer"+e]}}}}return null},getLocalPosition:function(h,g,f){if(typeof f==="undefined"){f=new b.Point()}var e=h.worldTransform;var i=1/(e.a*e.d+e.b*-e.c);return f.setTo(e.d*i*g.x+-e.b*i*g.y+(e.ty*e.b-e.tx*e.d)*i,e.a*i*g.y+-e.c*i*g.x+(-e.ty*e.a+e.tx*e.c)*i)},hitTest:function(k,e,n){if(!k.worldVisible){return false}this.getLocalPosition(k,e,this._localPoint);n.copyFrom(this._localPoint);if(k.hitArea&&k.hitArea.contains){if(k.hitArea.contains(this._localPoint.x,this._localPoint.y)){return true}return false}else{if(k instanceof b.TileSprite){var f=k.width;var m=k.height;var g=-f*k.anchor.x;if(this._localPoint.x>g&&this._localPoint.x<g+f){var l=-m*k.anchor.y;if(this._localPoint.y>l&&this._localPoint.y<l+m){return true}}}else{if(k instanceof PIXI.Sprite){var f=k.texture.frame.width;var m=k.texture.frame.height;var g=-f*k.anchor.x;if(this._localPoint.x>g&&this._localPoint.x<g+f){var l=-m*k.anchor.y;if(this._localPoint.y>l&&this._localPoint.y<l+m){return true}}}}}for(var h=0,j=k.children.length;h<j;h++){if(this.hitTest(k.children[h],e,n)){return true}}return false}};b.Input.prototype.constructor=b.Input;Object.defineProperty(b.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=Math.floor(e)}});Object.defineProperty(b.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=Math.floor(e)}});Object.defineProperty(b.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(b.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}});Object.defineProperty(b.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var e=1;e<=10;e++){if(this["pointer"+e]&&this["pointer"+e].active){this.currentPointers++}}return this.currentPointers}});Object.defineProperty(b.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(b.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});b.Key=function(f,e){this.game=f;this.enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=e;this.onDown=new b.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new b.Signal()};b.Key.prototype={update:function(){if(!this.enabled){return}if(this.isDown){this.duration=this.game.time.now-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(e){if(!this.enabled){return}this.event=e;if(this.isDown){return}this.altKey=e.altKey;this.ctrlKey=e.ctrlKey;this.shiftKey=e.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0;this.onDown.dispatch(this)},processKeyUp:function(e){if(!this.enabled){return}this.event=e;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.duration=this.game.time.now-this.timeDown;this.onUp.dispatch(this)},reset:function(e){if(typeof e==="undefined"){e=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.duration=this.game.time.now-this.timeDown;this.enabled=true;if(e){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},justPressed:function(e){if(typeof e==="undefined"){e=50}return(this.isDown&&this.duration<e)},justReleased:function(e){if(typeof e==="undefined"){e=50}return(!this.isDown&&((this.game.time.now-this.timeUp)<e))}};b.Key.prototype.constructor=b.Key;b.Keyboard=function(e){this.game=e;this.disabled=false;this.event=null;this.callbackContext=this;this.onDownCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyUp=null;this._i=0};b.Keyboard.prototype={addCallbacks:function(e,f,g){this.callbackContext=e;this.onDownCallback=f;if(typeof g!=="undefined"){this.onUpCallback=g}},addKey:function(e){if(!this._keys[e]){this._keys[e]=new b.Key(this.game,e);this.addKeyCapture(e)}return this._keys[e]},removeKey:function(e){if(this._keys[e]){this._keys[e]=null;this.removeKeyCapture(e)}},createCursorKeys:function(){return{up:this.addKey(b.Keyboard.UP),down:this.addKey(b.Keyboard.DOWN),left:this.addKey(b.Keyboard.LEFT),right:this.addKey(b.Keyboard.RIGHT)}},start:function(){if(this._onKeyDown!==null){return}var e=this;this._onKeyDown=function(f){return e.processKeyDown(f)};this._onKeyUp=function(f){return e.processKeyUp(f)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);this._onKeyDown=null;this._onKeyUp=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(e){if(typeof e==="object"){for(var f in e){this._capture[e[f]]=true}}else{this._capture[e]=true}},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(e){this.event=e;if(this.game.input.disabled||this.disabled){return}if(this._capture[e.keyCode]){e.preventDefault()}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,e)}if(!this._keys[e.keyCode]){this._keys[e.keyCode]=new b.Key(this.game,e.keyCode)}this._keys[e.keyCode].processKeyDown(e)},processKeyUp:function(e){this.event=e;if(this.game.input.disabled||this.disabled){return}if(this._capture[e.keyCode]){e.preventDefault()}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,e)}if(!this._keys[e.keyCode]){this._keys[e.keyCode]=new b.Key(this.game,e.keyCode)}this._keys[e.keyCode].processKeyUp(e)},reset:function(f){if(typeof f==="undefined"){f=true}this.event=null;var e=this._keys.length;while(e--){if(this._keys[e]){this._keys[e].reset(f)}}},justPressed:function(e,f){if(typeof f==="undefined"){f=50}if(this._keys[e]){return this._keys[e].justPressed(f)}else{return false}},justReleased:function(e,f){if(typeof f==="undefined"){f=50}if(this._keys[e]){return this._keys[e].justReleased(f)}else{return false}},isDown:function(e){if(this._keys[e]){return this._keys[e].isDown}return false}};b.Keyboard.prototype.constructor=b.Keyboard;b.Keyboard.A="A".charCodeAt(0);b.Keyboard.B="B".charCodeAt(0);b.Keyboard.C="C".charCodeAt(0);b.Keyboard.D="D".charCodeAt(0);b.Keyboard.E="E".charCodeAt(0);b.Keyboard.F="F".charCodeAt(0);b.Keyboard.G="G".charCodeAt(0);b.Keyboard.H="H".charCodeAt(0);b.Keyboard.I="I".charCodeAt(0);b.Keyboard.J="J".charCodeAt(0);b.Keyboard.K="K".charCodeAt(0);b.Keyboard.L="L".charCodeAt(0);b.Keyboard.M="M".charCodeAt(0);b.Keyboard.N="N".charCodeAt(0);b.Keyboard.O="O".charCodeAt(0);b.Keyboard.P="P".charCodeAt(0);b.Keyboard.Q="Q".charCodeAt(0);b.Keyboard.R="R".charCodeAt(0);b.Keyboard.S="S".charCodeAt(0);b.Keyboard.T="T".charCodeAt(0);b.Keyboard.U="U".charCodeAt(0);b.Keyboard.V="V".charCodeAt(0);b.Keyboard.W="W".charCodeAt(0);b.Keyboard.X="X".charCodeAt(0);b.Keyboard.Y="Y".charCodeAt(0);b.Keyboard.Z="Z".charCodeAt(0);b.Keyboard.ZERO="0".charCodeAt(0);b.Keyboard.ONE="1".charCodeAt(0);b.Keyboard.TWO="2".charCodeAt(0);b.Keyboard.THREE="3".charCodeAt(0);b.Keyboard.FOUR="4".charCodeAt(0);b.Keyboard.FIVE="5".charCodeAt(0);b.Keyboard.SIX="6".charCodeAt(0);b.Keyboard.SEVEN="7".charCodeAt(0);b.Keyboard.EIGHT="8".charCodeAt(0);b.Keyboard.NINE="9".charCodeAt(0);b.Keyboard.NUMPAD_0=96;b.Keyboard.NUMPAD_1=97;b.Keyboard.NUMPAD_2=98;b.Keyboard.NUMPAD_3=99;b.Keyboard.NUMPAD_4=100;b.Keyboard.NUMPAD_5=101;b.Keyboard.NUMPAD_6=102;b.Keyboard.NUMPAD_7=103;b.Keyboard.NUMPAD_8=104;b.Keyboard.NUMPAD_9=105;b.Keyboard.NUMPAD_MULTIPLY=106;b.Keyboard.NUMPAD_ADD=107;b.Keyboard.NUMPAD_ENTER=108;b.Keyboard.NUMPAD_SUBTRACT=109;b.Keyboard.NUMPAD_DECIMAL=110;b.Keyboard.NUMPAD_DIVIDE=111;b.Keyboard.F1=112;b.Keyboard.F2=113;b.Keyboard.F3=114;b.Keyboard.F4=115;b.Keyboard.F5=116;b.Keyboard.F6=117;b.Keyboard.F7=118;b.Keyboard.F8=119;b.Keyboard.F9=120;b.Keyboard.F10=121;b.Keyboard.F11=122;b.Keyboard.F12=123;b.Keyboard.F13=124;b.Keyboard.F14=125;b.Keyboard.F15=126;b.Keyboard.COLON=186;b.Keyboard.EQUALS=187;b.Keyboard.UNDERSCORE=189;b.Keyboard.QUESTION_MARK=191;b.Keyboard.TILDE=192;b.Keyboard.OPEN_BRACKET=219;b.Keyboard.BACKWARD_SLASH=220;b.Keyboard.CLOSED_BRACKET=221;b.Keyboard.QUOTES=222;b.Keyboard.BACKSPACE=8;b.Keyboard.TAB=9;b.Keyboard.CLEAR=12;b.Keyboard.ENTER=13;b.Keyboard.SHIFT=16;b.Keyboard.CONTROL=17;b.Keyboard.ALT=18;b.Keyboard.CAPS_LOCK=20;b.Keyboard.ESC=27;b.Keyboard.SPACEBAR=32;b.Keyboard.PAGE_UP=33;b.Keyboard.PAGE_DOWN=34;b.Keyboard.END=35;b.Keyboard.HOME=36;b.Keyboard.LEFT=37;b.Keyboard.UP=38;b.Keyboard.RIGHT=39;b.Keyboard.DOWN=40;b.Keyboard.INSERT=45;b.Keyboard.DELETE=46;b.Keyboard.HELP=47;b.Keyboard.NUM_LOCK=144;b.Mouse=function(e){this.game=e;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.capture=false;this.button=-1;this.disabled=false;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new b.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null};b.Mouse.NO_BUTTON=-1;b.Mouse.LEFT_BUTTON=0;b.Mouse.MIDDLE_BUTTON=1;b.Mouse.RIGHT_BUTTON=2;b.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var e=this;this._onMouseDown=function(f){return e.onMouseDown(f)};this._onMouseMove=function(f){return e.onMouseMove(f)};this._onMouseUp=function(f){return e.onMouseUp(f)};this._onMouseOut=function(f){return e.onMouseOut(f)};this._onMouseOver=function(f){return e.onMouseOver(f)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,true);this.game.canvas.addEventListener("mousemove",this._onMouseMove,true);this.game.canvas.addEventListener("mouseup",this._onMouseUp,true);this.game.canvas.addEventListener("mouseover",this._onMouseOver,true);this.game.canvas.addEventListener("mouseout",this._onMouseOut,true)},onMouseDown:function(e){this.event=e;if(this.capture){e.preventDefault()}this.button=e.button;if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}e.identifier=0;this.game.input.mousePointer.start(e)},onMouseMove:function(e){this.event=e;if(this.capture){e.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}e.identifier=0;this.game.input.mousePointer.move(e)},onMouseUp:function(e){this.event=e;if(this.capture){e.preventDefault()}this.button=b.Mouse.NO_BUTTON;if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}e.identifier=0;this.game.input.mousePointer.stop(e)},onMouseOut:function(e){this.event=e;if(this.capture){e.preventDefault()}if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}this.game.input.mousePointer.withinGame=false;if(this.stopOnGameOut){e.identifier=0;this.game.input.mousePointer.stop(e)}},onMouseOver:function(e){this.event=e;if(this.capture){e.preventDefault()}if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}this.game.input.mousePointer.withinGame=true},requestPointerLock:function(){if(this.game.device.pointerLock){var e=this.game.canvas;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock;e.requestPointerLock();var f=this;this._pointerLockChange=function(g){return f.pointerLockChange(g)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(f){var e=this.game.canvas;if(document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e){this.locked=true;this.pointerLock.dispatch(true,f)}else{this.locked=false;this.pointerLock.dispatch(false,f)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,true);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,true);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,true);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,true);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,true)}};b.Mouse.prototype.constructor=b.Mouse;b.MSPointer=function(e){this.game=e;this.callbackContext=this.game;this.disabled=false;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};b.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var e=this;if(this.game.device.mspointer===true){this._onMSPointerDown=function(f){return e.onPointerDown(f)};this._onMSPointerMove=function(f){return e.onPointerMove(f)};this._onMSPointerUp=function(f){return e.onPointerUp(f)};this.game.renderer.view.addEventListener("MSPointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("MSPointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("MSPointerUp",this._onMSPointerUp,false);this.game.renderer.view.addEventListener("pointerDown",this._onMSPointerDown,false);this.game.renderer.view.addEventListener("pointerMove",this._onMSPointerMove,false);this.game.renderer.view.addEventListener("pointerUp",this._onMSPointerUp,false);this.game.renderer.view.style["-ms-content-zooming"]="none";this.game.renderer.view.style["-ms-touch-action"]="none"}},onPointerDown:function(e){if(this.game.input.disabled||this.disabled){return}e.preventDefault();e.identifier=e.pointerId;this.game.input.startPointer(e)},onPointerMove:function(e){if(this.game.input.disabled||this.disabled){return}e.preventDefault();e.identifier=e.pointerId;this.game.input.updatePointer(e)},onPointerUp:function(e){if(this.game.input.disabled||this.disabled){return}e.preventDefault();e.identifier=e.pointerId;this.game.input.stopPointer(e)},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};b.MSPointer.prototype.constructor=b.MSPointer;b.Pointer=function(e,f){this.game=e;this.id=f;this.type=b.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=false;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=false;this.position=new b.Point();this.positionDown=new b.Point();this.positionUp=new b.Point();this.circle=new b.Circle(0,0,44);if(f===0){this.isMouse=true}};b.Pointer.prototype={start:function(e){if(e.pointerId){this.pointerId=e.pointerId}this.identifier=e.identifier;this.target=e.target;if(typeof e.button!=="undefined"){this.button=e.button}this._history=[];this.active=true;this.withinGame=true;this.isDown=true;this.isUp=false;this.msSinceLastClick=this.game.time.now-this.timeDown;this.timeDown=this.game.time.now;this._holdSent=false;this.move(e,true);this.positionDown.setTo(this.x,this.y);if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.x,this.y);this.game.input.onDown.dispatch(this,e);this.game.input.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(!this.isMouse){this.game.input.currentPointers++}if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){if(this.active){if(this._holdSent===false&&this.duration>=this.game.input.holdRate){if(this.game.input.multiInputOverride==b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride==b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onHold.dispatch(this)}this._holdSent=true}if(this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop){this._nextDrop=this.game.time.now+this.game.input.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>this.game.input.recordLimit){this._history.shift()}}}},move:function(g,h){if(this.game.input.pollLocked){return}if(typeof h==="undefined"){h=false}if(typeof g.button!=="undefined"){this.button=g.button}this.clientX=g.clientX;this.clientY=g.clientY;this.pageX=g.pageX;this.pageY=g.pageY;this.screenX=g.screenX;this.screenY=g.screenY;if(this.isMouse&&this.game.input.mouse.locked&&!h){this.rawMovementX=g.movementX||g.mozMovementX||g.webkitMovementX||0;this.rawMovementY=g.movementY||g.mozMovementY||g.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.stage.offset.x)*this.game.input.scale.x;this.y=(this.pageY-this.game.stage.offset.y)*this.game.input.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.activePointer=this;this.game.input.x=this.x;this.game.input.y=this.y;this.game.input.position.setTo(this.game.input.x,this.game.input.y);this.game.input.circle.x=this.game.input.x;this.game.input.circle.y=this.game.input.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}if(this.game.input.moveCallback){this.game.input.moveCallback.call(this.game.input.moveCallbackContext,this,this.x,this.y)}var f=this.game.input.moveCallbacks.length;while(f--){this.game.input.moveCallbacks[f].callback.call(this.game.input.moveCallbacks[f].context,this,this.x,this.y)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}return this}this._highestRenderOrderID=Number.MAX_SAFE_INTEGER;this._highestRenderObject=null;this._highestInputPriorityID=-1;if(this.game.input.interactiveItems.total>0){var e=this.game.input.interactiveItems.first;do{if(e&&e.validForInput(this._highestInputPriorityID,this._highestRenderOrderID)){if((!h&&e.checkPointerOver(this))||(h&&e.checkPointerDown(this))){this._highestRenderOrderID=e.sprite._cache[3];this._highestInputPriorityID=e.priorityID;this._highestRenderObject=e}}e=this.game.input.interactiveItems.next}while(e!==null)}if(this._highestRenderObject===null){if(this.targetObject){this.targetObject._pointerOutHandler(this);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=this._highestRenderObject;this._highestRenderObject._pointerOverHandler(this)}else{if(this.targetObject===this._highestRenderObject){if(this._highestRenderObject.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this);this.targetObject=this._highestRenderObject;this.targetObject._pointerOverHandler(this)}}}return this},leave:function(e){this.withinGame=false;this.move(e,false)},stop:function(e){if(this._stateReset){e.preventDefault();return}this.timeUp=this.game.time.now;if(this.game.input.multiInputOverride===b.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===b.Input.MOUSE_TOUCH_COMBINE||(this.game.input.multiInputOverride===b.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)){this.game.input.onUp.dispatch(this,e);if(this.duration>=0&&this.duration<=this.game.input.tapRate){if(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate){this.game.input.onTap.dispatch(this,true)}else{this.game.input.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.id>0){this.active=false}this.withinGame=false;this.isDown=false;this.isUp=true;this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){this.game.input.currentPointers--}this.game.input.interactiveItems.callAll("_releasedHandler",this);this.targetObject=null;return this},justPressed:function(e){e=e||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+e)>this.game.time.now)},justReleased:function(e){e=e||this.game.input.justReleasedRate;return(this.isUp===true&&(this.timeUp+e)>this.game.time.now)},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.isDown=false;this.isUp=true;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};b.Pointer.prototype.constructor=b.Pointer;Object.defineProperty(b.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.now-this.timeDown}});Object.defineProperty(b.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(b.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});b.Touch=function(e){this.game=e;this.disabled=false;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};b.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var e=this;if(this.game.device.touch){this._onTouchStart=function(f){return e.onTouchStart(f)};this._onTouchMove=function(f){return e.onTouchMove(f)};this._onTouchEnd=function(f){return e.onTouchEnd(f)};this._onTouchEnter=function(f){return e.onTouchEnter(f)};this._onTouchLeave=function(f){return e.onTouchLeave(f)};this._onTouchCancel=function(f){return e.onTouchCancel(f)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false)}},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},onTouchStart:function(f){this.event=f;if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,f)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){f.preventDefault()}for(var e=0;e<f.changedTouches.length;e++){this.game.input.startPointer(f.changedTouches[e])}},onTouchCancel:function(f){this.event=f;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,f)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){f.preventDefault()}for(var e=0;e<f.changedTouches.length;e++){this.game.input.stopPointer(f.changedTouches[e])}},onTouchEnter:function(e){console.log("touch enter",e);this.event=e;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,e)}if(this.game.input.disabled||this.disabled){return}if(this.preventDefault){e.preventDefault()}},onTouchLeave:function(e){this.event=e;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,e)}if(this.preventDefault){e.preventDefault()}},onTouchMove:function(f){this.event=f;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,f)}if(this.preventDefault){f.preventDefault()}for(var e=0;e<f.changedTouches.length;e++){this.game.input.updatePointer(f.changedTouches[e])}},onTouchEnd:function(f){this.event=f;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,f)}if(this.preventDefault){f.preventDefault()}for(var e=0;e<f.changedTouches.length;e++){this.game.input.stopPointer(f.changedTouches[e])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};b.Touch.prototype.constructor=b.Touch;b.Gamepad=function(e){this.game=e;this._gamepads=[new b.SinglePad(e,this),new b.SinglePad(e,this),new b.SinglePad(e,this),new b.SinglePad(e,this)];this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.disabled=false;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!=-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null};b.Gamepad.prototype={addCallbacks:function(e,f){if(typeof f!=="undefined"){this.onConnectCallback=(typeof f.onConnect==="function")?f.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof f.onDisconnect==="function")?f.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof f.onDown==="function")?f.onDown:this.onDownCallback;this.onUpCallback=(typeof f.onUp==="function")?f.onUp:this.onUpCallback;this.onAxisCallback=(typeof f.onAxis==="function")?f.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof f.onFloat==="function")?f.onFloat:this.onFloatCallback}},start:function(){if(this._active){return}this._active=true;var e=this;this._ongamepadconnected=function(g){var f=g.gamepad;e._rawPads.push(f);e._gamepads[f.index].connect(f)};window.addEventListener("gamepadconnected",this._ongamepadconnected,false);this._ongamepaddisconnected=function(g){var h=g.gamepad;for(var f in e._rawPads){if(e._rawPads[f].index===h.index){e._rawPads.splice(f,1)}}e._gamepads[h.index].disconnect()};window.addEventListener("gamepaddisconnected",this._ongamepaddisconnected,false)},update:function(){this._pollGamepads();for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e]._connected){this._gamepads[e].pollStatus()}}},_pollGamepads:function(){var e=navigator.getGamepads||(navigator.webkitGetGamepads&&navigator.webkitGetGamepads())||navigator.webkitGamepads;if(e){this._rawPads=[];var p=false;for(var o=0;o<e.length;o++){if(typeof e[o]!==this._prevRawGamepadTypes[o]){p=true;this._prevRawGamepadTypes[o]=typeof e[o]}if(e[o]){this._rawPads.push(e[o])}if(o===3){break}}if(p){var s={rawIndices:{},padIndices:{}};var r;for(var n=0;n<this._gamepads.length;n++){r=this._gamepads[n];if(r.connected){for(var h=0;h<this._rawPads.length;h++){if(this._rawPads[h].index===r.index){s.rawIndices[r.index]=true;s.padIndices[n]=true}}}}for(var g=0;g<this._gamepads.length;g++){r=this._gamepads[g];if(s.padIndices[g]){continue}if(this._rawPads.length<1){r.disconnect()}for(var f=0;f<this._rawPads.length;f++){if(s.padIndices[g]){break}var q=this._rawPads[f];if(q){if(s.rawIndices[q.index]){r.disconnect();continue}else{r.connect(q);s.rawIndices[q.index]=true;s.padIndices[g]=true}}else{r.disconnect()}}}}}},setDeadZones:function(f){for(var e=0;e<this._gamepads.length;e++){this._gamepads[e].deadZone=f}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._ongamepadconnected);window.removeEventListener("gamepaddisconnected",this._ongamepaddisconnected)},reset:function(){this.update();for(var e=0;e<this._gamepads.length;e++){this._gamepads[e].reset()}},justPressed:function(e,g){for(var f=0;f<this._gamepads.length;f++){if(this._gamepads[f].justPressed(e,g)===true){return true}}return false},justReleased:function(e,g){for(var f=0;f<this._gamepads.length;f++){if(this._gamepads[f].justReleased(e,g)===true){return true}}return false},isDown:function(e){for(var f=0;f<this._gamepads.length;f++){if(this._gamepads[f].isDown(e)===true){return true}}return false}};b.Gamepad.prototype.constructor=b.Gamepad;Object.defineProperty(b.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(b.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(b.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(b.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(b.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(b.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(b.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});b.Gamepad.BUTTON_0=0;b.Gamepad.BUTTON_1=1;b.Gamepad.BUTTON_2=2;b.Gamepad.BUTTON_3=3;b.Gamepad.BUTTON_4=4;b.Gamepad.BUTTON_5=5;b.Gamepad.BUTTON_6=6;b.Gamepad.BUTTON_7=7;b.Gamepad.BUTTON_8=8;b.Gamepad.BUTTON_9=9;b.Gamepad.BUTTON_10=10;b.Gamepad.BUTTON_11=11;b.Gamepad.BUTTON_12=12;b.Gamepad.BUTTON_13=13;b.Gamepad.BUTTON_14=14;b.Gamepad.BUTTON_15=15;b.Gamepad.AXIS_0=0;b.Gamepad.AXIS_1=1;b.Gamepad.AXIS_2=2;b.Gamepad.AXIS_3=3;b.Gamepad.AXIS_4=4;b.Gamepad.AXIS_5=5;b.Gamepad.AXIS_6=6;b.Gamepad.AXIS_7=7;b.Gamepad.AXIS_8=8;b.Gamepad.AXIS_9=9;b.Gamepad.XBOX360_A=0;b.Gamepad.XBOX360_B=1;b.Gamepad.XBOX360_X=2;b.Gamepad.XBOX360_Y=3;b.Gamepad.XBOX360_LEFT_BUMPER=4;b.Gamepad.XBOX360_RIGHT_BUMPER=5;b.Gamepad.XBOX360_LEFT_TRIGGER=6;b.Gamepad.XBOX360_RIGHT_TRIGGER=7;b.Gamepad.XBOX360_BACK=8;b.Gamepad.XBOX360_START=9;b.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;b.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;b.Gamepad.XBOX360_DPAD_LEFT=14;b.Gamepad.XBOX360_DPAD_RIGHT=15;b.Gamepad.XBOX360_DPAD_UP=12;b.Gamepad.XBOX360_DPAD_DOWN=13;b.Gamepad.XBOX360_STICK_LEFT_X=0;b.Gamepad.XBOX360_STICK_LEFT_Y=1;b.Gamepad.XBOX360_STICK_RIGHT_X=2;b.Gamepad.XBOX360_STICK_RIGHT_Y=3;b.SinglePad=function(e,f){this.game=e;this._padParent=f;this._index=null;this._rawPad=null;this._connected=false;this._prevTimestamp=null;this._rawButtons=[];this._buttons=[];this._axes=[];this._hotkeys=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26};b.SinglePad.prototype={addCallbacks:function(e,f){if(typeof f!=="undefined"){this.onConnectCallback=(typeof f.onConnect==="function")?f.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof f.onDisconnect==="function")?f.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof f.onDown==="function")?f.onDown:this.onDownCallback;this.onUpCallback=(typeof f.onUp==="function")?f.onUp:this.onUpCallback;this.onAxisCallback=(typeof f.onAxis==="function")?f.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof f.onFloat==="function")?f.onFloat:this.onFloatCallback}},addButton:function(e){this._hotkeys[e]=new b.GamepadButton(this.game,e);return this._hotkeys[e]},pollStatus:function(){if(this._rawPad.timestamp&&(this._rawPad.timestamp==this._prevTimestamp)){return}for(var g=0;g<this._rawPad.buttons.length;g+=1){var e=this._rawPad.buttons[g];if(this._rawButtons[g]!==e){if(e===1){this.processButtonDown(g,e)}else{if(e===0){this.processButtonUp(g,e)}else{this.processButtonFloat(g,e)}}this._rawButtons[g]=e}}var k=this._rawPad.axes;for(var f=0;f<k.length;f+=1){var h=k[f];if(h>0&&h>this.deadZone||h<0&&h<-this.deadZone){this.processAxisChange({axis:f,value:h})}else{this.processAxisChange({axis:f,value:0})}}this._prevTimestamp=this._rawPad.timestamp},connect:function(e){var f=!this._connected;this._index=e.index;this._connected=true;this._rawPad=e;this._rawButtons=e.buttons;this._axes=e.axes;if(f&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this._index)}if(f&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var f=this._connected;this._connected=false;this._rawPad=undefined;this._rawButtons=[];this._buttons=[];var e=this._index;this._index=null;if(f&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e)}if(f&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},processAxisChange:function(e){if(this.game.input.disabled||this.game.input.gamepad.disabled){return}if(this._axes[e.axis]===e.value){return}this._axes[e.axis]=e.value;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,e,this._index)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,e)}},processButtonDown:function(e,f){if(this.game.input.disabled||this.game.input.gamepad.disabled){return}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,e,f,this._index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,e,f)}if(this._buttons[e]&&this._buttons[e].isDown){this._buttons[e].duration=this.game.time.now-this._buttons[e].timeDown}else{if(!this._buttons[e]){this._buttons[e]={isDown:true,timeDown:this.game.time.now,timeUp:0,duration:0,value:f}}else{this._buttons[e].isDown=true;this._buttons[e].timeDown=this.game.time.now;this._buttons[e].duration=0;this._buttons[e].value=f}}if(this._hotkeys[e]){this._hotkeys[e].processButtonDown(f)}},processButtonUp:function(e,f){if(this.game.input.disabled||this.game.input.gamepad.disabled){return}if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,e,f,this._index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,e,f)}if(this._hotkeys[e]){this._hotkeys[e].processButtonUp(f)}if(this._buttons[e]){this._buttons[e].isDown=false;this._buttons[e].timeUp=this.game.time.now;this._buttons[e].value=f}else{this._buttons[e]={isDown:false,timeDown:this.game.time.now,timeUp:this.game.time.now,duration:0,value:f}}},processButtonFloat:function(e,f){if(this.game.input.disabled||this.game.input.gamepad.disabled){return}if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,e,f,this._index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,e,f)}if(!this._buttons[e]){this._buttons[e]={value:f}}else{this._buttons[e].value=f}if(this._hotkeys[e]){this._hotkeys[e].processButtonFloat(f)}},axis:function(e){if(this._axes[e]){return this._axes[e]}return false},isDown:function(e){if(this._buttons[e]){return this._buttons[e].isDown}return false},justReleased:function(e,f){if(typeof f==="undefined"){f=250}return(this._buttons[e]&&this._buttons[e].isDown===false&&(this.game.time.now-this._buttons[e].timeUp<f))},justPressed:function(e,f){if(typeof f==="undefined"){f=250}return(this._buttons[e]&&this._buttons[e].isDown&&this._buttons[e].duration<f)},buttonValue:function(e){if(this._buttons[e]){return this._buttons[e].value}return false},reset:function(){for(var f=0;f<this._buttons.length;f++){this._buttons[f]=0}for(var e=0;e<this._axes.length;e++){this._axes[e]=0}}};b.SinglePad.prototype.constructor=b.SinglePad;Object.defineProperty(b.SinglePad.prototype,"connected",{get:function(){return this._connected}});Object.defineProperty(b.SinglePad.prototype,"index",{get:function(){return this._index}});b.GamepadButton=function(e,f){this.game=e;this.isDown=false;this.isUp=true;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=f;this.onDown=new b.Signal();this.onUp=new b.Signal();this.onFloat=new b.Signal()};b.GamepadButton.prototype={processButtonDown:function(e){if(this.isDown){this.duration=this.game.time.now-this.timeDown;this.repeats++}else{this.isDown=true;this.isUp=false;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0;this.value=e;this.onDown.dispatch(this,e)}},processButtonUp:function(e){this.isDown=false;this.isUp=true;this.timeUp=this.game.time.now;this.value=e;this.onUp.dispatch(this,e)},processButtonFloat:function(e){this.value=e;this.onFloat.dispatch(this,e)},justPressed:function(e){if(typeof e==="undefined"){e=250}return(this.isDown&&this.duration<e)},justReleased:function(e){if(typeof e==="undefined"){e=250}return(this.isDown===false&&(this.game.time.now-this.timeUp<e))}};b.GamepadButton.prototype.constructor=b.GamepadButton;b.InputHandler=function(e){this.sprite=e;this.game=e.game;this.enabled=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=false;this._dragPhase=false;this._wasEnabled=false;this._tempPoint=new b.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};b.InputHandler.prototype={start:function(g,e){g=g||0;if(typeof e==="undefined"){e=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=e;this.priorityID=g;for(var f=0;f<10;f++){this._pointerData[f]={id:f,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new b.Point();this.enabled=true;this._wasEnabled=true;if(this.sprite.events&&this.sprite.events.onInputOver===null){this.sprite.events.onInputOver=new b.Signal();this.sprite.events.onInputOut=new b.Signal();this.sprite.events.onInputDown=new b.Signal();this.sprite.events.onInputUp=new b.Signal();this.sprite.events.onDragStart=new b.Signal();this.sprite.events.onDragStop=new b.Signal()}}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;for(var e=0;e<10;e++){this._pointerData[e]={id:e,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(f,e){if(this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID){return false}if(this.pixelPerfectClick||this.pixelPerfectOver){return true}if(this.priorityID>f||(this.priorityID===f&&this.sprite._cache[3]<e)){return true}return false},pointerX:function(e){e=e||0;return this._pointerData[e].x},pointerY:function(e){e=e||0;return this._pointerData[e].y},pointerDown:function(e){e=e||0;return this._pointerData[e].isDown},pointerUp:function(e){e=e||0;return this._pointerData[e].isUp},pointerTimeDown:function(e){e=e||0;return this._pointerData[e].timeDown},pointerTimeUp:function(e){e=e||0;return this._pointerData[e].timeUp},pointerOver:function(e){if(this.enabled){if(typeof e==="undefined"){for(var f=0;f<10;f++){if(this._pointerData[f].isOver){return true}}}else{return this._pointerData[e].isOver}}return false},pointerOut:function(e){if(this.enabled){if(typeof e==="undefined"){for(var f=0;f<10;f++){if(this._pointerData[f].isOut){return true}}}else{return this._pointerData[e].isOut}}return false},pointerTimeOver:function(e){e=e||0;return this._pointerData[e].timeOver},pointerTimeOut:function(e){e=e||0;return this._pointerData[e].timeOut},pointerDragged:function(e){e=e||0;return this._pointerData[e].isDragged},checkPointerDown:function(e){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,e,this._tempPoint)){if(this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(e){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible){return false}if(this.game.input.hitTest(this.sprite,e,this._tempPoint)){if(this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(e,h,g){if(this.sprite.texture.baseTexture.source){this.game.input.hitContext.clearRect(0,0,1,1);if(e===null&&h===null){this.game.input.getLocalPosition(this.sprite,g,this._tempPoint);var e=this._tempPoint.x;var h=this._tempPoint.y}if(this.sprite.anchor.x!==0){e-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){h-=-this.sprite.texture.frame.height*this.sprite.anchor.y}e+=this.sprite.texture.frame.x;h+=this.sprite.texture.frame.y;this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,e,h,1,1,0,0,1,1);var f=this.game.input.hitContext.getImageData(0,0,1,1);if(f.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(e){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(e);return false}if(this.draggable&&this._draggedPointerID==e.id){return this.updateDrag(e)}else{if(this._pointerData[e.id].isOver===true){if(this.checkPointerOver(e)){this._pointerData[e.id].x=e.x-this.sprite.x;this._pointerData[e.id].y=e.y-this.sprite.y;return true}else{this._pointerOutHandler(e);return false}}}},_pointerOverHandler:function(e){if(this.sprite===null){return}if(this._pointerData[e.id].isOver===false){this._pointerData[e.id].isOver=true;this._pointerData[e.id].isOut=false;this._pointerData[e.id].timeOver=this.game.time.now;this._pointerData[e.id].x=e.x-this.sprite.x;this._pointerData[e.id].y=e.y-this.sprite.y;if(this.useHandCursor&&this._pointerData[e.id].isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOver.dispatch(this.sprite,e)}}},_pointerOutHandler:function(e){if(this.sprite===null){return}this._pointerData[e.id].isOver=false;this._pointerData[e.id].isOut=true;this._pointerData[e.id].timeOut=this.game.time.now;if(this.useHandCursor&&this._pointerData[e.id].isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(this.sprite&&this.sprite.events){this.sprite.events.onInputOut.dispatch(this.sprite,e)}},_touchedHandler:function(e){if(this.sprite===null){return}if(this._pointerData[e.id].isDown===false&&this._pointerData[e.id].isOver===true){if(this.pixelPerfectClick&&!this.checkPixel(null,null,e)){return}this._pointerData[e.id].isDown=true;this._pointerData[e.id].isUp=false;this._pointerData[e.id].timeDown=this.game.time.now;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown.dispatch(this.sprite,e)}if(this.draggable&&this.isDragged===false){this.startDrag(e)}if(this.bringToTop){this.sprite.bringToTop()}}return this.consumePointerEvent},_releasedHandler:function(e){if(this.sprite===null){return}if(this._pointerData[e.id].isDown&&e.isUp){this._pointerData[e.id].isDown=false;this._pointerData[e.id].isUp=true;this._pointerData[e.id].timeUp=this.game.time.now;this._pointerData[e.id].downDuration=this._pointerData[e.id].timeUp-this._pointerData[e.id].timeDown;if(this.checkPointerOver(e)){if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp.dispatch(this.sprite,e,true)}}else{if(this.sprite&&this.sprite.events){this.sprite.events.onInputUp.dispatch(this.sprite,e,false)}if(this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}}if(this.draggable&&this.isDragged&&this._draggedPointerID===e.id){this.stopDrag(e)}}},updateDrag:function(e){if(e.isUp){this.stopDrag(e);return false}if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=e.x+this._dragPoint.x+this.dragOffset.x}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=e.y+this._dragPoint.y+this.dragOffset.y}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}else{if(this.allowHorizontalDrag){this.sprite.x=e.x+this._dragPoint.x+this.dragOffset.x}if(this.allowVerticalDrag){this.sprite.y=e.y+this._dragPoint.y+this.dragOffset.y}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}return true},justOver:function(f,e){f=f||0;e=e||500;return(this._pointerData[f].isOver&&this.overDuration(f)<e)},justOut:function(f,e){f=f||0;e=e||500;return(this._pointerData[f].isOut&&(this.game.time.now-this._pointerData[f].timeOut<e))},justPressed:function(f,e){f=f||0;e=e||500;return(this._pointerData[f].isDown&&this.downDuration(f)<e)},justReleased:function(f,e){f=f||0;e=e||500;return(this._pointerData[f].isUp&&(this.game.time.now-this._pointerData[f].timeUp<e))},overDuration:function(e){e=e||0;if(this._pointerData[e].isOver){return this.game.time.now-this._pointerData[e].timeOver}return -1},downDuration:function(e){e=e||0;if(this._pointerData[e].isDown){return this.game.time.now-this._pointerData[e].timeDown}return -1},enableDrag:function(f,i,e,h,j,g){if(typeof f=="undefined"){f=false}if(typeof i=="undefined"){i=false}if(typeof e=="undefined"){e=false}if(typeof h=="undefined"){h=255}if(typeof j=="undefined"){j=null}if(typeof g=="undefined"){g=null}this._dragPoint=new b.Point();this.draggable=true;this.bringToTop=i;this.dragOffset=new b.Point();this.dragFromCenter=f;this.pixelPerfect=e;this.pixelPerfectAlpha=h;if(j){this.boundsRect=j}if(g){this.boundsSprite=g}},disableDrag:function(){if(this._pointerData){for(var e=0;e<10;e++){this._pointerData[e].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1},startDrag:function(f){this.isDragged=true;this._draggedPointerID=f.id;this._pointerData[f.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){this.sprite.centerOn(f.x,f.y);this._dragPoint.setTo(this.sprite.cameraOffset.x-f.x,this.sprite.cameraOffset.y-f.y)}else{this._dragPoint.setTo(this.sprite.cameraOffset.x-f.x,this.sprite.cameraOffset.y-f.y)}}else{if(this.dragFromCenter){var e=this.sprite.getBounds();this.sprite.x=f.x+(this.sprite.x-e.centerX);this.sprite.y=f.y+(this.sprite.y-e.centerY);this._dragPoint.setTo(this.sprite.x-f.x,this.sprite.y-f.y)}else{this._dragPoint.setTo(this.sprite.x-f.x,this.sprite.y-f.y)}}this.updateDrag(f);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.sprite.events.onDragStart.dispatch(this.sprite,f)},stopDrag:function(e){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[e.id].isDragged=false;this._dragPhase=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop.dispatch(this.sprite,e);if(this.checkPointerOver(e)===false){this._pointerOutHandler(e)}},setDragLock:function(e,f){if(typeof e=="undefined"){e=true}if(typeof f=="undefined"){f=true}this.allowHorizontalDrag=e;this.allowVerticalDrag=f},enableSnap:function(h,g,f,e,j,i){if(typeof f=="undefined"){f=true}if(typeof e=="undefined"){e=false}if(typeof j=="undefined"){j=0}if(typeof i=="undefined"){i=0}this.snapX=h;this.snapY=g;this.snapOffsetX=j;this.snapOffsetY=i;this.snapOnDrag=f;this.snapOnRelease=e},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.x<this.boundsRect.left){this.sprite.x=this.boundsRect.x}else{if((this.sprite.x+this.sprite.width)>this.boundsRect.right){this.sprite.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.y<this.boundsRect.top){this.sprite.y=this.boundsRect.top}else{if((this.sprite.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-this.sprite.height}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.camerOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.camerOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.camerOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.camerOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.x<this.boundsSprite.x){this.sprite.x=this.boundsSprite.x}else{if((this.sprite.x+this.sprite.width)>(this.boundsSprite.x+this.boundsSprite.width)){this.sprite.x=(this.boundsSprite.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.y<this.boundsSprite.y){this.sprite.y=this.boundsSprite.y}else{if((this.sprite.y+this.sprite.height)>(this.boundsSprite.y+this.boundsSprite.height)){this.sprite.y=(this.boundsSprite.y+this.boundsSprite.height)-this.sprite.height}}}}};b.InputHandler.prototype.constructor=b.InputHandler;b.Events=function(e){this.parent=e;this.onAddedToGroup=new b.Signal();this.onRemovedFromGroup=new b.Signal();this.onKilled=new b.Signal();this.onRevived=new b.Signal();this.onOutOfBounds=new b.Signal();this.onEnterBounds=new b.Signal();this.onInputOver=null;this.onInputOut=null;this.onInputDown=null;this.onInputUp=null;this.onDragStart=null;this.onDragStop=null;this.onAnimationStart=null;this.onAnimationComplete=null;this.onAnimationLoop=null};b.Events.prototype={destroy:function(){this.parent=null;this.onAddedToGroup.dispose();this.onRemovedFromGroup.dispose();this.onKilled.dispose();this.onRevived.dispose();this.onOutOfBounds.dispose();if(this.onInputOver){this.onInputOver.dispose();this.onInputOut.dispose();this.onInputDown.dispose();this.onInputUp.dispose();this.onDragStart.dispose();this.onDragStop.dispose()}if(this.onAnimationStart){this.onAnimationStart.dispose();this.onAnimationComplete.dispose();this.onAnimationLoop.dispose()}}};b.Events.prototype.constructor=b.Events;b.GameObjectFactory=function(e){this.game=e;this.world=this.game.world};b.GameObjectFactory.prototype={existing:function(e){return this.world.add(e)},image:function(e,i,f,h,g){if(typeof g==="undefined"){g=this.world}return g.add(new b.Image(this.game,e,i,f,h))},sprite:function(e,i,f,h,g){if(typeof g==="undefined"){g=this.world}return g.create(e,i,f,h)},tween:function(e){return this.game.tweens.create(e)},group:function(h,f,e,i,g){return new b.Group(this.game,h,f,e,i,g)},physicsGroup:function(h,g,f,e){return new b.Group(this.game,g,f,e,true,h)},spriteBatch:function(g,f,e){if(typeof f==="undefined"){f="group"}if(typeof e==="undefined"){e=false}return new b.SpriteBatch(this.game,g,f,e)},audio:function(g,h,e,f){return this.game.sound.add(g,h,e,f)},sound:function(g,h,e,f){return this.game.sound.add(g,h,e,f)},tileSprite:function(f,k,h,e,g,j,i){if(typeof i==="undefined"){i=this.world}return i.add(new b.TileSprite(this.game,f,k,h,e,g,j))},text:function(e,i,h,f,g){if(typeof g==="undefined"){g=this.world}return g.add(new b.Text(this.game,e,i,h,f))},button:function(k,j,m,n,f,g,e,h,i,l){if(typeof l==="undefined"){l=this.world}return l.add(new b.Button(this.game,k,j,m,n,f,g,e,h,i))},graphics:function(e,g,f){if(typeof f==="undefined"){f=this.world}return f.add(new b.Graphics(this.game,e,g))},emitter:function(e,g,f){return this.game.particles.add(new b.Particles.Arcade.Emitter(this.game,e,g,f))},retroFont:function(f,e,h,k,m,l,i,j,g){return new b.RetroFont(this.game,f,e,h,k,m,l,i,j,g)},bitmapText:function(e,j,f,i,g,h){if(typeof h==="undefined"){h=this.world}return h.add(new b.BitmapText(this.game,e,j,f,i,g))},tilemap:function(g,i,f,h,e){return new b.Tilemap(this.game,g,i,f,h,e)},renderTexture:function(h,f,g,e){if(typeof g==="undefined"||g===""){g=this.game.rnd.uuid()}if(typeof e==="undefined"){e=false}var i=new b.RenderTexture(this.game,h,f,g);if(e){this.game.cache.addRenderTexture(g,i)}return i},bitmapData:function(h,f,g,e){if(typeof e==="undefined"){e=false}if(typeof g==="undefined"||g===""){g=this.game.rnd.uuid()}var i=new b.BitmapData(this.game,g,h,f);if(e){this.game.cache.addBitmapData(g,i)}return i},filter:function(f){var e=Array.prototype.splice.call(arguments,1);var f=new b.Filter[f](this.game);f.init.apply(f,e);return f}};b.GameObjectFactory.prototype.constructor=b.GameObjectFactory;b.GameObjectCreator=function(e){this.game=e;this.world=this.game.world};b.GameObjectCreator.prototype={image:function(e,h,f,g){return new b.Image(this.game,e,h,f,g)},sprite:function(e,h,f,g){return new b.Sprite(this.game,e,h,f,g)},tween:function(e){return new b.Tween(e,this.game)},group:function(h,f,e,i,g){return new b.Group(this.game,null,f,e,i,g)},spriteBatch:function(g,f,e){if(typeof f==="undefined"){f="group"}if(typeof e==="undefined"){e=false}return new b.SpriteBatch(this.game,g,f,e)},audio:function(g,h,e,f){return this.game.sound.add(g,h,e,f)},sound:function(g,h,e,f){return this.game.sound.add(g,h,e,f)},tileSprite:function(f,j,h,e,g,i){return new b.TileSprite(this.game,f,j,h,e,g,i)},text:function(e,h,g,f){return new b.Text(this.game,e,h,g,f)},button:function(k,j,l,m,f,g,e,h,i){return new b.Button(this.game,k,j,l,m,f,g,e,h,i)},graphics:function(e,f){return new b.Graphics(this.game,e,f)},emitter:function(e,g,f){return new b.Particles.Arcade.Emitter(this.game,e,g,f)},retroFont:function(f,e,h,k,m,l,i,j,g){return new b.RetroFont(this.game,f,e,h,k,m,l,i,j,g)},bitmapText:function(e,i,f,h,g){return new b.BitmapText(this.game,e,i,f,h,g)},tilemap:function(g,i,f,h,e){return new b.Tilemap(this.game,g,i,f,h,e)},renderTexture:function(h,f,g,e){if(typeof g==="undefined"||g===""){g=this.game.rnd.uuid()}if(typeof e==="undefined"){e=false}var i=new b.RenderTexture(this.game,h,f,g);if(e){this.game.cache.addRenderTexture(g,i)}return i},bitmapData:function(h,f,g,e){if(typeof e==="undefined"){e=false}if(typeof g==="undefined"||g===""){g=this.game.rnd.uuid()}var i=new b.BitmapData(this.game,g,h,f);if(e){this.game.cache.addBitmapData(g,i)}return i},filter:function(f){var e=Array.prototype.splice.call(arguments,1);var f=new b.Filter[f](this.game);f.init.apply(f,e);return f}};b.GameObjectCreator.prototype.constructor=b.GameObjectCreator;b.BitmapData=function(f,g,h,e){if(typeof h==="undefined"){h=100}if(typeof e==="undefined"){e=100}this.game=f;this.key=g;this.width=h;this.height=e;this.canvas=b.Canvas.create(h,e,"",true);this.context=this.canvas.getContext("2d");this.ctx=this.context;this.imageData=this.context.getImageData(0,0,h,e);this.data=this.imageData.data;this.pixels=null;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,h,e,"bitmapData",f.rnd.uuid());this.type=b.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this.update=this.refreshBuffer;this._tempR=0;this._tempG=0;this._tempB=0};b.BitmapData.prototype={add:function(e){if(Array.isArray(e)){for(var f=0;f<e.length;f++){if(e[f]["loadTexture"]){e[f].loadTexture(this)}}}else{e.loadTexture(this)}},clear:function(){this.context.clearRect(0,0,this.width,this.height);this.dirty=true},fill:function(i,h,e,f){if(typeof f==="undefined"){f=1}this.context.fillStyle="rgba("+i+","+h+","+e+","+f+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true},resize:function(f,e){if(f!==this.width||e!==this.height){this.width=f;this.height=e;this.canvas.width=f;this.canvas.height=e;this.textureFrame.width=f;this.textureFrame.height=e;this.refreshBuffer()}this.dirty=true},refreshBuffer:function(f,h,g,e){if(typeof f==="undefined"){f=0}if(typeof h==="undefined"){h=0}if(typeof g==="undefined"){g=this.width}if(typeof e==="undefined"){e=this.height}this.imageData=this.context.getImageData(f,h,g,e);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}},processPixelRGB:function(p,i,n,m,g,q){if(typeof n==="undefined"){n=0}if(typeof m==="undefined"){m=0}if(typeof g==="undefined"){g=this.width}if(typeof q==="undefined"){q=this.height}var o=n+g;var l=m+q;var f=b.Color.createColor();var r={r:0,g:0,b:0,a:0};var e=false;for(var j=m;j<l;j++){for(var k=n;k<o;k++){b.Color.unpackPixel(this.getPixel32(k,j),f);r=p.call(i,f,k,j);if(r!==false&&r!==null&&r!==undefined){this.setPixel32(k,j,r.r,r.g,r.b,r.a,false);e=true}}}if(e){this.context.putImageData(this.imageData,0,0);this.dirty=true}},processPixel:function(p,i,n,m,g,q){if(typeof n==="undefined"){n=0}if(typeof m==="undefined"){m=0}if(typeof g==="undefined"){g=this.width}if(typeof q==="undefined"){q=this.height}var o=n+g;var l=m+q;var f=0;var r=0;var e=false;for(var j=m;j<l;j++){for(var k=n;k<o;k++){f=this.getPixel32(k,j);r=p.call(i,f,k,j);if(r!==f){this.pixels[j*this.width+k]=r;e=true}}}if(e){this.context.putImageData(this.imageData,0,0);this.dirty=true}},replaceRGB:function(k,f,s,i,j,u,p,g,o){var r=0;var n=0;var t=this.width;var l=this.height;var e=b.Color.packPixel(k,f,s,i);if(o!==undefined&&o instanceof b.Rectangle){r=o.x;n=o.y;t=o.width;l=o.height}for(var m=0;m<l;m++){for(var q=0;q<t;q++){if(this.getPixel32(r+q,n+m)===e){this.setPixel32(r+q,n+m,j,u,p,g,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true},setHSL:function(j,i,f,k){if(typeof j==="undefined"||j===null){j=false}if(typeof i==="undefined"||i===null){i=false}if(typeof f==="undefined"||f===null){f=false}if(!j&&!i&&!f){return}if(typeof k==="undefined"){k=new b.Rectangle(0,0,this.width,this.height)}var g=b.Color.createColor();for(var m=k.y;m<k.bottom;m++){for(var e=k.x;e<k.right;e++){b.Color.unpackPixel(this.getPixel32(e,m),g,true);if(j){g.h=j}if(i){g.s=i}if(f){g.l=f}b.Color.HSLtoRGB(g.h,g.s,g.l,g);this.setPixel32(e,m,g.r,g.g,g.b,g.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true},shiftHSL:function(j,i,f,k){if(typeof j==="undefined"||j===null){j=false}if(typeof i==="undefined"||i===null){i=false}if(typeof f==="undefined"||f===null){f=false}if(!j&&!i&&!f){return}if(typeof k==="undefined"){k=new b.Rectangle(0,0,this.width,this.height)}var g=b.Color.createColor();for(var m=k.y;m<k.bottom;m++){for(var e=k.x;e<k.right;e++){b.Color.unpackPixel(this.getPixel32(e,m),g,true);if(j){g.h=this.game.math.wrap(g.h+j,0,1)}if(i){g.s=this.game.math.limitValue(g.s+i,0,1)}if(f){g.l=this.game.math.limitValue(g.l+f,0,1)}b.Color.HSLtoRGB(g.h,g.s,g.l,g);this.setPixel32(e,m,g.r,g.g,g.b,g.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true},setPixel32:function(f,k,j,h,e,i,g){if(typeof g==="undefined"){g=true}if(f>=0&&f<=this.width&&k>=0&&k<=this.height){if(b.Device.LITTLE_ENDIAN){this.pixels[k*this.width+f]=(i<<24)|(e<<16)|(h<<8)|j}else{this.pixels[k*this.width+f]=(j<<24)|(h<<16)|(e<<8)|i}if(g){this.context.putImageData(this.imageData,0,0);this.dirty=true}}},setPixel:function(f,j,i,h,e,g){this.setPixel32(f,j,i,h,e,255,g)},getPixel:function(e,h,g){if(!g){g=b.Color.createColor()}var f=~~(e+(h*this.width));f*=4;if(this.data[f]){g.r=this.data[f];g.g=this.data[++f];g.b=this.data[++f];g.a=this.data[++f]}return g},getPixel32:function(e,f){if(e>=0&&e<=this.width&&f>=0&&f<=this.height){return this.pixels[f*this.width+e]}},getPixelRGB:function(e,i,h,f,g){return b.Color.unpackPixel(this.getPixel32(e,i),h,f,g)},getPixels:function(e){return this.context.getImageData(e.x,e.y,e.width,e.height)},copyPixels:function(h,g,f,e){if(typeof h==="string"){h=this.game.cache.getImage(h)}if(h){this.context.drawImage(h,g.x,g.y,g.width,g.height,f,e,g.width,g.height)}this.dirty=true},draw:function(f,e,g){if(typeof e==="undefined"){e=0}if(typeof g==="undefined"){g=0}if(typeof f==="string"){f=this.game.cache.getImage(f)}if(f){this.context.drawImage(f,0,0,f.width,f.height,e,g,f.width,f.height)}this.dirty=true},drawSprite:function(f,e,h){if(typeof e==="undefined"){e=0}if(typeof h==="undefined"){h=0}var g=f.texture.frame;this.context.drawImage(f.texture.baseTexture.source,g.x,g.y,g.width,g.height,e,h,g.width,g.height);this.dirty=true},alphaMask:function(g,e){var f=this.context.globalCompositeOperation;if(typeof e==="string"){e=this.game.cache.getImage(e)}if(e){this.context.drawImage(e,0,0)}this.context.globalCompositeOperation="source-atop";if(typeof g==="string"){g=this.game.cache.getImage(g)}if(g){this.context.drawImage(g,0,0)}this.context.globalCompositeOperation=f;this.dirty=true},extract:function(f,j,i,e,h){if(typeof h==="undefined"){h=255}this.processPixelRGB(function(k,g,l){if(k.r===j&&k.g===i&&k.b===e){f.setPixel32(g,l,j,i,e,h,false)}return false},this);f.context.putImageData(f.imageData,0,0);f.dirty=true;return f},rect:function(f,i,h,e,g){if(typeof g!=="undefined"){this.context.fillStyle=g}this.context.fillRect(f,i,h,e);this.context.fill()},circle:function(f,h,e,g){if(typeof g!=="undefined"){this.context.fillStyle=g}this.context.beginPath();this.context.arc(f,h,e,0,Math.PI*2,false);this.context.closePath();this.context.fill()},render:function(){if(!this.disableTextureUpload&&this.game.renderType===b.WEBGL&&this.dirty){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl);this.dirty=false}}};b.BitmapData.prototype.constructor=b.BitmapData;b.Sprite=function(f,e,i,g,h){e=e||0;i=i||0;g=g||null;h=h||null;this.game=f;this.name="";this.type=b.SPRITE;this.z=0;this.events=new b.Events(this);this.animations=new b.AnimationManager(this);this.key=g;this._frame=0;this._frameName="";PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.loadTexture(g,h);this.position.set(e,i);this.world=new b.Point(e,i);this.autoCull=false;this.input=null;this.body=null;this.health=1;this.lifespan=0;this.checkWorldBounds=false;this.outOfBoundsKill=false;this.debug=false;this.cameraOffset=new b.Point();this._cache=[0,0,0,0,1,0,1,0,0];this._bounds=new b.Rectangle()};b.Sprite.prototype=Object.create(PIXI.Sprite.prototype);b.Sprite.prototype.constructor=b.Sprite;b.Sprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(this.body){this.body.preUpdate()}this._cache[4]=0;return false}this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.lifespan>0){this.lifespan-=this.game.time.elapsed;if(this.lifespan<=0){this.kill();return false}}if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds())}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this._bounds)}if(this.checkWorldBounds){if(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)){this._cache[5]=0;this.events.onEnterBounds.dispatch(this)}else{if(this._cache[5]===0&&!this.game.world.bounds.intersects(this._bounds)){this._cache[5]=1;this.events.onOutOfBounds.dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}this.animations.update();if(this.body){this.body.preUpdate()}for(var f=0,e=this.children.length;f<e;f++){this.children[f].preUpdate()}return true};b.Sprite.prototype.update=function(){};b.Sprite.prototype.postUpdate=function(){if(this.key instanceof b.BitmapData){this.key.render()}if(this.exists&&this.body){this.body.postUpdate()}if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var f=0,e=this.children.length;f<e;f++){this.children[f].postUpdate()}};b.Sprite.prototype.loadTexture=function(e,f){f=f||0;if(e instanceof b.RenderTexture){this.key=e.key;this.setTexture(e);return}else{if(e instanceof b.BitmapData){this.key=e;this.setTexture(e.texture);return}else{if(e instanceof PIXI.Texture){this.key=e;this.setTexture(e);return}else{if(e===null||typeof e==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key]);return}else{if(typeof e==="string"&&!this.game.cache.checkImageKey(e)){this.key="__missing";this.setTexture(PIXI.TextureCache[this.key]);return}}if(this.game.cache.isSpriteSheet(e)){this.key=e;this.animations.loadFrameData(this.game.cache.getFrameData(e));if(typeof f==="string"){this.frameName=f}else{this.frame=f}}else{this.key=e;this.setTexture(PIXI.TextureCache[e]);return}}}}};b.Sprite.prototype.crop=function(f){if(typeof f==="undefined"||f===null){if(this.texture.hasOwnProperty("sourceWidth")){this.texture.setFrame(new b.Rectangle(0,0,this.texture.sourceWidth,this.texture.sourceHeight))}}else{if(this.texture instanceof PIXI.Texture){var e={};b.Utils.extend(true,e,this.texture);e.sourceWidth=e.width;e.sourceHeight=e.height;e.frame=f;e.width=f.width;e.height=f.height;this.texture=e;this.texture.updateFrame=true;PIXI.Texture.frameUpdates.push(this.texture)}else{this.texture.setFrame(f)}}};b.Sprite.prototype.revive=function(e){if(typeof e==="undefined"){e=1}this.alive=true;this.exists=true;this.visible=true;this.health=e;if(this.events){this.events.onRevived.dispatch(this)}return this};b.Sprite.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled.dispatch(this)}return this};b.Sprite.prototype.destroy=function(f){if(this.game===null||this._cache[8]===1){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}var e=this.children.length;if(f){while(e--){this.children[e].destroy(f)}}else{while(e--){this.removeChild(this.children[e])}}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Sprite.prototype.damage=function(e){if(this.alive){this.health-=e;if(this.health<=0){this.kill()}}return this};b.Sprite.prototype.reset=function(e,g,f){if(typeof f==="undefined"){f=1}this.world.setTo(e,g);this.position.x=e;this.position.y=g;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.health=f;if(this.body){this.body.reset(e,g,false,false)}this._cache[4]=1;return this};b.Sprite.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};b.Sprite.prototype.play=function(h,g,f,e){if(this.animations){return this.animations.play(h,g,f,e)}};b.Sprite.prototype.overlap=function(e){return b.Rectangle.intersects(this.getBounds(),e.getBounds())};Object.defineProperty(b.Sprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(e){this.rotation=b.Math.degToRad(b.Math.wrapAngle(e))}});Object.defineProperty(b.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(b.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(b.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(b.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(b.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(b.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}});Object.defineProperty(b.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}});Object.defineProperty(b.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(b.Sprite.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(e){if(e){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Sprite.prototype,"exists",{get:function(){return !!this._cache[6]},set:function(e){if(e){this._cache[6]=1;if(this.body&&this.body.type===b.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._cache[6]=0;if(this.body&&this.body.type===b.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}});Object.defineProperty(b.Sprite.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Sprite.prototype,"smoothed",{get:function(){return !this.texture.baseTexture.scaleMode},set:function(e){if(e){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}});Object.defineProperty(b.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.Sprite.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Image=function(f,e,i,g,h){e=e||0;i=i||0;g=g||null;h=h||null;this.game=f;this.exists=true;this.name="";this.type=b.IMAGE;this.z=0;this.events=new b.Events(this);this.key=g;this._frame=0;this._frameName="";PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.loadTexture(g,h);this.position.set(e,i);this.world=new b.Point(e,i);this.autoCull=false;this.input=null;this.cameraOffset=new b.Point();this._cache=[0,0,0,0,1,0,1,0,0]};b.Image.prototype=Object.create(PIXI.Sprite.prototype);b.Image.prototype.constructor=b.Image;b.Image.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}for(var f=0,e=this.children.length;f<e;f++){this.children[f].preUpdate()}return true};b.Image.prototype.update=function(){};b.Image.prototype.postUpdate=function(){if(this.key instanceof b.BitmapData){this.key.render()}if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var f=0,e=this.children.length;f<e;f++){this.children[f].postUpdate()}};b.Image.prototype.loadTexture=function(e,g){g=g||0;if(e instanceof b.RenderTexture){this.key=e.key;this.setTexture(e);return}else{if(e instanceof b.BitmapData){this.key=e;this.setTexture(e.texture);return}else{if(e instanceof PIXI.Texture){this.key=e;this.setTexture(e);return}else{if(e===null||typeof e==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key]);return}else{if(typeof e==="string"&&!this.game.cache.checkImageKey(e)){this.key="__missing";this.setTexture(PIXI.TextureCache[this.key]);return}}if(this.game.cache.isSpriteSheet(e)){this.key=e;var f=this.game.cache.getFrameData(e);if(typeof g==="string"){this._frame=0;this._frameName=g;this.setTexture(PIXI.TextureCache[f.getFrameByName(g).uuid]);return}else{this._frame=g;this._frameName="";this.setTexture(PIXI.TextureCache[f.getFrame(g).uuid]);return}}else{this.key=e;this.setTexture(PIXI.TextureCache[e]);return}}}}};b.Image.prototype.crop=function(f){if(typeof f==="undefined"||f===null){if(this.texture.hasOwnProperty("sourceWidth")){this.texture.setFrame(new b.Rectangle(0,0,this.texture.sourceWidth,this.texture.sourceHeight))}}else{if(this.texture instanceof PIXI.Texture){var e={};b.Utils.extend(true,e,this.texture);e.sourceWidth=e.width;e.sourceHeight=e.height;e.frame=f;e.width=f.width;e.height=f.height;this.texture=e;this.texture.updateFrame=true;PIXI.Texture.frameUpdates.push(this.texture)}else{this.texture.setFrame(f)}}};b.Image.prototype.revive=function(){this.alive=true;this.exists=true;this.visible=true;if(this.events){this.events.onRevived.dispatch(this)}return this};b.Image.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled.dispatch(this)}return this};b.Image.prototype.destroy=function(f){if(this.game===null||this.destroyPhase){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.events){this.events.destroy()}if(this.input){this.input.destroy()}var e=this.children.length;if(f){while(e--){this.children[e].destroy(f)}}else{while(e--){this.removeChild(this.children[e])}}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Image.prototype.reset=function(e,f){this.world.setTo(e,f);this.position.x=e;this.position.y=f;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;return this};b.Image.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};Object.defineProperty(b.Image.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(e){this.rotation=b.Math.degToRad(b.Math.wrapAngle(e))}});Object.defineProperty(b.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(b.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(b.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(b.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(b.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(b.Image.prototype,"frame",{get:function(){return this._frame},set:function(f){if(f!==this.frame&&this.game.cache.isSpriteSheet(this.key)){var e=this.game.cache.getFrameData(this.key);if(e&&f<e.total&&e.getFrame(f)){this.setTexture(PIXI.TextureCache[e.getFrame(f).uuid]);this._frame=f}}}});Object.defineProperty(b.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(f){if(f!==this.frameName&&this.game.cache.isSpriteSheet(this.key)){var e=this.game.cache.getFrameData(this.key);if(e&&e.getFrameByName(f)){this.setTexture(PIXI.TextureCache[e.getFrameByName(f).uuid]);this._frameName=f}}}});Object.defineProperty(b.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(b.Image.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(e){if(e){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Image.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Image.prototype,"smoothed",{get:function(){return !this.texture.baseTexture.scaleMode},set:function(e){if(e){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}});Object.defineProperty(b.Image.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.TileSprite=function(g,f,k,i,e,h,j){f=f||0;k=k||0;i=i||256;e=e||256;h=h||null;j=j||null;this.game=g;this.name="";this.type=b.TILESPRITE;this.z=0;this.events=new b.Events(this);this.animations=new b.AnimationManager(this);this.key=h;this._frame=0;this._frameName="";this._scroll=new b.Point();PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,i,e);this.loadTexture(h,j);this.position.set(f,k);this.input=null;this.world=new b.Point(f,k);this.autoCull=false;this.checkWorldBounds=false;this.cameraOffset=new b.Point();this.body=null;this._cache=[0,0,0,0,1,0,1,0,0]};b.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);b.TileSprite.prototype.constructor=b.TileSprite;b.TileSprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(this.body){this.body.preUpdate()}this._cache[4]=0;return false}this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this._cache[3]=-1;return false}if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds())}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this._bounds)}if(this.checkWorldBounds){if(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)){this._cache[5]=0;this.events.onEnterBounds.dispatch(this)}else{if(this._cache[5]===0&&!this.game.world.bounds.intersects(this._bounds)){this._cache[5]=1;this.events.onOutOfBounds.dispatch(this)}}}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}this.animations.update();if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(this.body){this.body.preUpdate()}for(var f=0,e=this.children.length;f<e;f++){this.children[f].preUpdate()}return true};b.TileSprite.prototype.update=function(){};b.TileSprite.prototype.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}if(this._cache[7]===1){this.position.x=this.game.camera.view.x+this.cameraOffset.x;this.position.y=this.game.camera.view.y+this.cameraOffset.y}for(var f=0,e=this.children.length;f<e;f++){this.children[f].postUpdate()}};b.TileSprite.prototype.autoScroll=function(e,f){this._scroll.set(e,f)};b.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};b.TileSprite.prototype.loadTexture=function(e,f){f=f||0;if(e instanceof b.RenderTexture){this.key=e.key;this.setTexture(e);return}else{if(e instanceof b.BitmapData){this.key=e;this.setTexture(e.texture);return}else{if(e instanceof PIXI.Texture){this.key=e;this.setTexture(e);return}else{if(e===null||typeof e==="undefined"){this.key="__default";this.setTexture(PIXI.TextureCache[this.key]);return}else{if(typeof e==="string"&&!this.game.cache.checkImageKey(e)){this.key="__missing";this.setTexture(PIXI.TextureCache[this.key]);return}}if(this.game.cache.isSpriteSheet(e)){this.key=e;this.animations.loadFrameData(this.game.cache.getFrameData(e));if(typeof f==="string"){this.frameName=f}else{this.frame=f}}else{this.key=e;this.setTexture(PIXI.TextureCache[e]);return}}}}};b.TileSprite.prototype.destroy=function(f){if(this.game===null||this.destroyPhase){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;if(this.filters){this.filters=null}if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}this.animations.destroy();this.events.destroy();var e=this.children.length;if(f){while(e--){this.children[e].destroy(f)}}else{while(e--){this.removeChild(this.children[e])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.TileSprite.prototype.play=function(h,g,f,e){return this.animations.play(h,g,f,e)};b.TileSprite.prototype.reset=function(e,f){this.world.setTo(e,f);this.position.x=e;this.position.y=f;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.tilePosition.x=0;this.tilePosition.y=0;if(this.body){this.body.reset(e,f,false,false)}this._cache[4]=1;return this};Object.defineProperty(b.TileSprite.prototype,"angle",{get:function(){return b.Math.wrapAngle(b.Math.radToDeg(this.rotation))},set:function(e){this.rotation=b.Math.degToRad(b.Math.wrapAngle(e))}});Object.defineProperty(b.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(e){if(e!==this.animations.frame){this.animations.frame=e}}});Object.defineProperty(b.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(e){if(e!==this.animations.frameName){this.animations.frameName=e}}});Object.defineProperty(b.TileSprite.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.TileSprite.prototype,"exists",{get:function(){return !!this._cache[6]},set:function(e){if(e){this._cache[6]=1;if(this.body&&this.body.type===b.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._cache[6]=0;if(this.body&&this.body.type===b.Physics.P2JS){this.body.safeRemove=true}this.visible=false}}});Object.defineProperty(b.TileSprite.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(e){if(e){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e;if(this.body&&this.body.type===b.Physics.ARCADE&&this.body.phase===2){this.body._reset=1}}});Object.defineProperty(b.TileSprite.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Text=function(f,e,i,h,g){e=e||0;i=i||0;h=h||" ";g=g||{};if(h.length===0){h=" "}else{h=h.toString()}this.game=f;this.exists=true;this.name="";this.type=b.TEXT;this.z=0;this.world=new b.Point(e,i);this._text=h;this._font="";this._fontSize=32;this._fontWeight="normal";this._lineSpacing=0;this.events=new b.Events(this);this.input=null;this.cameraOffset=new b.Point();this.setStyle(g);PIXI.Text.call(this,h,this.style);this.position.set(e,i);this._cache=[0,0,0,0,1,0,1,0,0]};b.Text.prototype=Object.create(PIXI.Text.prototype);b.Text.prototype.constructor=b.Text;b.Text.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}for(var f=0,e=this.children.length;f<e;f++){this.children[f].preUpdate()}return true};b.Text.prototype.update=function(){};b.Text.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}for(var f=0,e=this.children.length;f<e;f++){this.children[f].postUpdate()}};b.Text.prototype.destroy=function(f){if(this.game===null||this.destroyPhase){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}this.texture.destroy();if(this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas)}else{this.canvas=null;this.context=null}var e=this.children.length;if(f){while(e--){this.children[e].destroy(f)}}else{while(e--){this.removeChild(this.children[e])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};b.Text.prototype.setShadow=function(e,h,f,g){this.style.shadowOffsetX=e||0;this.style.shadowOffsetY=h||0;this.style.shadowColor=f||"rgba(0,0,0,0)";this.style.shadowBlur=g||0;this.dirty=true};b.Text.prototype.setStyle=function(e){e=e||{};e.font=e.font||"bold 20pt Arial";e.fill=e.fill||"black";e.align=e.align||"left";e.stroke=e.stroke||"black";e.strokeThickness=e.strokeThickness||0;e.wordWrap=e.wordWrap||false;e.wordWrapWidth=e.wordWrapWidth||100;e.shadowOffsetX=e.shadowOffsetX||0;e.shadowOffsetY=e.shadowOffsetY||0;e.shadowColor=e.shadowColor||"rgba(0,0,0,0)";e.shadowBlur=e.shadowBlur||0;this.style=e;this.dirty=true};b.Text.prototype.updateText=function(){this.context.font=this.style.font;var g=this.text;if(this.style.wordWrap){g=this.runWordWrap(this.text)}var m=g.split(/(?:\r\n|\r|\n)/);var f=[];var n=0;for(var h=0;h<m.length;h++){var j=this.context.measureText(m[h]).width;f[h]=j;n=Math.max(n,j)}this.canvas.width=n+this.style.strokeThickness;var l=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness+this._lineSpacing+this.style.shadowOffsetY;this.canvas.height=l*m.length;if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;this.context.textBaseline="top";this.context.lineCap="round";this.context.lineJoin="round";for(h=0;h<m.length;h++){var e=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+h*l);if(this.style.align==="right"){e.x+=n-f[h]}else{if(this.style.align==="center"){e.x+=(n-f[h])/2}}e.y+=this._lineSpacing;var k=d?7:0;if(this.style.stroke&&this.style.strokeThickness){this.context.strokeText(m[h],e.x,k+e.y)}if(this.style.fill){this.context.fillText(m[h],e.x,k+e.y)}}this.updateTexture()};b.Text.prototype.runWordWrap=function(l){var o="";var n=l.split("\n");for(var g=0;g<n.length;g++){var f=this.style.wordWrapWidth;var k=n[g].split(" ");for(var e=0;e<k.length;e++){var m=this.context.measureText(k[e]).width;var h=m+this.context.measureText(" ").width;if(h>f){if(e>0){o+="\n"}o+=k[e]+" ";f=this.style.wordWrapWidth-m}else{f-=h;o+=k[e]+" "}}if(g<n.length-1){o+="\n"}}return o};Object.defineProperty(b.Text.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(e){this.rotation=b.Math.degToRad(e)}});Object.defineProperty(b.Text.prototype,"text",{get:function(){return this._text},set:function(e){if(e!==this._text){this._text=e.toString()||" ";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"font",{get:function(){return this._font},set:function(e){if(e!==this._font){this._font=e.trim();this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10);if(e!==this._fontSize){this._fontSize=e;this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){if(e!==this._fontWeight){this._fontWeight=e;this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'";this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(e){if(e!==this.style.fill){this.style.fill=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"align",{get:function(){return this.style.align},set:function(e){if(e!==this.style.align){this.style.align=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(e){if(e!==this.style.stroke){this.style.stroke=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(e){if(e!==this.style.strokeThickness){this.style.strokeThickness=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(e){if(e!==this.style.wordWrap){this.style.wordWrap=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(e){if(e!==this.style.wordWrapWidth){this.style.wordWrapWidth=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){if(e!==this._lineSpacing){this._lineSpacing=parseFloat(e);this.dirty=true;this.updateTransform()}}});Object.defineProperty(b.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(e){if(e!==this.style.shadowOffsetX){this.style.shadowOffsetX=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(e){if(e!==this.style.shadowOffsetY){this.style.shadowOffsetY=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){if(e!==this.style.shadowColor){this.style.shadowColor=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(e){if(e!==this.style.shadowBlur){this.style.shadowBlur=e;this.dirty=true}}});Object.defineProperty(b.Text.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(e){if(e){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.Text.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Text.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.BitmapText=function(g,e,j,f,i,h){e=e||0;j=j||0;f=f||"";i=i||"";h=h||32;this.game=g;this.exists=true;this.name="";this.type=b.BITMAPTEXT;this.z=0;this.world=new b.Point(e,j);this._text=i;this._font=f;this._fontSize=h;this._align="left";this._tint=16777215;this.events=new b.Events(this);this.input=null;this.cameraOffset=new b.Point();PIXI.BitmapText.call(this,i);this.position.set(e,j);this._cache=[0,0,0,0,1,0,1,0,0]};b.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);b.BitmapText.prototype.constructor=b.BitmapText;b.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=true};b.BitmapText.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}return true};b.BitmapText.prototype.update=function(){};b.BitmapText.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.BitmapText.prototype.destroy=function(f){if(this.game===null||this.destroyPhase){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}var e=this.children.length;if(f){while(e--){if(this.children[e].destroy){this.children[e].destroy(f)}else{this.removeChild(this.children[e])}}}else{while(e--){this.removeChild(this.children[e])}}this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0};Object.defineProperty(b.BitmapText.prototype,"align",{get:function(){return this._align},set:function(e){if(e!==this._align){this._align=e;this.setStyle()}}});Object.defineProperty(b.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(e){if(e!==this._tint){this._tint=e;this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(e){this.rotation=b.Math.degToRad(e)}});Object.defineProperty(b.BitmapText.prototype,"font",{get:function(){return this._font},set:function(e){if(e!==this._font){this._font=e.trim();this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){e=parseInt(e,10);if(e!==this._fontSize){this._fontSize=e;this.style.font=this._fontSize+"px '"+this._font+"'";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"text",{get:function(){return this._text},set:function(e){if(e!==this._text){this._text=e.toString()||" ";this.dirty=true}}});Object.defineProperty(b.BitmapText.prototype,"inputEnabled",{get:function(){return(this.input&&this.input.enabled)},set:function(e){if(e){if(this.input===null){this.input=new b.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}});Object.defineProperty(b.BitmapText.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.BitmapText.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.Button=function(n,k,j,l,m,f,g,e,h,i){k=k||0;j=j||0;l=l||null;m=m||null;f=f||this;b.Image.call(this,n,k,j,l,e);this.type=b.BUTTON;this._onOverFrameName=null;this._onOutFrameName=null;this._onDownFrameName=null;this._onUpFrameName=null;this._onOverFrameID=null;this._onOutFrameID=null;this._onDownFrameID=null;this._onUpFrameID=null;this.onOverMouseOnly=false;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new b.Signal();this.onInputOut=new b.Signal();this.onInputDown=new b.Signal();this.onInputUp=new b.Signal();this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.setFrames(g,e,h,i);if(m!==null){this.onInputUp.add(m,f)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)};b.Button.prototype=Object.create(b.Image.prototype);b.Button.prototype.constructor=b.Button;b.Button.prototype.clearFrames=function(){this._onOverFrameName=null;this._onOverFrameID=null;this._onOutFrameName=null;this._onOutFrameID=null;this._onDownFrameName=null;this._onDownFrameID=null;this._onUpFrameName=null;this._onUpFrameID=null};b.Button.prototype.setFrames=function(f,h,e,g){this.clearFrames();if(f!==null){if(typeof f==="string"){this._onOverFrameName=f;if(this.input.pointerOver()){this.frameName=f}}else{this._onOverFrameID=f;if(this.input.pointerOver()){this.frame=f}}}if(h!==null){if(typeof h==="string"){this._onOutFrameName=h;if(this.input.pointerOver()===false){this.frameName=h}}else{this._onOutFrameID=h;if(this.input.pointerOver()===false){this.frame=h}}}if(e!==null){if(typeof e==="string"){this._onDownFrameName=e;if(this.input.pointerDown()){this.frameName=e}}else{this._onDownFrameID=e;if(this.input.pointerDown()){this.frame=e}}}if(g!==null){if(typeof g==="string"){this._onUpFrameName=g;if(this.input.pointerUp()){this.frameName=g}}else{this._onUpFrameID=g;if(this.input.pointerUp()){this.frame=g}}}};b.Button.prototype.setSounds=function(f,j,e,i,h,l,g,k){this.setOverSound(f,j);this.setOutSound(h,l);this.setDownSound(e,i);this.setUpSound(g,k)};b.Button.prototype.setOverSound=function(f,e){this.onOverSound=null;this.onOverSoundMarker="";if(f instanceof b.Sound){this.onOverSound=f}if(typeof e==="string"){this.onOverSoundMarker=e}};b.Button.prototype.setOutSound=function(f,e){this.onOutSound=null;this.onOutSoundMarker="";if(f instanceof b.Sound){this.onOutSound=f}if(typeof e==="string"){this.onOutSoundMarker=e}};b.Button.prototype.setDownSound=function(f,e){this.onDownSound=null;this.onDownSoundMarker="";if(f instanceof b.Sound){this.onDownSound=f}if(typeof e==="string"){this.onDownSoundMarker=e}};b.Button.prototype.setUpSound=function(f,e){this.onUpSound=null;this.onUpSoundMarker="";if(f instanceof b.Sound){this.onUpSound=f}if(typeof e==="string"){this.onUpSoundMarker=e}};b.Button.prototype.onInputOverHandler=function(e,f){if(this.freezeFrames===false){this.setState(1)}if(this.onOverMouseOnly&&!f.isMouse){return}if(this.onOverSound){this.onOverSound.play(this.onOverSoundMarker)}if(this.onInputOver){this.onInputOver.dispatch(this,f)}};b.Button.prototype.onInputOutHandler=function(e,f){if(this.freezeFrames===false){this.setState(2)}if(this.onOutSound){this.onOutSound.play(this.onOutSoundMarker)}if(this.onInputOut){this.onInputOut.dispatch(this,f)}};b.Button.prototype.onInputDownHandler=function(e,f){if(this.freezeFrames===false){this.setState(3)}if(this.onDownSound){this.onDownSound.play(this.onDownSoundMarker)}if(this.onInputDown){this.onInputDown.dispatch(this,f)}};b.Button.prototype.onInputUpHandler=function(e,g,f){if(this.onUpSound){this.onUpSound.play(this.onUpSoundMarker)}if(this.onInputUp){this.onInputUp.dispatch(this,g,f)}if(this.freezeFrames){return}if(this.forceOut){this.setState(2)}else{if(this._onUpFrameName!==null||this._onUpFrameID!==null){this.setState(4)}else{if(f){this.setState(1)}else{this.setState(2)}}}};b.Button.prototype.setState=function(e){if(e===1){if(this._onOverFrameName!=null){this.frameName=this._onOverFrameName}else{if(this._onOverFrameID!=null){this.frame=this._onOverFrameID}}}else{if(e===2){if(this._onOutFrameName!=null){this.frameName=this._onOutFrameName}else{if(this._onOutFrameID!=null){this.frame=this._onOutFrameID}}}else{if(e===3){if(this._onDownFrameName!=null){this.frameName=this._onDownFrameName}else{if(this._onDownFrameID!=null){this.frame=this._onDownFrameID}}}else{if(e===4){if(this._onUpFrameName!=null){this.frameName=this._onUpFrameName}else{if(this._onUpFrameID!=null){this.frame=this._onUpFrameID}}}}}}};b.Graphics=function(f,e,g){e=e||0;g=g||0;this.game=f;this.exists=true;this.name="";this.type=b.GRAPHICS;this.z=0;this.world=new b.Point(e,g);this.cameraOffset=new b.Point();PIXI.Graphics.call(this);this.position.set(e,g);this._cache=[0,0,0,0,1,0,1,0,0]};b.Graphics.prototype=Object.create(PIXI.Graphics.prototype);b.Graphics.prototype.constructor=b.Graphics;b.Graphics.prototype.preUpdate=function(){this._cache[0]=this.world.x;this._cache[1]=this.world.y;this._cache[2]=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}if(this.autoCull){this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())}this.world.setTo(this.game.camera.x+this.worldTransform[2],this.game.camera.y+this.worldTransform[5]);if(this.visible){this._cache[3]=this.game.stage.currentRenderOrderID++}return true};b.Graphics.prototype.update=function(){};b.Graphics.prototype.postUpdate=function(){if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.Graphics.prototype.destroy=function(f){if(this.game===null||this.destroyPhase){return}if(typeof f==="undefined"){f=true}this._cache[8]=1;this.clear();if(this.parent){if(this.parent instanceof b.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}var e=this.children.length;if(f){while(e--){this.children[e].destroy(f)}}else{while(e--){this.removeChild(this.children[e])}}this.exists=false;this.visible=false;this.game=null;this._cache[8]=0};b.Graphics.prototype.drawPolygon=function(f){this.moveTo(f.points[0].x,f.points[0].y);for(var e=1;e<f.points.length;e+=1){this.lineTo(f.points[e].x,f.points[e].y)}this.lineTo(f.points[0].x,f.points[0].y)};b.Graphics.prototype.drawTriangle=function(g,f){if(typeof f==="undefined"){f=false}var k=new b.Polygon(g);if(f){var i=new b.Point(this.game.camera.x-g[0].x,this.game.camera.y-g[0].y);var h=new b.Point(g[1].x-g[0].x,g[1].y-g[0].y);var e=new b.Point(g[1].x-g[2].x,g[1].y-g[2].y);var j=e.cross(h);if(i.dot(j)>0){this.drawPolygon(k)}}else{this.drawPolygon(k)}};b.Graphics.prototype.drawTriangles=function(g,m,e){if(typeof e==="undefined"){e=false}var l=new b.Point();var j=new b.Point();var f=new b.Point();var k=[];var h;if(!m){if(g[0] instanceof b.Point){for(h=0;h<g.length/3;h++){this.drawTriangle([g[h*3],g[h*3+1],g[h*3+2]],e)}}else{for(h=0;h<g.length/6;h++){l.x=g[h*6+0];l.y=g[h*6+1];j.x=g[h*6+2];j.y=g[h*6+3];f.x=g[h*6+4];f.y=g[h*6+5];this.drawTriangle([l,j,f],e)}}}else{if(g[0] instanceof b.Point){for(h=0;h<m.length/3;h++){k.push(g[m[h*3]]);k.push(g[m[h*3+1]]);k.push(g[m[h*3+2]]);if(k.length===3){this.drawTriangle(k,e);k=[]}}}else{for(h=0;h<m.length;h++){l.x=g[m[h]*2];l.y=g[m[h]*2+1];k.push(l.copyTo({}));if(k.length===3){this.drawTriangle(k,e);k=[]}}}}};Object.defineProperty(b.Graphics.prototype,"angle",{get:function(){return b.Math.radToDeg(this.rotation)},set:function(e){this.rotation=b.Math.degToRad(e)}});Object.defineProperty(b.Graphics.prototype,"fixedToCamera",{get:function(){return !!this._cache[7]},set:function(e){if(e){this._cache[7]=1;this.cameraOffset.set(this.x,this.y)}else{this._cache[7]=0}}});Object.defineProperty(b.Graphics.prototype,"destroyPhase",{get:function(){return !!this._cache[8]}});b.RenderTexture=function(f,i,e,g,h){if(typeof g==="undefined"){g=""}if(typeof h==="undefined"){h=b.scaleModes.DEFAULT}this.game=f;this.key=g;this.type=b.RENDERTEXTURE;this._temp=new b.Point();PIXI.RenderTexture.call(this,i,e,h)};b.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.renderXY=function(g,f,h,e){this._temp.set(f,h);this.render(g,this._temp,e)};b.SpriteBatch=function(f,h,g,e){PIXI.SpriteBatch.call(this);b.Group.call(this,f,h,g,e);this.type=b.SPRITEBATCH};b.SpriteBatch.prototype=b.Utils.extend(true,b.SpriteBatch.prototype,b.Group.prototype,PIXI.SpriteBatch.prototype);b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.RetroFont=function(v,u,g,l,q,t,s,o,n,k){this.characterWidth=g;this.characterHeight=l;this.characterSpacingX=s||0;this.characterSpacingY=o||0;this.characterPerRow=t;this.offsetX=n||0;this.offsetY=k||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=v.cache.getImage(u);this._text="";this.grabData=[];var j=this.offsetX;var i=this.offsetY;var f=0;var m=new b.FrameData();for(var p=0;p<q.length;p++){var e=v.rnd.uuid();var h=m.addFrame(new b.Frame(p,j,i,this.characterWidth,this.characterHeight,"",e));this.grabData[q.charCodeAt(p)]=h.index;PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[u],{x:j,y:i,width:this.characterWidth,height:this.characterHeight});f++;if(f==this.characterPerRow){f=0;j=this.offsetX;i+=this.characterHeight+this.characterSpacingY}else{j+=this.characterWidth+this.characterSpacingX}}v.cache.updateFrameData(u,m);this.stamp=new b.Image(v,0,0,u,0);b.RenderTexture.call(this,v);this.type=b.RETROFONT};b.RetroFont.prototype=Object.create(b.RenderTexture.prototype);b.RetroFont.prototype.constructor=b.RetroFont;b.RetroFont.ALIGN_LEFT="left";b.RetroFont.ALIGN_RIGHT="right";b.RetroFont.ALIGN_CENTER="center";b.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";b.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";b.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";b.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";b.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";b.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";b.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";b.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";b.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";b.RetroFont.prototype.setFixedWidth=function(f,e){if(typeof e==="undefined"){e="left"}this.fixedWidth=f;this.align=e};b.RetroFont.prototype.setText=function(h,i,g,j,f,e){this.multiLine=i||false;this.customSpacingX=g||0;this.customSpacingY=j||0;this.align=f||"left";if(e){this.autoUpperCase=false}else{this.autoUpperCase=true}if(h.length>0){this.text=h}};b.RetroFont.prototype.buildRetroFontText=function(){var e=0;var h=0;this.clear();if(this.multiLine){var f=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(f.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(f.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var g=0;g<f.length;g++){switch(this.align){case b.RetroFont.ALIGN_LEFT:e=0;break;case b.RetroFont.ALIGN_RIGHT:e=this.width-(f[g].length*(this.characterWidth+this.customSpacingX));break;case b.RetroFont.ALIGN_CENTER:e=(this.width/2)-((f[g].length*(this.characterWidth+this.customSpacingX))/2);e+=this.customSpacingX/2;break}if(e<0){e=0}this.pasteLine(f[g],e,h,this.customSpacingX);h+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}switch(this.align){case b.RetroFont.ALIGN_LEFT:e=0;break;case b.RetroFont.ALIGN_RIGHT:e=this.width-(this._text.length*(this.characterWidth+this.customSpacingX));break;case b.RetroFont.ALIGN_CENTER:e=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);e+=this.customSpacingX/2;break}this.textureBuffer.clear();this.pasteLine(this._text,e,0,this.customSpacingX)}};b.RetroFont.prototype.pasteLine=function(f,e,j,g){var h=new b.Point();for(var i=0;i<f.length;i++){if(f.charAt(i)==" "){e+=this.characterWidth+g}else{if(this.grabData[f.charCodeAt(i)]>=0){this.stamp.frame=this.grabData[f.charCodeAt(i)];h.set(e,j);this.render(this.stamp,h,false);e+=this.characterWidth+g;if(e>this.width){break}}}}};b.RetroFont.prototype.getLongestLine=function(){var f=0;if(this._text.length>0){var e=this._text.split("\n");for(var g=0;g<e.length;g++){if(e[g].length>f){f=e[g].length}}}return f};b.RetroFont.prototype.removeUnsupportedCharacters=function(h){var f="";for(var i=0;i<this._text.length;i++){var e=this._text[i];var g=e.charCodeAt(0);if(this.grabData[g]>=0||(!h&&e==="\n")){f=f.concat(e)}}return f};Object.defineProperty(b.RetroFont.prototype,"text",{get:function(){return this._text},set:function(f){var e;if(this.autoUpperCase){e=f.toUpperCase()}else{e=f}if(e!==this._text){this._text=e;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});b.Particle=function(f,e,i,g,h){b.Sprite.call(this,f,e,i,g,h);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};b.Particle.prototype=Object.create(b.Sprite.prototype);b.Particle.prototype.constructor=b.Particle;b.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};b.Particle.prototype.onEmit=function(){};b.Particle.prototype.setAlphaData=function(e){this.alphaData=e;this._a=e.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};b.Particle.prototype.setScaleData=function(e){this.scaleData=e;this._s=e.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};b.Particle.prototype.reset=function(e,g,f){if(typeof f==="undefined"){f=1}this.world.setTo(e,g);this.position.x=e;this.position.y=g;this.alive=true;this.exists=true;this.visible=true;this.renderable=true;this._outOfBoundsFired=false;this.health=f;if(this.body){this.body.reset(e,g,false,false)}this._cache[4]=1;this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};b.Canvas={create:function(h,e,i,f){if(typeof f==="undefined"){f=false}h=h||256;e=e||256;if(f){var g=document.createElement("canvas")}else{var g=document.createElement(navigator.isCocoonJS?"screencanvas":"canvas")}if(typeof i==="string"&&i!==""){g.id=i}g.width=h;g.height=e;g.style.display="block";return g},getOffset:function(f,e){e=e||new b.Point();var g=f.getBoundingClientRect();var k=f.clientTop||document.body.clientTop||0;var j=f.clientLeft||document.body.clientLeft||0;var h=0;var i=0;if(document.compatMode==="CSS1Compat"){h=window.pageYOffset||document.documentElement.scrollTop||f.scrollTop||0;i=window.pageXOffset||document.documentElement.scrollLeft||f.scrollLeft||0}else{h=window.pageYOffset||document.body.scrollTop||f.scrollTop||0;i=window.pageXOffset||document.body.scrollLeft||f.scrollLeft||0}e.x=g.left+i-j;e.y=g.top+h-k;return e},getAspectRatio:function(e){return e.width/e.height},setBackgroundColor:function(f,e){e=e||"rgb(0,0,0)";f.style.backgroundColor=e;return f},setTouchAction:function(e,f){f=f||"none";e.style.msTouchAction=f;e.style["ms-touch-action"]=f;e.style["touch-action"]=f;return e},setUserSelect:function(e,f){f=f||"none";e.style["-webkit-touch-callout"]=f;e.style["-webkit-user-select"]=f;e.style["-khtml-user-select"]=f;e.style["-moz-user-select"]=f;e.style["-ms-user-select"]=f;e.style["user-select"]=f;e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return e},addToDOM:function(e,f,h){var g;if(typeof h==="undefined"){h=true}if(f){if(typeof f==="string"){g=document.getElementById(f)}else{if(typeof f==="object"&&f.nodeType===1){g=f}}}if(!g){g=document.body}if(h&&g.style){g.style.overflow="hidden"}g.appendChild(e);return e},setTransform:function(i,k,j,g,e,h,f){i.setTransform(g,h,f,e,k,j);return i},setSmoothingEnabled:function(e,f){e.imageSmoothingEnabled=f;e.mozImageSmoothingEnabled=f;e.oImageSmoothingEnabled=f;e.webkitImageSmoothingEnabled=f;e.msImageSmoothingEnabled=f;return e},setImageRenderingCrisp:function(e){e.style["image-rendering"]="optimizeSpeed";e.style["image-rendering"]="crisp-edges";e.style["image-rendering"]="-moz-crisp-edges";e.style["image-rendering"]="-webkit-optimize-contrast";e.style["image-rendering"]="optimize-contrast";e.style.msInterpolationMode="nearest-neighbor";return e},setImageRenderingBicubic:function(e){e.style["image-rendering"]="auto";e.style.msInterpolationMode="bicubic";return e}};b.Device=function(e){this.game=e;this.desktop=false;this.iOS=false;this.cocoonJS=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.webGL=false;this.worker=false;this.touch=false;this.mspointer=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=false;this.quirksMode=false;this.arora=false;this.chrome=false;this.epiphany=false;this.firefox=false;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false;this._checkAudio();this._checkBrowser();this._checkCSS3D();this._checkDevice();this._checkFeatures();this._checkOS()};b.Device.LITTLE_ENDIAN=false;b.Device.prototype={_checkOS:function(){var e=navigator.userAgent;if(/Android/.test(e)){this.android=true}else{if(/CrOS/.test(e)){this.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(e)){this.iOS=true}else{if(/Linux/.test(e)){this.linux=true}else{if(/Mac OS/.test(e)){this.macOS=true}else{if(/Windows/.test(e)){this.windows=true;if(/Windows Phone/i.test(e)){this.windowsPhone=true}}}}}}}if(this.windows||this.macOS||(this.linux&&this.silk===false)){this.desktop=true}if(this.windowsPhone||((/Windows NT/i.test(e))&&(/Touch/i.test(e)))){this.desktop=false}},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(e){this.localStorage=false}this.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;this.fileSystem=!!window.requestFileSystem;this.webGL=(function(){try{var f=document.createElement("canvas");return !!window.WebGLRenderingContext&&(f.getContext("webgl")||f.getContext("experimental-webgl"))}catch(g){return false}})();if(this.webGL===null||this.webGL===false){this.webGL=false}else{this.webGL=true}this.worker=!!window.Worker;if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)){this.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){this.mspointer=true}this.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;this.quirksMode=(document.compatMode==="CSS1Compat")?false:true;this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){var f=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];for(var g=0;g<f.length;g++){if(this.game.canvas[f[g]]){this.fullscreen=true;this.requestFullscreen=f[g]}}var e=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(this.fullscreen){for(var g=0;g<e.length;g++){if(this.game.canvas[e[g]]){this.cancelFullscreen=e[g]}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){this.fullscreenKeyboard=true}},_checkBrowser:function(){var e=navigator.userAgent;if(/Arora/.test(e)){this.arora=true}else{if(/Chrome/.test(e)){this.chrome=true}else{if(/Epiphany/.test(e)){this.epiphany=true}else{if(/Firefox/.test(e)){this.firefox=true}else{if(/Mobile Safari/.test(e)){this.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(e)){this.ie=true;this.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(e)){this.midori=true}else{if(/Opera/.test(e)){this.opera=true}else{if(/Safari/.test(e)){this.safari=true}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)){this.ie=true;this.trident=true;this.tridentVersion=parseInt(RegExp.$1,10);this.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}if(/Silk/.test(e)){this.silk=true}if(navigator.standalone){this.webApp=true}if(navigator.isCocoonJS){this.cocoonJS=true}if(typeof window.ejecta!=="undefined"){this.ejecta=true}if(/Crosswalk/.test(e)){this.crosswalk=true}},_checkAudio:function(){this.audioData=!!(window.Audio);this.webAudio=!!(window.webkitAudioContext||window.AudioContext);var h=document.createElement("audio");var f=false;try{if(f=!!h.canPlayType){if(h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){this.ogg=true}if(h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")){this.opus=true}if(h.canPlayType("audio/mpeg;").replace(/^no$/,"")){this.mp3=true}if(h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){this.wav=true}if(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/aac;").replace(/^no$/,"")){this.m4a=true}if(h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){this.webm=true}}}catch(g){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=(this.pixelRatio==2&&this.iPhone);this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;if(typeof Int8Array!=="undefined"){this.typedArray=true}else{this.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){this.littleEndian=this._checkIsLittleEndian();b.Device.LITTLE_ENDIAN=this.littleEndian}this.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&this.littleEndian!==null&&this._checkIsUint8ClampedImageData());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){this.vibration=true}},_checkIsLittleEndian:function(){var f=new ArrayBuffer(4);var e=new Uint8Array(f);var g=new Uint32Array(f);e[0]=161;e[1]=178;e[2]=195;e[3]=212;if(g[0]==3569595041){return true}if(g[0]==2712847316){return false}else{return null}},_checkIsUint8ClampedImageData:function(){if(typeof Uint8ClampedArray==="undefined"){return false}var f=document.createElement("canvas");var e=f.getContext("2d");if(!e){return false}var g=e.createImageData(1,1);return g.data instanceof Uint8ClampedArray},_checkCSS3D:function(){var g=document.createElement("p");var h;var f={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(g,null);for(var e in f){if(g.style[e]!==undefined){g.style[e]="translate3d(1px,1px,1px)";h=window.getComputedStyle(g).getPropertyValue(f[e])}}document.body.removeChild(g);this.css3D=(h!==undefined&&h.length>0&&h!=="none")},canPlayAudio:function(e){if(e=="mp3"&&this.mp3){return true}else{if(e=="ogg"&&(this.ogg||this.opus)){return true}else{if(e=="m4a"&&this.m4a){return true}else{if(e=="wav"&&this.wav){return true}else{if(e=="webm"&&this.webm){return true}}}}}return false},isConsoleOpen:function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false}};b.Device.prototype.constructor=b.Device;b.RequestAnimationFrame=function(f,g){if(typeof g==="undefined"){g=false}this.game=f;this.isRunning=false;this.forceSetTimeOut=g;var h=["ms","moz","webkit","o"];for(var e=0;e<h.length&&!window.requestAnimationFrame;e++){window.requestAnimationFrame=window[h[e]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[h[e]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};b.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var e=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return e.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(f){return e.updateRAF(f)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(){this.game.update(Date.now());this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};b.RequestAnimationFrame.prototype.constructor=b.RequestAnimationFrame;b.Math={PI2:Math.PI*2,fuzzyEqual:function(f,e,g){if(typeof g==="undefined"){g=0.0001}return Math.abs(f-e)<g},fuzzyLessThan:function(f,e,g){if(typeof g==="undefined"){g=0.0001}return f<e+g},fuzzyGreaterThan:function(f,e,g){if(typeof g==="undefined"){g=0.0001}return f>e-g},fuzzyCeil:function(e,f){if(typeof f==="undefined"){f=0.0001}return Math.ceil(e-f)},fuzzyFloor:function(e,f){if(typeof f==="undefined"){f=0.0001}return Math.floor(e+f)},average:function(){var e=[];for(var g=0;g<(arguments.length-0);g++){e[g]=arguments[g+0]}var h=0;for(var f=0;f<e.length;f++){h+=e[f]}return h/e.length},truncate:function(e){return(e>0)?Math.floor(e):Math.ceil(e)},shear:function(e){return e%1},snapTo:function(e,g,f){if(typeof f==="undefined"){f=0}if(g===0){return e}e-=f;e=g*Math.round(e/g);return f+e},snapToFloor:function(e,g,f){if(typeof f==="undefined"){f=0}if(g===0){return e}e-=f;e=g*Math.floor(e/g);return f+e},snapToCeil:function(e,g,f){if(typeof f==="undefined"){f=0}if(g===0){return e}e-=f;e=g*Math.ceil(e/g);return f+e},snapToInArray:function(g,f,j){if(typeof j==="undefined"){j=true}if(j){f.sort()}if(g<f[0]){return f[0]}var h=1;while(f[h]<g){h++}var e=f[h-1];var k=(h<f.length)?f[h]:Number.POSITIVE_INFINITY;return((k-g)<=(g-e))?k:e},roundTo:function(g,e,f){if(typeof e==="undefined"){e=0}if(typeof f==="undefined"){f=10}var h=Math.pow(f,-e);return Math.round(g*h)/h},floorTo:function(g,e,f){if(typeof e==="undefined"){e=0}if(typeof f==="undefined"){f=10}var h=Math.pow(f,-e);return Math.floor(g*h)/h},ceilTo:function(g,e,f){if(typeof e==="undefined"){e=0}if(typeof f==="undefined"){f=10}var h=Math.pow(f,-e);return Math.ceil(g*h)/h},interpolateFloat:function(f,e,g){return(e-f)*g+f},angleBetween:function(f,h,e,g){return Math.atan2(g-h,e-f)},angleBetweenPoints:function(f,e){return Math.atan2(e.y-f.y,e.x-f.x)},reverseAngle:function(e){return this.normalizeAngle(e+Math.PI,true)},normalizeAngle:function(e){e=e%(2*Math.PI);return e>=0?e:e+2*Math.PI},normalizeLatitude:function(e){return Math.max(-90,Math.min(90,e))},normalizeLongitude:function(e){if(e%360==180){return 180}e=e%360;return e<-180?e+360:e>180?e-360:e},chanceRoll:function(e){if(typeof e==="undefined"){e=50}if(e<=0){return false}else{if(e>=100){return true}else{if(Math.random()*100>=e){return false}else{return true}}}},numberArray:function(h,f){var e=[];for(var g=h;g<=f;g++){e.push(g)}return e},maxAdd:function(g,f,e){g+=f;if(g>e){g=e}return g},minSub:function(g,f,e){g-=f;if(g<e){g=e}return g},wrap:function(i,h,f){var g=f-h;if(g<=0){return 0}var e=(i-h)%g;if(e<0){e+=g}return e+h},wrapValue:function(g,f,e){var h;g=Math.abs(g);f=Math.abs(f);e=Math.abs(e);h=(g+f)%e;return h},limitValue:function(g,f,e){return g<f?f:g>e?e:g},randomSign:function(){return(Math.random()>0.5)?1:-1},isOdd:function(e){return(e&1)},isEven:function(e){if(e&1){return false}else{return true}},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var h=arguments[0]}else{var h=arguments}for(var g=1,f=0,e=h.length;g<e;g++){if(h[g]<h[f]){f=g}}return h[f]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var h=arguments[0]}else{var h=arguments}for(var g=1,f=0,e=h.length;g<e;g++){if(h[g]>h[f]){f=g}}return h[f]},minProperty:function(j){if(arguments.length===2&&typeof arguments[1]==="object"){var h=arguments[1]}else{var h=arguments.slice(1)}for(var g=1,f=0,e=h.length;g<e;g++){if(h[g][j]<h[f][j]){f=g}}return h[f][j]},maxProperty:function(j){if(arguments.length===2&&typeof arguments[1]==="object"){var h=arguments[1]}else{var h=arguments.slice(1)}for(var g=1,f=0,e=h.length;g<e;g++){if(h[g][j]>h[f][j]){f=g}}return h[f][j]},wrapAngle:function(g,f){var e=(f)?Math.PI/180:1;return this.wrap(g,-180*e,180*e)},angleLimit:function(h,g,f){var e=h;if(h>f){e=f}else{if(h<g){e=g}}return e},linearInterpolation:function(h,g){var e=h.length-1;var l=e*g;var j=Math.floor(l);if(g<0){return this.linear(h[0],h[1],l)}if(g>1){return this.linear(h[e],h[e-1],e-l)}return this.linear(h[j],h[j+1>e?e:j+1],l-j)},bezierInterpolation:function(g,f){var e=0;var j=g.length-1;for(var h=0;h<=j;h++){e+=Math.pow(1-f,j-h)*Math.pow(f,h)*g[h]*this.bernstein(j,h)}return e},catmullRomInterpolation:function(h,g){var e=h.length-1;var l=e*g;var j=Math.floor(l);if(h[0]===h[e]){if(g<0){j=Math.floor(l=e*(1+g))}return this.catmullRom(h[(j-1+e)%e],h[j],h[(j+1)%e],h[(j+2)%e],l-j)}else{if(g<0){return h[0]-(this.catmullRom(h[0],h[0],h[1],h[1],-l)-h[0])}if(g>1){return h[e]-(this.catmullRom(h[e],h[e],h[e-1],h[e-1],l-e)-h[e])}return this.catmullRom(h[j?j-1:0],h[j],h[e<j+1?e:j+1],h[e<j+2?e:j+2],l-j)}},linear:function(g,f,e){return(f-g)*e+g},bernstein:function(f,e){return this.factorial(f)/this.factorial(e)/this.factorial(f-e)},catmullRom:function(l,k,i,h,m){var j=(i-l)*0.5,g=(h-k)*0.5,f=m*m,e=m*f;return(2*k-2*i+j+g)*e+(-3*k+3*i-2*j-g)*f+j*m+k},difference:function(f,e){return Math.abs(f-e)},getRandom:function(g,h,f){if(typeof h==="undefined"){h=0}if(typeof f==="undefined"){f=0}if(g!=null){var e=f;if((e===0)||(e>g.length-h)){e=g.length-h}if(e>0){return g[h+Math.floor(Math.random()*e)]}}return null},removeRandom:function(h,j,g){if(typeof j==="undefined"){j=0}if(typeof g==="undefined"){g=0}if(h!=null){var f=g;if((f===0)||(f>h.length-j)){f=h.length-j}if(f>0){var e=j+Math.floor(Math.random()*f);var i=h.splice(e,1);return i[0]}}return null},floor:function(e){var f=e|0;return(e>0)?(f):((f!=e)?(f-1):(f))},ceil:function(e){var f=e|0;return(e>0)?((f!=e)?(f+1):(f)):(f)},sinCosGenerator:function(e,l,f,j){if(typeof l==="undefined"){l=1}if(typeof f==="undefined"){f=1}if(typeof j==="undefined"){j=1}var k=l;var n=f;var h=j*Math.PI/e;var g=[];var m=[];for(var i=0;i<e;i++){n-=k*h;k+=n*h;g[i]=n;m[i]=k}return{sin:m,cos:g,length:e}},shift:function(e){var f=e.shift();e.push(f);return f},shuffleArray:function(h){for(var g=h.length-1;g>0;g--){var f=Math.floor(Math.random()*(g+1));var e=h[g];h[g]=h[f];h[f]=e}return h},distance:function(h,j,g,i){var f=h-g;var e=j-i;return Math.sqrt(f*f+e*e)},distancePow:function(f,h,e,g,i){if(typeof i==="undefined"){i=2}return Math.sqrt(Math.pow(e-f,i)+Math.pow(g-h,i))},distanceRounded:function(f,h,e,g){return Math.round(b.Math.distance(f,h,e,g))},clamp:function(f,g,e){return(f<g)?g:((f>e)?e:f)},clampBottom:function(e,f){return e<f?f:e},within:function(f,e,g){return(Math.abs(f-e)<=g)},mapLinear:function(f,g,e,i,h){return i+(f-g)*(h-i)/(e-g)},smoothstep:function(f,g,e){f=Math.max(0,Math.min(1,(f-g)/(e-g)));return f*f*(3-2*f)},smootherstep:function(f,g,e){f=Math.max(0,Math.min(1,(f-g)/(e-g)));return f*f*f*(f*(f*6-15)+10)},sign:function(e){return(e<0)?-1:((e>0)?1:0)},percent:function(f,e,g){if(typeof g==="undefined"){g=0}if(f>e||g>e){return 1}else{if(f<g||g>f){return 0}else{return(f-g)/e}}},degToRad:(function(){var e=Math.PI/180;return function(f){return f*e}}()),radToDeg:(function(){var e=180/Math.PI;return function(f){return f*e}}())};b.RandomDataGenerator=function(e){if(typeof e==="undefined"){e=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(e)};b.RandomDataGenerator.prototype={rnd:function(){var e=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=e|0;this.s0=this.s1;this.s1=this.s2;this.s2=e-this.c;return this.s2},sow:function(f){if(typeof f==="undefined"){f=[]}this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;var e;for(var g=0;e=f[g++];){this.s0-=this.hash(e);this.s0+=~~(this.s0<0);this.s1-=this.hash(e);this.s1+=~~(this.s1<0);this.s2-=this.hash(e);this.s2+=~~(this.s2<0)}},hash:function(g){var f,e,j;j=4022871197;g=g.toString();for(e=0;e<g.length;e++){j+=g.charCodeAt(e);f=0.02519603282416938*j;j=f>>>0;f-=j;f*=j;j=f>>>0;f-=j;j+=f*4294967296}return(j>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(f,e){return Math.floor(this.realInRange(0,e-f+1)+f)},realInRange:function(f,e){return this.frac()*(e-f)+f},normal:function(){return 1-2*this.frac()},uuid:function(){var f="";var e="";for(e=f="";f++<36;e+=~f%5|f*3&4?(f^15?8^this.frac()*(f^20?16:4):4).toString(16):"-"){}return e},pick:function(e){return e[this.integerInRange(0,e.length-1)]},weightedPick:function(e){return e[~~(Math.pow(this.frac(),2)*(e.length-1))]},timestamp:function(f,e){return this.realInRange(f||946684800000,e||1577862000000)},angle:function(){return this.integerInRange(-180,180)}};b.RandomDataGenerator.prototype.constructor=b.RandomDataGenerator;b.QuadTree=function(f,k,i,e,h,g,j){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(f,k,i,e,h,g,j)};b.QuadTree.prototype={reset:function(f,k,i,e,h,g,j){this.maxObjects=h||10;this.maxLevels=g||4;this.level=j||0;this.bounds={x:Math.round(f),y:Math.round(k),width:i,height:e,subWidth:Math.floor(i/2),subHeight:Math.floor(e/2),right:Math.round(f)+Math.floor(i/2),bottom:Math.round(k)+Math.floor(e/2)};this.objects.length=0;this.nodes.length=0},populate:function(e){e.forEach(this.populateHandler,this,true)},populateHandler:function(e){if(e.body&&e.exists){this.insert(e.body)}},split:function(){this.level++;this.nodes[0]=new b.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[1]=new b.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[2]=new b.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level);this.nodes[3]=new b.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level)},insert:function(e){var g=0;var f;if(this.nodes[0]!=null){f=this.getIndex(e);if(f!==-1){this.nodes[f].insert(e);return}}this.objects.push(e);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(g<this.objects.length){f=this.getIndex(this.objects[g]);if(f!==-1){this.nodes[f].insert(this.objects.splice(g,1)[0])}else{g++}}}},getIndex:function(f){var e=-1;if(f.x<this.bounds.right&&f.right<this.bounds.right){if(f.y<this.bounds.bottom&&f.bottom<this.bounds.bottom){e=1}else{if(f.y>this.bounds.bottom){e=2}}}else{if(f.x>this.bounds.right){if(f.y<this.bounds.bottom&&f.bottom<this.bounds.bottom){e=0}else{if(f.y>this.bounds.bottom){e=3}}}}return e},retrieve:function(f){if(f instanceof b.Rectangle){var g=this.objects;var e=this.getIndex(f)}else{if(!f.body){return this._empty}var g=this.objects;var e=this.getIndex(f.body)}if(this.nodes[0]){if(e!==-1){g=g.concat(this.nodes[e].retrieve(f))}else{g=g.concat(this.nodes[0].retrieve(f));g=g.concat(this.nodes[1].retrieve(f));g=g.concat(this.nodes[2].retrieve(f));g=g.concat(this.nodes[3].retrieve(f))}}return g},clear:function(){this.objects.length=0;var e=this.nodes.length;while(e--){this.nodes[e].clear();this.nodes.splice(e,1)}this.nodes.length=0}};b.QuadTree.prototype.constructor=b.QuadTree;b.Net=function(e){this.game=e};b.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(e){return window.location.hostname.indexOf(e)!==-1},updateQueryString:function(g,i,l,f){if(typeof l==="undefined"){l=false}if(typeof f==="undefined"||f===""){f=window.location.href}var e="";var h=new RegExp("([?|&])"+g+"=.*?(&|#|$)(.*)","gi");if(h.test(f)){if(typeof i!=="undefined"&&i!==null){e=f.replace(h,"$1"+g+"="+i+"$2$3")}else{e=f.replace(h,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof i!=="undefined"&&i!==null){var k=f.indexOf("?")!==-1?"&":"?";var j=f.split("#");f=j[0]+k+g+"="+i;if(j[1]){f+="#"+j[1]}e=f}else{e=f}}if(l){window.location.href=e}else{return e}},getQueryString:function(j){if(typeof j==="undefined"){j=""}var f={};var e=location.search.substring(1).split("&");for(var h in e){var g=e[h].split("=");if(g.length>1){if(j&&j==this.decodeURI(g[0])){return this.decodeURI(g[1])}else{f[this.decodeURI(g[0])]=this.decodeURI(g[1])}}}return f},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}};b.Net.prototype.constructor=b.Net;b.TweenManager=function(e){this.game=e;this._tweens=[];this._add=[];this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};b.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var e=0;e<this._tweens.length;e++){this._tweens[e].pendingDelete=true}this._add=[]},add:function(e){e._manager=this;this._add.push(e)},create:function(e){return new b.Tween(e,this.game,this)},remove:function(f){var e=this._tweens.indexOf(f);if(e!==-1){this._tweens[e].pendingDelete=true}},update:function(){if(this._tweens.length===0&&this._add.length===0){return false}var e=0;var f=this._tweens.length;while(e<f){if(this._tweens[e].update(this.game.time.now)){e++}else{this._tweens.splice(e,1);f--}}if(this._add.length>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(e){return this._tweens.some(function(f){return f._object===e})},_pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--){this._tweens[e]._pause()}},_resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--){this._tweens[e]._resume()}},pauseAll:function(){for(var e=this._tweens.length-1;e>=0;e--){this._tweens[e].pause()}},resumeAll:function(){for(var e=this._tweens.length-1;e>=0;e--){this._tweens[e].resume(true)}}};b.TweenManager.prototype.constructor=b.TweenManager;b.Tween=function(f,e,g){this._object=f;this.game=e;this._manager=g;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1000;this._repeat=0;this._yoyo=false;this._reversed=false;this._delayTime=0;this._startTime=null;this._easingFunction=b.Easing.Linear.None;this._interpolationFunction=b.Math.linearInterpolation;this._chainedTweens=[];this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._paused=false;this._pausedTime=0;this._codePaused=false;this.pendingDelete=false;this.onStart=new b.Signal();this.onLoop=new b.Signal();this.onComplete=new b.Signal();this.isRunning=false};b.Tween.prototype={to:function(h,k,l,g,f,j,i){k=k||1000;l=l||null;g=g||false;f=f||0;j=j||0;i=i||false;if(i&&j===0){j=1}var e;if(this._parent){e=this._manager.create(this._object);this._lastChild.chain(e);this._lastChild=e}else{e=this;this._parent=this;this._lastChild=this}e._repeat=j;e._duration=k;e._valuesEnd=h;if(l!==null){e._easingFunction=l}if(f>0){e._delayTime=f}e._yoyo=i;if(g){return this.start()}else{return this}},from:function(l,i,h,m,j,f,k){var g={};for(var e in l){if(l.hasOwnProperty(e)){g[e]=this._object[e];this._object[e]=l[e]}}this.to(g,i,h,m,j,f,k)},start:function(){if(this.game===null||this._object===null){return}this._manager.add(this);this.isRunning=true;this._onStartCallbackFired=false;this._startTime=this.game.time.now+this._delayTime;for(var e in this._valuesEnd){if(Array.isArray(this._valuesEnd[e])){if(this._valuesEnd[e].length===0){continue}this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}this._valuesStart[e]=this._object[e];if(!Array.isArray(this._valuesStart[e])){this._valuesStart[e]*=1}this._valuesStartRepeat[e]=this._valuesStart[e]||0}return this},generateData:function(q,k){if(this.game===null||this._object===null){return null}this._startTime=0;for(var o in this._valuesEnd){if(Array.isArray(this._valuesEnd[o])){if(this._valuesEnd[o].length===0){continue}this._valuesEnd[o]=[this._object[o]].concat(this._valuesEnd[o])}this._valuesStart[o]=this._object[o];if(!Array.isArray(this._valuesStart[o])){this._valuesStart[o]*=1}this._valuesStartRepeat[o]=this._valuesStart[o]||0}var h=0;var m=Math.floor(q*(this._duration/1000));var l=this._duration/m;var g=[];while(m--){var o;var p=(h-this._startTime)/this._duration;p=p>1?1:p;var n=this._easingFunction(p);var e={};for(o in this._valuesEnd){var f=this._valuesStart[o]||0;var i=this._valuesEnd[o];if(i instanceof Array){e[o]=this._interpolationFunction(i,n)}else{if(typeof(i)==="string"){i=f+parseFloat(i,10)}if(typeof(i)==="number"){e[o]=f+(i-f)*n}}}g.push(e);h+=l}if(this._yoyo){var j=g.slice();j.reverse();g=g.concat(j)}if(typeof k!=="undefined"){k=k.concat(g);return k}else{return g}},stop:function(){this.isRunning=false;this._onUpdateCallback=null;this._manager.remove(this);return this},delay:function(e){this._delayTime=e;return this},repeat:function(e){this._repeat=e;return this},yoyo:function(e){this._yoyo=e;if(e&&this._repeat===0){this._repeat=1}return this},easing:function(e){this._easingFunction=e;return this},interpolation:function(e){this._interpolationFunction=e;return this},chain:function(){this._chainedTweens=arguments;return this},loop:function(){this._lastChild.chain(this);return this},onUpdateCallback:function(f,e){this._onUpdateCallback=f;this._onUpdateCallbackContext=e;return this},pause:function(){this._codePaused=true;this._paused=true;this._pausedTime=this.game.time.now},_pause:function(){if(!this._codePaused){this._paused=true;this._pausedTime=this.game.time.now}},resume:function(){if(this._paused){this._paused=false;this._codePaused=false;this._startTime+=(this.game.time.now-this._pausedTime)}},_resume:function(){if(this._codePaused){return}else{this._startTime+=this.game.time.pauseDuration;this._paused=false}},update:function(f){if(this.pendingDelete){return false}if(this._paused||f<this._startTime){return true}var m;if(f<this._startTime){return true}if(this._onStartCallbackFired===false){this.onStart.dispatch(this._object);this._onStartCallbackFired=true}var n=(f-this._startTime)/this._duration;n=n>1?1:n;var l=this._easingFunction(n);for(m in this._valuesEnd){var e=this._valuesStart[m]||0;var g=this._valuesEnd[m];if(g instanceof Array){this._object[m]=this._interpolationFunction(g,l)}else{if(typeof(g)==="string"){g=e+parseFloat(g,10)}if(typeof(g)==="number"){this._object[m]=e+(g-e)*l}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,l)}if(n==1){if(this._repeat>0){if(isFinite(this._repeat)){this._repeat--}for(m in this._valuesStartRepeat){if(typeof(this._valuesEnd[m])==="string"){this._valuesStartRepeat[m]=this._valuesStartRepeat[m]+parseFloat(this._valuesEnd[m],10)}if(this._yoyo){var h=this._valuesStartRepeat[m];this._valuesStartRepeat[m]=this._valuesEnd[m];this._valuesEnd[m]=h}this._valuesStart[m]=this._valuesStartRepeat[m]}if(this._yoyo){this._reversed=!this._reversed}this._startTime=f+this._delayTime;this.onLoop.dispatch(this._object);return true}else{this.isRunning=false;this.onComplete.dispatch(this._object);for(var j=0,k=this._chainedTweens.length;j<k;j++){this._chainedTweens[j].start(f)}return false}}return true}};b.Tween.prototype.constructor=b.Tween;b.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){if((e*=2)<1){return 0.5*e*e}return -0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return --e*e*e+1},InOut:function(e){if((e*=2)<1){return 0.5*e*e*e}return 0.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1-(--e*e*e*e)},InOut:function(e){if((e*=2)<1){return 0.5*e*e*e*e}return -0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return --e*e*e*e*e+1},InOut:function(e){if((e*=2)<1){return 0.5*e*e*e*e*e}return 0.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return 0.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){if(e===0){return 0}if(e===1){return 1}if((e*=2)<1){return 0.5*Math.pow(1024,e-1)}return 0.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1-(--e*e))},InOut:function(e){if((e*=2)<1){return -0.5*(Math.sqrt(1-e*e)-1)}return 0.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(f){var g,e=0.1,h=0.4;if(f===0){return 0}if(f===1){return 1}if(!e||e<1){e=1;g=h/4}else{g=h*Math.asin(1/e)/(2*Math.PI)}return -(e*Math.pow(2,10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h))},Out:function(f){var g,e=0.1,h=0.4;if(f===0){return 0}if(f===1){return 1}if(!e||e<1){e=1;g=h/4}else{g=h*Math.asin(1/e)/(2*Math.PI)}return(e*Math.pow(2,-10*f)*Math.sin((f-g)*(2*Math.PI)/h)+1)},InOut:function(f){var g,e=0.1,h=0.4;if(f===0){return 0}if(f===1){return 1}if(!e||e<1){e=1;g=h/4}else{g=h*Math.asin(1/e)/(2*Math.PI)}if((f*=2)<1){return -0.5*(e*Math.pow(2,10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h))}return e*Math.pow(2,-10*(f-=1))*Math.sin((f-g)*(2*Math.PI)/h)*0.5+1}},Back:{In:function(e){var f=1.70158;return e*e*((f+1)*e-f)},Out:function(e){var f=1.70158;return --e*e*((f+1)*e+f)+1},InOut:function(e){var f=1.70158*1.525;if((e*=2)<1){return 0.5*(e*e*((f+1)*e-f))}return 0.5*((e-=2)*e*((f+1)*e+f)+2)}},Bounce:{In:function(e){return 1-b.Easing.Bounce.Out(1-e)},Out:function(e){if(e<(1/2.75)){return 7.5625*e*e}else{if(e<(2/2.75)){return 7.5625*(e-=(1.5/2.75))*e+0.75}else{if(e<(2.5/2.75)){return 7.5625*(e-=(2.25/2.75))*e+0.9375}else{return 7.5625*(e-=(2.625/2.75))*e+0.984375}}}},InOut:function(e){if(e<0.5){return b.Easing.Bounce.In(e*2)*0.5}return b.Easing.Bounce.Out(e*2-1)*0.5+0.5}}};b.Time=function(e){this.game=e;this.time=0;this.now=0;this.elapsed=0;this.pausedTime=0;this.advancedTiming=false;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.physicsElapsed=0;this.deltaCap=0;this.timeCap=1000;this.frames=0;this.pauseDuration=0;this.timeToCall=0;this.lastTime=0;this.events=new b.Timer(this.game,false);this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[];this._len=0;this._i=0};b.Time.prototype={boot:function(){this._started=Date.now();this.events.start()},create:function(e){if(typeof e==="undefined"){e=true}var f=new b.Timer(this.game,e);this._timers.push(f);return f},removeAll:function(){for(var e=0;e<this._timers.length;e++){this._timers[e].destroy()}this._timers=[];this.events.removeAll()},update:function(e){this.now=e;this.timeToCall=this.game.math.max(0,16-(e-this.lastTime));this.elapsed=this.now-this.time;if(this.elapsed>this.timeCap){this.elapsed=1/60}this.physicsElapsed=this.elapsed/1000||1/60;if(this.deltaCap>0&&this.physicsElapsed>this.deltaCap){this.physicsElapsed=this.deltaCap}if(this.advancedTiming){this.msMin=this.game.math.min(this.msMin,this.elapsed);this.msMax=this.game.math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=this.game.math.min(this.fpsMin,this.fps);this.fpsMax=this.game.math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}}this.time=this.now;this.lastTime=e+this.timeToCall;if(!this.game.paused){this.events.update(this.now);this._i=0;this._len=this._timers.length;while(this._i<this._len){if(this._timers[this._i].update(this.now)){this._i++}else{this._timers.splice(this._i,1);this._len--}}}},gamePaused:function(){this._pauseStarted=this.now;this.events.pause();var e=this._timers.length;while(e--){this._timers[e]._pause()}},gameResumed:function(){this.time=this.now=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var e=this._timers.length;while(e--){this._timers[e]._resume()}},totalElapsedSeconds:function(){return(this.now-this._started)*0.001},elapsedSince:function(e){return this.now-e},elapsedSecondsSince:function(e){return(this.now-e)*0.001},reset:function(){this._started=this.now;this.removeAll()}};b.Time.prototype.constructor=b.Time;b.Timer=function(e,f){if(typeof f==="undefined"){f=true}this.game=e;this.running=false;this.autoDestroy=f;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new b.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};b.Timer.MINUTE=60000;b.Timer.SECOND=1000;b.Timer.HALF=500;b.Timer.QUARTER=250;b.Timer.prototype={create:function(i,e,g,l,f,h){var j=i;if(this._now===0){j+=this.game.time.now}else{j+=this._now}var k=new b.TimerEvent(this,i,j,g,e,l,f,h);this.events.push(k);this.order();this.expired=false;return k},add:function(f,g,e){return this.create(f,false,0,g,e,Array.prototype.splice.call(arguments,3))},repeat:function(g,f,h,e){return this.create(g,false,f,h,e,Array.prototype.splice.call(arguments,4))},loop:function(f,g,e){return this.create(f,true,0,g,e,Array.prototype.splice.call(arguments,3))},start:function(e){if(this.running){return}this._started=this.game.time.now+(e||0);this.running=true;for(var f=0;f<this.events.length;f++){this.events[f].tick=this.events[f].delay+this._started}},stop:function(e){this.running=false;if(typeof e==="undefined"){e=true}if(e){this.events.length=0}},remove:function(f){for(var e=0;e<this.events.length;e++){if(this.events[e]===f){this.events[e].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(f,e){if(f.tick<e.tick){return -1}else{if(f.tick>e.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(e){if(this.paused){return true}this.elapsed=e-this._now;this._now=e;if(this.elapsed>this.timeCap){this.adjustEvents(e-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.now;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.now;this.paused=true},adjustEvents:function(h){for(var f=0;f<this.events.length;f++){if(!this.events[f].pendingDelete){var e=this.events[f].tick-h;if(e<0){e=0}this.events[f].tick=this._now+e}}var g=this.nextTick-h;if(g<0){this.nextTick=this._now}else{this.nextTick=this._now+g}},resume:function(){if(!this.paused){return}var e=this.game.time.now;this._pauseTotal+=e-this._now;this._now=e;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(b.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(b.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(b.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(b.Timer.prototype,"ms",{get:function(){return this._now-this._started-this._pauseTotal}});Object.defineProperty(b.Timer.prototype,"seconds",{get:function(){return this.ms*0.001}});b.Timer.prototype.constructor=b.Timer;b.TimerEvent=function(l,i,j,g,e,k,f,h){this.timer=l;this.delay=i;this.tick=j;this.repeatCount=g-1;this.loop=e;this.callback=k;this.callbackContext=f;this.args=h;this.pendingDelete=false};b.TimerEvent.prototype.constructor=b.TimerEvent;b.AnimationManager=function(e){this.sprite=e;this.game=e.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};b.AnimationManager.prototype={loadFrameData:function(e){this._frameData=e;this.frame=0;this.isLoaded=true},add:function(h,i,g,f,e){if(this._frameData===null){console.warn("No FrameData available for Phaser.Animation "+h);return}i=i||[];g=g||60;if(typeof f==="undefined"){f=false}if(typeof e==="undefined"){if(i&&typeof i[0]==="number"){e=true}else{e=false}}if(this.sprite.events.onAnimationStart===null){this.sprite.events.onAnimationStart=new b.Signal();this.sprite.events.onAnimationComplete=new b.Signal();this.sprite.events.onAnimationLoop=new b.Signal()}this._outputFrames.length=0;this._frameData.getFrameIndexes(i,e,this._outputFrames);this._anims[h]=new b.Animation(this.game,this.sprite,h,this._frameData,this._outputFrames,g,f);this.currentAnim=this._anims[h];this.currentFrame=this.currentAnim.currentFrame;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}return this._anims[h]},validateFrames:function(g,e){if(typeof e=="undefined"){e=true}for(var f=0;f<g.length;f++){if(e===true){if(g[f]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(g[f])===false){return false}}}return true},play:function(h,g,f,e){if(this._anims[h]){if(this.currentAnim===this._anims[h]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(g,f,e)}}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[h];this.currentAnim.paused=false;return this.currentAnim.play(g,f,e)}}},stop:function(f,e){if(typeof e=="undefined"){e=false}if(typeof f=="string"){if(this._anims[f]){this.currentAnim=this._anims[f];this.currentAnim.stop(e)}}else{if(this.currentAnim){this.currentAnim.stop(e)}}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()===true){this.currentFrame=this.currentAnim.currentFrame;return true}return false},getAnimation:function(e){if(typeof e==="string"){if(this._anims[e]){return this._anims[e]}}return null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}},destroy:function(){var e=null;for(var e in this._anims){if(this._anims.hasOwnProperty(e)){this._anims[e].destroy()}}this._anims={};this._frameData=null;this._frameIndex=0;this.currentAnim=null;this.currentFrame=null}};b.AnimationManager.prototype.constructor=b.AnimationManager;Object.defineProperty(b.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(b.AnimationManager.prototype,"frameTotal",{get:function(){if(this._frameData){return this._frameData.total}else{return -1}}});Object.defineProperty(b.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(e){this.currentAnim.paused=e}});Object.defineProperty(b.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this._frameIndex}},set:function(e){if(typeof e==="number"&&this._frameData&&this._frameData.getFrame(e)!==null){this.currentFrame=this._frameData.getFrame(e);if(this.currentFrame){this._frameIndex=e;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}}});Object.defineProperty(b.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(e){if(typeof e==="string"&&this._frameData&&this._frameData.getFrameByName(e)!==null){this.currentFrame=this._frameData.getFrameByName(e);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this.sprite.__tilePattern){this.__tilePattern=false;this.tilingTexture=false}}}else{console.warn("Cannot set frameName: "+e)}}});b.Animation=function(f,j,h,i,k,g,e){this.game=f;this._parent=j;this._frameData=i;this.name=h;this._frames=[];this._frames=this._frames.concat(k);this.delay=1000/g;this.loop=e;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new b.Signal();this.onComplete=new b.Signal();this.onLoop=new b.Signal();this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};b.Animation.prototype={play:function(g,f,e){if(typeof g==="number"){this.delay=1000/g}if(typeof f==="boolean"){this.loop=f}if(typeof e!=="undefined"){this.killOnComplete=e}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}this._parent.events.onAnimationStart.dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart.dispatch(this._parent,this)},setFrame:function(g,e){var h;if(typeof e==="undefined"){e=false}if(typeof g==="string"){for(var f=0;f<this._frames.length;f++){if(this._frameData.getFrame(this._frames[f]).name===g){h=f}}}else{if(typeof g==="number"){if(e){h=g}else{for(var f=0;f<this._frames.length;f++){if(this.frames[f]===h){h=f}}}}}if(h){this._frameIndex=h-1;this._timeNextFrame=this.game.time.now;this.update()}},stop:function(e,f){if(typeof e==="undefined"){e=false}if(typeof f==="undefined"){f=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(e){this.currentFrame=this._frameData.getFrame(this._frames[0])}if(f){this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.now}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.now+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying===true&&this.game.time.now>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.now-this._timeNextFrame;this._timeLastFrame=this.game.time.now;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff);this._frameIndex+=this._frameSkip;if(this._frameIndex>=this._frames.length){if(this.loop){this._frameIndex%=this._frames.length;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}this.loopCount++;this._parent.events.onAnimationLoop.dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this)}else{this.complete()}}else{this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);if(this._parent.__tilePattern){this._parent.__tilePattern=false;this._parent.tilingTexture=false}}}return true}return false},destroy:function(){this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose()},complete:function(){this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};b.Animation.prototype.constructor=b.Animation;Object.defineProperty(b.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(e){this.isPaused=e;if(e){this._pauseStartTime=this.game.time.now}else{if(this.isPlaying){this._timeNextFrame=this.game.time.now+this.delay}}}});Object.defineProperty(b.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(b.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(e){this.currentFrame=this._frameData.getFrame(this._frames[e]);if(this.currentFrame!==null){this._frameIndex=e;this._parent.setTexture(PIXI.TextureCache[this.currentFrame.uuid])}}});Object.defineProperty(b.Animation.prototype,"speed",{get:function(){return Math.round(1000/this.delay)},set:function(e){if(e>=1){this.delay=1000/e}}});b.Animation.generateFrameNames=function(j,m,g,k,h){if(typeof k=="undefined"){k=""}var e=[];var l="";if(m<g){for(var f=m;f<=g;f++){if(typeof h=="number"){l=b.Utils.pad(f.toString(),h,"0",1)}else{l=f.toString()}l=j+l+k;e.push(l)}}else{for(var f=m;f>=g;f--){if(typeof h=="number"){l=b.Utils.pad(f.toString(),h,"0",1)}else{l=f.toString()}l=j+l+k;e.push(l)}}return e};b.Frame=function(h,f,k,j,e,g,i){this.index=h;this.x=f;this.y=k;this.width=j;this.height=e;this.name=g;this.uuid=i;this.centerX=Math.floor(j/2);this.centerY=Math.floor(e/2);this.distance=b.Math.distance(0,0,j,e);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=j;this.sourceSizeH=e;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0};b.Frame.prototype={setTrim:function(i,h,k,f,e,g,j){this.trimmed=i;if(i){this.width=h;this.height=k;this.sourceSizeW=h;this.sourceSizeH=k;this.centerX=Math.floor(h/2);this.centerY=Math.floor(k/2);this.spriteSourceSizeX=f;this.spriteSourceSizeY=e;this.spriteSourceSizeW=g;this.spriteSourceSizeH=j}},getRect:function(e){if(typeof e==="undefined"){e=new b.Rectangle(this.x,this.y,this.width,this.height)}else{e.setTo(this.x,this.y,this.width,this.height)}return e}};b.Frame.prototype.constructor=b.Frame;b.FrameData=function(){this._frames=[];this._frameNames=[]};b.FrameData.prototype={addFrame:function(e){e.index=this._frames.length;this._frames.push(e);if(e.name!==""){this._frameNames[e.name]=e.index}return e},getFrame:function(e){if(e>this._frames.length){e=0}return this._frames[e]},getFrameByName:function(e){if(typeof this._frameNames[e]==="number"){return this._frames[this._frameNames[e]]}return null},checkFrameName:function(e){if(this._frameNames[e]==null){return false}return true},getFrameRange:function(h,e,f){if(typeof f==="undefined"){f=[]}for(var g=h;g<=e;g++){f.push(this._frames[g])}return f},getFrames:function(j,f,g){if(typeof f==="undefined"){f=true}if(typeof g==="undefined"){g=[]}if(typeof j==="undefined"||j.length===0){for(var h=0;h<this._frames.length;h++){g.push(this._frames[h])}}else{for(var h=0,e=j.length;h<e;h++){if(f){g.push(this.getFrame(j[h]))}else{g.push(this.getFrameByName(j[h]))}}}return g},getFrameIndexes:function(j,f,g){if(typeof f==="undefined"){f=true}if(typeof g==="undefined"){g=[]}if(typeof j==="undefined"||j.length===0){for(var h=0,e=this._frames.length;h<e;h++){g.push(this._frames[h].index)}}else{for(var h=0,e=j.length;h<e;h++){if(f){g.push(j[h])}else{if(this.getFrameByName(j[h])){g.push(this.getFrameByName(j[h]).index)}}}}return g}};b.FrameData.prototype.constructor=b.FrameData;Object.defineProperty(b.FrameData.prototype,"total",{get:function(){return this._frames.length}});b.AnimationParser={spriteSheet:function(s,u,o,h,r,l,f){var w=s.cache.getImage(u);if(w==null){return null}var n=w.width;var m=w.height;if(o<=0){o=Math.floor(-n/Math.min(-1,o))}if(h<=0){h=Math.floor(-m/Math.min(-1,h))}var g=Math.floor((n-l)/(o+f));var e=Math.floor((m-l)/(h+f));var v=g*e;if(r!==-1){v=r}if(n===0||m===0||n<o||m<h||v===0){console.warn("Phaser.AnimationParser.spriteSheet: width/height zero or width/height < given frameWidth/frameHeight");return null}var t=new b.FrameData();var k=l;var j=l;for(var q=0;q<v;q++){var p=s.rnd.uuid();t.addFrame(new b.Frame(q,k,j,o,h,"",p));PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[u],{x:k,y:j,width:o,height:h});k+=o+f;if(k+o>n){k=l;j+=h+f}}return t},JSONData:function(e,g,l){if(!g.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(g);return}var j=new b.FrameData();var k=g.frames;var m;for(var f=0;f<k.length;f++){var h=e.rnd.uuid();m=j.addFrame(new b.Frame(f,k[f].frame.x,k[f].frame.y,k[f].frame.w,k[f].frame.h,k[f].filename,h));PIXI.TextureCache[h]=new PIXI.Texture(PIXI.BaseTextureCache[l],{x:k[f].frame.x,y:k[f].frame.y,width:k[f].frame.w,height:k[f].frame.h});if(k[f].trimmed){m.setTrim(k[f].trimmed,k[f].sourceSize.w,k[f].sourceSize.h,k[f].spriteSourceSize.x,k[f].spriteSourceSize.y,k[f].spriteSourceSize.w,k[f].spriteSourceSize.h);PIXI.TextureCache[h].trim=new b.Rectangle(k[f].spriteSourceSize.x,k[f].spriteSourceSize.y,k[f].sourceSize.w,k[f].sourceSize.h)}}return j},JSONDataHash:function(m,n,j){if(!n.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(n);return}var f=new b.FrameData();var k=n.frames;var h;var g=0;for(var l in k){var e=m.rnd.uuid();h=f.addFrame(new b.Frame(g,k[l].frame.x,k[l].frame.y,k[l].frame.w,k[l].frame.h,l,e));PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[j],{x:k[l].frame.x,y:k[l].frame.y,width:k[l].frame.w,height:k[l].frame.h});if(k[l].trimmed){h.setTrim(k[l].trimmed,k[l].sourceSize.w,k[l].sourceSize.h,k[l].spriteSourceSize.x,k[l].spriteSourceSize.y,k[l].spriteSourceSize.w,k[l].spriteSourceSize.h);PIXI.TextureCache[e].trim=new b.Rectangle(k[l].spriteSourceSize.x,k[l].spriteSourceSize.y,k[l].sourceSize.w,k[l].sourceSize.h)}g++}return f},XMLData:function(u,g,h){if(!g.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var v=new b.FrameData();var n=g.getElementsByTagName("SubTexture");var j;var t;var w;var o;var m;var l;var q;var p;var f;var e;var r;var k;for(var s=0;s<n.length;s++){t=u.rnd.uuid();o=n[s].attributes;w=o.name.nodeValue;m=parseInt(o.x.nodeValue,10);l=parseInt(o.y.nodeValue,10);q=parseInt(o.width.nodeValue,10);p=parseInt(o.height.nodeValue,10);f=null;e=null;if(o.frameX){f=Math.abs(parseInt(o.frameX.nodeValue,10));e=Math.abs(parseInt(o.frameY.nodeValue,10));r=parseInt(o.frameWidth.nodeValue,10);k=parseInt(o.frameHeight.nodeValue,10)}j=v.addFrame(new b.Frame(s,m,l,q,p,w,t));PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[h],{x:m,y:l,width:q,height:p});if(f!==null||e!==null){j.setTrim(true,q,p,f,e,r,k);PIXI.TextureCache[t].trim=new b.Rectangle(f,e,q,p)}}return v}};b.Cache=function(e){this.game=e;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new b.Signal();this._cacheMap=[];this._cacheMap[b.Cache.CANVAS]=this._canvases;this._cacheMap[b.Cache.IMAGE]=this._images;this._cacheMap[b.Cache.TEXTURE]=this._textures;this._cacheMap[b.Cache.SOUND]=this._sounds;this._cacheMap[b.Cache.TEXT]=this._text;this._cacheMap[b.Cache.PHYSICS]=this._physics;this._cacheMap[b.Cache.TILEMAP]=this._tilemaps;this._cacheMap[b.Cache.BINARY]=this._binary;this._cacheMap[b.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[b.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[b.Cache.JSON]=this._json};b.Cache.CANVAS=1;b.Cache.IMAGE=2;b.Cache.TEXTURE=3;b.Cache.SOUND=4;b.Cache.TEXT=5;b.Cache.PHYSICS=6;b.Cache.TILEMAP=7;b.Cache.BINARY=8;b.Cache.BITMAPDATA=9;b.Cache.BITMAPFONT=10;b.Cache.JSON=11;b.Cache.prototype={addCanvas:function(g,e,f){this._canvases[g]={canvas:e,context:f}},addBinary:function(f,e){this._binary[f]=e},addBitmapData:function(e,f){this._bitmapDatas[e]=f;return f},addRenderTexture:function(e,f){var g=new b.Frame(0,0,0,f.width,f.height,"","");this._textures[e]={texture:f,frame:g}},addSpriteSheet:function(h,g,j,e,f,k,i,l){this._images[h]={url:g,data:j,spriteSheet:true,frameWidth:e,frameHeight:f,margin:i,spacing:l};PIXI.BaseTextureCache[h]=new PIXI.BaseTexture(j);PIXI.TextureCache[h]=new PIXI.Texture(PIXI.BaseTextureCache[h]);this._images[h].frameData=b.AnimationParser.spriteSheet(this.game,h,e,f,k,i,l)},addTilemap:function(f,e,h,g){this._tilemaps[f]={url:e,data:h,format:g}},addTextureAtlas:function(g,f,h,e,i){this._images[g]={url:f,data:h,spriteSheet:true};PIXI.BaseTextureCache[g]=new PIXI.BaseTexture(h);PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[g]);if(i==b.Loader.TEXTURE_ATLAS_JSON_ARRAY){this._images[g].frameData=b.AnimationParser.JSONData(this.game,e,g)}else{if(i==b.Loader.TEXTURE_ATLAS_JSON_HASH){this._images[g].frameData=b.AnimationParser.JSONDataHash(this.game,e,g)}else{if(i==b.Loader.TEXTURE_ATLAS_XML_STARLING){this._images[g].frameData=b.AnimationParser.XMLData(this.game,e,g)}}}},addBitmapFont:function(f,e,j,g,i,h){this._images[f]={url:e,data:j,spriteSheet:true};PIXI.BaseTextureCache[f]=new PIXI.BaseTexture(j);PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[f]);b.LoaderParser.bitmapFont(this.game,g,f,i,h)},addPhysicsData:function(f,e,g,h){this._physics[f]={url:e,data:g,format:h}},addDefaultImage:function(){var e=new Image();e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:e,spriteSheet:false};this._images.__default.frame=new b.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(e);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var e=new Image();e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:e,spriteSheet:false};this._images.__missing.frame=new b.Frame(0,0,0,32,32,"","");PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(e);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(f,e,g){this._text[f]={url:e,data:g}},addJSON:function(f,e,g){this._json[f]={url:e,data:g}},addImage:function(f,e,g){this._images[f]={url:e,data:g,spriteSheet:false};this._images[f].frame=new b.Frame(0,0,0,g.width,g.height,f,this.game.rnd.uuid());PIXI.BaseTextureCache[f]=new PIXI.BaseTexture(g);PIXI.TextureCache[f]=new PIXI.Texture(PIXI.BaseTextureCache[f])},addSound:function(h,g,j,f,i){f=f||true;i=i||false;var e=false;if(i){e=true}this._sounds[h]={url:g,data:j,isDecoding:false,decoded:e,webAudio:f,audioTag:i,locked:this.game.sound.touchLocked}},reloadSound:function(e){var f=this;if(this._sounds[e]){this._sounds[e].data.src=this._sounds[e].url;this._sounds[e].data.addEventListener("canplaythrough",function(){return f.reloadSoundComplete(e)},false);this._sounds[e].data.load()}},reloadSoundComplete:function(e){if(this._sounds[e]){this._sounds[e].locked=false;this.onSoundUnlock.dispatch(e)}},updateSound:function(e,g,f){if(this._sounds[e]){this._sounds[e][g]=f}},decodedSound:function(e,f){this._sounds[e].data=f;this._sounds[e].decoded=true;this._sounds[e].isDecoding=false},getCanvas:function(e){if(this._canvases[e]){return this._canvases[e].canvas}else{console.warn('Phaser.Cache.getCanvas: Invalid key: "'+e+'"')}},getBitmapData:function(e){if(this._bitmapDatas[e]){return this._bitmapDatas[e]}else{console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+e+'"')}},getBitmapFont:function(e){if(this._bitmapFont[e]){return this._bitmapFont[e]}else{console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+e+'"')}},getPhysicsData:function(g,f,e){if(typeof f==="undefined"||f===null){if(this._physics[g]){return this._physics[g].data}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+g+'"')}}else{if(this._physics[g]&&this._physics[g].data[f]){var h=this._physics[g].data[f];if(h&&e){for(var i in h){i=h[i];if(i.fixtureKey===e){return i}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+e+" in "+g+'"')}else{return h}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+g+" / "+f+'"')}}return null},checkKey:function(f,e){if(this._cacheMap[f][e]){return true}return false},checkCanvasKey:function(e){return this.checkKey(b.Cache.CANVAS,e)},checkImageKey:function(e){return this.checkKey(b.Cache.IMAGE,e)},checkTextureKey:function(e){return this.checkKey(b.Cache.TEXTURE,e)},checkSoundKey:function(e){return this.checkKey(b.Cache.SOUND,e)},checkTextKey:function(e){return this.checkKey(b.Cache.TEXT,e)},checkPhysicsKey:function(e){return this.checkKey(b.Cache.PHYSICS,e)},checkTilemapKey:function(e){return this.checkKey(b.Cache.TILEMAP,e)},checkBinaryKey:function(e){return this.checkKey(b.Cache.BINARY,e)},checkBitmapDataKey:function(e){return this.checkKey(b.Cache.BITMAPDATA,e)},checkBitmapFontKey:function(e){return this.checkKey(b.Cache.BITMAPFONT,e)},checkJSONKey:function(e){return this.checkKey(b.Cache.JSON,e)},getImage:function(e){if(this._images[e]){return this._images[e].data}else{console.warn('Phaser.Cache.getImage: Invalid key: "'+e+'"')}},getTilemapData:function(e){if(this._tilemaps[e]){return this._tilemaps[e]}else{console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+e+'"')}},getFrameData:function(e){if(this._images[e]&&this._images[e].frameData){return this._images[e].frameData}return null},updateFrameData:function(e,f){if(this._images[e]){this._images[e].spriteSheet=true;this._images[e].frameData=f}},getFrameByIndex:function(e,f){if(this._images[e]&&this._images[e].frameData){return this._images[e].frameData.getFrame(f)}return null},getFrameByName:function(e,f){if(this._images[e]&&this._images[e].frameData){return this._images[e].frameData.getFrameByName(f)}return null},getFrame:function(e){if(this._images[e]&&this._images[e].spriteSheet===false){return this._images[e].frame}return null},getTextureFrame:function(e){if(this._textures[e]){return this._textures[e].frame}return null},getTexture:function(e){if(this._textures[e]){return this._textures[e]}else{console.warn('Phaser.Cache.getTexture: Invalid key: "'+e+'"')}},getSound:function(e){if(this._sounds[e]){return this._sounds[e]}else{console.warn('Phaser.Cache.getSound: Invalid key: "'+e+'"')}},getSoundData:function(e){if(this._sounds[e]){return this._sounds[e].data}else{console.warn('Phaser.Cache.getSoundData: Invalid key: "'+e+'"')}},isSoundDecoded:function(e){if(this._sounds[e]){return this._sounds[e].decoded}},isSoundReady:function(e){return(this._sounds[e]&&this._sounds[e].decoded&&this.game.sound.touchLocked===false)},isSpriteSheet:function(e){if(this._images[e]){return this._images[e].spriteSheet}return false},getText:function(e){if(this._text[e]){return this._text[e].data}else{console.warn('Phaser.Cache.getText: Invalid key: "'+e+'"')}},getJSON:function(e){if(this._json[e]){return this._json[e].data}else{console.warn('Phaser.Cache.getJSON: Invalid key: "'+e+'"')}},getBinary:function(e){if(this._binary[e]){return this._binary[e]}else{console.warn('Phaser.Cache.getBinary: Invalid key: "'+e+'"')}},getKeys:function(f){var h=null;switch(f){case b.Cache.CANVAS:h=this._canvases;break;case b.Cache.IMAGE:h=this._images;break;case b.Cache.TEXTURE:h=this._textures;break;case b.Cache.SOUND:h=this._sounds;break;case b.Cache.TEXT:h=this._text;break;case b.Cache.PHYSICS:h=this._physics;break;case b.Cache.TILEMAP:h=this._tilemaps;break;case b.Cache.BINARY:h=this._binary;break;case b.Cache.BITMAPDATA:h=this._bitmapDatas;break;case b.Cache.BITMAPFONT:h=this._bitmapFont;break;case b.Cache.JSON:h=this._json;break}if(!h){return}var e=[];for(var g in h){if(g!=="__default"&&g!=="__missing"){e.push(g)}}return e},removeCanvas:function(e){delete this._canvases[e]},removeImage:function(e){delete this._images[e]},removeSound:function(e){delete this._sounds[e]},removeText:function(e){delete this._text[e]},removeJSON:function(e){delete this._json[e]},removePhysics:function(e){delete this._physics[e]},removeTilemap:function(e){delete this._tilemaps[e]},removeBinary:function(e){delete this._binary[e]},removeBitmapData:function(e){delete this._bitmapDatas[e]},removeBitmapFont:function(e){delete this._bitmapFont[e]},destroy:function(){for(var e in this._canvases){delete this._canvases[e]}for(var e in this._images){if(e!=="__default"&&e!=="__missing"){delete this._images[e]}}for(var e in this._sounds){delete this._sounds[e]}for(var e in this._text){delete this._text[e]}for(var e in this._json){delete this._json[e]}for(var e in this._textures){delete this._textures[e]}for(var e in this._physics){delete this._physics[e]}for(var e in this._tilemaps){delete this._tilemaps[e]}for(var e in this._binary){delete this._binary[e]}for(var e in this._bitmapDatas){delete this._bitmapDatas[e]}for(var e in this._bitmapFont){delete this._bitmapFont[e]}}};b.Cache.prototype.constructor=b.Cache;b.Loader=function(e){this.game=e;this._fileList=[];this._fileIndex=0;this._progressChunk=0;this._xhr=new XMLHttpRequest();this._ajax=null;this.isLoading=false;this.hasLoaded=false;this.progress=0;this.progressFloat=0;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.onLoadStart=new b.Signal();this.onFileStart=new b.Signal();this.onFileComplete=new b.Signal();this.onFileError=new b.Signal();this.onLoadComplete=new b.Signal()};b.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;b.Loader.TEXTURE_ATLAS_JSON_HASH=1;b.Loader.TEXTURE_ATLAS_XML_STARLING=2;b.Loader.PHYSICS_LIME_CORONA_JSON=3;b.Loader.PHYSICS_PHASER_JSON=4;b.Loader.prototype={setPreloadSprite:function(e,f){f=f||0;this.preloadSprite={sprite:e,direction:f,width:e.width,height:e.height,rect:null};if(f===0){this.preloadSprite.rect=new b.Rectangle(0,0,1,e.height)}else{this.preloadSprite.rect=new b.Rectangle(0,0,e.width,1)}e.crop(this.preloadSprite.rect);e.visible=true},checkKeyExists:function(g,f){if(this._fileList.length>0){for(var e=0;e<this._fileList.length;e++){if(this._fileList[e].type===g&&this._fileList[e].key===f){return true}}}return false},getAssetIndex:function(g,f){if(this._fileList.length>0){for(var e=0;e<this._fileList.length;e++){if(this._fileList[e].type===g&&this._fileList[e].key===f){return e}}}return -1},getAsset:function(g,f){if(this._fileList.length>0){for(var e=0;e<this._fileList.length;e++){if(this._fileList[e].type===g&&this._fileList[e].key===f){return{index:e,file:this._fileList[e]}}}}return false},reset:function(){this.preloadSprite=null;this.isLoading=false;this._fileList.length=0;this._fileIndex=0},addToFileList:function(h,g,e,f){var i={type:h,key:g,url:e,data:null,error:false,loaded:false};if(typeof f!=="undefined"){for(var j in f){i[j]=f[j]}}if(this.checkKeyExists(h,g)===false){this._fileList.push(i)}},replaceInFileList:function(i,h,f,g){var j={type:i,key:h,url:f,data:null,error:false,loaded:false};if(typeof g!=="undefined"){for(var k in g){j[k]=g[k]}}var e=this.getAssetIndex(i,h);if(e===-1){this._fileList.push(j)}else{this._fileList[e]=j}},image:function(g,f,e){if(typeof e==="undefined"){e=false}if(e){this.replaceInFileList("image",g,f)}else{this.addToFileList("image",g,f)}return this},text:function(g,f,e){if(typeof e==="undefined"){e=false}if(e){this.replaceInFileList("text",g,f)}else{this.addToFileList("text",g,f)}return this},json:function(g,f,e){if(typeof e==="undefined"){e=false}if(e){this.replaceInFileList("json",g,f)}else{this.addToFileList("json",g,f)}return this},script:function(g,f,h,e){if(typeof h==="undefined"){h=false}if(h!==false&&typeof e==="undefined"){e=h}this.addToFileList("script",g,f,{callback:h,callbackContext:e});return this},binary:function(g,f,h,e){if(typeof h==="undefined"){h=false}if(h!==false&&typeof e==="undefined"){e=h}this.addToFileList("binary",g,f,{callback:h,callbackContext:e});return this},spritesheet:function(h,g,e,f,j,i,k){if(typeof j==="undefined"){j=-1}if(typeof i==="undefined"){i=0}if(typeof k==="undefined"){k=0}this.addToFileList("spritesheet",h,g,{frameWidth:e,frameHeight:f,frameMax:j,margin:i,spacing:k});return this},audio:function(f,g,e){if(typeof e==="undefined"){e=true}this.addToFileList("audio",f,g,{buffer:null,autoDecode:e});return this},tilemap:function(e,h,g,f){if(typeof h==="undefined"){h=null}if(typeof g==="undefined"){g=null}if(typeof f==="undefined"){f=b.Tilemap.CSV}if(h==null&&g==null){console.warn("Phaser.Loader.tilemap - Both mapDataURL and mapData are null. One must be set.");return this}if(g){switch(f){case b.Tilemap.CSV:break;case b.Tilemap.TILED_JSON:if(typeof g==="string"){g=JSON.parse(g)}break}this.game.cache.addTilemap(e,null,g,f)}else{this.addToFileList("tilemap",e,h,{format:f})}return this},physics:function(e,h,f,g){if(typeof h==="undefined"){h=null}if(typeof f==="undefined"){f=null}if(typeof g==="undefined"){g=b.Physics.LIME_CORONA_JSON}if(h==null&&f==null){console.warn("Phaser.Loader.physics - Both dataURL and jsonData are null. One must be set.");return this}if(f){if(typeof f==="string"){f=JSON.parse(f)}this.game.cache.addPhysicsData(e,null,f,g)}else{this.addToFileList("physics",e,h,{format:g})}return this},bitmapFont:function(n,g,m,f,l,k){if(typeof m==="undefined"){m=null}if(typeof f==="undefined"){f=null}if(typeof l==="undefined"){l=0}if(typeof k==="undefined"){k=0}if(m){this.addToFileList("bitmapfont",n,g,{xmlURL:m,xSpacing:l,ySpacing:k})}else{if(typeof f==="string"){var h;try{if(window.DOMParser){var i=new DOMParser();h=i.parseFromString(f,"text/xml")}else{h=new ActiveXObject("Microsoft.XMLDOM");h.async="false";h.loadXML(f)}}catch(j){h=undefined}if(!h||!h.documentElement||h.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Bitmap Font XML given")}else{this.addToFileList("bitmapfont",n,g,{xmlURL:null,xmlData:h,xSpacing:l,ySpacing:k})}}}return this},atlasJSONArray:function(g,f,h,e){return this.atlas(g,f,h,e,b.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(g,f,h,e){return this.atlas(g,f,h,e,b.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(g,f,h,e){return this.atlas(g,f,h,e,b.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(i,h,j,f,l){if(typeof j==="undefined"){j=null}if(typeof f==="undefined"){f=null}if(typeof l==="undefined"){l=b.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(j){this.addToFileList("textureatlas",i,h,{atlasURL:j,format:l})}else{switch(l){case b.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof f==="string"){f=JSON.parse(f)}break;case b.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof f==="string"){var g;try{if(window.DOMParser){var m=new DOMParser();g=m.parseFromString(f,"text/xml")}else{g=new ActiveXObject("Microsoft.XMLDOM");g.async="false";g.loadXML(f)}}catch(k){g=undefined}if(!g||!g.documentElement||g.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}else{f=g}}break}this.addToFileList("textureatlas",i,h,{atlasURL:null,atlasData:f,format:l})}return this},removeFile:function(g,f){var e=this.getAsset(g,f);if(e!==false){this._fileList.splice(e.index,1)}},removeAll:function(){this._fileList.length=0},start:function(){if(this.isLoading){return}this.progress=0;this.progressFloat=0;this.hasLoaded=false;this.isLoading=true;this.onLoadStart.dispatch(this._fileList.length);if(this._fileList.length>0){this._fileIndex=0;this._progressChunk=100/this._fileList.length;this.loadFile()}else{this.progress=100;this.progressFloat=100;this.hasLoaded=true;this.onLoadComplete.dispatch()}},loadFile:function(){if(!this._fileList[this._fileIndex]){console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);return}var e=this._fileList[this._fileIndex];var f=this;this.onFileStart.dispatch(this.progress,e.key);switch(e.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":e.data=new Image();e.data.name=e.key;e.data.onload=function(){return f.fileComplete(f._fileIndex)};e.data.onerror=function(){return f.fileError(f._fileIndex)};if(this.crossOrigin){e.data.crossOrigin=this.crossOrigin}e.data.src=this.baseURL+e.url;break;case"audio":e.url=this.getAudioURL(e.url);if(e.url!==null){if(this.game.sound.usingWebAudio){this._xhr.open("GET",this.baseURL+e.url,true);this._xhr.responseType="arraybuffer";this._xhr.onload=function(){return f.fileComplete(f._fileIndex)};this._xhr.onerror=function(){return f.fileError(f._fileIndex)};this._xhr.send()}else{if(this.game.sound.usingAudioTag){if(this.game.sound.touchLocked){e.data=new Audio();e.data.name=e.key;e.data.preload="auto";e.data.src=this.baseURL+e.url;this.fileComplete(this._fileIndex)}else{e.data=new Audio();e.data.name=e.key;e.data.onerror=function(){return f.fileError(f._fileIndex)};e.data.preload="auto";e.data.src=this.baseURL+e.url;e.data.addEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete(this._fileIndex),false);e.data.load()}}}}else{this.fileError(this._fileIndex)}break;case"json":if(window.XDomainRequest){this._ajax=new window.XDomainRequest();this._ajax.timeout=3000;this._ajax.onerror=function(){return f.dataLoadError(f._fileIndex)};this._ajax.ontimeout=function(){return f.dataLoadError(f._fileIndex)};this._ajax.onprogress=function(){};this._ajax.onload=function(){return f.jsonLoadComplete(f._fileIndex)};this._ajax.open("GET",this.baseURL+e.url,true);this._ajax.send()}else{this._xhr.open("GET",this.baseURL+e.url,true);this._xhr.responseType="text";this._xhr.onload=function(){return f.jsonLoadComplete(f._fileIndex)};this._xhr.onerror=function(){return f.dataLoadError(f._fileIndex)};this._xhr.send()}break;case"tilemap":this._xhr.open("GET",this.baseURL+e.url,true);this._xhr.responseType="text";if(e.format===b.Tilemap.TILED_JSON){this._xhr.onload=function(){return f.jsonLoadComplete(f._fileIndex)}}else{if(e.format===b.Tilemap.CSV){this._xhr.onload=function(){return f.csvLoadComplete(f._fileIndex)}}else{throw new Error("Phaser.Loader. Invalid Tilemap format: "+e.format)}}this._xhr.onerror=function(){return f.dataLoadError(f._fileIndex)};this._xhr.send();break;case"text":case"script":case"physics":this._xhr.open("GET",this.baseURL+e.url,true);this._xhr.responseType="text";this._xhr.onload=function(){return f.fileComplete(f._fileIndex)};this._xhr.onerror=function(){return f.fileError(f._fileIndex)};this._xhr.send();break;case"binary":this._xhr.open("GET",this.baseURL+e.url,true);this._xhr.responseType="arraybuffer";this._xhr.onload=function(){return f.fileComplete(f._fileIndex)};this._xhr.onerror=function(){return f.fileError(f._fileIndex)};this._xhr.send();break}},getAudioURL:function(f){var g;if(typeof f==="string"){f=[f]}for(var e=0;e<f.length;e++){g=f[e].toLowerCase();g=g.substr((Math.max(0,g.lastIndexOf("."))||Infinity)+1);if(this.game.device.canPlayAudio(g)){return f[e]}}return null},fileError:function(e){this._fileList[e].loaded=true;this._fileList[e].error=true;this.onFileError.dispatch(this._fileList[e].key,this._fileList[e]);console.warn("Phaser.Loader error loading file: "+this._fileList[e].key+" from URL "+this._fileList[e].url);this.nextFile(e,false)},fileComplete:function(e){if(!this._fileList[e]){console.warn("Phaser.Loader fileComplete invalid index "+e);return}var g=this._fileList[e];g.loaded=true;var j=true;var k=this;switch(g.type){case"image":this.game.cache.addImage(g.key,g.url,g.data);break;case"spritesheet":this.game.cache.addSpriteSheet(g.key,g.url,g.data,g.frameWidth,g.frameHeight,g.frameMax,g.margin,g.spacing);break;case"textureatlas":if(g.atlasURL==null){this.game.cache.addTextureAtlas(g.key,g.url,g.data,g.atlasData,g.format)}else{j=false;this._xhr.open("GET",this.baseURL+g.atlasURL,true);this._xhr.responseType="text";if(g.format==b.Loader.TEXTURE_ATLAS_JSON_ARRAY||g.format==b.Loader.TEXTURE_ATLAS_JSON_HASH){this._xhr.onload=function(){return k.jsonLoadComplete(e)}}else{if(g.format==b.Loader.TEXTURE_ATLAS_XML_STARLING){this._xhr.onload=function(){return k.xmlLoadComplete(e)}}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+g.format)}}this._xhr.onerror=function(){return k.dataLoadError(e)};this._xhr.send()}break;case"bitmapfont":if(g.xmlURL==null){this.game.cache.addBitmapFont(g.key,g.url,g.data,g.xmlData,g.xSpacing,g.ySpacing)}else{j=false;this._xhr.open("GET",this.baseURL+g.xmlURL,true);this._xhr.responseType="text";this._xhr.onload=function(){return k.xmlLoadComplete(e)};this._xhr.onerror=function(){return k.dataLoadError(e)};this._xhr.send()}break;case"audio":if(this.game.sound.usingWebAudio){g.data=this._xhr.response;this.game.cache.addSound(g.key,g.url,g.data,true,false);if(g.autoDecode){var h=this;var f=g.key;this.game.cache.updateSound(f,"isDecoding",true);this.game.sound.context.decodeAudioData(g.data,function(l){if(l){h.game.cache.decodedSound(f,l);h.game.sound.onSoundDecode.dispatch(f,h.game.cache.getSound(f))}})}}else{g.data.removeEventListener("canplaythrough",b.GAMES[this.game.id].load.fileComplete);this.game.cache.addSound(g.key,g.url,g.data,false,true)}break;case"text":g.data=this._xhr.responseText;this.game.cache.addText(g.key,g.url,g.data);break;case"physics":var i=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(g.key,g.url,i,g.format);break;case"script":g.data=document.createElement("script");g.data.language="javascript";g.data.type="text/javascript";g.data.defer=false;g.data.text=this._xhr.responseText;document.head.appendChild(g.data);if(g.callback){g.data=g.callback.call(g.callbackContext,g.key,this._xhr.responseText)}break;case"binary":if(g.callback){g.data=g.callback.call(g.callbackContext,g.key,this._xhr.response)}else{g.data=this._xhr.response}this.game.cache.addBinary(g.key,g.data);break}if(j){this.nextFile(e,true)}},jsonLoadComplete:function(e){if(!this._fileList[e]){console.warn("Phaser.Loader jsonLoadComplete invalid index "+e);return}var f=this._fileList[e];var g=JSON.parse(this._xhr.responseText);f.loaded=true;if(f.type==="tilemap"){this.game.cache.addTilemap(f.key,f.url,g,f.format)}else{if(f.type==="json"){this.game.cache.addJSON(f.key,f.url,g)}else{this.game.cache.addTextureAtlas(f.key,f.url,f.data,g,f.format)}}this.nextFile(e,true)},csvLoadComplete:function(e){if(!this._fileList[e]){console.warn("Phaser.Loader csvLoadComplete invalid index "+e);return}var f=this._fileList[e];var g=this._xhr.responseText;f.loaded=true;this.game.cache.addTilemap(f.key,f.url,g,f.format);this.nextFile(e,true)},dataLoadError:function(e){var f=this._fileList[e];f.loaded=true;f.error=true;console.warn("Phaser.Loader dataLoadError: "+f.key);this.nextFile(e,true)},xmlLoadComplete:function(g){var i=this._xhr.responseText;var f;try{if(window.DOMParser){var k=new DOMParser();f=k.parseFromString(i,"text/xml")}else{f=new ActiveXObject("Microsoft.XMLDOM");f.async="false";f.loadXML(i)}}catch(j){f=undefined}if(!f||!f.documentElement||f.getElementsByTagName("parsererror").length){throw new Error("Phaser.Loader. Invalid XML given")}var h=this._fileList[g];h.loaded=true;if(h.type=="bitmapfont"){this.game.cache.addBitmapFont(h.key,h.url,h.data,f,h.xSpacing,h.ySpacing)}else{if(h.type=="textureatlas"){this.game.cache.addTextureAtlas(h.key,h.url,h.data,f,h.format)}}this.nextFile(g,true)},nextFile:function(e,f){this.progressFloat+=this._progressChunk;this.progress=Math.round(this.progressFloat);if(this.progress>100){this.progress=100}if(this.preloadSprite!==null){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress);this.preloadSprite.sprite.crop(this.preloadSprite.rect)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress);this.preloadSprite.sprite.crop(this.preloadSprite.rect)}}this.onFileComplete.dispatch(this.progress,this._fileList[e].key,f,this.totalLoadedFiles(),this._fileList.length);if(this.totalQueuedFiles()>0){this._fileIndex++;this.loadFile()}else{this.hasLoaded=true;this.isLoading=false;this.removeAll();this.onLoadComplete.dispatch()}},totalLoadedFiles:function(){var f=0;for(var e=0;e<this._fileList.length;e++){if(this._fileList[e].loaded){f++}}return f},totalQueuedFiles:function(){var f=0;for(var e=0;e<this._fileList.length;e++){if(this._fileList[e].loaded===false){f++}}return f}};b.Loader.prototype.constructor=b.Loader;b.LoaderParser={bitmapFont:function(v,l,q,r,m){var h={};var f=l.getElementsByTagName("info")[0];var n=l.getElementsByTagName("common")[0];h.font=f.getAttribute("face");h.size=parseInt(f.getAttribute("size"),10);h.lineHeight=parseInt(n.getAttribute("lineHeight"),10)+m;h.chars={};var p=l.getElementsByTagName("char");var o=PIXI.TextureCache[q];for(var g=0;g<p.length;g++){var u=parseInt(p[g].getAttribute("id"),10);var t=new PIXI.Rectangle(parseInt(p[g].getAttribute("x"),10),parseInt(p[g].getAttribute("y"),10),parseInt(p[g].getAttribute("width"),10),parseInt(p[g].getAttribute("height"),10));h.chars[u]={xOffset:parseInt(p[g].getAttribute("xoffset"),10),yOffset:parseInt(p[g].getAttribute("yoffset"),10),xAdvance:parseInt(p[g].getAttribute("xadvance"),10)+r,kerning:{},texture:PIXI.TextureCache[q]=new PIXI.Texture(o,t)}}var s=l.getElementsByTagName("kerning");for(g=0;g<s.length;g++){var k=parseInt(s[g].getAttribute("first"),10);var e=parseInt(s[g].getAttribute("second"),10);var j=parseInt(s[g].getAttribute("amount"),10);h.chars[e].kerning[k]=j}PIXI.BitmapText.fonts[q]=h}};b.Sound=function(g,h,i,e,f){if(typeof i=="undefined"){i=1}if(typeof e=="undefined"){e=false}if(typeof f==="undefined"){f=g.sound.connectToMaster}this.game=g;this.name=h;this.key=h;this.loop=e;this.volume=i;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.pendingPlayback=false;this.override=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(typeof this.context.createGain==="undefined"){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=i*this.game.sound.volume;if(f){this.gainNode.connect(this.masterGainNode)}}else{if(this.game.cache.getSound(h)&&this.game.cache.isSoundReady(h)){this._sound=this.game.cache.getSoundData(h);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new b.Signal();this.onPlay=new b.Signal();this.onPause=new b.Signal();this.onResume=new b.Signal();this.onLoop=new b.Signal();this.onStop=new b.Signal();this.onMute=new b.Signal();this.onMarkerComplete=new b.Signal();this._volume=i;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempLoop=0;this._paused=false};b.Sound.prototype={soundHasUnlocked:function(e){if(e==this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(f,i,h,g,e){if(typeof g=="undefined"){g=1}if(typeof e=="undefined"){e=false}this.markers[f]={name:f,start:i,stop:i+h,volume:g,duration:h,durationMS:h*1000,loop:e}},removeMarker:function(e){delete this.markers[e]},update:function(){if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.now-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.now}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{this.stop()}}else{if(this.loop){this.onLoop.dispatch(this);this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},play:function(g,e,i,f,h){if(typeof g==="undefined"){g=""}if(typeof h==="undefined"){h=true}if(this.isPlaying===true&&h===false&&this.override===false){return this}if(this.isPlaying&&this.override){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{this._sound.stop(0)}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.currentMarker=g;if(g!==""){if(this.markers[g]){this.position=this.markers[g].start;this.volume=this.markers[g].volume;this.loop=this.markers[g].loop;this.duration=this.markers[g].duration;this.durationMS=this.markers[g].durationMS;if(typeof i!=="undefined"){this.volume=i}if(typeof f!=="undefined"){this.loop=f}this._tempMarker=g;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+g+" doesn't exist");return this}}else{e=e||0;if(typeof i==="undefined"){i=this._volume}if(typeof f==="undefined"){f=this.loop}this.position=e;this.volume=i;this.loop=f;this.duration=0;this.durationMS=0;this._tempMarker=g;this._tempPosition=e;this._tempVolume=i;this._tempLoop=f}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){if(this._buffer==null){this._buffer=this.game.cache.getSoundData(this.key)}this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode.input)}else{this._sound.connect(this.gainNode)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}if(this.loop&&g===""){this._sound.loop=true}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,this.position,this.duration)}else{this._sound.start(0,this.position,this.duration)}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.now;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(g,e,h,f){g=g||"";e=e||0;h=h||1;if(typeof f=="undefined"){f=false}this.play(g,e,h,f,true)},pause:function(){if(this.isPlaying&&this._sound){this.stop();this.isPlaying=false;this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.now;this.onPause.dispatch(this)}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var e=this.position+(this.pausedPosition/1000);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode.input)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(typeof this._sound.start==="undefined"){this._sound.noteGrainOn(0,e,this.duration)}else{this._sound.start(0,e,this.duration)}}else{this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.now-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(typeof this._sound.stop==="undefined"){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(g){}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.isPlaying=false;var f=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";this.onStop.dispatch(this,f)},destroy:function(e){if(typeof e==="undefined"){e=true}this.stop();if(e){this.game.sound.remove(this)}this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}};b.Sound.prototype.constructor=b.Sound;Object.defineProperty(b.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(b.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(b.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(e){e=e||null;if(e){this._muted=true;if(this.usingWebAudio){this._muteVolume=this.gainNode.gain.value;this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._muteVolume=this._sound.volume;this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(b.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){if(this.usingWebAudio){this._volume=e;this.gainNode.gain.value=e}else{if(this.usingAudioTag&&this._sound){if(e>=0&&e<=1){this._volume=e;this._sound.volume=e}}}}});b.SoundManager=function(e){this.game=e;this.onSoundDecode=new b.Signal();this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this.context=null;this.usingWebAudio=true;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32};b.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.game.input.touch.callbackContext=this;this.game.input.touch.touchStartCallback=this.unlock;this.game.input.mouse.callbackContext=this;this.game.input.mouse.mouseDownCallback=this.unlock;this.touchLocked=true}else{this.touchLocked=false}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.usingWebAudio=false;this.noAudio=true;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false;return}}if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(e){this.context=null;this.usingWebAudio=false;this.noAudio=true}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(e){this.context=null;this.usingWebAudio=false;this.noAudio=true}}}if(!!window.Audio&&this.context===null){this.usingWebAudio=false;this.usingAudioTag=true;this.noAudio=false}if(this.context!==null){if(typeof this.context.createGain==="undefined"){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}},unlock:function(){if(this.touchLocked===false){return}if(this.game.device.webAudio===false||(window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===true)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null;this.game.input.mouse.callbackContext=null;this.game.input.mouse.mouseDownCallback=null}else{var e=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=e;this._unlockSource.connect(this.context.destination);this._unlockSource.noteOn(0)}},stopAll:function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].stop()}}},pauseAll:function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].pause()}}},resumeAll:function(){for(var e=0;e<this._sounds.length;e++){if(this._sounds[e]){this._sounds[e].resume()}}},decode:function(f,h){h=h||null;var e=this.game.cache.getSoundData(f);if(e){if(this.game.cache.isSoundDecoded(f)===false){this.game.cache.updateSound(f,"isDecoding",true);var g=this;this.context.decodeAudioData(e,function(i){g.game.cache.decodedSound(f,i);if(h){g.onSoundDecode.dispatch(f,h)}})}}},update:function(){if(this.touchLocked){if(this.game.device.webAudio&&this._unlockSource!==null){if((this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null;this.game.input.touch.callbackContext=null;this.game.input.touch.touchStartCallback=null}}}for(var e=0;e<this._sounds.length;e++){this._sounds[e].update()}},add:function(g,h,e,f){if(typeof h==="undefined"){h=1}if(typeof e==="undefined"){e=false}if(typeof f==="undefined"){f=this.connectToMaster}var i=new b.Sound(this.game,g,h,e,f);this._sounds.push(i);return i},remove:function(f){var e=this._sounds.length;while(e--){if(this._sounds[e]===f){this._sounds[e].destroy(false);this._sounds.splice(e,1);return true}}return false},removeByKey:function(f){var e=this._sounds.length;var g=0;while(e--){if(this._sounds[e].key===f){this._sounds[e].destroy(false);this._sounds.splice(e,1);g++}}return g},play:function(f,g,e){var h=this.add(f,g,e);h.play();return h},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].mute=true}}},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].mute=false}}}};b.SoundManager.prototype.constructor=b.SoundManager;Object.defineProperty(b.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){e=e||null;if(e){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(b.SoundManager.prototype,"volume",{get:function(){if(this.usingWebAudio){return this.masterGain.gain.value}else{return this._volume}},set:function(f){this._volume=f;if(this.usingWebAudio){this.masterGain.gain.value=f}else{for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].volume=this._sounds[e].volume*f}}}}});b.Utils.Debug=function(e){this.game=e;this.sprite=null;this.canvas=null;this.baseTexture=null;this.texture=null;this.textureFrame=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};b.Utils.Debug.prototype={boot:function(){if(this.game.renderType===b.CANVAS){this.context=this.game.context}else{this.canvas=b.Canvas.create(this.game.width,this.game.height,"",true);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,this.game.width,this.game.height,"debug",this.game.rnd.uuid());this.sprite=this.game.make.image(0,0,this.texture,this.textureFrame);this.game.stage.addChild(this.sprite)}},preUpdate:function(){if(this.dirty&&this.sprite){this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},start:function(e,h,f,g){if(typeof e!=="number"){e=0}if(typeof h!=="number"){h=0}f=f||"rgb(255,255,255)";if(typeof g==="undefined"){g=0}this.currentX=e;this.currentY=h;this.currentColor=f;this.currentAlpha=this.context.globalAlpha;this.columnWidth=g;if(this.sprite){this.dirty=true}this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=f;this.context.fillStyle=f;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha;if(this.sprite){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)}},line:function(){var e=this.currentX;for(var f=0;f<arguments.length;f++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[f],e+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[f],e,this.currentY);e+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(g,e,h,f){this.start(e,h,f);this.line("Sound: "+g.key+" Locked: "+g.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(g.key)+" Pending Playback: "+g.pendingPlayback);this.line("Decoded: "+g.isDecoded+" Decoding: "+g.isDecoding);this.line("Total Duration: "+g.totalDuration+" Playing: "+g.isPlaying);this.line("Time: "+g.currentTime);this.line("Volume: "+g.volume+" Muted: "+g.mute);this.line("WebAudio: "+g.usingWebAudio+" Audio: "+g.usingAudioTag);if(g.currentMarker!==""){this.line("Marker: "+g.currentMarker+" Duration: "+g.duration+" (ms: "+g.durationMS+")");this.line("Start: "+g.markers[g.currentMarker].start+" Stop: "+g.markers[g.currentMarker].stop);this.line("Position: "+g.position)}this.stop()},cameraInfo:function(g,e,h,f){this.start(e,h,f);this.line("Camera ("+g.width+" x "+g.height+")");this.line("X: "+g.x+" Y: "+g.y);this.line("Bounds x: "+g.bounds.x+" Y: "+g.bounds.y+" w: "+g.bounds.width+" h: "+g.bounds.height);this.line("View x: "+g.view.x+" Y: "+g.view.y+" w: "+g.view.width+" h: "+g.view.height);this.stop()},timer:function(h,e,g,f){this.start(e,g,f);this.line("Timer (running: "+h.running+" expired: "+h.expired+")");this.line("Next Tick: "+h.next+" Duration: "+h.duration);this.line("Paused: "+h.paused+" Length: "+h.length);this.stop()},pointer:function(i,h,f,g,e){if(i==null){return}if(typeof h==="undefined"){h=false}f=f||"rgba(0,255,0,0.5)";g=g||"rgba(255,0,0,0.5)";if(h===true&&i.isUp===true){return}this.start(i.x,i.y-100,e);this.context.beginPath();this.context.arc(i.x,i.y,i.circle.radius,0,Math.PI*2);if(i.active){this.context.fillStyle=f}else{this.context.fillStyle=g}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(i.positionDown.x,i.positionDown.y);this.context.lineTo(i.position.x,i.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+i.id+" Active: "+i.active);this.line("World X: "+i.worldX+" World Y: "+i.worldY);this.line("Screen X: "+i.x+" Screen Y: "+i.y);this.line("Duration: "+i.duration+" ms");this.line("is Down: "+i.isDown+" is Up: "+i.isUp);this.stop()},spriteInputInfo:function(g,e,h,f){this.start(e,h,f);this.line("Sprite Input: ("+g.width+" x "+g.height+")");this.line("x: "+g.input.pointerX().toFixed(1)+" y: "+g.input.pointerY().toFixed(1));this.line("over: "+g.input.pointerOver()+" duration: "+g.input.overDuration().toFixed(0));this.line("down: "+g.input.pointerDown()+" duration: "+g.input.downDuration().toFixed(0));this.line("just over: "+g.input.justOver()+" just out: "+g.input.justOut());this.stop()},key:function(g,e,h,f){this.start(e,h,f,150);this.line("Key:",g.keyCode,"isDown:",g.isDown);this.line("justPressed:",g.justPressed(),"justReleased:",g.justReleased());this.line("Time Down:",g.timeDown.toFixed(0),"duration:",g.duration.toFixed(0));this.stop()},inputInfo:function(e,g,f){this.start(e,g,f);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(f,e,h){var g=f.getBounds();g.x+=this.game.camera.x;g.y+=this.game.camera.y;this.rectangle(g,e,h)},spriteInfo:function(g,e,h,f){this.start(e,h,f);this.line("Sprite:  ("+g.width+" x "+g.height+") anchor: "+g.anchor.x+" x "+g.anchor.y);this.line("x: "+g.x.toFixed(1)+" y: "+g.y.toFixed(1));this.line("angle: "+g.angle.toFixed(1)+" rotation: "+g.rotation.toFixed(1));this.line("visible: "+g.visible+" in camera: "+g.inCamera);this.stop()},spriteCoords:function(g,e,h,f){this.start(e,h,f,100);if(g.name){this.line(g.name)}this.line("x:",g.x.toFixed(2),"y:",g.y.toFixed(2));this.line("pos x:",g.position.x.toFixed(2),"pos y:",g.position.y.toFixed(2));this.line("world x:",g.world.x.toFixed(2),"world y:",g.world.y.toFixed(2));this.stop()},lineInfo:function(f,e,h,g){this.start(e,h,g,80);this.line("start.x:",f.start.x.toFixed(2),"start.y:",f.start.y.toFixed(2));this.line("end.x:",f.end.x.toFixed(2),"end.y:",f.end.y.toFixed(2));this.line("length:",f.length.toFixed(2),"angle:",f.angle);this.stop()},pixel:function(e,h,f,g){g=g||2;this.start();this.context.fillStyle=f;this.context.fillRect(e,h,g,g);this.stop()},geom:function(f,e,h,g){if(typeof h==="undefined"){h=true}if(typeof g==="undefined"){g=0}e=e||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=e;this.context.strokeStyle=e;if(f instanceof b.Rectangle||g===1){if(h){this.context.fillRect(f.x-this.game.camera.x,f.y-this.game.camera.y,f.width,f.height)}else{this.context.strokeRect(f.x-this.game.camera.x,f.y-this.game.camera.y,f.width,f.height)}}else{if(f instanceof b.Circle||g===2){this.context.beginPath();this.context.arc(f.x-this.game.camera.x,f.y-this.game.camera.y,f.radius,0,Math.PI*2,false);this.context.closePath();if(h){this.context.fill()}else{this.context.stroke()}}else{if(f instanceof b.Point||g===3){this.context.fillRect(f.x-this.game.camera.x,f.y-this.game.camera.y,4,4)}else{if(f instanceof b.Line||g===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo((f.start.x+0.5)-this.game.camera.x,(f.start.y+0.5)-this.game.camera.y);this.context.lineTo((f.end.x+0.5)-this.game.camera.x,(f.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(f,e,g){if(typeof g==="undefined"){g=true}e=e||"rgba(0, 255, 0, 0.4)";this.start();if(g){this.context.fillStyle=e;this.context.fillRect(f.x-this.game.camera.x,f.y-this.game.camera.y,f.width,f.height)}else{this.context.strokeStyle=e;this.context.strokeRect(f.x-this.game.camera.x,f.y-this.game.camera.y,f.width,f.height)}this.stop()},text:function(h,e,i,g,f){g=g||"rgb(255,255,255)";f=f||"16px Courier";this.start();this.context.font=f;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(h,e+1,i+1)}this.context.fillStyle=g;this.context.fillText(h,e,i);this.stop()},quadTree:function(e,f){f=f||"rgba(255,0,0,0.3)";this.start();var h=e.bounds;if(e.nodes.length===0){this.context.strokeStyle=f;this.context.strokeRect(h.x,h.y,h.width,h.height);this.text("size: "+e.objects.length,h.x+4,h.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var g=0;g<e.objects.length;g++){this.context.strokeRect(e.objects[g].x,e.objects[g].y,e.objects[g].width,e.objects[g].height)}}else{for(var g=0;g<e.nodes.length;g++){this.quadTree(e.nodes[g])}}this.stop()},body:function(f,e,g){if(f.body){if(f.body.type===b.Physics.ARCADE){this.start();b.Physics.Arcade.Body.render(this.context,f.body,e,g);this.stop()}}},bodyInfo:function(g,e,h,f){if(g.body){if(g.body.type===b.Physics.ARCADE){this.start(e,h,f,210);b.Physics.Arcade.Body.renderBodyInfo(this,g.body);this.stop()}}}};b.Utils.Debug.prototype.constructor=b.Utils.Debug;b.Color={packPixel:function(i,h,e,f){if(b.Device.LITTLE_ENDIAN){return(f<<24)|(e<<16)|(h<<8)|i}else{return(i<<24)|(h<<16)|(e<<8)|f}},unpackPixel:function(h,g,e,f){if(typeof g==="undefined"||g===null){g=b.Color.createColor()}if(typeof e==="undefined"||e===null){e=false}if(typeof f==="undefined"||f===null){f=false}if(b.Device.LITTLE_ENDIAN){g.a=((h&4278190080)>>>24);g.b=((h&16711680)>>>16);g.g=((h&65280)>>>8);g.r=((h&255))}else{g.r=((h&4278190080)>>>24);g.g=((h&16711680)>>>16);g.b=((h&65280)>>>8);g.a=((h&255))}g.color=h;g.rgba="rgba("+g.r+","+g.g+","+g.b+","+(g.a/255)+")";if(e){b.Color.RGBtoHSL(g.r,g.g,g.b,g)}if(f){b.Color.RGBtoHSV(g.r,g.g,g.b,g)}return g},fromRGBA:function(f,e){if(!e){e=b.Color.createColor()}e.r=((f&4278190080)>>>24);e.g=((f&16711680)>>>16);e.b=((f&65280)>>>8);e.a=((f&255));e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";return e},toRGBA:function(i,h,e,f){return(i<<24)|(h<<16)|(e<<8)|f},RGBtoHSL:function(k,j,f,h){if(!h){h=b.Color.createColor(k,j,f,1)}k/=255;j/=255;f/=255;var i=Math.min(k,j,f);var e=Math.max(k,j,f);h.h=0;h.s=0;h.l=(e+i)/2;if(e!==i){var l=e-i;h.s=h.l>0.5?l/(2-e-i):l/(e+i);if(e===k){h.h=(j-f)/l+(j<f?6:0)}else{if(e===j){h.h=(f-k)/l+2}else{if(e===f){h.h=(k-j)/l+4}}}h.h/=6}return h},HSLtoRGB:function(i,g,e,f){if(!f){f=b.Color.createColor(e,e,e)}else{f.r=e;f.g=e;f.b=e}if(g!==0){var j=e<0.5?e*(1+g):e+g-e*g;var k=2*e-j;f.r=b.Color.hueToColor(k,j,i+1/3);f.g=b.Color.hueToColor(k,j,i);f.b=b.Color.hueToColor(k,j,i-1/3)}f.r=Math.floor((f.r*255|0));f.g=Math.floor((f.g*255|0));f.b=Math.floor((f.b*255|0));b.Color.updateColor(f);return f},RGBtoHSV:function(k,j,f,h){if(!h){h=b.Color.createColor(k,j,f,255)}k/=255;j/=255;f/=255;var i=Math.min(k,j,f);var e=Math.max(k,j,f);var l=e-i;h.h=0;h.s=e===0?0:l/e;h.v=e;if(e!==i){if(e===k){h.h=(j-f)/l+(j<f?6:0)}else{if(e===j){h.h=(f-k)/l+2}else{if(e===f){h.h=(k-j)/l+4}}}h.h/=6}return h},HSVtoRGB:function(n,z,x,l){if(typeof l==="undefined"){l=b.Color.createColor(0,0,0,1,n,z,0,x)}var e,o,w;var m=Math.floor(n*6);var u=n*6-m;var k=x*(1-z);var j=x*(1-u*z);var y=x*(1-(1-u)*z);switch(m%6){case 0:e=x;o=y;w=k;break;case 1:e=j;o=x;w=k;break;case 2:e=k;o=x;w=y;break;case 3:e=k;o=j;w=x;break;case 4:e=y;o=k;w=x;break;case 5:e=x;o=k;w=j;break}l.r=Math.floor(e*255);l.g=Math.floor(o*255);l.b=Math.floor(w*255);b.Color.updateColor(l);return l},hueToColor:function(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g},createColor:function(e,k,m,n,j,p,f,o){var i={r:e||0,g:k||0,b:m||0,a:n||1,h:j||0,s:p||0,l:f||0,v:o||0,color:0};i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")";return i},updateColor:function(e){e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";return e},getColor32:function(f,i,h,e){return f<<24|i<<16|h<<8|e},getColor:function(h,f,e){return h<<16|f<<8|e},RGBtoString:function(i,h,e,f,j){if(typeof f==="undefined"){f=255}if(typeof j==="undefined"){j="#"}if(j==="#"){return"#"+((1<<24)+(i<<16)+(h<<8)+e).toString(16).slice(1)}else{return"0x"+b.Color.componentToHex(f)+b.Color.componentToHex(i)+b.Color.componentToHex(h)+b.Color.componentToHex(e)}},hexToRGB:function(f){var e=b.Color.hexToColor(f);if(e){return b.Color.getColor32(e.a,e.r,e.g,e.b)}},hexToColor:function(h,g){if(!g){g=b.Color.createColor()}var f=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;h=h.replace(f,function(j,l,k,i){return l+l+k+k+i+i});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);if(e){g.r=parseInt(e[1],16);g.g=parseInt(e[2],16);g.b=parseInt(e[3],16)}return g},componentToHex:function(e){var f=e.toString(16);return f.length==1?"0"+f:f},HSVColorWheel:function(g,f){if(typeof g==="undefined"){g=1}if(typeof f==="undefined"){f=1}var e=[];for(var h=0;h<=359;h++){e.push(b.Color.HSVtoRGB(h/359,g,f))}return e},HSLColorWheel:function(g,f){if(typeof g==="undefined"){g=0.5}if(typeof f==="undefined"){f=0.5}var e=[];for(var h=0;h<=359;h++){e.push(b.Color.HSLtoRGB(h/359,g,f))}return e},interpolateColor:function(o,n,m,f,j){if(typeof j==="undefined"){j=255}var i=b.Color.getRGB(o);var h=b.Color.getRGB(n);var e=(((h.red-i.red)*f)/m)+i.red;var k=(((h.green-i.green)*f)/m)+i.green;var l=(((h.blue-i.blue)*f)/m)+i.blue;return b.Color.getColor32(j,e,k,l)},interpolateColorWithRGB:function(j,f,l,n,m,h){var e=b.Color.getRGB(j);var k=(((f-e.red)*h)/m)+e.red;var o=(((l-e.green)*h)/m)+e.green;var i=(((n-e.blue)*h)/m)+e.blue;return b.Color.getColor(k,o,i)},interpolateRGB:function(j,f,o,i,p,m,n,h){var e=(((i-j)*h)/n)+j;var k=(((p-f)*h)/n)+f;var l=(((m-o)*h)/n)+o;return b.Color.getColor(e,k,l)},getRandomColor:function(g,f,j){if(typeof g==="undefined"){g=0}if(typeof f==="undefined"){f=255}if(typeof j==="undefined"){j=255}if(f>255||g>f){return b.Color.getColor(255,255,255)}var i=g+Math.round(Math.random()*(f-g));var h=g+Math.round(Math.random()*(f-g));var e=g+Math.round(Math.random()*(f-g));return b.Color.getColor32(j,i,h,e)},getRGB:function(e){if(e>16777215){return{alpha:e>>>24,red:e>>16&255,green:e>>8&255,blue:e&255,a:e>>>24,r:e>>16&255,g:e>>8&255,b:e&255}}else{return{alpha:255,red:e>>16&255,green:e>>8&255,blue:e&255,a:255,r:e>>16&255,g:e>>8&255,b:e&255}}},getWebRGB:function(e){var f=b.Color.getRGB(e);return"rgba("+f.r.toString()+","+f.g.toString()+","+f.b.toString()+","+f.a.toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return e&255},getColorInfo:function(f){var g=b.Color.getRGB(f);var e=b.Color.RGBtoHexstring(f)+"\n";e=e.concat("Alpha: "+g.alpha+" Red: "+g.red+" Green: "+g.green+" Blue: "+g.blue)+"\n";return e},RGBtoHexstring:function(e){var f=b.Color.getRGB(e);return"0x"+b.Color.colorToHexstring(f.alpha)+b.Color.colorToHexstring(f.red)+b.Color.colorToHexstring(f.green)+b.Color.colorToHexstring(f.blue)},RGBtoWebstring:function(e){var f=b.Color.getRGB(e);return"#"+b.Color.colorToHexstring(f.red)+b.Color.colorToHexstring(f.green)+b.Color.colorToHexstring(f.blue)},colorToHexstring:function(g){var i="0123456789ABCDEF";var h=g%16;var f=(g-h)/16;var e=i.charAt(f)+i.charAt(h);return e}};b.Physics=function(e,f){f=f||{};this.game=e;this.config=f;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};b.Physics.ARCADE=0;b.Physics.P2JS=1;b.Physics.NINJA=2;b.Physics.BOX2D=3;b.Physics.CHIPMUNK=5;b.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&b.Physics.hasOwnProperty("Arcade")){this.arcade=new b.Physics.Arcade(this.game);this.game.time.deltaCap=0.2}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&b.Physics.hasOwnProperty("Ninja")){this.ninja=new b.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&b.Physics.hasOwnProperty("P2")){this.p2=new b.Physics.P2(this.game,this.config)}},startSystem:function(e){if(e===b.Physics.ARCADE){this.arcade=new b.Physics.Arcade(this.game)}else{if(e===b.Physics.P2JS){this.p2=new b.Physics.P2(this.game,this.config)}}if(e===b.Physics.NINJA){this.ninja=new b.Physics.Ninja(this.game)}else{if(e===b.Physics.BOX2D&&this.box2d===null){throw new Error("The Box2D physics system has not been implemented yet.")}else{if(e===b.Physics.CHIPMUNK&&this.chipmunk===null){throw new Error("The Chipmunk physics system has not been implemented yet.")}}}},enable:function(f,g,e){if(typeof g==="undefined"){g=b.Physics.ARCADE}if(typeof e==="undefined"){e=false}if(g===b.Physics.ARCADE){this.arcade.enable(f)}else{if(g===b.Physics.P2JS&&this.p2){this.p2.enable(f,e)}else{if(g===b.Physics.NINJA&&this.ninja){this.ninja.enableAABB(f)}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}},update:function(){if(this.p2){this.p2.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}},destroy:function(){if(this.p2){this.p2.destroy()}this.arcade=null;this.ninja=null;this.p2=null}};b.Physics.prototype.constructor=b.Physics;b.Physics.Arcade=function(e){this.game=e;this.gravity=new b.Point();this.bounds=new b.Rectangle(0,0,e.world.width,e.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.TILE_BIAS=16;this.forceX=false;this.quadTree=new b.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._overlap=0;this._maxOverlap=0;this._velocity1=0;this._velocity2=0;this._newVelocity1=0;this._newVelocity2=0;this._average=0;this._mapData=[];this._result=false;this._total=0;this._angle=0;this._dx=0;this._dy=0};b.Physics.Arcade.prototype.constructor=b.Physics.Arcade;b.Physics.Arcade.prototype={setBounds:function(f,h,g,e){this.bounds.setTo(f,h,g,e)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(e,g){if(typeof g==="undefined"){g=true}var f=1;if(Array.isArray(e)){f=e.length;while(f--){if(e[f] instanceof b.Group){this.enable(e[f].children,g)}else{this.enableBody(e[f]);if(g&&e[f].hasOwnProperty("children")&&e[f].children.length>0){this.enable(e[f],true)}}}}else{if(e instanceof b.Group){this.enable(e.children,g)}else{this.enableBody(e);if(g&&e.hasOwnProperty("children")&&e.children.length>0){this.enable(e.children,true)}}}},enableBody:function(e){if(e.hasOwnProperty("body")&&e.body===null){e.body=new b.Physics.Arcade.Body(e)}},updateMotion:function(e){this._velocityDelta=this.computeVelocity(0,e,e.angularVelocity,e.angularAcceleration,e.angularDrag,e.maxAngular)-e.angularVelocity;e.angularVelocity+=this._velocityDelta;e.rotation+=(e.angularVelocity*this.game.time.physicsElapsed);e.velocity.x=this.computeVelocity(1,e,e.velocity.x,e.acceleration.x,e.drag.x,e.maxVelocity.x);e.velocity.y=this.computeVelocity(2,e,e.velocity.y,e.acceleration.y,e.drag.y,e.maxVelocity.y)},computeVelocity:function(h,f,j,i,g,e){e=e||10000;if(h==1&&f.allowGravity){j+=(this.gravity.x+f.gravity.x)*this.game.time.physicsElapsed}else{if(h==2&&f.allowGravity){j+=(this.gravity.y+f.gravity.y)*this.game.time.physicsElapsed}}if(i){j+=i*this.game.time.physicsElapsed}else{if(g){this._drag=g*this.game.time.physicsElapsed;if(j-this._drag>0){j-=this._drag}else{if(j+this._drag<0){j+=this._drag}else{j=0}}}}if(j>e){j=e}else{if(j<-e){j=-e}}return j},overlap:function(l,k,f,j,g){f=f||null;j=j||null;g=g||f;this._result=false;this._total=0;if(Array.isArray(k)){for(var h=0,e=k.length;h<e;h++){this.collideHandler(l,k[h],f,j,g,true)}}else{this.collideHandler(l,k,f,j,g,true)}return(this._total>0)},collide:function(l,k,j,h,f){j=j||null;h=h||null;f=f||j;this._result=false;this._total=0;if(Array.isArray(k)){for(var g=0,e=k.length;g<e;g++){this.collideHandler(l,k[g],j,h,f,false)}}else{this.collideHandler(l,k,j,h,f,false)}return(this._total>0)},collideHandler:function(j,i,h,g,e,f){if(typeof i==="undefined"&&(j.type===b.GROUP||j.type===b.EMITTER)){this.collideGroupVsSelf(j,h,g,e,f);return}if(j&&i&&j.exists&&i.exists){if(j.type==b.SPRITE||j.type==b.TILESPRITE){if(i.type==b.SPRITE||i.type==b.TILESPRITE){this.collideSpriteVsSprite(j,i,h,g,e,f)}else{if(i.type==b.GROUP||i.type==b.EMITTER){this.collideSpriteVsGroup(j,i,h,g,e,f)}else{if(i.type==b.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(j,i,h,g,e)}}}}else{if(j.type==b.GROUP){if(i.type==b.SPRITE||i.type==b.TILESPRITE){this.collideSpriteVsGroup(i,j,h,g,e,f)}else{if(i.type==b.GROUP||i.type==b.EMITTER){this.collideGroupVsGroup(j,i,h,g,e,f)}else{if(i.type==b.TILEMAPLAYER){this.collideGroupVsTilemapLayer(j,i,h,g,e)}}}}else{if(j.type==b.TILEMAPLAYER){if(i.type==b.SPRITE||i.type==b.TILESPRITE){this.collideSpriteVsTilemapLayer(i,j,h,g,e)}else{if(i.type==b.GROUP||i.type==b.EMITTER){this.collideGroupVsTilemapLayer(i,j,h,g,e)}}}else{if(j.type==b.EMITTER){if(i.type==b.SPRITE||i.type==b.TILESPRITE){this.collideSpriteVsGroup(i,j,h,g,e,f)}else{if(i.type==b.GROUP||i.type==b.EMITTER){this.collideGroupVsGroup(j,i,h,g,e,f)}else{if(i.type==b.TILEMAPLAYER){this.collideGroupVsTilemapLayer(j,i,h,g,e)}}}}}}}}},collideSpriteVsSprite:function(j,i,h,g,e,f){if(!j.body||!i.body){return false}if(this.separate(j.body,i.body,g,e,f)){if(h){h.call(e,j,i)}this._total++}return true},collideSpriteVsGroup:function(j,m,l,k,f,g){if(m.length===0||!j.body){return}this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(m);this._potentials=this.quadTree.retrieve(j);for(var h=0,e=this._potentials.length;h<e;h++){if(this.separate(j.body,this._potentials[h],k,f,g)){if(l){l.call(f,j,this._potentials[h].sprite)}this._total++}}},collideGroupVsSelf:function(n,m,l,f,h){if(n.length===0){return}var e=n.children.length;for(var k=0;k<e;k++){for(var g=k+1;g<=e;g++){if(n.children[k]&&n.children[g]&&n.children[k].exists&&n.children[g].exists){this.collideSpriteVsSprite(n.children[k],n.children[g],m,l,f,h)}}}},collideGroupVsGroup:function(f,m,l,k,g,h){if(f.length===0||m.length===0){return}for(var j=0,e=f.children.length;j<e;j++){if(f.children[j].exists){this.collideSpriteVsGroup(f.children[j],m,l,k,g,h)}}},collideSpriteVsTilemapLayer:function(h,e,k,j,f){if(!h.body){return}this._mapData=e.getTiles(h.body.position.x-h.body.tilePadding.x,h.body.position.y-h.body.tilePadding.y,h.body.width+h.body.tilePadding.x,h.body.height+h.body.tilePadding.y,false,false);if(this._mapData.length===0){return}for(var g=0;g<this._mapData.length;g++){if(this.separateTile(g,h.body,this._mapData[g])){if(j){if(j.call(f,h,this._mapData[g])){this._total++;if(k){k.call(f,h,this._mapData[g])}}}else{this._total++;if(k){k.call(f,h,this._mapData[g])}}}}},collideGroupVsTilemapLayer:function(l,f,k,j,g){if(l.length===0){return}for(var h=0,e=l.children.length;h<e;h++){if(l.children[h].exists){this.collideSpriteVsTilemapLayer(l.children[h],f,k,j,g)}}},separate:function(h,f,i,e,g){if(!this.intersects(h,f)){return false}if(i&&i.call(e,h.sprite,f.sprite)===false){return false}if(g){return true}if(this.forceX||Math.abs(this.gravity.y+h.gravity.y)<Math.abs(this.gravity.x+h.gravity.x)){this._result=(this.separateX(h,f,g)||this.separateY(h,f,g))}else{this._result=(this.separateY(h,f,g)||this.separateX(h,f,g))}return this._result},intersects:function(f,e){if(f.right<=e.position.x){return false}if(f.bottom<=e.position.y){return false}if(f.position.x>=e.right){return false}if(f.position.y>=e.bottom){return false}return true},separateX:function(g,e,f){if(g.immovable&&e.immovable){return false}this._overlap=0;if(this.intersects(g,e)){this._maxOverlap=g.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;if(g.deltaX()===0&&e.deltaX()===0){g.embedded=true;e.embedded=true}else{if(g.deltaX()>e.deltaX()){this._overlap=g.right-e.x;if((this._overlap>this._maxOverlap)||g.checkCollision.right===false||e.checkCollision.left===false){this._overlap=0}else{g.touching.none=false;g.touching.right=true;e.touching.none=false;e.touching.left=true}}else{if(g.deltaX()<e.deltaX()){this._overlap=g.x-e.width-e.x;if((-this._overlap>this._maxOverlap)||g.checkCollision.left===false||e.checkCollision.right===false){this._overlap=0}else{g.touching.none=false;g.touching.left=true;e.touching.none=false;e.touching.right=true}}}}if(this._overlap!==0){g.overlapX=this._overlap;e.overlapX=this._overlap;if(f||g.customSeparateX||e.customSeparateX){return true}this._velocity1=g.velocity.x;this._velocity2=e.velocity.x;if(!g.immovable&&!e.immovable){this._overlap*=0.5;g.x=g.x-this._overlap;e.x+=this._overlap;this._newVelocity1=Math.sqrt((this._velocity2*this._velocity2*e.mass)/g.mass)*((this._velocity2>0)?1:-1);this._newVelocity2=Math.sqrt((this._velocity1*this._velocity1*g.mass)/e.mass)*((this._velocity1>0)?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*0.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;g.velocity.x=this._average+this._newVelocity1*g.bounce.x;e.velocity.x=this._average+this._newVelocity2*e.bounce.x}else{if(!g.immovable){g.x=g.x-this._overlap;g.velocity.x=this._velocity2-this._velocity1*g.bounce.x}else{if(!e.immovable){e.x+=this._overlap;e.velocity.x=this._velocity1-this._velocity2*e.bounce.x}}}return true}}return false},separateY:function(g,e,f){if(g.immovable&&e.immovable){return false}this._overlap=0;if(this.intersects(g,e)){this._maxOverlap=g.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;if(g.deltaY()===0&&e.deltaY()===0){g.embedded=true;e.embedded=true}else{if(g.deltaY()>e.deltaY()){this._overlap=g.bottom-e.y;if((this._overlap>this._maxOverlap)||g.checkCollision.down===false||e.checkCollision.up===false){this._overlap=0}else{g.touching.none=false;g.touching.down=true;e.touching.none=false;e.touching.up=true}}else{if(g.deltaY()<e.deltaY()){this._overlap=g.y-e.bottom;if((-this._overlap>this._maxOverlap)||g.checkCollision.up===false||e.checkCollision.down===false){this._overlap=0}else{g.touching.none=false;g.touching.up=true;e.touching.none=false;e.touching.down=true}}}}if(this._overlap!==0){g.overlapY=this._overlap;e.overlapY=this._overlap;if(f||g.customSeparateY||e.customSeparateY){return true}this._velocity1=g.velocity.y;this._velocity2=e.velocity.y;if(!g.immovable&&!e.immovable){this._overlap*=0.5;g.y=g.y-this._overlap;e.y+=this._overlap;this._newVelocity1=Math.sqrt((this._velocity2*this._velocity2*e.mass)/g.mass)*((this._velocity2>0)?1:-1);this._newVelocity2=Math.sqrt((this._velocity1*this._velocity1*g.mass)/e.mass)*((this._velocity1>0)?1:-1);this._average=(this._newVelocity1+this._newVelocity2)*0.5;this._newVelocity1-=this._average;this._newVelocity2-=this._average;g.velocity.y=this._average+this._newVelocity1*g.bounce.y;e.velocity.y=this._average+this._newVelocity2*e.bounce.y}else{if(!g.immovable){g.y=g.y-this._overlap;g.velocity.y=this._velocity2-this._velocity1*g.bounce.y;if(e.moves){g.x+=e.x-e.prev.x}}else{if(!e.immovable){e.y+=this._overlap;e.velocity.y=this._velocity1-this._velocity2*e.bounce.y;if(g.moves){e.x+=g.x-g.prev.x}}}}return true}}return false},separateTile:function(j,f,k){if(!k.intersects(f.position.x,f.position.y,f.right,f.bottom)){return false}if(k.collisionCallback&&!k.collisionCallback.call(k.collisionCallbackContext,f.sprite,k)){return false}else{if(k.layer.callbacks[k.index]&&!k.layer.callbacks[k.index].callback.call(k.layer.callbacks[k.index].callbackContext,f.sprite,k)){return false}}if(!k.faceLeft&&!k.faceRight&&!k.faceTop&&!k.faceBottom){return false}var h=0;var g=0;var e=0;var l=1;if(f.deltaAbsX()>f.deltaAbsY()){e=-1}else{if(f.deltaAbsX()<f.deltaAbsY()){l=-1}}if(f.deltaX()!==0&&f.deltaY()!==0&&(k.faceLeft||k.faceRight)&&(k.faceTop||k.faceBottom)){e=Math.min(Math.abs(f.position.x-k.right),Math.abs(f.right-k.left));l=Math.min(Math.abs(f.position.y-k.bottom),Math.abs(f.bottom-k.top))}if(e<l){if(k.faceLeft||k.faceRight){h=this.tileCheckX(f,k);if(h!==0&&!k.intersects(f.position.x,f.position.y,f.right,f.bottom)){return true}}if(k.faceTop||k.faceBottom){g=this.tileCheckY(f,k)}}else{if(k.faceTop||k.faceBottom){g=this.tileCheckY(f,k);if(g!==0&&!k.intersects(f.position.x,f.position.y,f.right,f.bottom)){return true}}if(k.faceLeft||k.faceRight){h=this.tileCheckX(f,k)}}return(h!==0||g!==0)},tileCheckX:function(e,g){var f=0;if(e.deltaX()<0&&!e.blocked.left&&g.collideRight&&e.checkCollision.left){if(g.faceRight&&e.x<g.right){f=e.x-g.right;if(f<-this.TILE_BIAS){f=0}}}else{if(e.deltaX()>0&&!e.blocked.right&&g.collideLeft&&e.checkCollision.right){if(g.faceLeft&&e.right>g.left){f=e.right-g.left;if(f>this.TILE_BIAS){f=0}}}}if(f!==0){this.processTileSeparationX(e,f)}return f},tileCheckY:function(e,g){var f=0;if(e.deltaY()<0&&!e.blocked.up&&g.collideDown&&e.checkCollision.up){if(g.faceBottom&&e.y<g.bottom){f=e.y-g.bottom;if(f<-this.TILE_BIAS){f=0}}}else{if(e.deltaY()>0&&!e.blocked.down&&g.collideUp&&e.checkCollision.down){if(g.faceTop&&e.bottom>g.top){f=e.bottom-g.top;if(f>this.TILE_BIAS){f=0}}}}if(f!==0){this.processTileSeparationY(e,f)}return f},processTileSeparationX:function(f,e){if(e<0){f.blocked.left=true}else{if(e>0){f.blocked.right=true}}f.position.x-=e;if(f.bounce.x===0){f.velocity.x=0}else{f.velocity.x=-f.velocity.x*f.bounce.x}},processTileSeparationY:function(e,f){if(f<0){e.blocked.up=true}else{if(f>0){e.blocked.down=true}}e.position.y-=f;if(e.bounce.y===0){e.velocity.y=0}else{e.velocity.y=-e.velocity.y*e.bounce.y}},getObjectsUnderPointer:function(l,k,m,g){if(k.length===0||!l.exists){return}this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(k);var j=new b.Rectangle(l.x,l.y,1,1);var f=[];this._potentials=this.quadTree.retrieve(j);for(var h=0,e=this._potentials.length;h<e;h++){if(this._potentials[h].hitTest(l.x,l.y)){if(m){m.call(g,l,this._potentials[h].sprite)}f.push(this._potentials[h].sprite)}}return f},moveToObject:function(h,e,g,f){if(typeof g==="undefined"){g=60}if(typeof f==="undefined"){f=0}this._angle=Math.atan2(e.y-h.y,e.x-h.x);if(f>0){g=this.distanceBetween(h,e)/(f/1000)}h.body.velocity.x=Math.cos(this._angle)*g;h.body.velocity.y=Math.sin(this._angle)*g;return this._angle},moveToPointer:function(h,f,g,e){if(typeof f==="undefined"){f=60}g=g||this.game.input.activePointer;if(typeof e==="undefined"){e=0}this._angle=this.angleToPointer(h,g);if(e>0){f=this.distanceToPointer(h,g)/(e/1000)}h.body.velocity.x=Math.cos(this._angle)*f;h.body.velocity.y=Math.sin(this._angle)*f;return this._angle},moveToXY:function(h,e,i,g,f){if(typeof g==="undefined"){g=60}if(typeof f==="undefined"){f=0}this._angle=Math.atan2(i-h.y,e-h.x);if(f>0){g=this.distanceToXY(h,e,i)/(f/1000)}h.body.velocity.x=Math.cos(this._angle)*g;h.body.velocity.y=Math.sin(this._angle)*g;return this._angle},velocityFromAngle:function(g,f,e){if(typeof f==="undefined"){f=60}e=e||new b.Point();return e.setTo((Math.cos(this.game.math.degToRad(g))*f),(Math.sin(this.game.math.degToRad(g))*f))},velocityFromRotation:function(f,g,e){if(typeof g==="undefined"){g=60}e=e||new b.Point();return e.setTo((Math.cos(f)*g),(Math.sin(f)*g))},accelerationFromRotation:function(f,g,e){if(typeof g==="undefined"){g=60}e=e||new b.Point();return e.setTo((Math.cos(f)*g),(Math.sin(f)*g))},accelerateToObject:function(h,f,g,e,i){if(typeof g==="undefined"){g=60}if(typeof e==="undefined"){e=1000}if(typeof i==="undefined"){i=1000}this._angle=this.angleBetween(h,f);h.body.acceleration.setTo(Math.cos(this._angle)*g,Math.sin(this._angle)*g);h.body.maxVelocity.setTo(e,i);return this._angle},accelerateToPointer:function(h,g,f,e,i){if(typeof f==="undefined"){f=60}if(typeof g==="undefined"){g=this.game.input.activePointer}if(typeof e==="undefined"){e=1000}if(typeof i==="undefined"){i=1000}this._angle=this.angleToPointer(h,g);h.body.acceleration.setTo(Math.cos(this._angle)*f,Math.sin(this._angle)*f);h.body.maxVelocity.setTo(e,i);return this._angle},accelerateToXY:function(h,f,j,g,e,i){if(typeof g==="undefined"){g=60}if(typeof e==="undefined"){e=1000}if(typeof i==="undefined"){i=1000}this._angle=this.angleToXY(h,f,j);h.body.acceleration.setTo(Math.cos(this._angle)*g,Math.sin(this._angle)*g);h.body.maxVelocity.setTo(e,i);return this._angle},distanceBetween:function(e,f){this._dx=e.x-f.x;this._dy=e.y-f.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(f,e,g){this._dx=f.x-e;this._dy=f.y-g;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(f,e){e=e||this.game.input.activePointer;this._dx=f.x-e.x;this._dy=f.y-e.y;return Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(e,f){this._dx=f.x-e.x;this._dy=f.y-e.y;return Math.atan2(this._dy,this._dx)},angleToXY:function(f,e,g){this._dx=e-f.x;this._dy=g-f.y;return Math.atan2(this._dy,this._dx)},angleToPointer:function(f,e){e=e||this.game.input.activePointer;this._dx=e.worldX-f.x;this._dy=e.worldY-f.y;return Math.atan2(this._dy,this._dx)}};b.Physics.Arcade.Body=function(e){this.sprite=e;this.game=e.game;this.type=b.Physics.ARCADE;this.offset=new b.Point();this.position=new b.Point(e.x,e.y);this.prev=new b.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=e.rotation;this.preRotation=e.rotation;this.sourceWidth=e.texture.frame.width;this.sourceHeight=e.texture.frame.height;this.width=e.width;this.height=e.height;this.halfWidth=Math.abs(e.width/2);this.halfHeight=Math.abs(e.height/2);this.center=new b.Point(e.x+this.halfWidth,e.y+this.halfHeight);this.velocity=new b.Point();this.newVelocity=new b.Point(0,0);this.deltaMax=new b.Point(0,0);this.acceleration=new b.Point();this.drag=new b.Point();this.allowGravity=true;this.gravity=new b.Point(0,0);this.bounce=new b.Point();this.maxVelocity=new b.Point(10000,10000);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=b.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new b.Point();this.phase=0;this._reset=true;this._sx=e.scale.x;this._sy=e.scale.y;this._dx=0;this._dy=0};b.Physics.Arcade.Body.prototype={updateBounds:function(){var f=Math.abs(this.sprite.scale.x);var e=Math.abs(this.sprite.scale.y);if(f!==this._sx||e!==this._sy){this.width=this.sourceWidth*f;this.height=this.sourceHeight*e;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this._sx=f;this._sy=e;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this._reset=true}},preUpdate:function(){this.phase=1;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.height))+this.offset.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite._cache[4]===1){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);this.angle=Math.atan2(this.velocity.y,this.velocity.x)}if(this.collideWorldBounds){this.checkWorldBounds()}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},postUpdate:function(){if(this.phase===2){return}this.phase=2;if(this.deltaX()<0){this.facing=b.LEFT}else{if(this.deltaX()>0){this.facing=b.RIGHT}}if(this.deltaY()<0){this.facing=b.UP}else{if(this.deltaY()>0){this.facing=b.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.x+=this._dx;this.sprite.y+=this._dy}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},destroy:function(){this.sprite=null},checkWorldBounds:function(){if(this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left){this.position.x=this.game.physics.arcade.bounds.x;this.velocity.x*=-this.bounce.x;this.blocked.left=true}else{if(this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right){this.position.x=this.game.physics.arcade.bounds.right-this.width;this.velocity.x*=-this.bounce.x;this.blocked.right=true}}if(this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up){this.position.y=this.game.physics.arcade.bounds.y;this.velocity.y*=-this.bounce.y;this.blocked.up=true}else{if(this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down){this.position.y=this.game.physics.arcade.bounds.bottom-this.height;this.velocity.y*=-this.bounce.y;this.blocked.down=true}}},setSize:function(g,f,e,h){e=e||this.offset.x;h=h||this.offset.y;this.sourceWidth=g;this.sourceHeight=f;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(e,h);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(e,f){this.velocity.set(0);this.acceleration.set(0);this.angularVelocity=0;this.angularAcceleration=0;this.position.x=(e-(this.sprite.anchor.x*this.width))+this.offset.x;this.position.y=(f-(this.sprite.anchor.y*this.height))+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(e,f){return b.Rectangle.contains(this,e,f)},onFloor:function(){return this.blocked.down},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(b.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}});Object.defineProperty(b.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}});b.Physics.Arcade.Body.render=function(g,e,h,f){if(typeof h==="undefined"){h=true}f=f||"rgba(0,255,0,0.4)";if(h){g.fillStyle=f;g.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}else{g.strokeStyle=f;g.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}};b.Physics.Arcade.Body.renderBodyInfo=function(f,e){f.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height);f.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2));f.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2));f.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2));f.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down);f.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)};b.Physics.Arcade.Body.prototype.constructor=b.Physics.Arcade.Body;b.Particles=function(e){this.game=e;this.emitters={};this.ID=0};b.Particles.prototype={add:function(e){this.emitters[e.name]=e;return e},remove:function(e){delete this.emitters[e.name]},update:function(){for(var e in this.emitters){if(this.emitters[e].exists){this.emitters[e].update()}}}};b.Particles.prototype.constructor=b.Particles;b.Particles.Arcade={};b.Particles.Arcade.Emitter=function(f,e,h,g){this.maxParticles=g||50;b.Group.call(this,f);this.name="emitter"+this.game.particles.ID++;this.type=b.EMITTER;this.width=1;this.height=1;this.minParticleSpeed=new b.Point(-100,-100);this.maxParticleSpeed=new b.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=b.Particle;this.particleDrag=new b.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new b.Point();this.on=false;this.particleAnchor=new b.Point(0.5,0.5);this.blendMode=b.blendModes.NORMAL;this.emitX=e;this.emitY=h;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new b.Point(1,1);this._maxParticleScale=new b.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._explode=true;this._frames=null};b.Particles.Arcade.Emitter.prototype=Object.create(b.Group.prototype);b.Particles.Arcade.Emitter.prototype.constructor=b.Particles.Arcade.Emitter;b.Particles.Arcade.Emitter.prototype.update=function(){if(this.on){if(this._explode){this._counter=0;do{this.emitParticle();this._counter++}while(this._counter<this._quantity);this.on=false}else{if(this.game.time.now>=this._timer){this.emitParticle();this._counter++;if(this._quantity>0){if(this._counter>=this._quantity){this.on=false}}this._timer=this.game.time.now+this.frequency}}}var e=this.children.length;while(e--){if(this.children[e].exists){this.children[e].update()}}};b.Particles.Arcade.Emitter.prototype.makeParticles=function(m,j,f,l,n){if(typeof j==="undefined"){j=0}if(typeof f==="undefined"){f=this.maxParticles}if(typeof l==="undefined"){l=false}if(typeof n==="undefined"){n=false}var h;var g=0;var e=m;var k=j;this._frames=j;while(g<f){if(Array.isArray(m)){e=this.game.rnd.pick(m)}if(Array.isArray(j)){k=this.game.rnd.pick(j)}h=new this.particleClass(this.game,0,0,e,k);this.game.physics.arcade.enable(h,false);if(l){h.body.checkCollision.any=true;h.body.checkCollision.none=false}else{h.body.checkCollision.none=true}h.body.collideWorldBounds=n;h.exists=false;h.visible=false;h.anchor.copyFrom(this.particleAnchor);this.add(h);g++}return this};b.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false};b.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true};b.Particles.Arcade.Emitter.prototype.start=function(e,h,g,f){if(typeof e==="undefined"){e=true}if(typeof h==="undefined"){h=0}if(typeof g==="undefined"||g===null){g=250}if(typeof f==="undefined"){f=0}this.revive();this.visible=true;this.on=true;this._explode=e;this.lifespan=h;this.frequency=g;if(e){this._quantity=f}else{this._quantity+=f}this._counter=0;this._timer=this.game.time.now+g};b.Particles.Arcade.Emitter.prototype.emitParticle=function(){var e=this.getFirstExists(false);if(e===null){return}if(this.width>1||this.height>1){e.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom))}else{e.reset(this.emitX,this.emitY)}e.angle=0;e.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(e)}else{if(this.particleSendToBack){this.sendToBack(e)}}if(this.autoScale){e.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){e.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){e.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}}}if(Array.isArray(this._frames==="object")){e.frame=this.game.rnd.pick(this._frames)}else{e.frame=this._frames}if(this.autoAlpha){e.setAlphaData(this.alphaData)}else{e.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}e.blendMode=this.blendMode;e.body.updateBounds();e.body.bounce.setTo(this.bounce.x,this.bounce.y);e.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x);e.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y);e.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation);e.body.gravity.y=this.gravity;e.body.drag.x=this.particleDrag.x;e.body.drag.y=this.particleDrag.y;e.body.angularDrag=this.angularDrag;e.onEmit()};b.Particles.Arcade.Emitter.prototype.setSize=function(f,e){this.width=f;this.height=e};b.Particles.Arcade.Emitter.prototype.setXSpeed=function(f,e){f=f||0;e=e||0;this.minParticleSpeed.x=f;this.maxParticleSpeed.x=e};b.Particles.Arcade.Emitter.prototype.setYSpeed=function(f,e){f=f||0;e=e||0;this.minParticleSpeed.y=f;this.maxParticleSpeed.y=e};b.Particles.Arcade.Emitter.prototype.setRotation=function(f,e){f=f||0;e=e||0;this.minRotation=f;this.maxRotation=e};b.Particles.Arcade.Emitter.prototype.setAlpha=function(h,e,j,k,i){if(typeof h==="undefined"){h=1}if(typeof e==="undefined"){e=1}if(typeof j==="undefined"){j=0}if(typeof k==="undefined"){k=b.Easing.Linear.None}if(typeof i==="undefined"){i=false}this.minParticleAlpha=h;this.maxParticleAlpha=e;this.autoAlpha=false;if(j>0&&h!==e){var f={v:h};var g=this.game.make.tween(f).to({v:e},j,k);g.yoyo(i);this.alphaData=g.generateData(60);this.alphaData.reverse();this.autoAlpha=true}};b.Particles.Arcade.Emitter.prototype.setScale=function(h,f,g,e,j,i,k){if(typeof h==="undefined"){h=1}if(typeof f==="undefined"){f=1}if(typeof g==="undefined"){g=1}if(typeof e==="undefined"){e=1}if(typeof j==="undefined"){j=0}if(typeof i==="undefined"){i=b.Easing.Linear.None}if(typeof k==="undefined"){k=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(h,g);this._maxParticleScale.set(f,e);this.autoScale=false;if(j>0&&(h!==f)||(g!==e)){var m={x:h,y:g};var l=this.game.make.tween(m).to({x:f,y:e},j,i);l.yoyo(k);this.scaleData=l.generateData(60);this.scaleData.reverse();this.autoScale=true}};b.Particles.Arcade.Emitter.prototype.at=function(e){if(e.center){this.emitX=e.center.x;this.emitY=e.center.y}else{this.emitX=e.world.x+(e.anchor.x*e.width);this.emitY=e.world.y+(e.anchor.y*e.height)}};Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.width/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.width/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.height/2))}});Object.defineProperty(b.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.height/2))}});b.Tile=function(h,g,f,j,i,e){this.layer=h;this.index=g;this.x=f;this.y=j;this.worldX=f*i;this.worldY=j*e;this.width=i;this.height=e;this.centerX=Math.abs(i/2);this.centerY=Math.abs(e/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};b.Tile.prototype={containsPoint:function(e,f){return !(e<this.worldX||f<this.worldY||e>this.right||f>this.bottom)},intersects:function(e,h,g,f){if(g<=this.worldX){return false}if(f<=this.worldY){return false}if(e>=this.worldX+this.width){return false}if(h>=this.worldY+this.height){return false}return true},setCollisionCallback:function(f,e){this.collisionCallback=f;this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(g,f,e,h){this.collideLeft=g;this.collideRight=f;this.collideUp=e;this.collideDown=h},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(f,e){if(f&&e){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(f){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(e){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(e){this.index=e.index;this.alpha=e.alpha;this.properties=e.properties;this.collideUp=e.collideUp;this.collideDown=e.collideDown;this.collideLeft=e.collideLeft;this.collideRight=e.collideRight;this.collisionCallback=e.collisionCallback;this.collisionCallbackContext=e.collisionCallbackContext}};b.Tile.prototype.constructor=b.Tile;Object.defineProperty(b.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(b.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(b.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(b.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(b.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(b.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});b.Tilemap=function(g,h,k,f,i,e){this.game=g;this.key=h;var j=b.TilemapParser.parse(this.game,h,k,f,i,e);if(j===null){return}this.width=j.width;this.height=j.height;this.tileWidth=j.tileWidth;this.tileHeight=j.tileHeight;this.orientation=j.orientation;this.format=j.format;this.version=j.version;this.properties=j.properties;this.widthInPixels=j.widthInPixels;this.heightInPixels=j.heightInPixels;this.layers=j.layers;this.tilesets=j.tilesets;this.tiles=j.tiles;this.objects=j.objects;this.collideIndexes=[];this.collision=j.collision;this.images=j.images;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};b.Tilemap.CSV=0;b.Tilemap.TILED_JSON=1;b.Tilemap.NORTH=0;b.Tilemap.EAST=1;b.Tilemap.SOUTH=2;b.Tilemap.WEST=3;b.Tilemap.prototype={create:function(g,h,e,j,f,i){if(typeof i==="undefined"){i=this.game.world}this.width=h;this.height=e;this.setTileSize(j,f);this.layers.length=0;return this.createBlankLayer(g,h,e,j,f,i)},setTileSize:function(f,e){this.tileWidth=f;this.tileHeight=e;this.widthInPixels=this.width*f;this.heightInPixels=this.height*e},addTilesetImage:function(e,p,n,j,u,k,g){if(typeof n==="undefined"){n=this.tileWidth}if(typeof j==="undefined"){j=this.tileHeight}if(typeof u==="undefined"){u=0}if(typeof k==="undefined"){k=0}if(typeof g==="undefined"){g=0}if(n===0){n=32}if(j===0){j=32}if(typeof p==="undefined"){if(typeof e==="string"){p=e;if(!this.game.cache.checkImageKey(p)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+p+'"');return null}}else{return null}}if(typeof e==="string"){e=this.getTilesetIndex(e);if(e===null&&this.format===b.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+p+'"');return null}}if(this.tilesets[e]){this.tilesets[e].setImage(this.game.cache.getImage(p));return this.tilesets[e]}else{var o=new b.Tileset(p,g,n,j,u,k,{});o.setImage(this.game.cache.getImage(p));this.tilesets.push(o);var f=this.tilesets.length-1;var m=u;var l=u;var h=0;var s=0;var q=0;for(var r=g;r<g+o.total;r++){this.tiles[r]=[m,l,f];m+=n+k;h++;if(h===o.total){break}s++;if(s===o.columns){m=u;l+=j+k;s=0;q++;if(q===o.rows){break}}}return o}return null},createFromObjects:function(f,k,r,g,n,m,q,e,h){if(typeof n==="undefined"){n=true}if(typeof m==="undefined"){m=false}if(typeof q==="undefined"){q=this.game.world}if(typeof e==="undefined"){e=b.Sprite}if(typeof h==="undefined"){h=true}if(!this.objects[f]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+f);return}var p;for(var j=0,l=this.objects[f].length;j<l;j++){if(this.objects[f][j].gid===k){p=new e(this.game,this.objects[f][j].x,this.objects[f][j].y,r,g);p.name=this.objects[f][j].name;p.visible=this.objects[f][j].visible;p.autoCull=m;p.exists=n;if(h){p.y-=p.height}q.add(p);for(var o in this.objects[f][j].properties){q.set(p,o,this.objects[f][j].properties[o],false,false,0,true)}}}},createLayer:function(g,h,e,i){if(typeof h==="undefined"){h=this.game.width}if(typeof e==="undefined"){e=this.game.height}if(typeof i==="undefined"){i=this.game.world}var f=g;if(typeof g==="string"){f=this.getLayerIndex(g)}if(f===null||f>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+f);return}return i.add(new b.TilemapLayer(this.game,this,f,h,e))},createBlankLayer:function(e,f,q,n,k,p){if(typeof p==="undefined"){p=this.game.world}if(this.getLayerIndex(e)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}var j={name:e,x:0,y:0,width:f,height:q,widthInPixels:f*n,heightInPixels:q*k,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var r;var g=[];for(var l=0;l<q;l++){r=[];for(var m=0;m<f;m++){r.push(new b.Tile(j,-1,m,l,n,k))}g.push(r)}j.data=g;this.layers.push(j);this.currentLayer=this.layers.length-1;var o=j.widthInPixels;var i=j.heightInPixels;if(o>this.game.width){o=this.game.width}if(i>this.game.height){i=this.game.height}var g=new b.TilemapLayer(this.game,this,this.layers.length-1,o,i);g.name=e;return p.add(g)},getIndex:function(e,f){for(var g=0;g<e.length;g++){if(e[g].name===f){return g}}return null},getLayerIndex:function(e){return this.getIndex(this.layers,e)},getTilesetIndex:function(e){return this.getIndex(this.tilesets,e)},getImageIndex:function(e){return this.getIndex(this.images,e)},getObjectIndex:function(e){return this.getIndex(this.objects,e)},setTileIndexCallback:function(g,k,f,j){j=this.getLayer(j);if(typeof g==="number"){this.layers[j].callbacks[g]={callback:k,callbackContext:f}}else{for(var h=0,e=g.length;h<e;h++){this.layers[j].callbacks[g[h]]={callback:k,callbackContext:f}}}},setTileLocationCallback:function(f,m,k,e,l,g,j){j=this.getLayer(j);this.copy(f,m,k,e,j);if(this._results.length<2){return}for(var h=1;h<this._results.length;h++){this._results[h].setCollisionCallback(l,g)}},setCollision:function(h,f,k,g){if(typeof f==="undefined"){f=true}if(typeof g==="undefined"){g=true}k=this.getLayer(k);if(typeof h==="number"){return this.setCollisionByIndex(h,f,k,true)}else{for(var j=0,e=h.length;j<e;j++){this.setCollisionByIndex(h[j],f,k,false)}if(g){this.calculateFaces(k)}}},setCollisionBetween:function(j,i,e,h,g){if(typeof e==="undefined"){e=true}if(typeof g==="undefined"){g=true}h=this.getLayer(h);if(j>i){return}for(var f=j;f<=i;f++){this.setCollisionByIndex(f,e,h,false)}if(g){this.calculateFaces(h)}},setCollisionByExclusion:function(h,f,k,g){if(typeof f==="undefined"){f=true}if(typeof g==="undefined"){g=true}k=this.getLayer(k);for(var j=0,e=this.tiles.length;j<e;j++){if(h.indexOf(j)===-1){this.setCollisionByIndex(j,f,k,false)}}if(g){this.calculateFaces(k)}},setCollisionByIndex:function(h,f,k,g){if(typeof f==="undefined"){f=true}if(typeof k==="undefined"){k=this.currentLayer}if(typeof g==="undefined"){g=true}if(f){this.collideIndexes.push(h)}else{var j=this.collideIndexes.indexOf(h);if(j>-1){this.collideIndexes.splice(j,1)}}for(var m=0;m<this.layers[k].height;m++){for(var e=0;e<this.layers[k].width;e++){var l=this.layers[k].data[m][e];if(l&&l.index===h){if(f){l.setCollision(true,true,true,true)}else{l.resetCollision()}l.faceTop=f;l.faceBottom=f;l.faceLeft=f;l.faceRight=f}}}if(g){this.calculateFaces(k)}return k},getLayer:function(e){if(typeof e==="undefined"){e=this.currentLayer}else{if(typeof e==="string"){e=this.getLayerIndex(e)}else{if(e instanceof b.TilemapLayer){e=e.index}}}return e},calculateFaces:function(g){var j=null;var n=null;var e=null;var o=null;for(var k=0,f=this.layers[g].height;k<f;k++){for(var l=0,m=this.layers[g].width;l<m;l++){var i=this.layers[g].data[k][l];if(i){j=this.getTileAbove(g,l,k);n=this.getTileBelow(g,l,k);e=this.getTileLeft(g,l,k);o=this.getTileRight(g,l,k);if(i.collides){i.faceTop=true;i.faceBottom=true;i.faceLeft=true;i.faceRight=true}if(j&&j.collides){i.faceTop=false}if(n&&n.collides){i.faceBottom=false}if(e&&e.collides){i.faceLeft=false}if(o&&o.collides){i.faceRight=false}}}}},getTileAbove:function(f,e,g){if(g>0){return this.layers[f].data[g-1][e]}return null},getTileBelow:function(f,e,g){if(g<this.layers[f].height-1){return this.layers[f].data[g+1][e]}return null},getTileLeft:function(f,e,g){if(e>0){return this.layers[f].data[g][e-1]}return null},getTileRight:function(f,e,g){if(e<this.layers[f].width-1){return this.layers[f].data[g][e+1]}return null},setLayer:function(e){e=this.getLayer(e);if(this.layers[e]){this.currentLayer=e}},hasTile:function(e,g,f){f=this.getLayer(f);return(this.layers[f].data[g]!==null&&this.layers[f].data[g][e]!==null)},removeTile:function(e,h,f){f=this.getLayer(f);if(e>=0&&e<this.layers[f].width&&h>=0&&h<this.layers[f].height){if(this.hasTile(e,h,f)){var g=this.layers[f].data[h][e];this.layers[f].data[h][e]=null;this.layers[f].dirty=true;this.calculateFaces(f);return g}}},removeTileWorldXY:function(e,i,h,f,g){g=this.getLayer(g);e=this.game.math.snapToFloor(e,h)/h;i=this.game.math.snapToFloor(i,f)/f;return this.removeTile(e,i,g)},putTile:function(h,e,i,g){if(h===null){return this.removeTile(e,i,g)}g=this.getLayer(g);if(e>=0&&e<this.layers[g].width&&i>=0&&i<this.layers[g].height){var f;if(h instanceof b.Tile){f=h.index;if(this.hasTile(e,i,g)){this.layers[g].data[i][e].copy(h)}else{this.layers[g].data[i][e]=new b.Tile(g,f,e,i,h.width,h.height)}}else{f=h;if(this.hasTile(e,i,g)){this.layers[g].data[i][e].index=f}else{this.layers[g].data[i][e]=new b.Tile(this.layers[g],f,e,i,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(f)>-1){this.layers[g].data[i][e].setCollision(true,true,true,true)}else{this.layers[g].data[i][e].resetCollision()}this.layers[g].dirty=true;this.calculateFaces(g);return this.layers[g].data[i][e]}return null},putTileWorldXY:function(h,e,j,i,f,g){g=this.getLayer(g);e=this.game.math.snapToFloor(e,i)/i;j=this.game.math.snapToFloor(j,f)/f;return this.putTile(h,e,j,g)},searchTileIndex:function(g,i,f,h){if(typeof i==="undefined"){i=0}if(typeof f==="undefined"){f=false}h=this.getLayer(h);var k=0;if(f){for(var j=this.layers[h].height-1;j>=0;j--){for(var e=this.layers[h].width-1;e>=0;e--){if(this.layers[h].data[j][e].index===g){if(k===i){return this.layers[h].data[j][e]}else{k++}}}}}else{for(var j=0;j<this.layers[h].height;j++){for(var e=0;e<this.layers[h].width;e++){if(this.layers[h].data[j][e].index===g){if(k===i){return this.layers[h].data[j][e]}else{k++}}}}}return null},getTile:function(e,h,g,f){if(typeof f==="undefined"){f=false}g=this.getLayer(g);if(e>=0&&e<this.layers[g].width&&h>=0&&h<this.layers[g].height){if(this.layers[g].data[h][e].index===-1){if(f){return this.layers[g].data[h][e]}else{return null}}else{return this.layers[g].data[h][e]}}else{return null}},getTileWorldXY:function(e,i,h,f,g){if(typeof h==="undefined"){h=this.tileWidth}if(typeof f==="undefined"){f=this.tileHeight}g=this.getLayer(g);e=this.game.math.snapToFloor(e,h)/h;i=this.game.math.snapToFloor(i,f)/f;return this.getTile(e,i,g)},copy:function(g,k,j,f,i){i=this.getLayer(i);if(!this.layers[i]){this._results.length=0;return}if(typeof g==="undefined"){g=0}if(typeof k==="undefined"){k=0}if(typeof j==="undefined"){j=this.layers[i].width}if(typeof f==="undefined"){f=this.layers[i].height}if(g<0){g=0}if(k<0){k=0}if(j>this.layers[i].width){j=this.layers[i].width}if(f>this.layers[i].height){f=this.layers[i].height}this._results.length=0;this._results.push({x:g,y:k,width:j,height:f,layer:i});for(var e=k;e<k+f;e++){for(var h=g;h<g+j;h++){this._results.push(this.layers[i].data[e][h])}}return this._results},paste:function(e,l,k,j){if(typeof e==="undefined"){e=0}if(typeof l==="undefined"){l=0}j=this.getLayer(j);if(!k||k.length<2){return}var g=k[1].x-e;var f=k[1].y-l;for(var h=1;h<k.length;h++){this.layers[j].data[f+k[h].y][g+k[h].x].copy(k[h])}this.layers[j].dirty=true;this.calculateFaces(j)},swap:function(j,i,f,k,h,e,g){g=this.getLayer(g);this.copy(f,k,h,e,g);if(this._results.length<2){return}this._tempA=j;this._tempB=i;this._results.forEach(this.swapHandler,this);this.paste(f,k,this._results,g)},swapHandler:function(f,e){if(f.index===this._tempA){this._results[e].index=this._tempB}if(f.index===this._tempB){this._results[e].index=this._tempA}},forEach:function(k,h,f,j,i,e,g){g=this.getLayer(g);this.copy(f,j,i,e,g);if(this._results.length<2){return}this._results.forEach(k,h);this.paste(f,j,this._results,g)},replace:function(l,g,f,m,k,e,j){j=this.getLayer(j);this.copy(f,m,k,e,j);if(this._results.length<2){return}for(var h=1;h<this._results.length;h++){if(this._results[h].index===l){this._results[h].index=g}}this.paste(f,m,this._results,j)},random:function(k,j,e,m,g){g=this.getLayer(g);this.copy(k,j,e,m,g);if(this._results.length<2){return}var h=[];for(var n=1;n<this._results.length;n++){if(this._results[n].index){var l=this._results[n].index;if(h.indexOf(l)===-1){h.push(l)}}}for(var f=1;f<this._results.length;f++){this._results[f].index=this.game.rnd.pick(h)}this.paste(k,j,this._results,g)},shuffle:function(f,m,l,e,k){k=this.getLayer(k);this.copy(f,m,l,e,k);if(this._results.length<2){return}var g=[];for(var j=1;j<this._results.length;j++){if(this._results[j].index){g.push(this._results[j].index)}}b.Utils.shuffle(g);for(var h=1;h<this._results.length;h++){this._results[h].index=g[h-1]}this.paste(f,m,this._results,k)},fill:function(g,f,l,k,e,j){j=this.getLayer(j);this.copy(f,l,k,e,j);if(this._results.length<2){return}for(var h=1;h<this._results.length;h++){this._results[h].index=g}this.paste(f,l,this._results,j)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var f="";var g=[""];for(var h=0;h<this.layers[this.currentLayer].height;h++){for(var e=0;e<this.layers[this.currentLayer].width;e++){f+="%c  ";if(this.layers[this.currentLayer].data[h][e]>1){if(this.debugMap[this.layers[this.currentLayer].data[h][e]]){g.push("background: "+this.debugMap[this.layers[this.currentLayer].data[h][e]])}else{g.push("background: #ffffff")}}else{g.push("background: rgb(0, 0, 0)")}}f+="\n"}g[0]=f;console.log.apply(console,g)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};b.Tilemap.prototype.constructor=b.Tilemap;Object.defineProperty(b.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(e){if(e!==this.currentLayer){this.setLayer(e)}}});b.TilemapLayer=function(f,i,g,h,e){this.game=f;this.map=i;this.index=g;this.layer=i.layers[g];this.canvas=b.Canvas.create(h,e,"",true);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new b.Frame(0,0,0,h,e,"tilemapLayer",f.rnd.uuid());b.Image.call(this,this.game,0,0,this.texture,this.textureFrame);this.name="";this.type=b.TILEMAPLAYER;this.fixedToCamera=true;this.cameraOffset=new b.Point(0,0);this.tileColor="rgb(255, 255, 255)";this.debug=false;this.debugAlpha=0.5;this.debugColor="rgba(0, 255, 0, 1)";this.debugFill=false;this.debugFillColor="rgba(0, 255, 0, 0.2)";this.debugCallbackColor="rgba(255, 0, 0, 1)";this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._mc={cw:i.tileWidth,ch:i.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0};this._results=[];this.updateMax()};b.TilemapLayer.prototype=Object.create(b.Image.prototype);b.TilemapLayer.prototype.constructor=b.TilemapLayer;b.TilemapLayer.prototype.postUpdate=function(){b.Image.prototype.postUpdate.call(this);this.scrollX=this.game.camera.x*this.scrollFactorX;this.scrollY=this.game.camera.y*this.scrollFactorY;this.render();if(this._cache[7]===1){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};b.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)};b.TilemapLayer.prototype._fixX=function(e){if(e<0){e=0}if(this.scrollFactorX===1){return e}return this._mc.x+(e-(this._mc.x/this.scrollFactorX))};b.TilemapLayer.prototype._unfixX=function(e){if(this.scrollFactorX===1){return e}return(this._mc.x/this.scrollFactorX)+(e-this._mc.x)};b.TilemapLayer.prototype._fixY=function(e){if(e<0){e=0}if(this.scrollFactorY===1){return e}return this._mc.y+(e-(this._mc.y/this.scrollFactorY))};b.TilemapLayer.prototype._unfixY=function(e){if(this.scrollFactorY===1){return e}return(this._mc.y/this.scrollFactorY)+(e-this._mc.y)};b.TilemapLayer.prototype.getTileX=function(e){return this.game.math.snapToFloor(this._fixX(e),this.map.tileWidth)/this.map.tileWidth};b.TilemapLayer.prototype.getTileY=function(e){return this.game.math.snapToFloor(this._fixY(e),this.map.tileHeight)/this.map.tileHeight};b.TilemapLayer.prototype.getTileXY=function(f,g,e){e.x=this.getTileX(f);e.y=this.getTileY(g);return e};b.TilemapLayer.prototype.getRayCastTiles=function(o,h,e,l){if(typeof h==="undefined"||h===null){h=this.rayStepRate}if(typeof e==="undefined"){e=false}if(typeof l==="undefined"){l=false}var m=this.getTiles(o.x,o.y,o.width,o.height,e,l);if(m.length===0){return[]}var k=o.coordinatesOnLine(h);var j=k.length;var g=[];for(var f=0;f<m.length;f++){for(var n=0;n<j;n++){if(m[f].containsPoint(k[n][0],k[n][1])){g.push(m[f]);break}}}return g};b.TilemapLayer.prototype.getTiles=function(f,l,i,e,g,h){if(typeof g==="undefined"){g=false}if(typeof h==="undefined"){h=false}f=this._fixX(f);l=this._fixY(l);if(i>this.layer.widthInPixels){i=this.layer.widthInPixels}if(e>this.layer.heightInPixels){e=this.layer.heightInPixels}this._mc.tx=this.game.math.snapToFloor(f,this._mc.cw)/this._mc.cw;this._mc.ty=this.game.math.snapToFloor(l,this._mc.ch)/this._mc.ch;this._mc.tw=(this.game.math.snapToCeil(i,this._mc.cw)+this._mc.cw)/this._mc.cw;this._mc.th=(this.game.math.snapToCeil(e,this._mc.ch)+this._mc.ch)/this._mc.ch;this._results.length=0;for(var j=this._mc.ty;j<this._mc.ty+this._mc.th;j++){for(var k=this._mc.tx;k<this._mc.tx+this._mc.tw;k++){if(this.layer.data[j]&&this.layer.data[j][k]){if((!g&&!h)||this.layer.data[j][k].isInteresting(g,h)){this._results.push(this.layer.data[j][k])}}}}return this._results};b.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1;this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1;if(this.layer){if(this._mc.maxX>this.layer.width){this._mc.maxX=this.layer.width}if(this._mc.maxY>this.layer.height){this._mc.maxY=this.layer.height}}this.dirty=true};b.TilemapLayer.prototype.render=function(){if(this.layer.dirty){this.dirty=true}if(!this.dirty||!this.visible){return}this._mc.prevX=this._mc.dx;this._mc.prevY=this._mc.dy;this._mc.dx=-(this._mc.x-(this._mc.startX*this.map.tileWidth));this._mc.dy=-(this._mc.y-(this._mc.startY*this.map.tileHeight));this._mc.tx=this._mc.dx;this._mc.ty=this._mc.dy;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle=this.tileColor;var f;var j;if(this.debug){this.context.globalAlpha=this.debugAlpha}for(var i=this._mc.startY,g=this._mc.startY+this._mc.maxY;i<g;i++){this._column=this.layer.data[i];for(var e=this._mc.startX,h=this._mc.startX+this._mc.maxX;e<h;e++){if(this._column[e]){f=this._column[e];if(f.index>-1){j=this.map.tilesets[this.map.tiles[f.index][2]];if(this.debug===false&&f.alpha!==this.context.globalAlpha){this.context.globalAlpha=f.alpha}j.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),f.index);if(f.debug){this.context.fillStyle="rgba(0, 255, 0, 0.4)";this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight)}}}this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}if(this.game.renderType===b.WEBGL){PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)}this.dirty=false;this.layer.dirty=false;return true};b.TilemapLayer.prototype.renderDebug=function(){this._mc.tx=this._mc.dx;this._mc.ty=this._mc.dy;this.context.strokeStyle=this.debugColor;this.context.fillStyle=this.debugFillColor;for(var i=this._mc.startY,g=this._mc.startY+this._mc.maxY;i<g;i++){this._column=this.layer.data[i];for(var e=this._mc.startX,h=this._mc.startX+this._mc.maxX;e<h;e++){var f=this._column[e];if(f&&(f.faceTop||f.faceBottom||f.faceLeft||f.faceRight)){this._mc.tx=Math.floor(this._mc.tx);if(this.debugFill){this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch)}this.context.beginPath();if(f.faceTop){this.context.moveTo(this._mc.tx,this._mc.ty);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)}if(f.faceBottom){this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)}if(f.faceLeft){this.context.moveTo(this._mc.tx,this._mc.ty);this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)}if(f.faceRight){this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty);this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)}this.context.stroke()}this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}};Object.defineProperty(b.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(e){if(e!==this._mc.x&&e>=0&&this.layer.widthInPixels>this.width){this._mc.x=e;if(this._mc.x>(this.layer.widthInPixels-this.width)){this._mc.x=this.layer.widthInPixels-this.width}this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth);if(this._mc.startX<0){this._mc.startX=0}if(this._mc.startX+this._mc.maxX>this.layer.width){this._mc.startX=this.layer.width-this._mc.maxX}this.dirty=true}}});Object.defineProperty(b.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(e){if(e!==this._mc.y&&e>=0&&this.layer.heightInPixels>this.height){this._mc.y=e;if(this._mc.y>(this.layer.heightInPixels-this.height)){this._mc.y=this.layer.heightInPixels-this.height}this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight);if(this._mc.startY<0){this._mc.startY=0}if(this._mc.startY+this._mc.maxY>this.layer.height){this._mc.startY=this.layer.height-this._mc.maxY}this.dirty=true}}});Object.defineProperty(b.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(e){this._mc.cw=e;this.dirty=true}});Object.defineProperty(b.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(e){this._mc.ch=e;this.dirty=true}});b.TilemapParser={parse:function(g,h,k,f,i,e){if(typeof k==="undefined"){k=32}if(typeof f==="undefined"){f=32}if(typeof i==="undefined"){i=10}if(typeof e==="undefined"){e=10}if(typeof h==="undefined"){return this.getEmptyData()}if(h===null){return this.getEmptyData(k,f,i,e)}var j=g.cache.getTilemapData(h);if(j){if(j.format===b.Tilemap.CSV){return this.parseCSV(h,j.data,k,f)}else{if(!j.format||j.format===b.Tilemap.TILED_JSON){return this.parseTiledJSON(j.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+h)}},parseCSV:function(n,i,m,j){var e=this.getEmptyData();i=i.trim();var g=[];var p=i.split("\n");var o=p.length;var f=0;for(var k=0;k<p.length;k++){g[k]=[];var h=p[k].split(",");for(var l=0;l<h.length;l++){g[k][l]=new b.Tile(e.layers[0],parseInt(h[l],10),l,k,m,j)}if(f===0){f=h.length}}e.format=b.Tilemap.CSV;e.name=n;e.width=f;e.height=o;e.tileWidth=m;e.tileHeight=j;e.widthInPixels=f*m;e.heightInPixels=o*j;e.layers[0].width=f;e.layers[0].height=o;e.layers[0].widthInPixels=e.widthInPixels;e.layers[0].heightInPixels=e.heightInPixels;e.layers[0].data=g;return e},getEmptyData:function(k,f,h,e){var j={};j.width=0;j.height=0;j.tileWidth=0;j.tileHeight=0;if(typeof k!=="undefined"&&k!==null){j.tileWidth=k}if(typeof f!=="undefined"&&f!==null){j.tileHeight=f}if(typeof h!=="undefined"&&h!==null){j.width=h}if(typeof e!=="undefined"&&e!==null){j.height=e}j.orientation="orthogonal";j.version="1";j.properties={};j.widthInPixels=0;j.heightInPixels=0;var i=[];var g={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],data:[]};i.push(g);j.layers=i;j.images=[];j.objects={};j.collision={};j.tilesets=[];j.tiles=[];return j},parseTiledJSON:function(F){if(F.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser");return null}var G={};G.width=F.width;G.height=F.height;G.tileWidth=F.tilewidth;G.tileHeight=F.tileheight;G.orientation=F.orientation;G.format=b.Tilemap.TILED_JSON;G.version=F.version;G.properties=F.properties;G.widthInPixels=G.width*G.tileWidth;G.heightInPixels=G.height*G.tileHeight;var j=[];for(var D=0;D<F.layers.length;D++){if(F.layers[D].type!=="tilelayer"){continue}var I={name:F.layers[D].name,x:F.layers[D].x,y:F.layers[D].y,width:F.layers[D].width,height:F.layers[D].height,widthInPixels:F.layers[D].width*F.tilewidth,heightInPixels:F.layers[D].height*F.tileheight,alpha:F.layers[D].opacity,visible:F.layers[D].visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(F.layers[D].properties){I.properties=F.layers[D].properties}var o=0;var h=[];var l=[];for(var u=0,E=F.layers[D].data.length;u<E;u++){if(F.layers[D].data[u]>0){h.push(new b.Tile(I,F.layers[D].data[u],o,l.length,F.tilewidth,F.tileheight))}else{h.push(new b.Tile(I,-1,o,l.length,F.tilewidth,F.tileheight))}o++;if(o===F.layers[D].width){l.push(h);o=0;h=[]}}I.data=l;j.push(I)}G.layers=j;var r=[];for(var D=0;D<F.layers.length;D++){if(F.layers[D].type!=="imagelayer"){continue}var z={name:F.layers[D].name,image:F.layers[D].image,x:F.layers[D].x,y:F.layers[D].y,alpha:F.layers[D].opacity,visible:F.layers[D].visible,properties:{}};if(F.layers[D].properties){z.properties=F.layers[D].properties}r.push(z)}G.images=r;var C=[];for(var D=0;D<F.tilesets.length;D++){var w=F.tilesets[D];var k=new b.Tileset(w.name,w.firstgid,w.tilewidth,w.tileheight,w.margin,w.spacing,w.properties);if(w.tileproperties){k.tileProperties=w.tileproperties}k.rows=Math.round((w.imageheight-w.margin)/(w.tileheight+w.spacing));k.columns=Math.round((w.imagewidth-w.margin)/(w.tilewidth+w.spacing));k.total=k.rows*k.columns;if(k.rows%1!==0||k.columns%1!==0){console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height.")}else{C.push(k)}}G.tilesets=C;var e={};var f={};function B(x,i){var t={};for(var p in i){var v=i[p];t[v]=x[v]}return t}for(var D=0;D<F.layers.length;D++){if(F.layers[D].type!=="objectgroup"){continue}e[F.layers[D].name]=[];f[F.layers[D].name]=[];for(var s=0,E=F.layers[D].objects.length;s<E;s++){if(F.layers[D].objects[s].gid){var H={gid:F.layers[D].objects[s].gid,name:F.layers[D].objects[s].name,x:F.layers[D].objects[s].x,y:F.layers[D].objects[s].y,visible:F.layers[D].objects[s].visible,properties:F.layers[D].objects[s].properties};e[F.layers[D].name].push(H)}else{if(F.layers[D].objects[s].polyline){var H={name:F.layers[D].objects[s].name,x:F.layers[D].objects[s].x,y:F.layers[D].objects[s].y,width:F.layers[D].objects[s].width,height:F.layers[D].objects[s].height,visible:F.layers[D].objects[s].visible,properties:F.layers[D].objects[s].properties};H.polyline=[];for(var A=0;A<F.layers[D].objects[s].polyline.length;A++){H.polyline.push([F.layers[D].objects[s].polyline[A].x,F.layers[D].objects[s].polyline[A].y])}f[F.layers[D].name].push(H)}else{if(F.layers[D].objects[s].polygon){var H=B(F.layers[D].objects[s],["name","x","y","visible","properties"]);H.polygon=[];for(var A=0;A<F.layers[D].objects[s].polygon.length;A++){H.polygon.push([F.layers[D].objects[s].polygon[A].x,F.layers[D].objects[s].polygon[A].y])}e[F.layers[D].name].push(H)}else{if(F.layers[D].objects[s].ellipse){var H=B(F.layers[D].objects[s],["name","ellipse","x","y","width","height","visible","properties"]);e[F.layers[D].name].push(H)}else{var H=B(F.layers[D].objects[s],["name","x","y","width","height","visible","properties"]);H.rectangle=true;e[F.layers[D].name].push(H)}}}}}}G.objects=e;G.collision=f;G.tiles=[];for(var D=0;D<G.tilesets.length;D++){var w=G.tilesets[D];var o=w.tileMargin;var m=w.tileMargin;var g=0;var q=0;var n=0;for(var u=w.firstgid;u<w.firstgid+w.total;u++){G.tiles[u]=[o,m,D];o+=w.tileWidth+w.tileSpacing;g++;if(g===w.total){break}q++;if(q===w.columns){o=w.tileMargin;m+=w.tileHeight+w.tileSpacing;q=0;n++;if(n===w.rows){break}}}}return G}};b.Tileset=function(f,j,h,e,i,k,g){if(typeof h==="undefined"||h<=0){h=32}if(typeof e==="undefined"||e<=0){e=32}if(typeof i==="undefined"){i=0}if(typeof k==="undefined"){k=0}this.name=f;this.firstgid=j;this.tileWidth=h;this.tileHeight=e;this.tileMargin=i;this.tileSpacing=k;this.properties=g;this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};b.Tileset.prototype={draw:function(g,e,h,f){if(!this.image||!this.drawCoords[f]){return}g.drawImage(this.image,this.drawCoords[f][0],this.drawCoords[f][1],this.tileWidth,this.tileHeight,e,h,this.tileWidth,this.tileHeight)},setImage:function(j){this.image=j;this.rows=Math.round((j.height-this.tileMargin)/(this.tileHeight+this.tileSpacing));this.columns=Math.round((j.width-this.tileMargin)/(this.tileWidth+this.tileSpacing));this.total=this.rows*this.columns;this.drawCoords.length=0;var g=this.tileMargin;var f=this.tileMargin;var h=this.firstgid;for(var k=0;k<this.rows;k++){for(var e=0;e<this.columns;e++){this.drawCoords[h]=[g,f];g+=this.tileWidth+this.tileSpacing;h++}g=this.tileMargin;f+=this.tileHeight+this.tileSpacing}},setSpacing:function(e,f){this.tileMargin=e;this.tileSpacing=f;this.setImage(this.image)}};b.Tileset.prototype.constructor=b.Tileset;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.Phaser=b}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return a.Phaser=b})())}else{a.Phaser=b}}}).call(this);Phaser.Physics.Ninja=function(a){this.game=a;this.time=this.game.time;this.gravity=0.2;this.bounds=new Phaser.Rectangle(0,0,a.world.width,a.world.height);this.maxObjects=10;this.maxLevels=4;this.quadTree=new Phaser.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels)};Phaser.Physics.Ninja.prototype.constructor=Phaser.Physics.Ninja;Phaser.Physics.Ninja.prototype={enableAABB:function(a,b){this.enable(a,1,0,0,b)},enableCircle:function(b,a,c){this.enable(b,2,0,a,c)},enableTile:function(a,c,b){this.enable(a,3,c,0,b)},enable:function(b,e,f,a,d){if(typeof e==="undefined"){e=1}if(typeof f==="undefined"){f=1}if(typeof a==="undefined"){a=0}if(typeof d==="undefined"){d=true}if(Array.isArray(b)){var c=b.length;while(c--){if(b[c] instanceof Phaser.Group){this.enable(b[c].children,e,f,a,d)}else{this.enableBody(b[c],e,f,a);if(d&&b[c].hasOwnProperty("children")&&b[c].children.length>0){this.enable(b[c],e,f,a,true)}}}}else{if(b instanceof Phaser.Group){this.enable(b.children,e,f,a,d)}else{this.enableBody(b,e,f,a);if(d&&b.hasOwnProperty("children")&&b.children.length>0){this.enable(b.children,e,f,a,true)}}}},enableBody:function(b,c,d,a){if(b.hasOwnProperty("body")&&b.body===null){b.body=new Phaser.Physics.Ninja.Body(this,b,c,d,a);b.anchor.set(0.5)}},setBounds:function(b,d,c,a){this.bounds.setTo(b,d,c,a)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},clearTilemapLayerBodies:function(c,b){b=c.getLayer(b);var a=c.layers[b].bodies.length;while(a--){c.layers[b].bodies[a].destroy()}c.layers[b].bodies.length=[]},convertTilemap:function(b,e,a){e=b.getLayer(e);this.clearTilemapLayerBodies(b,e);for(var g=0,c=b.layers[e].height;g<c;g++){for(var i=0,j=b.layers[e].width;i<j;i++){var f=b.layers[e].data[g][i];if(f&&a.hasOwnProperty(f.index)){var d=new Phaser.Physics.Ninja.Body(this,null,3,a[f.index],0,f.worldX+f.centerX,f.worldY+f.centerY,f.width,f.height);b.layers[e].bodies.push(d)}}}return b.layers[e].bodies},overlap:function(g,f,b,e,c){b=b||null;e=e||null;c=c||b;this._result=false;this._total=0;if(Array.isArray(f)){for(var d=0,a=f.length;d<a;d++){this.collideHandler(g,f[d],b,e,c,true)}}else{this.collideHandler(g,f,b,e,c,true)}return(this._total>0)},collide:function(g,f,e,d,b){e=e||null;d=d||null;b=b||e;this._result=false;this._total=0;if(Array.isArray(f)){for(var c=0,a=f.length;c<a;c++){this.collideHandler(g,f[c],e,d,b,false)}}else{this.collideHandler(g,f,e,d,b,false)}return(this._total>0)},collideHandler:function(f,e,d,c,a,b){if(typeof e==="undefined"&&(f.type===Phaser.GROUP||f.type===Phaser.EMITTER)){this.collideGroupVsSelf(f,d,c,a,b);return}if(f&&e&&f.exists&&e.exists){if(f.type==Phaser.SPRITE||f.type==Phaser.TILESPRITE){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsSprite(f,e,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideSpriteVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(f,e,d,c,a)}}}}else{if(f.type==Phaser.GROUP){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsGroup(e,f,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(f,e,d,c,a)}}}}else{if(f.type==Phaser.TILEMAPLAYER){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsTilemapLayer(e,f,d,c,a)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsTilemapLayer(e,f,d,c,a)}}}else{if(f.type==Phaser.EMITTER){if(e.type==Phaser.SPRITE||e.type==Phaser.TILESPRITE){this.collideSpriteVsGroup(e,f,d,c,a,b)}else{if(e.type==Phaser.GROUP||e.type==Phaser.EMITTER){this.collideGroupVsGroup(f,e,d,c,a,b)}else{if(e.type==Phaser.TILEMAPLAYER){this.collideGroupVsTilemapLayer(f,e,d,c,a)}}}}}}}}},collideSpriteVsSprite:function(f,e,d,c,a,b){if(this.separate(f.body,e.body,c,a,b)){if(d){d.call(a,f,e)}this._total++}},collideSpriteVsGroup:function(e,h,g,f,b,c){if(h.length===0){return}for(var d=0,a=h.children.length;d<a;d++){if(h.children[d].exists&&h.children[d].body&&this.separate(e.body,h.children[d].body,f,b,c)){if(g){g.call(b,e,h.children[d])}this._total++}}},collideGroupVsSelf:function(h,g,f,b,d){if(h.length===0){return}var a=h.children.length;for(var e=0;e<a;e++){for(var c=e+1;c<=a;c++){if(h.children[e]&&h.children[c]&&h.children[e].exists&&h.children[c].exists){this.collideSpriteVsSprite(h.children[e],h.children[c],g,f,b,d)}}}},collideGroupVsGroup:function(b,h,g,f,c,d){if(b.length===0||h.length===0){return}for(var e=0,a=b.children.length;e<a;e++){if(b.children[e].exists){this.collideSpriteVsGroup(b.children[e],h,g,f,c,d)}}},separate:function(b,a){if(b.type!==Phaser.Physics.NINJA||a.type!==Phaser.Physics.NINJA){return false}if(b.aabb&&a.aabb){return b.aabb.collideAABBVsAABB(a.aabb)}if(b.aabb&&a.tile){return b.aabb.collideAABBVsTile(a.tile)}if(b.tile&&a.aabb){return a.aabb.collideAABBVsTile(b.tile)}if(b.circle&&a.tile){return b.circle.collideCircleVsTile(a.tile)}if(b.tile&&a.circle){return a.circle.collideCircleVsTile(b.tile)}}};Phaser.Physics.Ninja.Body=function(a,h,e,b,d,g,f,c,i){h=h||null;if(typeof e==="undefined"){e=1}if(typeof b==="undefined"){b=1}if(typeof d==="undefined"){d=16}this.sprite=h;this.game=a.game;this.type=Phaser.Physics.NINJA;this.system=a;this.aabb=null;this.tile=null;this.circle=null;this.shape=null;this.drag=1;this.friction=0.05;this.gravityScale=1;this.bounce=0.3;this.velocity=new Phaser.Point();this.facing=Phaser.NONE;this.immovable=false;this.collideWorldBounds=true;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.maxSpeed=8;if(h){g=h.x;f=h.y;c=h.width;i=h.height;if(h.anchor.x===0){g+=(h.width*0.5)}if(h.anchor.y===0){f+=(h.height*0.5)}}if(e===1){this.aabb=new Phaser.Physics.Ninja.AABB(this,g,f,c,i);this.shape=this.aabb}else{if(e===2){this.circle=new Phaser.Physics.Ninja.Circle(this,g,f,d);this.shape=this.circle}else{if(e===3){this.tile=new Phaser.Physics.Ninja.Tile(this,g,f,c,i,b);this.shape=this.tile}}}};Phaser.Physics.Ninja.Body.prototype={preUpdate:function(){this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.shape.integrate();if(this.collideWorldBounds){this.shape.collideWorldBounds()}},postUpdate:function(){if(this.sprite){if(this.sprite.type===Phaser.TILESPRITE){this.sprite.x=this.shape.pos.x-this.shape.xw;this.sprite.y=this.shape.pos.y-this.shape.yw}else{this.sprite.x=this.shape.pos.x;this.sprite.y=this.shape.pos.y}}if(this.velocity.x<0){this.facing=Phaser.LEFT}else{if(this.velocity.x>0){this.facing=Phaser.RIGHT}}if(this.velocity.y<0){this.facing=Phaser.UP}else{if(this.velocity.y>0){this.facing=Phaser.DOWN}}},setZeroVelocity:function(){this.shape.oldpos.x=this.shape.pos.x;this.shape.oldpos.y=this.shape.pos.y},moveTo:function(b,c){var a=b*this.game.time.physicsElapsed;var c=this.game.math.degToRad(c);this.shape.pos.x=this.shape.oldpos.x+(a*Math.cos(c));this.shape.pos.y=this.shape.oldpos.y+(a*Math.sin(c))},moveFrom:function(b,c){var a=-b*this.game.time.physicsElapsed;var c=this.game.math.degToRad(c);this.shape.pos.x=this.shape.oldpos.x+(a*Math.cos(c));this.shape.pos.y=this.shape.oldpos.y+(a*Math.sin(c))},moveLeft:function(b){var a=-b*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+a))},moveRight:function(b){var a=b*this.game.time.physicsElapsed;this.shape.pos.x=this.shape.oldpos.x+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.x-this.shape.oldpos.x+a))},moveUp:function(b){var a=-b*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+a))},moveDown:function(b){var a=b*this.game.time.physicsElapsed;this.shape.pos.y=this.shape.oldpos.y+Math.min(this.maxSpeed,Math.max(-this.maxSpeed,this.shape.pos.y-this.shape.oldpos.y+a))},reset:function(){this.velocity.set(0);this.shape.pos.x=this.sprite.x;this.shape.pos.y=this.sprite.y;this.shape.oldpos.copyFrom(this.shape.pos)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.shape.pos.x-this.shape.oldpos.x},deltaY:function(){return this.shape.pos.y-this.shape.oldpos.y},destroy:function(){this.sprite=null;this.system=null;this.aabb=null;this.tile=null;this.circle=null;this.shape.destroy();this.shape=null}};Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"x",{get:function(){return this.shape.pos.x},set:function(a){this.shape.pos.x=a}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"y",{get:function(){return this.shape.pos.y},set:function(a){this.shape.pos.y=a}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"width",{get:function(){return this.shape.width}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"height",{get:function(){return this.shape.height}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"bottom",{get:function(){return this.shape.pos.y+this.shape.yw}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"right",{get:function(){return this.shape.pos.x+this.shape.xw}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"speed",{get:function(){return Math.sqrt(this.shape.velocity.x*this.shape.velocity.x+this.shape.velocity.y*this.shape.velocity.y)}});Object.defineProperty(Phaser.Physics.Ninja.Body.prototype,"angle",{get:function(){return Math.atan2(this.shape.velocity.y,this.shape.velocity.x)}});Phaser.Physics.Ninja.AABB=function(c,b,e,d,a){this.body=c;this.system=c.system;this.pos=new Phaser.Point(b,e);this.oldpos=new Phaser.Point(b,e);this.xw=Math.abs(d/2);this.yw=Math.abs(a/2);this.width=d;this.height=a;this.oH=0;this.oV=0;this.velocity=new Phaser.Point();this.aabbTileProjections={};this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projAABB_Full;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projAABB_45Deg;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projAABB_Concave;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projAABB_Convex;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projAABB_22DegS;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projAABB_22DegB;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projAABB_67DegS;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projAABB_67DegB;this.aabbTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projAABB_Half};Phaser.Physics.Ninja.AABB.prototype.constructor=Phaser.Physics.Ninja.AABB;Phaser.Physics.Ninja.AABB.COL_NONE=0;Phaser.Physics.Ninja.AABB.COL_AXIS=1;Phaser.Physics.Ninja.AABB.COL_OTHER=2;Phaser.Physics.Ninja.AABB.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},reverse:function(){var b=this.pos.x-this.oldpos.x;var a=this.pos.y-this.oldpos.y;if(this.oldpos.x<this.pos.x){this.oldpos.x=this.pos.x+b}else{if(this.oldpos.x>this.pos.x){this.oldpos.x=this.pos.x-b}}if(this.oldpos.y<this.pos.y){this.oldpos.y=this.pos.y+a}else{if(this.oldpos.y>this.pos.y){this.oldpos.y=this.pos.y-a}}},reportCollisionVsBody:function(e,c,b,a,h){var d=this.pos.x-this.oldpos.x;var g=this.pos.y-this.oldpos.y;var f=(d*b+g*a);if(this.body.immovable&&h.body.immovable){e*=0.5;c*=0.5;this.pos.add(e,c);this.oldpos.set(this.pos.x,this.pos.y);h.pos.subtract(e,c);h.oldpos.set(h.pos.x,h.pos.y);return}else{if(!this.body.immovable&&!h.body.immovable){e*=0.5;c*=0.5;this.pos.add(e,c);h.pos.subtract(e,c);if(f<0){this.reverse();h.reverse()}}else{if(!this.body.immovable){this.pos.subtract(e,c);if(f<0){this.reverse()}}else{if(!h.body.immovable){h.pos.subtract(e,c);if(f<0){h.reverse()}}}}}},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.xw);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.xw)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.yw);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.yw)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},collideAABBVsAABB:function(e){var h=this.pos;var g=e;var f=g.pos.x;var d=g.pos.y;var b=g.xw;var m=g.yw;var n=h.x-f;var j=(b+this.xw)-Math.abs(n);if(0<j){var k=h.y-d;var i=(m+this.yw)-Math.abs(k);if(0<i){if(j<i){if(n<0){j*=-1;i=0}else{i=0}}else{if(k<0){j=0;i*=-1}else{j=0}}var a=Math.sqrt(j*j+i*i);this.reportCollisionVsBody(j,i,j/a,i/a,g);return Phaser.Physics.Ninja.AABB.COL_AXIS}}return false},collideAABBVsTile:function(e){var b=this.pos.x-e.pos.x;var d=(e.xw+this.xw)-Math.abs(b);if(0<d){var a=this.pos.y-e.pos.y;var c=(e.yw+this.yw)-Math.abs(a);if(0<c){if(d<c){if(b<0){d*=-1;c=0}else{c=0}}else{if(a<0){d=0;c*=-1}else{d=0}}return this.resolveTile(d,c,this,e)}}return false},resolveTile:function(b,d,a,c){if(0<c.id){return this.aabbTileProjections[c.type](b,d,a,c)}else{return false}},projAABB_Full:function(a,e,d,c){var b=Math.sqrt(a*a+e*e);d.reportCollisionVsWorld(a,e,a/b,e/b,c);return Phaser.Physics.Ninja.AABB.COL_AXIS},projAABB_Half:function(j,g,f,k){var i=k.signx;var h=k.signy;var d=(f.pos.x-(i*f.xw))-k.pos.x;var c=(f.pos.y-(h*f.yw))-k.pos.y;var e=(d*i)+(c*h);if(e<0){i*=-e;h*=-e;var b=Math.sqrt(i*i+h*h);var a=Math.sqrt(j*j+g*g);if(a<b){f.reportCollisionVsWorld(j,g,j/a,g/a,k);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(i,h,k.signx,k.signy,k);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_45Deg:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-m.pos.x;var c=(f.pos.y-(g*f.yw))-m.pos.y;var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegS:function(o,l,g,p){var i=p.signx;var h=p.signy;var n=g.pos.y-(h*g.yw);var j=p.pos.y-n;if(0<(j*h)){var d=(g.pos.x-(i*g.xw))-(p.pos.x+(i*p.xw));var c=(g.pos.y-(h*g.yw))-(p.pos.y-(h*p.yw));var m=p.sx;var k=p.sy;var e=(d*m)+(c*k);if(e<0){m*=-e;k*=-e;var b=Math.sqrt(m*m+k*k);var a=Math.sqrt(o*o+l*l);var f=Math.abs(j);if(a<b){if(f<a){g.reportCollisionVsWorld(0,j,0,j/f,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(o,l,o/a,l/a,p);return Phaser.Physics.Ninja.AABB.COL_AXIS}}else{if(f<b){g.reportCollisionVsWorld(0,j,0,j/f,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(m,k,p.sx,p.sy,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}}}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_22DegB:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-(m.pos.x-(h*m.xw));var c=(f.pos.y-(g*f.yw))-(m.pos.y+(g*m.yw));var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegS:function(n,l,g,p){var i=p.signx;var h=p.signy;var o=g.pos.x-(i*g.xw);var j=p.pos.x-o;if(0<(j*i)){var d=(g.pos.x-(i*g.xw))-(p.pos.x-(i*p.xw));var c=(g.pos.y-(h*g.yw))-(p.pos.y+(h*p.yw));var m=p.sx;var k=p.sy;var e=(d*m)+(c*k);if(e<0){m*=-e;k*=-e;var b=Math.sqrt(m*m+k*k);var a=Math.sqrt(n*n+l*l);var f=Math.abs(j);if(a<b){if(f<a){g.reportCollisionVsWorld(j,0,j/f,0,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(n,l,n/a,l/a,p);return Phaser.Physics.Ninja.AABB.COL_AXIS}}else{if(f<b){g.reportCollisionVsWorld(j,0,j/f,0,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}else{g.reportCollisionVsWorld(m,k,p.sx,p.sy,p);return Phaser.Physics.Ninja.AABB.COL_OTHER}}}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_67DegB:function(l,j,f,m){var h=m.signx;var g=m.signy;var d=(f.pos.x-(h*f.xw))-(m.pos.x+(h*m.xw));var c=(f.pos.y-(g*f.yw))-(m.pos.y-(g*m.yw));var k=m.sx;var i=m.sy;var e=(d*k)+(c*i);if(e<0){k*=-e;i*=-e;var b=Math.sqrt(k*k+i*i);var a=Math.sqrt(l*l+j*j);if(a<b){f.reportCollisionVsWorld(l,j,l/a,j/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{f.reportCollisionVsWorld(k,i,m.sx,m.sy,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Convex:function(l,k,e,m){var g=m.signx;var f=m.signy;var c=(e.pos.x-(g*e.xw))-(m.pos.x-(g*m.xw));var b=(e.pos.y-(f*e.yw))-(m.pos.y-(f*m.yw));var h=Math.sqrt(c*c+b*b);var j=m.xw*2;var i=Math.sqrt(j*j+0);var d=i-h;if(((g*c)<0)||((f*b)<0)){var a=Math.sqrt(l*l+k*k);e.reportCollisionVsWorld(l,k,l/a,k/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{if(0<d){c/=h;b/=h;e.reportCollisionVsWorld(c*d,b*d,c,b,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},projAABB_Concave:function(l,k,e,m){var g=m.signx;var f=m.signy;var c=(m.pos.x+(g*m.xw))-(e.pos.x-(g*e.xw));var b=(m.pos.y+(f*m.yw))-(e.pos.y-(f*e.yw));var j=m.xw*2;var i=Math.sqrt(j*j+0);var h=Math.sqrt(c*c+b*b);var d=h-i;if(0<d){var a=Math.sqrt(l*l+k*k);if(a<d){e.reportCollisionVsWorld(l,k,l/a,k/a,m);return Phaser.Physics.Ninja.AABB.COL_AXIS}else{c/=h;b/=h;e.reportCollisionVsWorld(c*d,b*d,c,b,m);return Phaser.Physics.Ninja.AABB.COL_OTHER}}return Phaser.Physics.Ninja.AABB.COL_NONE},destroy:function(){this.body=null;this.system=null}};Phaser.Physics.Ninja.Tile=function(c,b,f,e,a,d){if(typeof d==="undefined"){d=Phaser.Physics.Ninja.Tile.EMPTY}this.body=c;this.system=c.system;this.id=d;this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY;this.pos=new Phaser.Point(b,f);this.oldpos=new Phaser.Point(b,f);if(this.id>1&&this.id<30){a=e}this.xw=Math.abs(e/2);this.yw=Math.abs(a/2);this.width=e;this.height=a;this.velocity=new Phaser.Point();this.signx=0;this.signy=0;this.sx=0;this.sy=0;this.body.gravityScale=0;this.body.collideWorldBounds=false;if(this.id>0){this.setType(this.id)}};Phaser.Physics.Ninja.Tile.prototype.constructor=Phaser.Physics.Ninja.Tile;Phaser.Physics.Ninja.Tile.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.xw);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.xw)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.yw);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.yw)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},setType:function(a){if(a===Phaser.Physics.Ninja.Tile.EMPTY){this.clear()}else{this.id=a;this.updateType()}return this},clear:function(){this.id=Phaser.Physics.Ninja.Tile.EMPTY;this.updateType()},destroy:function(){this.body=null;this.system=null},updateType:function(){if(this.id===0){this.type=Phaser.Physics.Ninja.Tile.TYPE_EMPTY;this.signx=0;this.signy=0;this.sx=0;this.sy=0;return true}if(this.id<Phaser.Physics.Ninja.Tile.TYPE_45DEG){this.type=Phaser.Physics.Ninja.Tile.TYPE_FULL;this.signx=0;this.signy=0;this.sx=0;this.sy=0}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONCAVE){this.type=Phaser.Physics.Ninja.Tile.TYPE_45DEG;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn){this.signx=1;this.signy=-1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn){this.signx=-1;this.signy=-1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp){this.signx=-1;this.signy=1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp){this.signx=1;this.signy=1;this.sx=this.signx/Math.SQRT2;this.sy=this.signy/Math.SQRT2}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_CONVEX){this.type=Phaser.Physics.Ninja.Tile.TYPE_CONCAVE;if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEpn){this.signx=1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnn){this.signx=-1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEnp){this.signx=-1;this.signy=1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONCAVEpp){this.signx=1;this.signy=1;this.sx=0;this.sy=0}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGs){this.type=Phaser.Physics.Ninja.Tile.TYPE_CONVEX;if(this.id==Phaser.Physics.Ninja.Tile.CONVEXpn){this.signx=1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnn){this.signx=-1;this.signy=-1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXnp){this.signx=-1;this.signy=1;this.sx=0;this.sy=0}else{if(this.id==Phaser.Physics.Ninja.Tile.CONVEXpp){this.signx=1;this.signy=1;this.sx=0;this.sy=0}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_22DEGb){this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGs;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGs){this.type=Phaser.Physics.Ninja.Tile.TYPE_22DEGb;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*1)/a;this.sy=(this.signy*2)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_67DEGb){this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGs;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{return false}}}}}else{if(this.id<Phaser.Physics.Ninja.Tile.TYPE_HALF){this.type=Phaser.Physics.Ninja.Tile.TYPE_67DEGb;if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB){this.signx=1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB){this.signx=-1;this.signy=-1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB){this.signx=-1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{if(this.id==Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB){this.signx=1;this.signy=1;var a=Math.sqrt(2*2+1*1);this.sx=(this.signx*2)/a;this.sy=(this.signy*1)/a}else{return false}}}}}else{this.type=Phaser.Physics.Ninja.Tile.TYPE_HALF;if(this.id==Phaser.Physics.Ninja.Tile.HALFd){this.signx=0;this.signy=-1;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFu){this.signx=0;this.signy=1;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFl){this.signx=1;this.signy=0;this.sx=this.signx;this.sy=this.signy}else{if(this.id==Phaser.Physics.Ninja.Tile.HALFr){this.signx=-1;this.signy=0;this.sx=this.signx;this.sy=this.signy}else{return false}}}}}}}}}}}}}};Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"x",{get:function(){return this.pos.x-this.xw},set:function(a){this.pos.x=a}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"y",{get:function(){return this.pos.y-this.yw},set:function(a){this.pos.y=a}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"bottom",{get:function(){return this.pos.y+this.yw}});Object.defineProperty(Phaser.Physics.Ninja.Tile.prototype,"right",{get:function(){return this.pos.x+this.xw}});Phaser.Physics.Ninja.Tile.EMPTY=0;Phaser.Physics.Ninja.Tile.FULL=1;Phaser.Physics.Ninja.Tile.SLOPE_45DEGpn=2;Phaser.Physics.Ninja.Tile.SLOPE_45DEGnn=3;Phaser.Physics.Ninja.Tile.SLOPE_45DEGnp=4;Phaser.Physics.Ninja.Tile.SLOPE_45DEGpp=5;Phaser.Physics.Ninja.Tile.CONCAVEpn=6;Phaser.Physics.Ninja.Tile.CONCAVEnn=7;Phaser.Physics.Ninja.Tile.CONCAVEnp=8;Phaser.Physics.Ninja.Tile.CONCAVEpp=9;Phaser.Physics.Ninja.Tile.CONVEXpn=10;Phaser.Physics.Ninja.Tile.CONVEXnn=11;Phaser.Physics.Ninja.Tile.CONVEXnp=12;Phaser.Physics.Ninja.Tile.CONVEXpp=13;Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnS=14;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnS=15;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpS=16;Phaser.Physics.Ninja.Tile.SLOPE_22DEGppS=17;Phaser.Physics.Ninja.Tile.SLOPE_22DEGpnB=18;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnnB=19;Phaser.Physics.Ninja.Tile.SLOPE_22DEGnpB=20;Phaser.Physics.Ninja.Tile.SLOPE_22DEGppB=21;Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnS=22;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnS=23;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpS=24;Phaser.Physics.Ninja.Tile.SLOPE_67DEGppS=25;Phaser.Physics.Ninja.Tile.SLOPE_67DEGpnB=26;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnnB=27;Phaser.Physics.Ninja.Tile.SLOPE_67DEGnpB=28;Phaser.Physics.Ninja.Tile.SLOPE_67DEGppB=29;Phaser.Physics.Ninja.Tile.HALFd=30;Phaser.Physics.Ninja.Tile.HALFr=31;Phaser.Physics.Ninja.Tile.HALFu=32;Phaser.Physics.Ninja.Tile.HALFl=33;Phaser.Physics.Ninja.Tile.TYPE_EMPTY=0;Phaser.Physics.Ninja.Tile.TYPE_FULL=1;Phaser.Physics.Ninja.Tile.TYPE_45DEG=2;Phaser.Physics.Ninja.Tile.TYPE_CONCAVE=6;Phaser.Physics.Ninja.Tile.TYPE_CONVEX=10;Phaser.Physics.Ninja.Tile.TYPE_22DEGs=14;Phaser.Physics.Ninja.Tile.TYPE_22DEGb=18;Phaser.Physics.Ninja.Tile.TYPE_67DEGs=22;Phaser.Physics.Ninja.Tile.TYPE_67DEGb=26;Phaser.Physics.Ninja.Tile.TYPE_HALF=30;Phaser.Physics.Ninja.Circle=function(c,b,d,a){this.body=c;this.system=c.system;this.pos=new Phaser.Point(b,d);this.oldpos=new Phaser.Point(b,d);this.radius=a;this.xw=a;this.yw=a;this.width=a*2;this.height=a*2;this.oH=0;this.oV=0;this.velocity=new Phaser.Point();this.circleTileProjections={};this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_FULL]=this.projCircle_Full;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_45DEG]=this.projCircle_45Deg;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONCAVE]=this.projCircle_Concave;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_CONVEX]=this.projCircle_Convex;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGs]=this.projCircle_22DegS;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_22DEGb]=this.projCircle_22DegB;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGs]=this.projCircle_67DegS;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_67DEGb]=this.projCircle_67DegB;this.circleTileProjections[Phaser.Physics.Ninja.Tile.TYPE_HALF]=this.projCircle_Half};Phaser.Physics.Ninja.Circle.prototype.constructor=Phaser.Physics.Ninja.Circle;Phaser.Physics.Ninja.Circle.COL_NONE=0;Phaser.Physics.Ninja.Circle.COL_AXIS=1;Phaser.Physics.Ninja.Circle.COL_OTHER=2;Phaser.Physics.Ninja.Circle.prototype={integrate:function(){var b=this.pos.x;var a=this.pos.y;this.pos.x+=(this.body.drag*this.pos.x)-(this.body.drag*this.oldpos.x);this.pos.y+=(this.body.drag*this.pos.y)-(this.body.drag*this.oldpos.y)+(this.system.gravity*this.body.gravityScale);this.velocity.set(this.pos.x-b,this.pos.y-a);this.oldpos.set(b,a)},reportCollisionVsWorld:function(g,f,e,d){var j=this.pos;var k=this.oldpos;var i=j.x-k.x;var h=j.y-k.y;var l=(i*e+h*d);var r=l*e;var q=l*d;var u=i-r;var t=h-q;var s,n,m,c,a;if(l<0){c=u*this.body.friction;a=t*this.body.friction;s=1+this.body.bounce;n=(r*s);m=(q*s);if(e===1){this.body.touching.left=true}else{if(e===-1){this.body.touching.right=true}}if(d===1){this.body.touching.up=true}else{if(d===-1){this.body.touching.down=true}}}else{n=m=c=a=0}j.x+=g;j.y+=f;k.x+=g+n+c;k.y+=f+m+a},collideWorldBounds:function(){var b=this.system.bounds.x-(this.pos.x-this.radius);if(0<b){this.reportCollisionVsWorld(b,0,1,0,null)}else{b=(this.pos.x+this.radius)-this.system.bounds.right;if(0<b){this.reportCollisionVsWorld(-b,0,-1,0,null)}}var a=this.system.bounds.y-(this.pos.y-this.radius);if(0<a){this.reportCollisionVsWorld(0,a,0,1,null)}else{a=(this.pos.y+this.radius)-this.system.bounds.bottom;if(0<a){this.reportCollisionVsWorld(0,-a,0,-1,null)}}},collideCircleVsTile:function(f){var h=this.pos;var a=this.radius;var g=f;var e=g.pos.x;var d=g.pos.y;var b=g.xw;var l=g.yw;var m=h.x-e;var j=(b+a)-Math.abs(m);if(0<j){var k=h.y-d;var i=(l+a)-Math.abs(k);if(0<i){this.oH=0;this.oV=0;if(m<-b){this.oH=-1}else{if(b<m){this.oH=1}}if(k<-l){this.oV=-1}else{if(l<k){this.oV=1}}return this.resolveCircleTile(j,i,this.oH,this.oV,this,g)}}},resolveCircleTile:function(a,f,d,b,e,c){if(0<c.id){return this.circleTileProjections[c.type](a,f,d,b,e,c)}else{return false}},projCircle_Full:function(i,h,a,e,c,j){if(a===0){if(e===0){if(i<h){var l=c.pos.x-j.pos.x;if(l<0){c.reportCollisionVsWorld(-i,0,-1,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c.reportCollisionVsWorld(i,0,1,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{var k=c.pos.y-j.pos.y;if(k<0){c.reportCollisionVsWorld(0,-h,0,-1,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c.reportCollisionVsWorld(0,h,0,1,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}}else{c.reportCollisionVsWorld(0,h*e,0,e,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{if(e===0){c.reportCollisionVsWorld(i*a,0,a,0,j);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var g=j.pos.x+(a*j.xw);var f=j.pos.y+(e*j.yw);var l=c.pos.x-g;var k=c.pos.y-f;var d=Math.sqrt(l*l+k*k);var b=c.radius-d;if(0<b){if(d===0){l=a/Math.SQRT2;k=e/Math.SQRT2}else{l/=d;k/=d}c.reportCollisionVsWorld(l*b,k*b,l,k,j);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_45Deg:function(e,d,c,u,j,k){var h=k.signx;var f=k.signy;var q;if(c===0){if(u===0){var n=k.sx;var l=k.sy;var b=(j.pos.x-(n*j.radius))-k.pos.x;var a=(j.pos.y-(l*j.radius))-k.pos.y;var p=(b*n)+(a*l);if(p<0){n*=-p;l*=-p;if(e<d){q=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{q=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}var r=Math.sqrt(n*n+l*l);if(q<r){j.reportCollisionVsWorld(e,d,e/q,d/q,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(n,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*u)<0){j.reportCollisionVsWorld(0,d*u,0,u,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(u*k.yw));var v=(b*-l)+(a*n);if(0<(v*h*f)){var s=Math.sqrt(b*b+a*a);var w=j.radius-s;if(0<w){b/=s;a/=s;j.reportCollisionVsWorld(b*w,a*w,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var p=(b*n)+(a*l);var w=j.radius-Math.abs(p);if(0<w){j.reportCollisionVsWorld(n*w,l*w,n,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(u===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x+(c*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var v=(b*-l)+(a*n);if((v*h*f)<0){var s=Math.sqrt(b*b+a*a);var w=j.radius-s;if(0<w){b/=s;a/=s;j.reportCollisionVsWorld(b*w,a*w,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var p=(b*n)+(a*l);var w=j.radius-Math.abs(p);if(0<w){j.reportCollisionVsWorld(n*w,l*w,n,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(0<((h*c)+(f*u))){return Phaser.Physics.Ninja.Circle.COL_NONE}else{var o=k.pos.x+(c*k.xw);var m=k.pos.y+(u*k.yw);var i=j.pos.x-o;var g=j.pos.y-m;var s=Math.sqrt(i*i+g*g);var w=j.radius-s;if(0<w){if(s===0){i=c/Math.SQRT2;g=u/Math.SQRT2}else{i/=s;g/=s}j.reportCollisionVsWorld(i*w,g*w,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Concave:function(f,e,d,r,k,l){var i=l.signx;var g=l.signy;var o;if(d===0){if(r===0){var c=(l.pos.x+(i*l.xw))-k.pos.x;var a=(l.pos.y+(g*l.yw))-k.pos.y;var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(q+k.radius)-b;if(0<s){if(f<e){o=f;e=0;if((k.pos.x-l.pos.x)<0){f*=-1}}else{o=e;f=0;if((k.pos.y-l.pos.y)<0){e*=-1}}if(o<s){k.reportCollisionVsWorld(f,e,f/o,e/o,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{return Phaser.Physics.Ninja.Circle.COL_NONE}}else{if((g*r)<0){k.reportCollisionVsWorld(0,e*r,0,r,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=l.pos.x-(i*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=0;h=r}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(r===0){if((i*d)<0){k.reportCollisionVsWorld(f*d,0,d,0,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y-(g*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d;h=0}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if(0<((i*d)+(g*r))){return Phaser.Physics.Ninja.Circle.COL_NONE}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d/Math.SQRT2;h=r/Math.SQRT2}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Convex:function(f,e,d,r,k,l){var i=l.signx;var g=l.signy;var o;if(d===0){if(r===0){var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){if(f<e){o=f;e=0;if((k.pos.x-l.pos.x)<0){f*=-1}}else{o=e;f=0;if((k.pos.y-l.pos.y)<0){e*=-1}}if(o<s){k.reportCollisionVsWorld(f,e,f/o,e/o,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((g*r)<0){k.reportCollisionVsWorld(0,e*r,0,r,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(r===0){if((i*d)<0){k.reportCollisionVsWorld(f*d,0,d,0,l);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if(0<((i*d)+(g*r))){var c=k.pos.x-(l.pos.x-(i*l.xw));var a=k.pos.y-(l.pos.y-(g*l.yw));var p=l.xw*2;var b=Math.sqrt(p*p+0);var q=Math.sqrt(c*c+a*a);var s=(b+k.radius)-q;if(0<s){c/=q;a/=q;k.reportCollisionVsWorld(c*s,a*s,c,a,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var n=l.pos.x+(d*l.xw);var m=l.pos.y+(r*l.yw);var j=k.pos.x-n;var h=k.pos.y-m;var q=Math.sqrt(j*j+h*h);var s=k.radius-q;if(0<s){if(q===0){j=d/Math.SQRT2;h=r/Math.SQRT2}else{j/=q;h/=q}k.reportCollisionVsWorld(j*s,h*s,j,h,l);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_Half:function(e,d,c,z,j,k){var h=k.signx;var f=k.signy;var w=(c*h+z*f);if(0<w){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(z===0){var m=j.radius;var b=(j.pos.x-(h*m))-k.pos.x;var a=(j.pos.y-(f*m))-k.pos.y;var o=h;var l=f;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);var s=Math.sqrt(e*e+d*d);if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.signx,k.signy);return Phaser.Physics.Ninja.Circle.COL_OTHER}return true}}else{if(w===0){var i=j.pos.x-k.pos.x;if((i*h)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var g=j.pos.y-(k.pos.y+z*k.yw);var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=h/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}}else{if(z===0){if(w===0){var g=j.pos.y-k.pos.y;if((g*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var i=j.pos.x-(k.pos.x+c*k.xw);var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=h/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegS:function(e,d,c,w,j,k){var s;var h=k.signx;var f=k.signy;if(0<(f*w)){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(w===0){var o=k.sx;var l=k.sy;var m=j.radius;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-k.pos.y;var z=(b*-l)+(a*o);if(0<(z*h*f)){var v=Math.sqrt(b*b+a*a);var A=m-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{b-=m*o;a-=m*l;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{j.reportCollisionVsWorld(0,d*w,0,w,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}}else{if(w===0){if((h*c)<0){var p=k.pos.x-(h*k.xw);var n=k.pos.y;var i=j.pos.x-p;var g=j.pos.y-n;if((g*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x+(c*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var z=(b*-l)+(a*o);if((z*h*f)<0){var v=Math.sqrt(b*b+a*a);var A=j.radius-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var A=j.radius-Math.abs(q);if(0<A){j.reportCollisionVsWorld(o*A,l*A,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(w*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_22DegB:function(e,d,c,z,j,k){var s;var h=k.signx;var f=k.signy;if(c===0){if(z===0){var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x-(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y+(f*k.yw));var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*z)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(f*k.yw));var A=(b*-l)+(a*o);if(0<(A*h*f)){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(z===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var b=j.pos.x-(k.pos.x+(h*k.xw));var a=j.pos.y-k.pos.y;if((a*f)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var A=(b*-l)+(a*o);if((A*h*f)<0){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(0<((h*c)+(f*z))){var w=Math.sqrt(2*2+1*1);var o=(h*1)/w;var l=(f*2)/w;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x-(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y+(f*k.yw));var q=(b*o)+(a*l);if(q<0){j.reportCollisionVsWorld(-o*q,-l*q,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var B=j.radius-v;if(0<B){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*B,g*B,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegS:function(e,d,c,w,j,k){var h=k.signx;var f=k.signy;if(0<(h*c)){return Phaser.Physics.Ninja.Circle.COL_NONE}else{if(c===0){if(w===0){var s;var o=k.sx;var l=k.sy;var m=j.radius;var b=j.pos.x-k.pos.x;var a=j.pos.y-(k.pos.y-(f*k.yw));var z=(b*-l)+(a*o);if((z*h*f)<0){var v=Math.sqrt(b*b+a*a);var A=m-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{b-=m*o;a-=m*l;var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if((f*w)<0){var p=k.pos.x;var n=k.pos.y-(f*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;if((i*h)<0){j.reportCollisionVsWorld(0,d*w,0,w,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{var o=k.sx;var l=k.sy;var b=j.pos.x-(k.pos.x-(h*k.xw));var a=j.pos.y-(k.pos.y+(w*k.yw));var z=(b*-l)+(a*o);if(0<(z*h*f)){var v=Math.sqrt(b*b+a*a);var A=j.radius-v;if(0<A){b/=v;a/=v;j.reportCollisionVsWorld(b*A,a*A,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var A=j.radius-Math.abs(q);if(0<A){j.reportCollisionVsWorld(o*A,l*A,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}else{if(w===0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(w*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var A=j.radius-v;if(0<A){if(v===0){i=c/Math.SQRT2;g=w/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*A,g*A,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},projCircle_67DegB:function(e,d,c,z,j,k){var h=k.signx;var f=k.signy;if(c===0){if(z===0){var s;var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x+(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y-(f*k.yw));var q=(b*o)+(a*l);if(q<0){o*=-q;l*=-q;var u=Math.sqrt(o*o+l*l);if(e<d){s=e;d=0;if((j.pos.x-k.pos.x)<0){e*=-1}}else{s=d;e=0;if((j.pos.y-k.pos.y)<0){d*=-1}}if(s<u){j.reportCollisionVsWorld(e,d,e/s,d/s,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{j.reportCollisionVsWorld(o,l,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}else{if((f*z)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var b=j.pos.x-k.pos.x;var a=j.pos.y-(k.pos.y+(f*k.yw));if((b*h)<0){j.reportCollisionVsWorld(0,d*z,0,z,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var o=k.sx;var l=k.sy;var A=(b*-l)+(a*o);if(0<(A*h*f)){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,o,l,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}}}else{if(z===0){if((h*c)<0){j.reportCollisionVsWorld(e*c,0,c,0,k);return Phaser.Physics.Ninja.Circle.COL_AXIS}else{var w=Math.sqrt(2*2+1*1);var o=(h*2)/w;var l=(f*1)/w;var b=j.pos.x-(k.pos.x+(h*k.xw));var a=j.pos.y-(k.pos.y-(f*k.yw));var A=(b*-l)+(a*o);if((A*h*f)<0){var v=Math.sqrt(b*b+a*a);var B=j.radius-v;if(0<B){b/=v;a/=v;j.reportCollisionVsWorld(b*B,a*B,b,a,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}else{var q=(b*o)+(a*l);var B=j.radius-Math.abs(q);if(0<B){j.reportCollisionVsWorld(o*B,l*B,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}else{if(0<((h*c)+(f*z))){var o=k.sx;var l=k.sy;var m=j.radius;var b=(j.pos.x-(o*m))-(k.pos.x+(h*k.xw));var a=(j.pos.y-(l*m))-(k.pos.y-(f*k.yw));var q=(b*o)+(a*l);if(q<0){j.reportCollisionVsWorld(-o*q,-l*q,k.sx,k.sy,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}return Phaser.Physics.Ninja.Circle.COL_NONE}else{var p=k.pos.x+(c*k.xw);var n=k.pos.y+(z*k.yw);var i=j.pos.x-p;var g=j.pos.y-n;var v=Math.sqrt(i*i+g*g);var B=j.radius-v;if(0<B){if(v===0){i=c/Math.SQRT2;g=z/Math.SQRT2}else{i/=v;g/=v}j.reportCollisionVsWorld(i*B,g*B,i,g,k);return Phaser.Physics.Ninja.Circle.COL_OTHER}}}}return Phaser.Physics.Ninja.Circle.COL_NONE},destroy:function(){this.body=null;this.system=null}};!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("p2",(function(){return this.p2=a()})()):"undefined"!=typeof window?window.p2=a():"undefined"!=typeof global?self.p2=a():"undefined"!=typeof self&&(self.p2=a())}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,i,f){if(!e){var e=0.000001}if(!k){var k=(typeof Float32Array!=="undefined")?Float32Array:Array}var g={};g.setMatrixArrayType=function(l){k=l};if(typeof(f)!=="undefined"){f.glMatrix=g}var j={};j.create=function(){var l=new k(2);l[0]=0;l[1]=0;return l};j.clone=function(l){var m=new k(2);m[0]=l[0];m[1]=l[1];return m};j.fromValues=function(l,n){var m=new k(2);m[0]=l;m[1]=n;return m};j.copy=function(m,l){m[0]=l[0];m[1]=l[1];return m};j.set=function(m,l,n){m[0]=l;m[1]=n;return m};j.add=function(n,m,l){n[0]=m[0]+l[0];n[1]=m[1]+l[1];return n};j.subtract=function(n,m,l){n[0]=m[0]-l[0];n[1]=m[1]-l[1];return n};j.sub=j.subtract;j.multiply=function(n,m,l){n[0]=m[0]*l[0];n[1]=m[1]*l[1];return n};j.mul=j.multiply;j.divide=function(n,m,l){n[0]=m[0]/l[0];n[1]=m[1]/l[1];return n};j.div=j.divide;j.min=function(n,m,l){n[0]=Math.min(m[0],l[0]);n[1]=Math.min(m[1],l[1]);return n};j.max=function(n,m,l){n[0]=Math.max(m[0],l[0]);n[1]=Math.max(m[1],l[1]);return n};j.scale=function(n,m,l){n[0]=m[0]*l;n[1]=m[1]*l;return n};j.distance=function(n,m){var l=m[0]-n[0],o=m[1]-n[1];return Math.sqrt(l*l+o*o)};j.dist=j.distance;j.squaredDistance=function(n,m){var l=m[0]-n[0],o=m[1]-n[1];return l*l+o*o};j.sqrDist=j.squaredDistance;j.length=function(m){var l=m[0],n=m[1];return Math.sqrt(l*l+n*n)};j.len=j.length;j.squaredLength=function(m){var l=m[0],n=m[1];return l*l+n*n};j.sqrLen=j.squaredLength;j.negate=function(m,l){m[0]=-l[0];m[1]=-l[1];return m};j.normalize=function(o,n){var m=n[0],p=n[1];var l=m*m+p*p;if(l>0){l=1/Math.sqrt(l);o[0]=n[0]*l;o[1]=n[1]*l}return o};j.dot=function(m,l){return m[0]*l[0]+m[1]*l[1]};j.cross=function(n,m,l){var o=m[0]*l[1]-m[1]*l[0];n[0]=n[1]=0;n[2]=o;return n};j.lerp=function(n,m,l,o){var q=m[0],p=m[1];n[0]=q+o*(l[0]-q);n[1]=p+o*(l[1]-p);return n};j.transformMat2=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[2]*q;p[1]=n[1]*l+n[3]*q;return p};j.transformMat2d=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[2]*q+n[4];p[1]=n[1]*l+n[3]*q+n[5];return p};j.transformMat3=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[3]*q+n[6];p[1]=n[1]*l+n[4]*q+n[7];return p};j.transformMat4=function(p,o,n){var l=o[0],q=o[1];p[0]=n[0]*l+n[4]*q+n[12];p[1]=n[1]*l+n[5]*q+n[13];return p};j.forEach=(function(){var l=j.create();return function(o,s,t,r,q,m){var p,n;if(!s){s=2}if(!t){t=0}if(r){n=Math.min((r*s)+t,o.length)}else{n=o.length}for(p=t;p<n;p+=s){l[0]=o[p];l[1]=o[p+1];q(l,l,m);o[p]=l[0];o[p+1]=l[1]}return o}})();j.str=function(l){return"vec2("+l[0]+", "+l[1]+")"};if(typeof(f)!=="undefined"){f.vec2=j}},{}],2:[function(g,h,f){var e=g("./Scalar");h.exports=i;function i(){}i.lineInt=function(m,l,q){q=q||0;var p=[0,0];var k,t,o,j,s,n,r;k=m[1][1]-m[0][1];t=m[0][0]-m[1][0];o=k*m[0][0]+t*m[0][1];j=l[1][1]-l[0][1];s=l[0][0]-l[1][0];n=j*l[0][0]+s*l[0][1];r=k*s-j*t;if(!e.eq(r,0,q)){p[0]=(s*o-t*n)/r;p[1]=(k*n-j*o)/r}return p};i.segmentsIntersect=function(m,l,k,j){var u=l[0]-m[0];var p=l[1]-m[1];var r=j[0]-k[0];var o=j[1]-k[1];if(r*p-o*u==0){return false}var q=(u*(k[1]-m[1])+p*(m[0]-k[0]))/(r*p-o*u);var n=(r*(m[1]-k[1])+o*(k[0]-m[0]))/(o*u-r*p);return(q>=0&&q<=1&&n>=0&&n<=1)}},{"./Scalar":5}],3:[function(h,i,g){i.exports=j;function j(){}j.area=function(l,k,m){return(((k[0]-l[0])*(m[1]-l[1]))-((m[0]-l[0])*(k[1]-l[1])))};j.left=function(l,k,m){return j.area(l,k,m)>0};j.leftOn=function(l,k,m){return j.area(l,k,m)>=0};j.right=function(l,k,m){return j.area(l,k,m)<0};j.rightOn=function(l,k,m){return j.area(l,k,m)<=0};var f=[],e=[];j.collinear=function(q,p,n,o){if(!o){return j.area(q,p,n)==0}else{var t=f,m=e;t[0]=p[0]-q[0];t[1]=p[1]-q[1];m[0]=n[0]-p[0];m[1]=n[1]-p[1];var k=t[0]*m[0]+t[1]*m[1],s=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=Math.sqrt(m[0]*m[0]+m[1]*m[1]),l=Math.acos(k/(s*r));return l<o}};j.sqdist=function(m,k){var n=k[0]-m[0];var l=k[1]-m[1];return n*n+l*l}},{}],4:[function(h,e,j){var i=h("./Line"),n=h("./Point"),k=h("./Scalar");e.exports=l;function l(){this.vertices=[]}l.prototype.at=function(p){var o=this.vertices,q=o.length;return o[p<0?p%q+q:p%q]};l.prototype.first=function(){return this.vertices[0]};l.prototype.last=function(){return this.vertices[this.vertices.length-1]};l.prototype.clear=function(){this.vertices.length=0};l.prototype.append=function(p,r,q){if(typeof(r)=="undefined"){throw new Error("From is not given!")}if(typeof(q)=="undefined"){throw new Error("To is not given!")}if(q-1<r){throw new Error("lol1")}if(q>p.vertices.length){throw new Error("lol2")}if(r<0){throw new Error("lol3")}for(var o=r;o<q;o++){this.vertices.push(p.vertices[o])}};l.prototype.makeCCW=function(){var q=0,o=this.vertices;for(var p=1;p<this.vertices.length;++p){if(o[p][1]<o[q][1]||(o[p][1]==o[q][1]&&o[p][0]>o[q][0])){q=p}}if(!n.left(this.at(q-1),this.at(q),this.at(q+1))){this.reverse()}};l.prototype.reverse=function(){var p=[];for(var o=0,q=this.vertices.length;o!==q;o++){p.push(this.vertices.pop())}this.vertices=p};l.prototype.isReflex=function(o){return n.right(this.at(o-1),this.at(o),this.at(o+1))};var g=[],f=[];l.prototype.canSee=function(s,q){var u,v,r=g,o=f;if(n.leftOn(this.at(s+1),this.at(s),this.at(q))&&n.rightOn(this.at(s-1),this.at(s),this.at(q))){return false}v=n.sqdist(this.at(s),this.at(q));for(var t=0;t!==this.vertices.length;++t){if((t+1)%this.vertices.length===s||t===s){continue}if(n.leftOn(this.at(s),this.at(q),this.at(t+1))&&n.rightOn(this.at(s),this.at(q),this.at(t))){r[0]=this.at(s);r[1]=this.at(q);o[0]=this.at(t);o[1]=this.at(t+1);u=i.lineInt(r,o);if(n.sqdist(this.at(s),u)<v){return false}}}return true};l.prototype.copy=function(r,q,t){var s=t||new l();s.clear();if(r<q){for(var o=r;o<=q;o++){s.vertices.push(this.vertices[o])}}else{for(var o=0;o<=q;o++){s.vertices.push(this.vertices[o])}for(var o=r;o<this.vertices.length;o++){s.vertices.push(this.vertices[o])}}return s};l.prototype.getCutEdges=function(){var r=[],v=[],s=[],u=new l();var t=Number.MAX_VALUE;for(var q=0;q<this.vertices.length;++q){if(this.isReflex(q)){for(var p=0;p<this.vertices.length;++p){if(this.canSee(q,p)){v=this.copy(q,p,u).getCutEdges();s=this.copy(p,q,u).getCutEdges();for(var o=0;o<s.length;o++){v.push(s[o])}if(v.length<t){r=v;t=v.length;r.push([this.at(q),this.at(p)])}}}}}return r};l.prototype.decomp=function(){var o=this.getCutEdges();if(o.length>0){return this.slice(o)}else{return[this]}};l.prototype.slice=function(q){if(q.length==0){return[this]}if(q instanceof Array&&q.length&&q[0] instanceof Array&&q[0].length==2&&q[0][0] instanceof Array){var p=[this];for(var s=0;s<q.length;s++){var t=q[s];for(var r=0;r<p.length;r++){var u=p[r];var o=u.slice(t);if(o){p.splice(r,1);p.push(o[0],o[1]);break}}}return p}else{var t=q;var s=this.vertices.indexOf(t[0]);var r=this.vertices.indexOf(t[1]);if(s!=-1&&r!=-1){return[this.copy(s,r),this.copy(r,s)]}else{return false}}};l.prototype.isSimple=function(){var q=this.vertices;for(var p=0;p<q.length-1;p++){for(var o=0;o<p-1;o++){if(i.segmentsIntersect(q[p],q[p+1],q[o],q[o+1])){return false}}}for(var p=1;p<q.length-2;p++){if(i.segmentsIntersect(q[0],q[q.length-1],q[p],q[p+1])){return false}}return true};function m(z,y,u,s,x){x=x||0;var p=y[1]-z[1];var w=z[0]-y[0];var r=(p*z[0])+(w*z[1]);var o=s[1]-u[1];var v=u[0]-s[0];var q=(o*u[0])+(v*u[1]);var t=(p*v)-(o*w);if(!k.eq(t,0,x)){return[((v*r)-(w*q))/t,((p*q)-(o*r))/t]}else{return[0,0]}}l.prototype.quickDecomp=function(y,u,x,K,L,q){L=L||100;q=q||0;K=K||25;y=typeof(y)!="undefined"?y:[];u=u||[];x=x||[];var D=[0,0],o=[0,0],C=[0,0];var A=0,H=0,J=0,s=0;var E=0,B=0,I=0;var w=new l(),r=new l();var t=this,z=this.vertices;if(z.length<3){return y}q++;if(q>L){console.warn("quickDecomp: max level ("+L+") reached.");return y}for(var G=0;G<this.vertices.length;++G){if(t.isReflex(G)){u.push(t.vertices[G]);A=H=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F){if(n.left(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G-1),t.at(G),t.at(F-1))){C=m(t.at(G-1),t.at(G),t.at(F),t.at(F-1));if(n.right(t.at(G+1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<H){H=J;o=C;B=F}}}if(n.left(t.at(G+1),t.at(G),t.at(F+1))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){C=m(t.at(G+1),t.at(G),t.at(F),t.at(F+1));if(n.left(t.at(G-1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<A){A=J;D=C;E=F}}}}if(B==(E+1)%this.vertices.length){C[0]=(o[0]+D[0])/2;C[1]=(o[1]+D[1])/2;x.push(C);if(G<E){w.append(t,G,E+1);w.vertices.push(C);r.vertices.push(C);if(B!=0){r.append(t,B,t.vertices.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,t.vertices.length)}w.append(t,0,E+1);w.vertices.push(C);r.vertices.push(C);r.append(t,B,G+1)}}else{if(B>E){E+=this.vertices.length}s=Number.MAX_VALUE;if(E<B){return y}for(var F=B;F<=E;++F){if(n.leftOn(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){J=n.sqdist(t.at(G),t.at(F));if(J<s){s=J;I=F%this.vertices.length}}}if(G<I){w.append(t,G,I+1);if(I!=0){r.append(t,I,z.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,z.length)}w.append(t,0,I+1);r.append(t,I,G+1)}}if(w.vertices.length<r.vertices.length){w.quickDecomp(y,u,x,K,L,q);r.quickDecomp(y,u,x,K,L,q)}else{r.quickDecomp(y,u,x,K,L,q);w.quickDecomp(y,u,x,K,L,q)}return y}}y.push(this);return y};l.prototype.removeCollinearPoints=function(o){var p=0;for(var q=this.vertices.length-1;this.vertices.length>3&&q>=0;--q){if(n.collinear(this.at(q-1),this.at(q),this.at(q+1),o)){this.vertices.splice(q%this.vertices.length,1);q--;p++}}return p}},{"./Line":2,"./Point":3,"./Scalar":5}],5:[function(g,h,f){h.exports=e;function e(){}e.eq=function(k,i,j){j=j||0;return Math.abs(k-i)<j}},{}],6:[function(f,g,e){g.exports={Polygon:f("./Polygon"),Point:f("./Point"),}},{"./Point":3,"./Polygon":4}],7:[function(f,g,e){g.exports={name:"p2",version:"0.5.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","z-schema":"~2.4.6"},dependencies:{"poly-decomp":"0.1.0","gl-matrix":"2.1.0"}}},{}],8:[function(f,h,e){var i=f("../math/vec2"),k=f("../utils/Utils");h.exports=j;function j(l){this.lowerBound=i.create();if(l&&l.lowerBound){i.copy(this.lowerBound,l.lowerBound)}this.upperBound=i.create();if(l&&l.upperBound){i.copy(this.upperBound,l.upperBound)}}var g=i.create();j.prototype.setFromPoints=function(s,m,v){var n=this.lowerBound,q=this.upperBound;i.set(n,Number.MAX_VALUE,Number.MAX_VALUE);i.set(q,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<s.length;r++){var t=s[r];if(typeof(v)==="number"){i.rotate(g,t,v);t=g}for(var o=0;o<2;o++){if(t[o]>q[o]){q[o]=t[o]}if(t[o]<n[o]){n[o]=t[o]}}}if(m){i.add(this.lowerBound,this.lowerBound,m);i.add(this.upperBound,this.upperBound,m)}};j.prototype.copy=function(l){i.copy(this.lowerBound,l.lowerBound);i.copy(this.upperBound,l.upperBound)};j.prototype.extend=function(l){for(var m=0;m<2;m++){if(l.lowerBound[m]<this.lowerBound[m]){this.lowerBound[m]=l.lowerBound[m]}if(l.upperBound[m]>this.upperBound[m]){this.upperBound[m]=l.upperBound[m]}}};j.prototype.overlaps=function(n){var m=this.lowerBound,p=this.upperBound,l=n.lowerBound,o=n.upperBound;return((l[0]<=p[0]&&p[0]<=o[0])||(m[0]<=o[0]&&o[0]<=p[0]))&&((l[1]<=p[1]&&p[1]<=o[1])||(m[1]<=o[1]&&o[1]<=p[1]))}},{"../math/vec2":30,"../utils/Utils":47}],9:[function(g,h,f){var i=g("../math/vec2");var j=g("../objects/Body");h.exports=e;function e(l){this.type=l;this.result=[];this.world=null;this.boundingVolumeType=e.AABB}e.AABB=1;e.BOUNDING_CIRCLE=2;e.prototype.setWorld=function(l){this.world=l};e.prototype.getCollisionPairs=function(l){throw new Error("getCollisionPairs must be implemented in a subclass!")};var k=i.create();e.boundingRadiusCheck=function(o,n){i.sub(k,o.position,n.position);var m=i.squaredLength(k),l=o.boundingRadius+n.boundingRadius;return m<=l*l};e.aabbCheck=function(m,l){if(m.aabbNeedsUpdate){m.updateAABB()}if(l.aabbNeedsUpdate){l.updateAABB()}return m.aabb.overlaps(l.aabb)};e.prototype.boundingVolumeCheck=function(n,m){var l;switch(this.boundingVolumeType){case e.BOUNDING_CIRCLE:l=e.boundingRadiusCheck(n,m);break;case e.AABB:l=e.aabbCheck(n,m);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return l};e.canCollide=function(m,l){if(m.motionState===j.STATIC&&l.motionState===j.STATIC){return false}if((m.motionState===j.KINEMATIC&&l.motionState===j.STATIC)||(m.motionState===j.STATIC&&l.motionState===j.KINEMATIC)){return false}if(m.motionState===j.KINEMATIC&&l.motionState===j.KINEMATIC){return false}if(m.sleepState===j.SLEEPING&&l.sleepState===j.SLEEPING){return false}if((m.sleepState===j.SLEEPING&&l.motionState===j.STATIC)||(l.sleepState===j.SLEEPING&&m.motionState===j.STATIC)){return false}return true};e.NAIVE=1;e.SAP=2},{"../math/vec2":30,"../objects/Body":31}],10:[function(g,f,j){var e=g("../shapes/Circle"),h=g("../shapes/Plane"),i=g("../shapes/Particle"),m=g("../collision/Broadphase"),k=g("../math/vec2"),l=g("../utils/Utils");f.exports=n;function n(o){m.apply(this);o=l.defaults(o,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=o.xmin;this.ymin=o.ymin;this.xmax=o.xmax;this.ymax=o.ymax;this.nx=o.nx;this.ny=o.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}n.prototype=new m();n.prototype.getCollisionPairs=function(G){var y=[],w=G.bodies,u=w.length,M=this.binsizeX,K=this.binsizeY,S=this.nx,R=this.ny,A=this.xmin,J=this.ymin,F=this.xmax,O=this.ymax;var H=[],P=S*R;for(var N=0;N<P;N++){H.push([])}var v=S/(F-A);var T=R/(O-J);for(var N=0;N!==u;N++){var r=w[N];var x=r.aabb;var t=Math.max(x.lowerBound[0],A);var s=Math.max(x.lowerBound[1],J);var W=Math.min(x.upperBound[0],F);var V=Math.min(x.upperBound[1],O);var p=Math.floor(v*(t-A));var E=Math.floor(T*(s-J));var o=Math.floor(v*(W-A));var D=Math.floor(T*(V-J));for(var L=p;L<=o;L++){for(var I=E;I<=D;I++){var C=L;var U=I;var z=C*(R-1)+U;if(z>=0&&z<P){H[z].push(r)}}}}for(var N=0;N!==P;N++){var B=H[N];for(var L=0,Q=B.length;L!==Q;L++){var r=B[L];for(var I=0;I!==L;I++){var q=B[I];if(m.canCollide(r,q)&&this.boundingVolumeCheck(r,q)){y.push(r,q)}}}}return y}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../utils/Utils":47}],11:[function(g,f,k){var e=g("../shapes/Circle"),h=g("../shapes/Plane"),j=g("../shapes/Shape"),i=g("../shapes/Particle"),m=g("../collision/Broadphase"),l=g("../math/vec2");f.exports=n;function n(){m.call(this,m.NAIVE)}n.prototype=new m();n.prototype.getCollisionPairs=function(v){var r=v.bodies,o=this.result;o.length=0;for(var u=0,t=r.length;u!==t;u++){var q=r[u];for(var s=0;s<u;s++){var p=r[s];if(m.canCollide(q,p)&&this.boundingVolumeCheck(q,p)){o.push(q,p)}}}return o}},{"../collision/Broadphase":9,"../math/vec2":30,"../shapes/Circle":35,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Shape":42}],12:[function(ap,aA,P){var ah=ap("../math/vec2"),ar=ah.sub,t=ah.add,y=ah.dot,ai=ap("../utils/Utils"),f=ap("../utils/TupleDictionary"),h=ap("../equations/Equation"),ax=ap("../equations/ContactEquation"),ag=ap("../equations/FrictionEquation"),af=ap("../shapes/Circle"),am=ap("../shapes/Convex"),M=ap("../shapes/Shape"),O=ap("../objects/Body"),J=ap("../shapes/Rectangle");aA.exports=av;var U=ah.fromValues(0,1);var s=ah.fromValues(0,0),r=ah.fromValues(0,0),p=ah.fromValues(0,0),n=ah.fromValues(0,0),m=ah.fromValues(0,0),l=ah.fromValues(0,0),k=ah.fromValues(0,0),j=ah.fromValues(0,0),i=ah.fromValues(0,0),F=ah.fromValues(0,0),E=ah.fromValues(0,0),D=ah.fromValues(0,0),C=ah.fromValues(0,0),B=ah.fromValues(0,0),A=ah.fromValues(0,0),z=ah.fromValues(0,0),x=ah.fromValues(0,0),w=ah.fromValues(0,0),az=[];function av(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.slipForce=10;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.reuseObjects=true;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=h.DEFAULT_STIFFNESS;this.relaxation=h.DEFAULT_RELAXATION;this.frictionStiffness=h.DEFAULT_STIFFNESS;this.frictionRelaxation=h.DEFAULT_RELAXATION;this.collidingBodiesLastStep=new f()}av.prototype.collidedLastStep=function(aD,aC){var aF=aD.id|0,aE=aC.id|0;return !!this.collidingBodiesLastStep.get(aF,aE)};function v(aD){var aC=aD.keys.length;while(aC--){delete aD[aD.keys[aC]]}aD.keys.length=0}av.prototype.reset=function(aF){this.collidingBodiesLastStep.reset();for(var aE=0;aE!==this.contactEquations.length;aE++){var aK=this.contactEquations[aE],aI=aK.bodyA.id|0,aG=aK.bodyB.id|0;this.collidingBodiesLastStep.set(aI,aG,true)}if(this.reuseObjects){var aD=this.contactEquations,aC=this.frictionEquations,aH=this.reusableFrictionEquations,aJ=this.reusableContactEquations;ai.appendArray(aJ,aD);ai.appendArray(aH,aC)}this.contactEquations.length=this.frictionEquations.length=0};av.prototype.createContactEquation=function(aF,aE,aD,aC){var aG=this.reusableContactEquations.length?this.reusableContactEquations.pop():new ax(aF,aE);aG.bodyA=aF;aG.bodyB=aE;aG.shapeA=aD;aG.shapeB=aC;aG.restitution=this.restitution;aG.firstImpact=!this.collidedLastStep(aF,aE);aG.stiffness=this.stiffness;aG.relaxation=this.relaxation;aG.needsUpdate=true;aG.enabled=true;return aG};av.prototype.createFrictionEquation=function(aF,aE,aD,aC){var aG=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new ag(aF,aE);aG.bodyA=aF;aG.bodyB=aE;aG.shapeA=aD;aG.shapeB=aC;aG.setSlipForce(this.slipForce);aG.frictionCoefficient=this.frictionCoefficient;aG.relativeVelocity=this.surfaceVelocity;aG.enabled=true;aG.needsUpdate=true;aG.stiffness=this.frictionStiffness;aG.relaxation=this.frictionRelaxation;return aG};av.prototype.createFrictionFromContact=function(aD){var aC=this.createFrictionEquation(aD.bodyA,aD.bodyB,aD.shapeA,aD.shapeB);ah.copy(aC.contactPointA,aD.contactPointA);ah.copy(aC.contactPointB,aD.contactPointB);ah.rotate90cw(aC.t,aD.normalA);aC.contactEquation=aD;return aC};av.prototype[M.LINE|M.CONVEX]=av.prototype.convexLine=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};av.prototype[M.LINE|M.RECTANGLE]=av.prototype.lineRectangle=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};function L(aD,aC){ah.set(aD.vertices[0],-aC.length*0.5,-aC.radius);ah.set(aD.vertices[1],aC.length*0.5,-aC.radius);ah.set(aD.vertices[2],aC.length*0.5,aC.radius);ah.set(aD.vertices[3],-aC.length*0.5,aC.radius)}var g=new J(1,1),N=ah.create();av.prototype[M.CAPSULE|M.CONVEX]=av.prototype[M.CAPSULE|M.RECTANGLE]=av.prototype.convexCapsule=function(aH,aJ,aN,aO,aG,aI,aM,aL,aK){var aE=N;ah.set(aE,aI.length/2,0);ah.rotate(aE,aE,aL);ah.add(aE,aE,aM);var aF=this.circleConvex(aG,aI,aE,aL,aH,aJ,aN,aO,aK,aI.radius);ah.set(aE,-aI.length/2,0);ah.rotate(aE,aE,aL);ah.add(aE,aE,aM);var aD=this.circleConvex(aG,aI,aE,aL,aH,aJ,aN,aO,aK,aI.radius);if(aK&&(aF||aD)){return true}var aC=g;L(aC,aI);var aP=this.convexConvex(aH,aJ,aN,aO,aG,aC,aM,aL,aK);return aP+aF+aD};av.prototype[M.CAPSULE|M.LINE]=av.prototype.lineCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};var K=ah.create();var I=ah.create();var an=new J(1,1);av.prototype[M.CAPSULE|M.CAPSULE]=av.prototype.capsuleCapsule=function(aG,aS,aK,aO,aF,aR,aJ,aM,aH){var aQ=K,aP=I;var aT=0;for(var aN=0;aN<2;aN++){ah.set(aQ,(aN==0?-1:1)*aS.length/2,0);ah.rotate(aQ,aQ,aO);ah.add(aQ,aQ,aK);for(var aL=0;aL<2;aL++){ah.set(aP,(aL==0?-1:1)*aR.length/2,0);ah.rotate(aP,aP,aM);ah.add(aP,aP,aJ);var aI=this.circleCircle(aG,aS,aQ,aO,aF,aR,aP,aM,aH,aS.radius,aR.radius);if(aH&&aI){return true}aT+=aI}}var aE=an;L(aE,aS);var aD=this.convexCapsule(aG,aE,aK,aO,aF,aR,aJ,aM,aH);if(aH&&aD){return true}aT+=aD;L(aE,aR);var aC=this.convexCapsule(aF,aE,aJ,aM,aG,aS,aK,aO,aH);if(aH&&aC){return true}aT+=aC;return aT};av.prototype[M.LINE|M.LINE]=av.prototype.lineLine=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){if(aG){return false}else{return 0}};av.prototype[M.PLANE|M.LINE]=av.prototype.planeLine=function(aO,aR,aW,aN,aE,aL,aS,aF,aD){var aI=s,aG=r,aX=p,aJ=n,aH=m,aY=l,aP=k,aK=j,aC=i,aV=az;numContacts=0;ah.set(aI,-aL.length/2,0);ah.set(aG,aL.length/2,0);ah.rotate(aX,aI,aF);ah.rotate(aJ,aG,aF);t(aX,aX,aS);t(aJ,aJ,aS);ah.copy(aI,aX);ah.copy(aG,aJ);ar(aH,aG,aI);ah.normalize(aY,aH);ah.rotate90cw(aC,aY);ah.rotate(aK,U,aN);aV[0]=aI;aV[1]=aG;for(var aQ=0;aQ<aV.length;aQ++){var aM=aV[aQ];ar(aP,aM,aW);var aT=y(aP,aK);if(aT<0){if(aD){return true}var aU=this.createContactEquation(aO,aE,aR,aL);numContacts++;ah.copy(aU.normalA,aK);ah.normalize(aU.normalA,aU.normalA);ah.scale(aP,aK,aT);ar(aU.contactPointA,aM,aP);ar(aU.contactPointA,aU.contactPointA,aO.position);ar(aU.contactPointB,aM,aS);t(aU.contactPointB,aU.contactPointB,aS);ar(aU.contactPointB,aU.contactPointB,aE.position);this.contactEquations.push(aU);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aU))}}}return numContacts};av.prototype[M.PARTICLE|M.CAPSULE]=av.prototype.particleCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){return this.circleLine(aD,aF,aJ,aK,aC,aE,aI,aH,aG,aE.radius,0)};av.prototype[M.CIRCLE|M.LINE]=av.prototype.circleLine=function(bb,aR,aZ,aO,ba,aQ,aY,aM,aL,aP,aC){var a2=aQ,a3=aM,aK=ba,aN=aY,be=aZ,a8=bb,a6=aR,aP=aP||0,aC=typeof(aC)!="undefined"?aC:a6.radius,a4=s,aH=r,aI=p,aS=n,a0=m,aF=l,a5=k,aV=j,aU=i,aT=F,aJ=E,aG=D,aX=C,bf=B,a9=az;ah.set(aV,-a2.length/2,0);ah.set(aU,a2.length/2,0);ah.rotate(aT,aV,a3);ah.rotate(aJ,aU,a3);t(aT,aT,aN);t(aJ,aJ,aN);ah.copy(aV,aT);ah.copy(aU,aJ);ar(aF,aU,aV);ah.normalize(a5,aF);ah.rotate90cw(a0,a5);ar(aG,be,aV);var bc=y(aG,a0);ar(aS,aV,aN);ar(aX,be,aN);if(Math.abs(bc)<aC+aP){ah.scale(a4,a0,bc);ar(aI,be,a4);ah.scale(aH,a0,y(a0,aX));ah.normalize(aH,aH);ah.scale(aH,aH,aP);t(aI,aI,aH);var aW=y(a5,aI);var aE=y(a5,aV);var aD=y(a5,aU);if(aW>aE&&aW<aD){if(aL){return true}var bd=this.createContactEquation(a8,aK,aR,aQ);ah.scale(bd.normalA,a4,-1);ah.normalize(bd.normalA,bd.normalA);ah.scale(bd.contactPointA,bd.normalA,aC);t(bd.contactPointA,bd.contactPointA,be);ar(bd.contactPointA,bd.contactPointA,a8.position);ar(bd.contactPointB,aI,aN);t(bd.contactPointB,bd.contactPointB,aN);ar(bd.contactPointB,bd.contactPointB,aK.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}}a9[0]=aV;a9[1]=aU;for(var a7=0;a7<a9.length;a7++){var a1=a9[a7];ar(aG,a1,be);if(ah.squaredLength(aG)<(aC+aP)*(aC+aP)){if(aL){return true}var bd=this.createContactEquation(a8,aK,aR,aQ);ah.copy(bd.normalA,aG);ah.normalize(bd.normalA,bd.normalA);ah.scale(bd.contactPointA,bd.normalA,aC);t(bd.contactPointA,bd.contactPointA,be);ar(bd.contactPointA,bd.contactPointA,a8.position);ar(bd.contactPointB,a1,aN);ah.scale(bf,bd.normalA,-aP);t(bd.contactPointB,bd.contactPointB,bf);t(bd.contactPointB,bd.contactPointB,aN);ar(bd.contactPointB,bd.contactPointB,aK.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}}return 0};av.prototype[M.CIRCLE|M.CAPSULE]=av.prototype.circleCapsule=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){return this.circleLine(aD,aF,aJ,aK,aC,aE,aI,aH,aG,aE.radius)};av.prototype[M.CIRCLE|M.CONVEX]=av.prototype[M.CIRCLE|M.RECTANGLE]=av.prototype.circleConvex=function(be,aR,a3,aM,bd,aO,a1,aL,aJ,aC){var aZ=aO,a0=aL,aP=bd,aQ=a1,bh=a3,bc=be,a9=aR,aC=typeof(aC)=="number"?aC:a9.radius;var aV=s,aU=r,aD=p,a8=n,a5=m,aS=l,aY=k,a6=j,aH=i,aF=F,aI=E,ba=-1,aW=null,bf=D,a4=C,a7=B,aT=A,aX=z,aG=false,a2=Number.MAX_VALUE;var aK=0;verts=aZ.vertices;for(var bb=0;bb!==verts.length+1;bb++){var bl=verts[bb%verts.length],bk=verts[(bb+1)%verts.length];ah.rotate(aV,bl,a0);ah.rotate(aU,bk,a0);t(aV,aV,aQ);t(aU,aU,aQ);ar(aD,aU,aV);ah.normalize(a8,aD);ah.rotate90cw(a5,a8);ah.scale(a7,a5,-a9.radius);t(a7,a7,bh);if(e(a7,aZ,aQ,a0)){ah.sub(aT,aV,a7);var aN=Math.abs(ah.dot(aT,a5));if(aN<a2){ah.copy(aX,a7);a2=aN;ah.scale(a4,a5,aN);ah.add(a4,a4,a7);aG=true}}}if(aG){if(aJ){return true}var bg=this.createContactEquation(bc,aP,aR,aO);ah.sub(bg.normalA,aX,bh);ah.normalize(bg.normalA,bg.normalA);ah.scale(bg.contactPointA,bg.normalA,aC);t(bg.contactPointA,bg.contactPointA,bh);ar(bg.contactPointA,bg.contactPointA,bc.position);ar(bg.contactPointB,a4,aQ);t(bg.contactPointB,bg.contactPointB,aQ);ar(bg.contactPointB,bg.contactPointB,aP.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}return 1}if(aC>0){for(var bb=0;bb<verts.length;bb++){var aE=verts[bb];ah.rotate(aI,aE,a0);t(aI,aI,aQ);ar(aF,aI,bh);if(ah.squaredLength(aF)<aC*aC){if(aJ){return true}var bg=this.createContactEquation(bc,aP,aR,aO);ah.copy(bg.normalA,aF);ah.normalize(bg.normalA,bg.normalA);ah.scale(bg.contactPointA,bg.normalA,aC);t(bg.contactPointA,bg.contactPointA,bh);ar(bg.contactPointA,bg.contactPointA,bc.position);ar(bg.contactPointB,aI,aQ);t(bg.contactPointB,bg.contactPointB,aQ);ar(bg.contactPointB,bg.contactPointB,aP.position);this.contactEquations.push(bg);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bg))}return 1}}}return 0};var al=ah.create(),ak=ah.create(),ae=ah.create(),ad=ah.create();function e(aG,aC,aF,aM){var aJ=al,aI=ak,aE=ae,aD=ad,aP=aG,aO=aC.vertices,aK=null;for(var aH=0;aH!==aO.length+1;aH++){var aQ=aO[aH%aO.length],aN=aO[(aH+1)%aO.length];ah.rotate(aJ,aQ,aM);ah.rotate(aI,aN,aM);t(aJ,aJ,aF);t(aI,aI,aF);ar(aE,aJ,aP);ar(aD,aI,aP);var aL=ah.crossLength(aE,aD);if(aK===null){aK=aL}if(aL*aK<=0){return false}aK=aL}return true}av.prototype[M.PARTICLE|M.CONVEX]=av.prototype[M.PARTICLE|M.RECTANGLE]=av.prototype.particleConvex=function(bg,aR,a6,aK,bf,aO,a4,aJ,aH){var a1=aO,a2=aJ,aP=bf,aQ=a4,a0=a6,a3=bg,aZ=aR,aV=s,aU=r,aC=p,bb=n,a8=m,aS=l,bm=k,a9=j,aF=i,aD=F,aG=E,bc=-1,aX=null,bk=D,a7=C,aM=B,aL=A,ba=z,aT=x,aW=w,a5=Number.MAX_VALUE;var aI=0,aE=false,be=a1.vertices;if(!e(a0,a1,aQ,a2)){return 0}if(aH){return true}var aY=null;for(var bd=0;bd!==be.length+1;bd++){var bo=be[bd%be.length],bn=be[(bd+1)%be.length];ah.rotate(aV,bo,a2);ah.rotate(aU,bn,a2);t(aV,aV,aQ);t(aU,aU,aQ);ar(aC,aU,aV);ah.normalize(bb,aC);ah.rotate90cw(a8,bb);ar(aD,a0,aV);var bh=y(aD,a8);ar(aS,aV,aQ);ar(bm,a0,aQ);ah.sub(aT,aV,a0);var aN=Math.abs(ah.dot(aT,a8));if(aN<a5){a5=aN;ah.scale(a7,a8,aN);ah.add(a7,a7,a0);ah.copy(aW,a8);aE=true}}if(aE){var bl=this.createContactEquation(a3,aP,aR,aO);ah.scale(bl.normalA,aW,-1);ah.normalize(bl.normalA,bl.normalA);ah.set(bl.contactPointA,0,0);t(bl.contactPointA,bl.contactPointA,a0);ar(bl.contactPointA,bl.contactPointA,a3.position);ar(bl.contactPointB,a7,aQ);t(bl.contactPointB,bl.contactPointB,aQ);ar(bl.contactPointB,bl.contactPointB,aP.position);this.contactEquations.push(bl);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bl))}return 1}return 0};av.prototype[M.CIRCLE]=av.prototype.circleCircle=function(aE,aV,aL,aQ,aC,aU,aK,aP,aG,aS,aR){var aF=aE,aO=aV,aI=aL,aD=aC,aN=aU,aH=aK,aM=s,aS=aS||aO.radius,aR=aR||aN.radius;ar(aM,aL,aK);var aJ=aS+aR;if(ah.squaredLength(aM)>aJ*aJ){return 0}if(aG){return true}var aT=this.createContactEquation(aF,aD,aV,aU);ar(aT.normalA,aH,aI);ah.normalize(aT.normalA,aT.normalA);ah.scale(aT.contactPointA,aT.normalA,aS);ah.scale(aT.contactPointB,aT.normalA,-aR);t(aT.contactPointA,aT.contactPointA,aI);ar(aT.contactPointA,aT.contactPointA,aF.position);t(aT.contactPointB,aT.contactPointB,aH);ar(aT.contactPointB,aT.contactPointB,aD.position);this.contactEquations.push(aT);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aT))}return 1};av.prototype[M.PLANE|M.CONVEX]=av.prototype[M.PLANE|M.RECTANGLE]=av.prototype.planeConvex=function(aD,aX,aO,aS,aC,aW,aN,aR,aF){var aH=aC,a0=aN,aJ=aW,aE=aR,aM=aD,aT=aX,aZ=aO,aL=aS;var aG=s,aI=r,aP=p;var aY=0;ah.rotate(aI,U,aL);for(var aQ=0;aQ<aJ.vertices.length;aQ++){var aK=aJ.vertices[aQ];ah.rotate(aG,aK,aE);t(aG,aG,a0);ar(aP,aG,aZ);if(y(aP,aI)<=av.convexPrecision){if(aF){return true}aY++;var aV=this.createContactEquation(aM,aH,aT,aJ);ar(aP,aG,aZ);ah.copy(aV.normalA,aI);var aU=y(aP,aV.normalA);ah.scale(aP,aV.normalA,aU);ar(aV.contactPointB,aG,aH.position);ar(aV.contactPointA,aG,aP);ar(aV.contactPointA,aV.contactPointA,aM.position);this.contactEquations.push(aV);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aV))}}}return aY};av.prototype.convexPlane=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){console.warn("Narrowphase.prototype.convexPlane is deprecated. Use planeConvex instead!");return this.planeConvex(aC,aE,aI,aH,aD,aF,aJ,aK,aG)};av.prototype[M.PARTICLE|M.PLANE]=av.prototype.particlePlane=function(aD,aU,aM,aP,aC,aT,aL,aO,aF){var aE=aD,aI=aU,aH=aM,aK=aC,aQ=aT,aV=aL,aJ=aO;var aN=s,aG=r;aJ=aJ||0;ar(aN,aH,aV);ah.rotate(aG,U,aJ);var aR=y(aN,aG);if(aR>0){return 0}if(aF){return true}var aS=this.createContactEquation(aK,aE,aT,aU);ah.copy(aS.normalA,aG);ah.scale(aN,aS.normalA,aR);ar(aS.contactPointA,aH,aN);ar(aS.contactPointA,aS.contactPointA,aK.position);ar(aS.contactPointB,aH,aE.position);this.contactEquations.push(aS);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aS))}return 1};av.prototype[M.CIRCLE|M.PARTICLE]=av.prototype.circleParticle=function(aE,aG,aP,aQ,aD,aF,aL,aK,aH){var aI=aE,aJ=aG,aO=aP,aS=aD,aR=aF,aC=aL,aN=s;ar(aN,aC,aO);if(ah.squaredLength(aN)>aJ.radius*aJ.radius){return 0}if(aH){return true}var aM=this.createContactEquation(aI,aS,aG,aF);ah.copy(aM.normalA,aN);ah.normalize(aM.normalA,aM.normalA);ah.scale(aM.contactPointA,aM.normalA,aJ.radius);t(aM.contactPointA,aM.contactPointA,aO);ar(aM.contactPointA,aM.contactPointA,aI.position);ar(aM.contactPointB,aC,aS.position);this.contactEquations.push(aM);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aM))}return 1};var aa=new af(1),au=ah.create(),at=ah.create(),aq=ah.create();av.prototype[M.PLANE|M.CAPSULE]=av.prototype.planeCapsule=function(aE,aG,aP,aQ,aD,aF,aM,aL,aH){var aK=au,aI=at,aC=aa,aO=aq;ah.set(aK,-aF.length/2,0);ah.rotate(aK,aK,aL);t(aK,aK,aM);ah.set(aI,aF.length/2,0);ah.rotate(aI,aI,aL);t(aI,aI,aM);aC.radius=aF.radius;var aN=this.circlePlane(aD,aC,aK,0,aE,aG,aP,aQ,aH),aJ=this.circlePlane(aD,aC,aI,0,aE,aG,aP,aQ,aH);if(aH){return aN||aJ}else{return aN+aJ}};av.prototype.capsulePlane=function(aD,aF,aJ,aK,aC,aE,aI,aH,aG){console.warn("Narrowphase.prototype.capsulePlane() is deprecated. Use .planeCapsule() instead!");return this.planeCapsule(aC,aE,aI,aH,aD,aF,aJ,aK,aG)};av.prototype[M.CIRCLE|M.PLANE]=av.prototype.circlePlane=function(aF,aV,aN,aR,aD,aU,aM,aQ,aG){var aI=aF,aC=aV,aE=aN,aL=aD,aO=aU,aW=aM,aK=aQ;aK=aK||0;var aH=s,aJ=r,aT=p;ar(aH,aE,aW);ah.rotate(aJ,U,aK);var aS=y(aJ,aH);if(aS>aC.radius){return 0}if(aG){return true}var aP=this.createContactEquation(aL,aI,aU,aV);ah.copy(aP.normalA,aJ);ah.scale(aP.contactPointB,aP.normalA,-aC.radius);t(aP.contactPointB,aP.contactPointB,aE);ar(aP.contactPointB,aP.contactPointB,aI.position);ah.scale(aT,aP.normalA,aS);ar(aP.contactPointA,aH,aT);t(aP.contactPointA,aP.contactPointA,aW);ar(aP.contactPointA,aP.contactPointA,aL.position);this.contactEquations.push(aP);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aP))}return 1};av.convexPrecision=1e-7;av.prototype[M.CONVEX]=av.prototype[M.CONVEX|M.RECTANGLE]=av.prototype[M.RECTANGLE]=av.prototype.convexConvex=function(a9,aW,a2,aT,a8,aU,a1,aS,aR,ba){var aD=s,aQ=r,aP=p,aO=n,aI=m,aL=l,aY=k,aJ=j,aZ=i,a0=0,ba=ba||av.convexPrecision;var aK=av.findSeparatingAxis(aW,a2,aT,aU,a1,aS,aD);if(!aK){return 0}ar(aJ,a1,a2);if(y(aD,aJ)>0){ah.scale(aD,aD,-1)}var aX=av.getClosestEdge(aW,aT,aD,true),aV=av.getClosestEdge(aU,aS,aD);if(aX===-1||aV===-1){return 0}for(var a5=0;a5<2;a5++){var aN=aX,aM=aV,aH=aW,aF=aU,bg=a2,be=a1,aG=aT,aE=aS,bk=a9,bh=a8;if(a5===0){var a4;a4=aN;aN=aM;aM=a4;a4=aH;aH=aF;aF=a4;a4=bg;bg=be;be=a4;a4=aG;aG=aE;aE=a4;a4=bk;bk=bh;bh=a4}for(var a6=aM;a6<aM+2;a6++){var a3=aF.vertices[(a6+aF.vertices.length)%aF.vertices.length];ah.rotate(aQ,a3,aE);t(aQ,aQ,be);var aC=0;for(var a7=aN-1;a7<aN+2;a7++){var bf=aH.vertices[(a7+aH.vertices.length)%aH.vertices.length],bd=aH.vertices[(a7+1+aH.vertices.length)%aH.vertices.length];ah.rotate(aP,bf,aG);ah.rotate(aO,bd,aG);t(aP,aP,bg);t(aO,aO,bg);ar(aI,aO,aP);ah.rotate90cw(aZ,aI);ah.normalize(aZ,aZ);ar(aJ,aQ,aP);var bb=y(aZ,aJ);if(bb<=ba){aC++}}if(aC>=3){if(aR){return true}var bc=this.createContactEquation(bk,bh,aH,aF);a0++;var bf=aH.vertices[(aN)%aH.vertices.length],bd=aH.vertices[(aN+1)%aH.vertices.length];ah.rotate(aP,bf,aG);ah.rotate(aO,bd,aG);t(aP,aP,bg);t(aO,aO,bg);ar(aI,aO,aP);ah.rotate90cw(bc.normalA,aI);ah.normalize(bc.normalA,bc.normalA);ar(aJ,aQ,aP);var bb=y(bc.normalA,aJ);ah.scale(aY,bc.normalA,bb);ar(bc.contactPointA,aQ,bg);ar(bc.contactPointA,bc.contactPointA,aY);t(bc.contactPointA,bc.contactPointA,bg);ar(bc.contactPointA,bc.contactPointA,bk.position);ar(bc.contactPointB,aQ,be);t(bc.contactPointB,bc.contactPointB,be);ar(bc.contactPointB,bc.contactPointB,bh.position);this.contactEquations.push(bc);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bc))}}}}return a0};var G=ah.fromValues(0,0);av.projectConvexOntoAxis=function(aC,aE,aK,aH,aO){var aJ=null,aF=null,aM,aL,aI=G;ah.rotate(aI,aH,-aK);for(var aG=0;aG<aC.vertices.length;aG++){aM=aC.vertices[aG];aL=y(aM,aI);if(aJ===null||aL>aJ){aJ=aL}if(aF===null||aL<aF){aF=aL}}if(aF>aJ){var aN=aF;aF=aJ;aJ=aN}var aD=y(aE,aH);ah.set(aO,aF+aD,aJ+aD)};var ab=ah.fromValues(0,0),Z=ah.fromValues(0,0),X=ah.fromValues(0,0),W=ah.fromValues(0,0),V=ah.fromValues(0,0),T=ah.fromValues(0,0);av.findSeparatingAxis=function(aM,aP,aE,aK,aN,aD,aW){var aF=null,aC=false,aH=false,aG=ab,aJ=Z,aI=X,aZ=W,aQ=V,aO=T;for(var aR=0;aR!==2;aR++){var aU=aM,aT=aE;if(aR===1){aU=aK;aT=aD}for(var aS=0;aS!==aU.vertices.length;aS++){ah.rotate(aJ,aU.vertices[aS],aT);ah.rotate(aI,aU.vertices[(aS+1)%aU.vertices.length],aT);ar(aG,aI,aJ);ah.rotate90cw(aZ,aG);ah.normalize(aZ,aZ);av.projectConvexOntoAxis(aM,aP,aE,aZ,aQ);av.projectConvexOntoAxis(aK,aN,aD,aZ,aO);var aY=aQ,aV=aO,aX=false;if(aQ[0]>aO[0]){aV=aQ;aY=aO;aX=true}var aL=aV[0]-aY[1];aC=(aL<=av.convexPrecision);if(aF===null||aL>aF){ah.copy(aW,aZ);aF=aL;aH=aC}}}return aH};var S=ah.fromValues(0,0),R=ah.fromValues(0,0),Q=ah.fromValues(0,0);av.getClosestEdge=function(aM,aE,aD,aH){var aI=S,aC=R,aK=Q;ah.rotate(aI,aD,-aE);if(aH){ah.scale(aI,aI,-1)}var aF=-1,aJ=aM.vertices.length;for(var aG=0;aG!==aJ;aG++){ar(aC,aM.vertices[(aG+1)%aJ],aM.vertices[aG%aJ]);ah.rotate90cw(aK,aC);ah.normalize(aK,aK);var aL=y(aK,aI);if(aF==-1||aL>maxDot){aF=aG%aJ;maxDot=aL}}return aF};var aj=ah.create(),ao=ah.create(),q=ah.create(),o=ah.create(),aB=ah.create(),H=ah.create(),ac=ah.create();av.prototype[M.CIRCLE|M.HEIGHTFIELD]=av.prototype.circleHeightfield=function(aI,aC,aS,aY,aL,aT,a1,aK,aF,aG){var a2=aT.data,aG=aG||aC.radius,aQ=aT.elementWidth,aU=ao,aJ=aj,aN=aB,aH=ac,aM=H,aE=q,aD=o;var aP=Math.floor((aS[0]-aG-a1[0])/aQ),aO=Math.ceil((aS[0]+aG-a1[0])/aQ);if(aP<0){aP=0}if(aO>=a2.length){aO=a2.length-1}var aX=a2[aP],aV=a2[aO];for(var aW=aP;aW<aO;aW++){if(a2[aW]<aV){aV=a2[aW]}if(a2[aW]>aX){aX=a2[aW]}}if(aS[1]-aG>aX){return aF?false:0}if(aS[1]+aG<aV){}var aR=false;for(var aW=aP;aW<aO;aW++){ah.set(aE,aW*aQ,a2[aW]);ah.set(aD,(aW+1)*aQ,a2[aW+1]);ah.add(aE,aE,a1);ah.add(aD,aD,a1);ah.sub(aM,aD,aE);ah.rotate(aM,aM,Math.PI/2);ah.normalize(aM,aM);ah.scale(aJ,aM,-aG);ah.add(aJ,aJ,aS);ah.sub(aU,aJ,aE);var aZ=ah.dot(aU,aM);if(aJ[0]>=aE[0]&&aJ[0]<aD[0]&&aZ<=0){if(aF){return true}aR=true;ah.scale(aU,aM,-aZ);ah.add(aN,aJ,aU);ah.copy(aH,aM);var a0=this.createContactEquation(aL,aI,aT,aC);ah.copy(a0.normalA,aH);ah.scale(a0.contactPointB,a0.normalA,-aG);t(a0.contactPointB,a0.contactPointB,aS);ar(a0.contactPointB,a0.contactPointB,aI.position);ah.copy(a0.contactPointA,aN);ah.sub(a0.contactPointA,a0.contactPointA,aL.position);this.contactEquations.push(a0);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a0))}}}aR=false;if(aG>0){for(var aW=aP;aW<=aO;aW++){ah.set(aE,aW*aQ,a2[aW]);ah.add(aE,aE,a1);ah.sub(aU,aS,aE);if(ah.squaredLength(aU)<aG*aG){if(aF){return true}aR=true;var a0=this.createContactEquation(aL,aI,aT,aC);ah.copy(a0.normalA,aU);ah.normalize(a0.normalA,a0.normalA);ah.scale(a0.contactPointB,a0.normalA,-aG);t(a0.contactPointB,a0.contactPointB,aS);ar(a0.contactPointB,a0.contactPointB,aI.position);ar(a0.contactPointA,aE,a1);t(a0.contactPointA,a0.contactPointA,a1);ar(a0.contactPointA,a0.contactPointA,aL.position);this.contactEquations.push(a0);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a0))}}}}if(aR){return 1}return 0};var ay=ah.create(),aw=ah.create(),Y=ah.create(),u=new am([ah.create(),ah.create(),ah.create(),ah.create()]);av.prototype[M.RECTANGLE|M.HEIGHTFIELD]=av.prototype[M.CONVEX|M.HEIGHTFIELD]=av.prototype.convexHeightfield=function(aH,aN,aG,aE,aJ,aQ,aW,aI,aF){var aX=aQ.data,aO=aQ.elementWidth,aD=ay,aC=aw,aR=Y,aV=u;var aM=Math.floor((aH.aabb.lowerBound[0]-aW[0])/aO),aL=Math.ceil((aH.aabb.upperBound[0]-aW[0])/aO);if(aM<0){aM=0}if(aL>=aX.length){aL=aX.length-1}var aU=aX[aM],aS=aX[aL];for(var aT=aM;aT<aL;aT++){if(aX[aT]<aS){aS=aX[aT]}if(aX[aT]>aU){aU=aX[aT]}}if(aH.aabb.lowerBound[1]>aU){return aF?false:0}var aP=false;var aY=0;for(var aT=aM;aT<aL;aT++){ah.set(aD,aT*aO,aX[aT]);ah.set(aC,(aT+1)*aO,aX[aT+1]);ah.add(aD,aD,aW);ah.add(aC,aC,aW);var aK=100;ah.set(aR,(aC[0]+aD[0])*0.5,(aC[1]+aD[1]-aK)*0.5);ah.sub(aV.vertices[0],aC,aR);ah.sub(aV.vertices[1],aD,aR);ah.copy(aV.vertices[2],aV.vertices[1]);ah.copy(aV.vertices[3],aV.vertices[0]);aV.vertices[2][1]-=aK;aV.vertices[3][1]-=aK;aY+=this.convexConvex(aH,aN,aG,aE,aJ,aV,aR,0,aF)}return aY}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Rectangle":41,"../shapes/Shape":42,"../utils/TupleDictionary":46,"../utils/Utils":47}],13:[function(g,h,f){var j=g("../utils/Utils"),e=g("../collision/Broadphase");h.exports=i;function i(){e.call(this,e.SAP);this.axisList=[];this.world=null;this.axisIndex=0;var k=this.axisList;this._addBodyHandler=function(l){k.push(l.body)};this._removeBodyHandler=function(m){var l=k.indexOf(m.body);if(l!==-1){k.splice(l,1)}}}i.prototype=new e();i.prototype.setWorld=function(k){this.axisList.length=0;j.appendArray(this.axisList,k.bodies);k.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);k.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=k};i.sortAxisList=function(m,q){q=q|0;for(var p=1,k=m.length;p<k;p++){var n=m[p];for(var o=p-1;o>=0;o--){if(m[o].aabb.lowerBound[q]<=n.aabb.lowerBound[q]){break}m[o+1]=m[o]}m[o+1]=n}return m};i.prototype.getCollisionPairs=function(s){var k=this.axisList,w=this.result,v=this.axisIndex;w.length=0;var o=k.length;while(o--){var u=k[o];if(u.aabbNeedsUpdate){u.updateAABB()}}i.sortAxisList(k,v);for(var r=0,t=k.length|0;r!==t;r++){var p=k[r];for(var q=r+1;q<t;q++){var n=k[q];var m=(n.aabb.lowerBound[v]<=p.aabb.upperBound[v]);if(!m){break}if(e.canCollide(p,n)&&this.boundingVolumeCheck(p,n)){w.push(p,n)}}}return w}},{"../collision/Broadphase":9,"../utils/Utils":47}],14:[function(f,h,e){h.exports=g;var i=f("../utils/Utils");function g(m,l,k,j){this.type=k;j=i.defaults(j,{collideConnected:true,wakeUpBodies:true,});this.equations=[];this.bodyA=m;this.bodyB=l;this.collideConnected=j.collideConnected;if(j.wakeUpBodies){if(m){m.wakeUp()}if(l){l.wakeUp()}}}g.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};g.DISTANCE=1;g.GEAR=2;g.LOCK=3;g.PRISMATIC=4;g.REVOLUTE=5;g.prototype.setStiffness=function(k){var l=this.equations;for(var m=0;m!==l.length;m++){var j=l[m];j.stiffness=k;j.needsUpdate=true}};g.prototype.setRelaxation=function(m){var k=this.equations;for(var l=0;l!==k.length;l++){var j=k[l];j.relaxation=m;j.needsUpdate=true}}},{"../utils/Utils":47}],15:[function(g,e,h){var o=g("./Constraint"),j=g("../equations/Equation"),i=g("../math/vec2");e.exports=m;function m(s,q,p,A){A=A||{};o.call(this,s,q,o.DISTANCE,A);this.distance=p;this.localAnchorA=i.create();this.localAnchorB=i.create();var w=this.localAnchorA;var u=this.localAnchorB;var z;if(typeof(A.maxForce)==="undefined"){z=Number.MAX_VALUE}else{z=A.maxForce}var v=new j(s,q,-z,z);this.equations=[v];var n=i.create();var y=i.create();var x=i.create();var t=this;v.computeGq=function(){var D=this.bodyA,C=this.bodyB,B=D.position,r=C.position;i.rotate(y,w,D.angle);i.rotate(x,u,C.angle);i.add(n,B,x);i.sub(n,n,y);i.sub(n,n,B);i.sub(n,C.position,D.position);return i.length(n)-t.distance};this.setMaxForce(z)}m.prototype=new o();var f=i.create();var l=i.create();var k=i.create();m.prototype.update=function(){var s=this.equations[0],q=this.bodyA,p=this.bodyB,n=this.distance,u=q.position,t=p.position,w=s.G;i.rotate(l,this.localAnchorA,q.angle);i.rotate(k,this.localAnchorB,p.angle);var r=i.crossLength(l,f),v=i.crossLength(k,f);i.sub(f,p.position,q.position);i.normalize(f,f);w[0]=-f[0];w[1]=-f[1];w[3]=f[0];w[4]=f[1]};m.prototype.setMaxForce=function(n){var p=this.equations[0];p.minForce=-n;p.maxForce=n};m.prototype.getMaxForce=function(n){var p=this.equations[0];return p.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],16:[function(f,h,e){var g=f("./Constraint"),j=f("../equations/Equation"),k=f("../equations/AngleLockEquation"),i=f("../math/vec2");h.exports=l;function l(o,n,m){m=m||{};g.call(this,o,n,g.GEAR,m);this.equations=[new k(o,n,m),];this.angle=typeof(m.angle)==="number"?m.angle:0;this.ratio=typeof(m.ratio)==="number"?m.ratio:1;if(typeof(m.maxTorque)==="number"){this.setMaxTorque(m.maxTorque)}}l.prototype=new g();l.prototype.update=function(){var m=this.equations[0];if(m.ratio!==this.ratio){m.setRatio(this.ratio)}m.angle=this.angle};l.prototype.setMaxTorque=function(m){this.equations[0].setMaxTorque(m)};l.prototype.getMaxTorque=function(m){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(i,h,k){var q=i("./Constraint"),m=i("../math/vec2"),n=i("../equations/Equation");h.exports=o;function o(A,w,I){I=I||{};q.call(this,A,w,q.LOCK,I);var G=(typeof(I.maxForce)==="undefined"?Number.MAX_VALUE:I.maxForce);var E=I.localOffsetB||m.fromValues(0,0);E=m.fromValues(E[0],E[1]);var z=I.localAngleB||0;var F=new n(A,w,-G,G),D=new n(A,w,-G,G),u=new n(A,w,-G,G);var v=m.create(),B=m.create(),C=this;F.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[0]};D.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[1]};var s=m.create(),H=m.create();u.computeGq=function(){m.rotate(s,C.localOffsetB,w.angle-C.localAngleB);m.scale(s,s,-1);m.sub(B,A.position,w.position);m.add(B,B,s);m.rotate(H,s,-Math.PI/2);m.normalize(H,H);return m.dot(B,H)};this.localOffsetB=E;this.localAngleB=z;this.equations.push(F,D,u);this.setMaxForce(G)}o.prototype=new q();o.prototype.setMaxForce=function(s){var l=this.equations;for(var r=0;r<this.equations.length;r++){l[r].maxForce=s;l[r].minForce=-s}};o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var j=m.create();var e=m.create();var p=m.create();var g=m.fromValues(1,0);var f=m.fromValues(0,1);o.prototype.update=function(){var l=this.equations[0],u=this.equations[1],r=this.equations[2],t=this.bodyA,s=this.bodyB;m.rotate(j,this.localOffsetB,t.angle);m.rotate(e,this.localOffsetB,s.angle-this.localAngleB);m.scale(e,e,-1);m.rotate(p,e,Math.PI/2);m.normalize(p,p);l.G[0]=-1;l.G[1]=0;l.G[2]=-m.crossLength(j,g);l.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-m.crossLength(j,f);u.G[4]=1;r.G[0]=-p[0];r.G[1]=-p[1];r.G[3]=p[0];r.G[4]=p[1];r.G[5]=m.crossLength(e,p)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(i,g,k){var s=i("./Constraint"),m=i("../equations/ContactEquation"),o=i("../equations/Equation"),n=i("../math/vec2"),e=i("../equations/RotationalLockEquation");g.exports=j;function j(x,w,J){J=J||{};s.call(this,x,w,s.PRISMATIC,J);var C=n.fromValues(0,0),y=n.fromValues(1,0),B=n.fromValues(0,0);if(J.localAnchorA){n.copy(C,J.localAnchorA)}if(J.localAxisA){n.copy(y,J.localAxisA)}if(J.localAnchorB){n.copy(B,J.localAnchorB)}this.localAnchorA=C;this.localAnchorB=B;this.localAxisA=y;var G=this.maxForce=typeof(J.maxForce)!="undefined"?J.maxForce:Number.MAX_VALUE;var I=new o(x,w,-G,G);var F=new n.create(),E=new n.create(),D=new n.create(),H=new n.create();I.computeGq=function(){return n.dot(D,H)};I.updateJacobian=function(){var L=this.G,K=x.position,t=w.position;n.rotate(F,C,x.angle);n.rotate(E,B,w.angle);n.add(D,t,E);n.sub(D,D,K);n.sub(D,D,F);n.rotate(H,y,x.angle+Math.PI/2);L[0]=-H[0];L[1]=-H[1];L[2]=-n.crossLength(F,H)+n.crossLength(H,D);L[3]=H[0];L[4]=H[1];L[5]=n.crossLength(E,H)};this.equations.push(I);if(!J.disableRotationalLock){var u=new e(x,w,-G,G);this.equations.push(u)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(J.lowerLimit)!=="undefined"?true:false;this.upperLimitEnabled=typeof(J.upperLimit)!=="undefined"?true:false;this.lowerLimit=typeof(J.lowerLimit)!=="undefined"?J.lowerLimit:0;this.upperLimit=typeof(J.upperLimit)!=="undefined"?J.upperLimit:1;this.upperLimitEquation=new m(x,w);this.lowerLimitEquation=new m(x,w);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=G;this.motorEquation=new o(x,w);this.motorEnabled=false;this.motorSpeed=0;var A=this;var z=this.motorEquation;var v=z.computeGW;z.computeGq=function(){return 0};z.computeGW=function(){var M=this.G,L=this.bodyA,K=this.bodyB,O=L.velocity,N=K.velocity,t=L.angularVelocity,P=K.angularVelocity;return this.transformedGmult(M,O,t,N,P)+A.motorSpeed}}j.prototype=new s();var r=n.create(),q=n.create(),p=n.create(),h=n.create(),f=n.create(),l=n.create();j.prototype.update=function(){var B=this.equations,H=B[0],w=this.upperLimit,E=this.lowerLimit,F=this.upperLimitEquation,A=this.lowerLimitEquation,u=this.bodyA,t=this.bodyB,v=this.localAxisA,z=this.localAnchorA,y=this.localAnchorB;H.updateJacobian();n.rotate(r,v,u.angle);n.rotate(h,z,u.angle);n.add(q,h,u.position);n.rotate(f,y,t.angle);n.add(p,f,t.position);var x=this.position=n.dot(p,r)-n.dot(q,r);if(this.motorEnabled){var D=this.motorEquation.G;D[0]=r[0];D[1]=r[1];D[2]=n.crossLength(r,f);D[3]=-r[0];D[4]=-r[1];D[5]=-n.crossLength(r,h)}if(this.upperLimitEnabled&&x>w){n.scale(F.normalA,r,-1);n.sub(F.contactPointA,q,u.position);n.sub(F.contactPointB,p,t.position);n.scale(l,r,w);n.add(F.contactPointA,F.contactPointA,l);if(B.indexOf(F)==-1){B.push(F)}}else{var C=B.indexOf(F);if(C!=-1){B.splice(C,1)}}if(this.lowerLimitEnabled&&x<E){n.scale(A.normalA,r,1);n.sub(A.contactPointA,q,u.position);n.sub(A.contactPointB,p,t.position);n.scale(l,r,E);n.sub(A.contactPointB,A.contactPointB,l);if(B.indexOf(A)==-1){B.push(A)}}else{var C=B.indexOf(A);if(C!=-1){B.splice(C,1)}}};j.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};j.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(l,j,n){var s=l("./Constraint"),q=l("../equations/Equation"),r=l("../equations/RotationalVelocityEquation"),f=l("../equations/RotationalLockEquation"),p=l("../math/vec2");j.exports=m;var k=p.create(),i=p.create(),h=p.fromValues(1,0),e=p.fromValues(0,1),o=p.create();function m(t,v,g,u,D){D=D||{};s.call(this,t,g,s.REVOLUTE,D);var C=this.maxForce=typeof(D.maxForce)!=="undefined"?D.maxForce:Number.MAX_VALUE;this.pivotA=p.fromValues(v[0],v[1]);this.pivotB=p.fromValues(u[0],u[1]);var z=this.equations=[new q(t,g,-C,C),new q(t,g,-C,C),];var B=z[0];var A=z[1];var w=this;B.computeGq=function(){p.rotate(k,w.pivotA,t.angle);p.rotate(i,w.pivotB,g.angle);p.add(o,g.position,i);p.sub(o,o,t.position);p.sub(o,o,k);return p.dot(o,h)};A.computeGq=function(){p.rotate(k,w.pivotA,t.angle);p.rotate(i,w.pivotB,g.angle);p.add(o,g.position,i);p.sub(o,o,t.position);p.sub(o,o,k);return p.dot(o,e)};A.minForce=B.minForce=-C;A.maxForce=B.maxForce=C;this.motorEquation=new r(t,g);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new f(t,g);this.lowerLimitEquation=new f(t,g);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}m.prototype=new s();m.prototype.update=function(){var t=this.bodyA,g=this.bodyB,w=this.pivotA,u=this.pivotB,C=this.equations,A=C[0],H=C[1],E=C[0],D=C[1],v=this.upperLimit,G=this.lowerLimit,I=this.upperLimitEquation,B=this.lowerLimitEquation;var z=this.angle=g.angle-t.angle;if(this.upperLimitEnabled&&z>v){I.angle=v;if(C.indexOf(I)==-1){C.push(I)}}else{var F=C.indexOf(I);if(F!=-1){C.splice(F,1)}}if(this.lowerLimitEnabled&&z<G){B.angle=G;if(C.indexOf(B)==-1){C.push(B)}}else{var F=C.indexOf(B);if(F!=-1){C.splice(F,1)}}p.rotate(k,w,t.angle);p.rotate(i,u,g.angle);E.G[0]=-1;E.G[1]=0;E.G[2]=-p.crossLength(k,h);E.G[3]=1;E.G[4]=0;E.G[5]=p.crossLength(i,h);D.G[0]=0;D.G[1]=-1;D.G[2]=-p.crossLength(k,e);D.G[3]=0;D.G[4]=1;D.G[5]=p.crossLength(i,e)};m.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};m.prototype.disableMotor=function(){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations.splice(g,1);this.motorEnabled=false};m.prototype.motorIsEnabled=function(){return !!this.motorEnabled};m.prototype.setMotorSpeed=function(t){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations[g].relativeVelocity=t};m.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(f,g,e){var i=f("./Equation"),h=f("../math/vec2");g.exports=j;function j(m,l,k){k=k||{};i.call(this,m,l,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=k.angle||0;this.ratio=typeof(k.ratio)==="number"?k.ratio:1;this.setRatio(this.ratio)}j.prototype=new i();j.prototype.constructor=j;j.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};j.prototype.setRatio=function(l){var k=this.G;k[2]=l;k[5]=-1;this.ratio=l};j.prototype.setMaxTorque=function(k){this.maxForce=k;this.minForce=-k}},{"../math/vec2":30,"./Equation":22}],21:[function(g,h,f){var j=g("./Equation"),i=g("../math/vec2");h.exports=e;function e(l,k){j.call(this,l,k,0,Number.MAX_VALUE);this.contactPointA=i.create();this.penetrationVec=i.create();this.contactPointB=i.create();this.normalA=i.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}e.prototype=new j();e.prototype.constructor=e;e.prototype.computeB=function(D,C,z){var m=this.bodyA,k=this.bodyB,r=this.contactPointA,q=this.contactPointB,v=m.position,u=k.position;var A=this.penetrationVec,w=this.normalA,p=this.G;var s=i.crossLength(r,w),l=i.crossLength(q,w);p[0]=-w[0];p[1]=-w[1];p[2]=-s;p[3]=w[0];p[4]=w[1];p[5]=l;i.add(A,u,q);i.sub(A,A,v);i.sub(A,A,r);var o,y;if(this.firstImpact&&this.restitution!==0){y=0;o=(1/C)*(1+this.restitution)*this.computeGW()}else{y=i.dot(w,A);o=this.computeGW()}var x=this.computeGiMf();var t=-y*D-o*C-z*x;return t}},{"../math/vec2":30,"./Equation":22}],22:[function(n,g,x){g.exports=j;var f=n("../math/vec2"),h=n("../utils/Utils"),q=n("../objects/Body");function j(C,B,z,A){this.minForce=typeof(z)==="undefined"?-Number.MAX_VALUE:z;this.maxForce=typeof(A)==="undefined"?Number.MAX_VALUE:A;this.bodyA=C;this.bodyB=B;this.stiffness=j.DEFAULT_STIFFNESS;this.relaxation=j.DEFAULT_RELAXATION;this.G=new h.ARRAY_TYPE(6);for(var y=0;y<6;y++){this.G[y]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}j.prototype.constructor=j;j.DEFAULT_STIFFNESS=1000000;j.DEFAULT_RELAXATION=4;j.prototype.update=function(){var y=this.stiffness,A=this.relaxation,z=this.timeStep;this.a=4/(z*(1+4*A));this.b=(4*A)/(1+4*A);this.epsilon=4/(z*z*y*(1+4*A));this.needsUpdate=false};function e(z,B,y,A,C){return z[0]*B[0]+z[1]*B[1]+z[2]*y+z[3]*A[0]+z[4]*A[1]+z[5]*C}j.prototype.computeB=function(A,y,B){var D=this.computeGW();var C=this.computeGq();var z=this.computeGiMf();return -C*A-D*y-z*B};var l=f.create(),k=f.create();j.prototype.computeGq=function(){var D=this.G,C=this.bodyA,A=this.bodyB,B=C.position,z=A.position,y=C.angle,E=A.angle;return e(D,l,y,k,E)+this.offset};j.prototype.computeGW=function(){var B=this.G,A=this.bodyA,z=this.bodyB,D=A.velocity,C=z.velocity,y=A.angularVelocity,E=z.angularVelocity;return e(B,D,y,C,E)+this.relativeVelocity};j.prototype.computeGWlambda=function(){var B=this.G,A=this.bodyA,z=this.bodyB,D=A.vlambda,C=z.vlambda,y=A.wlambda,E=z.wlambda;return e(B,D,y,C,E)};var s=f.create(),r=f.create();j.prototype.computeGiMf=function(){var B=this.bodyA,A=this.bodyB,J=B.force,z=B.angularForce,I=A.force,y=A.angularForce,D=t(B),C=t(A),F=u(B),E=u(A),H=this.G;f.scale(s,J,D);f.scale(r,I,C);return e(H,s,z*F,r,y*E)};function t(y){if(y.sleepState===q.SLEEPING){return 0}else{return y.invMass}}function u(y){if(y.sleepState===q.SLEEPING){return 0}else{return y.invInertia}}j.prototype.computeGiMGt=function(){var C=this.bodyA,A=this.bodyB,B=t(C),z=t(A),y=u(C),E=u(A),D=this.G;return D[0]*D[0]*B+D[1]*D[1]*B+D[2]*D[2]*y+D[3]*D[3]*z+D[4]*D[4]*z+D[5]*D[5]*E};var i=f.create(),w=f.create(),v=f.create(),p=f.create(),o=f.create(),m=f.create();j.prototype.addToWlambda=function(y){var A=this.bodyA,z=this.bodyB,M=i,E=w,D=v,H=p,F=o,C=t(A),B=t(z),K=u(A),J=u(z),I=m,L=this.G;E[0]=L[0];E[1]=L[1];D[0]=L[3];D[1]=L[4];f.scale(M,E,C*y);f.add(A.vlambda,A.vlambda,M);A.wlambda+=K*L[2]*y;f.scale(M,D,B*y);f.add(z.vlambda,z.vlambda,M);z.wlambda+=J*L[5]*y};j.prototype.computeInvC=function(y){return 1/(this.computeGiMGt()+y)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":47}],23:[function(f,h,e){var j=f("../math/vec2"),i=f("./Equation"),k=f("../utils/Utils");h.exports=g;function g(n,m,l){i.call(this,n,m,-l,l);this.contactPointA=j.create();this.contactPointB=j.create();this.t=j.create();this.contactEquation=null;this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}g.prototype=new i();g.prototype.constructor=g;g.prototype.setSlipForce=function(l){this.maxForce=l;this.minForce=-l};g.prototype.getSlipForce=function(){return this.maxForce};g.prototype.computeB=function(u,r,p){var o=this.bodyA,n=this.bodyB,v=this.contactPointA,s=this.contactPointB,x=this.t,w=this.G;w[0]=-x[0];w[1]=-x[1];w[2]=-j.crossLength(v,x);w[3]=x[0];w[4]=x[1];w[5]=j.crossLength(s,x);var q=this.computeGW(),l=this.computeGiMf();var m=-q*r-p*l;return m}},{"../math/vec2":30,"../utils/Utils":47,"./Equation":22}],24:[function(i,h,k){var n=i("./Equation"),m=i("../math/vec2");h.exports=f;function f(r,q,o){o=o||{};n.call(this,r,q,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=o.angle||0;var p=this.G;p[2]=1;p[5]=-1}f.prototype=new n();f.prototype.constructor=f;var l=m.create(),j=m.create(),g=m.fromValues(1,0),e=m.fromValues(0,1);f.prototype.computeGq=function(){m.rotate(l,g,this.bodyA.angle+this.angle);m.rotate(j,e,this.bodyB.angle);return m.dot(l,j)}},{"../math/vec2":30,"./Equation":22}],25:[function(f,g,e){var i=f("./Equation"),h=f("../math/vec2");g.exports=j;function j(l,k){i.call(this,l,k,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}j.prototype=new i();j.prototype.constructor=j;j.prototype.computeB=function(m,k,o){var n=this.G;n[2]=-1;n[5]=this.ratio;var l=this.computeGiMf();var q=this.computeGW();var p=-q*k-o*l;return p}},{"../math/vec2":30,"./Equation":22}],26:[function(f,g,e){var h=function(){};g.exports=h;h.prototype={constructor:h,on:function(k,l,i){l.context=i||this;if(this._listeners===undefined){this._listeners={}}var j=this._listeners;if(j[k]===undefined){j[k]=[]}if(j[k].indexOf(l)===-1){j[k].push(l)}return this},has:function(j,k){if(this._listeners===undefined){return false}var i=this._listeners;if(k){if(i[j]!==undefined&&i[j].indexOf(k)!==-1){return true}}else{if(i[j]!==undefined){return true}}return false},off:function(k,l){if(this._listeners===undefined){return this}var j=this._listeners;var i=j[k].indexOf(l);if(i!==-1){j[k].splice(i,1)}return this},emit:function(o){if(this._listeners===undefined){return this}var n=this._listeners;var j=n[o.type];if(j!==undefined){o.target=this;for(var m=0,k=j.length;m<k;m++){var p=j[m];p.call(p.context,o)}}return this}}},{}],27:[function(g,h,f){var j=g("./Material");var i=g("../equations/Equation");h.exports=e;function e(m,l,k){k=k||{};if(!(m instanceof j)||!(l instanceof j)){throw new Error("First two arguments must be Material instances.")}this.id=e.idCounter++;this.materialA=m;this.materialB=l;this.friction=typeof(k.friction)!=="undefined"?Number(k.friction):0.3;this.restitution=typeof(k.restitution)!=="undefined"?Number(k.restitution):0;this.stiffness=typeof(k.stiffness)!=="undefined"?Number(k.stiffness):i.DEFAULT_STIFFNESS;this.relaxation=typeof(k.relaxation)!=="undefined"?Number(k.relaxation):i.DEFAULT_RELAXATION;this.frictionStiffness=typeof(k.frictionStiffness)!=="undefined"?Number(k.frictionStiffness):i.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(k.frictionRelaxation)!=="undefined"?Number(k.frictionRelaxation):i.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(k.surfaceVelocity)!=="undefined"?Number(k.surfaceVelocity):0}e.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(f,g,e){g.exports=h;function h(){this.id=h.idCounter++}h.idCounter=0},{}],29:[function(g,h,f){var e={};e.GetArea=function(n){if(n.length<6){return 0}var j=n.length-2;var m=0;for(var k=0;k<j;k+=2){m+=(n[k+2]-n[k])*(n[k+1]+n[k+3])}m+=(n[0]-n[j])*(n[j+1]+n[1]);return -m*0.5};e.Triangulate=function(s){var t=s.length>>1;if(t<3){return[]}var B=[];var r=[];for(var z=0;z<t;z++){r.push(z)}var z=0;var w=t;while(w>3){var x=r[(z+0)%w];var v=r[(z+1)%w];var u=r[(z+2)%w];var q=s[2*x],m=s[2*x+1];var C=s[2*v],A=s[2*v+1];var l=s[2*u],k=s[2*u+1];var o=false;if(e._convex(q,m,C,A,l,k)){o=true;for(var y=0;y<w;y++){var D=r[y];if(D==x||D==v||D==u){continue}if(e._PointInTriangle(s[2*D],s[2*D+1],q,m,C,A,l,k)){o=false;break}}}if(o){B.push(x,v,u);r.splice((z+1)%w,1);w--;z=0}else{if(z++>3*w){break}}}B.push(r[0],r[1],r[2]);return B};e._PointInTriangle=function(y,x,s,r,F,E,o,m){var l=o-s;var k=m-r;var q=F-s;var p=E-r;var D=y-s;var B=x-r;var C=l*l+k*k;var A=l*q+k*p;var z=l*D+k*B;var j=q*q+p*p;var i=q*D+p*B;var n=1/(C*j-A*A);var w=(j*z-A*i)*n;var t=(C*i-A*z)*n;return(w>=0)&&(t>=0)&&(w+t<1)};e._convex=function(k,j,m,l,i,n){return(j-l)*(i-m)+(m-k)*(n-l)>=0};h.exports=e},{}],30:[function(f,g,e){var h=f("../../build/vec2").vec2;h.crossLength=function(j,i){return j[0]*i[1]-j[1]*i[0]};h.crossVZ=function(i,j,k){h.rotate(i,j,-Math.PI/2);h.scale(i,i,k);return i};h.crossZV=function(i,k,j){h.rotate(i,j,Math.PI/2);h.scale(i,i,k);return i};h.rotate=function(k,j,m){var o=Math.cos(m),l=Math.sin(m),i=j[0],n=j[1];k[0]=o*i-l*n;k[1]=l*i+o*n};h.rotate90cw=function(j,i){j[0]=i[1];j[1]=-i[0]};h.toLocalFrame=function(i,l,j,k){h.copy(i,l);h.sub(i,i,j);h.rotate(i,i,-k)};h.toGlobalFrame=function(i,l,j,k){h.copy(i,l);h.rotate(i,i,k);h.add(i,i,j)};h.centroid=function(k,j,i,l){h.add(k,j,i);h.add(k,k,l);h.scale(k,k,1/3);return k};g.exports=h},{"../../build/vec2":1}],31:[function(g,f,k){var n=g("../math/vec2"),m=g("poly-decomp"),h=g("../shapes/Convex"),i=g("../collision/AABB"),t=g("../events/EventEmitter");f.exports=p;function p(u){u=u||{};t.call(this);this.id=++p._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=u.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.fixedRotation=!!u.fixedRotation||false;this.position=n.fromValues(0,0);if(u.position){n.copy(this.position,u.position)}this.interpolatedPosition=n.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=n.fromValues(0,0);this.previousAngle=0;this.velocity=n.fromValues(0,0);if(u.velocity){n.copy(this.velocity,u.velocity)}this.vlambda=n.fromValues(0,0);this.wlambda=0;this.angle=u.angle||0;this.angularVelocity=u.angularVelocity||0;this.force=n.create();if(u.force){n.copy(this.force,u.force)}this.angularForce=u.angularForce||0;this.damping=typeof(u.damping)=="number"?u.damping:0.1;this.angularDamping=typeof(u.angularDamping)=="number"?u.angularDamping:0.1;this.motionState=this.mass===0?p.STATIC:p.DYNAMIC;this.boundingRadius=0;this.aabb=new i();this.aabbNeedsUpdate=true;this.allowSleep=true;this.wantsToSleep=false;this.sleepState=p.AWAKE;this.sleepSpeedLimit=0.2;this.sleepTimeLimit=1;this.gravityScale=1;this.timeLastSleepy=0;this.concavePath=null;this.lastDampingScale=1;this.lastAngularDampingScale=1;this.lastDampingTimeStep=-1;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}p.prototype=new t();p._idCounter=0;p.prototype.setDensity=function(u){var v=this.getArea();this.mass=v*u;this.updateMassProperties()};p.prototype.getArea=function(){var u=0;for(var v=0;v<this.shapes.length;v++){u+=this.shapes[v].area}return u};var o=new i(),l=n.create();p.prototype.updateAABB=function(){var u=this.shapes,y=this.shapeOffsets,w=this.shapeAngles,B=u.length;for(var x=0;x!==B;x++){var v=u[x],A=l,z=w[x]+this.angle;n.rotate(A,y[x],this.angle);n.add(A,A,this.position);v.computeAABB(o,A,z);if(x===0){this.aabb.copy(o)}else{this.aabb.extend(o)}}this.aabbNeedsUpdate=false};p.prototype.updateBoundingRadius=function(){var v=this.shapes,z=this.shapeOffsets,B=v.length,u=0;for(var x=0;x!==B;x++){var w=v[x],A=n.length(z[x]),y=w.boundingRadius;if(A+y>u){u=A+y}}this.boundingRadius=u};p.prototype.addShape=function(u,w,v){v=v||0;if(w){w=n.fromValues(w[0],w[1])}else{w=n.fromValues(0,0)}this.shapes.push(u);this.shapeOffsets.push(w);this.shapeAngles.push(v);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};p.prototype.removeShape=function(v){var u=this.shapes.indexOf(v);if(u!==-1){this.shapes.splice(u,1);this.shapeOffsets.splice(u,1);this.shapeAngles.splice(u,1);this.aabbNeedsUpdate=true;return true}else{return false}};p.prototype.updateMassProperties=function(){if(this.motionState===p.STATIC||this.motionState===p.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var w=this.shapes,B=w.length,u=this.mass/B,y=0;if(!this.fixedRotation){for(var z=0;z<B;z++){var x=w[z],v=n.squaredLength(this.shapeOffsets[z]),A=x.computeMomentOfInertia(u);y+=A+u*v}this.inertia=y;this.invInertia=y>0?1/y:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass}};var j=n.create();p.prototype.applyForce=function(x,v){var w=j;n.sub(w,v,this.position);n.add(this.force,this.force,x);var u=n.crossLength(w,x);this.angularForce+=u};p.prototype.toLocalFrame=function(u,v){n.toLocalFrame(u,v,this.position,this.angle)};p.prototype.toWorldFrame=function(u,v){n.toGlobalFrame(u,v,this.position,this.angle)};p.prototype.fromPolygon=function(C,D){D=D||{};for(var x=this.shapes.length;x>=0;--x){this.removeShape(this.shapes[x])}var u=new m.Polygon();u.vertices=C;u.makeCCW();if(typeof(D.removeCollinearPoints)=="number"){u.removeCollinearPoints(D.removeCollinearPoints)}if(typeof(D.skipSimpleCheck)=="undefined"){if(!u.isSimple()){return false}}this.concavePath=u.vertices.slice(0);for(var x=0;x<this.concavePath.length;x++){var B=[0,0];n.copy(B,this.concavePath[x]);this.concavePath[x]=B}var y;if(D.optimalDecomp){y=u.decomp()}else{y=u.quickDecomp()}var A=n.create();for(var x=0;x!==y.length;x++){var z=new h(y[x].vertices);for(var w=0;w!==z.vertices.length;w++){var B=z.vertices[w];n.sub(B,B,z.centerOfMass)}n.scale(A,z.centerOfMass,1);z.updateTriangles();z.updateCenterOfMass();z.updateBoundingRadius();this.addShape(z,A)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var e=n.fromValues(0,0),s=n.fromValues(0,0),r=n.fromValues(0,0),q=n.fromValues(0,0);p.prototype.adjustCenterOfMass=function(){var A=s,y=r,u=q,v=0;n.set(y,0,0);for(var w=0;w!==this.shapes.length;w++){var x=this.shapes[w],z=this.shapeOffsets[w];n.scale(A,z,x.area);n.add(y,y,A);v+=x.area}n.scale(u,y,1/v);for(var w=0;w!==this.shapes.length;w++){var x=this.shapes[w],z=this.shapeOffsets[w];if(!z){z=this.shapeOffsets[w]=n.create()}n.sub(z,z,u)}n.add(this.position,this.position,u);for(var w=0;this.concavePath&&w<this.concavePath.length;w++){n.sub(this.concavePath[w],this.concavePath[w],u)}this.updateMassProperties();this.updateBoundingRadius()};p.prototype.setZeroForce=function(){n.set(this.force,0,0);this.angularForce=0};p.prototype.resetConstraintVelocity=function(){var u=this,v=u.vlambda;n.set(v,0,0);u.wlambda=0};p.prototype.addConstraintVelocity=function(){var u=this,w=u.velocity;n.add(w,w,u.vlambda);u.angularVelocity+=u.wlambda};p.prototype.applyDamping=function(w){if(this.motionState===p.DYNAMIC){if(w!==this.lastDampingTimeStep){this.lastDampingScale=Math.pow(1-this.damping,w);this.lastAngularDampingScale=Math.pow(1-this.angularDamping,w);this.lastDampingTimeStep=w}var u=this.velocity;n.scale(u,u,this.lastDampingScale);this.angularVelocity*=this.lastAngularDampingScale}};p.prototype.wakeUp=function(){var u=this.sleepState;this.sleepState=p.AWAKE;this.idleTime=0;if(u!==p.AWAKE){this.emit(p.wakeUpEvent)}};p.prototype.sleep=function(){this.sleepState=p.SLEEPING;this.angularVelocity=0;this.angularForce=0;n.set(this.velocity,0,0);n.set(this.force,0,0);this.emit(p.sleepEvent)};p.prototype.sleepTick=function(z,v,x){if(!this.allowSleep||this.motionState===p.SLEEPING){return}this.wantsToSleep=false;var w=this.sleepState,u=n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),y=Math.pow(this.sleepSpeedLimit,2);if(u>=y){this.idleTime=0;this.sleepState=p.AWAKE}else{this.idleTime+=x;this.sleepState=p.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!v){this.sleep()}else{this.wantsToSleep=true}}};p.prototype.getVelocityFromPosition=function(u,v){u=u||n.create();n.sub(u,this.position,this.previousPosition);n.scale(u,u,1/v);return u};p.prototype.getAngularVelocityFromPosition=function(u){return(this.angle-this.previousAngle)/u};p.sleepyEvent={type:"sleepy"};p.sleepEvent={type:"sleep"};p.wakeUpEvent={type:"wakeup"};p.DYNAMIC=1;p.STATIC=2;p.KINEMATIC=4;p.AWAKE=0;p.SLEEPY=1;p.SLEEPING=2},{"../collision/AABB":8,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":36,"poly-decomp":6}],32:[function(g,f,j){var l=g("../math/vec2");var n=g("../utils/Utils");f.exports=e;function e(v,u,t){t=n.defaults(t,{restLength:1,stiffness:100,damping:1,localAnchorA:[0,0],localAnchorB:[0,0],});this.restLength=t.restLength;this.stiffness=t.stiffness;this.damping=t.damping;this.bodyA=v;this.bodyB=u;this.localAnchorA=l.create();l.copy(this.localAnchorA,t.localAnchorA);this.localAnchorB=l.create();l.copy(this.localAnchorB,t.localAnchorB);if(t.worldAnchorA){this.setWorldAnchorA(t.worldAnchorA)}if(t.worldAnchorB){this.setWorldAnchorB(t.worldAnchorB)}}e.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)};e.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)};e.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)};e.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=l.create(),i=l.create(),q=l.create(),h=l.create(),r=l.create(),p=l.create(),o=l.create(),m=l.create(),k=l.create();e.prototype.applyForce=function(){var y=this.stiffness,E=this.damping,w=this.restLength,x=this.bodyA,v=this.bodyB,t=s,A=i,K=q,C=h,z=k;var J=r,H=p,G=o,F=m;this.getWorldAnchorA(J);this.getWorldAnchorB(H);l.sub(G,J,x.position);l.sub(F,H,v.position);l.sub(t,H,J);var I=l.len(t);l.normalize(A,t);l.sub(K,v.velocity,x.velocity);l.crossZV(z,v.angularVelocity,F);l.add(K,K,z);l.crossZV(z,x.angularVelocity,G);l.sub(K,K,z);l.scale(C,A,-y*(I-w)-E*l.dot(K,A));l.sub(x.force,x.force,C);l.add(v.force,v.force,C);var D=l.crossLength(G,C);var B=l.crossLength(F,C);x.angularForce-=D;v.angularForce+=B}},{"../math/vec2":30,"../utils/Utils":47}],33:[function(f,g,e){g.exports={AABB:f("./collision/AABB"),AngleLockEquation:f("./equations/AngleLockEquation"),Body:f("./objects/Body"),Broadphase:f("./collision/Broadphase"),Capsule:f("./shapes/Capsule"),Circle:f("./shapes/Circle"),Constraint:f("./constraints/Constraint"),ContactEquation:f("./equations/ContactEquation"),ContactMaterial:f("./material/ContactMaterial"),Convex:f("./shapes/Convex"),DistanceConstraint:f("./constraints/DistanceConstraint"),Equation:f("./equations/Equation"),EventEmitter:f("./events/EventEmitter"),FrictionEquation:f("./equations/FrictionEquation"),GearConstraint:f("./constraints/GearConstraint"),GridBroadphase:f("./collision/GridBroadphase"),GSSolver:f("./solver/GSSolver"),Heightfield:f("./shapes/Heightfield"),Line:f("./shapes/Line"),LockConstraint:f("./constraints/LockConstraint"),Material:f("./material/Material"),Narrowphase:f("./collision/Narrowphase"),NaiveBroadphase:f("./collision/NaiveBroadphase"),Particle:f("./shapes/Particle"),Plane:f("./shapes/Plane"),RevoluteConstraint:f("./constraints/RevoluteConstraint"),PrismaticConstraint:f("./constraints/PrismaticConstraint"),Rectangle:f("./shapes/Rectangle"),RotationalVelocityEquation:f("./equations/RotationalVelocityEquation"),SAPBroadphase:f("./collision/SAPBroadphase"),Shape:f("./shapes/Shape"),Solver:f("./solver/Solver"),Spring:f("./objects/Spring"),Utils:f("./utils/Utils"),World:f("./world/World"),vec2:f("./math/vec2"),version:f("../package.json").version,}},{"../package.json":7,"./collision/AABB":8,"./collision/Broadphase":9,"./collision/GridBroadphase":10,"./collision/NaiveBroadphase":11,"./collision/Narrowphase":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/Spring":32,"./shapes/Capsule":34,"./shapes/Circle":35,"./shapes/Convex":36,"./shapes/Heightfield":37,"./shapes/Line":38,"./shapes/Particle":39,"./shapes/Plane":40,"./shapes/Rectangle":41,"./shapes/Shape":42,"./solver/GSSolver":43,"./solver/Solver":44,"./utils/Utils":47,"./world/World":51}],34:[function(g,h,f){var k=g("./Shape"),i=g("../math/vec2");h.exports=e;function e(m,l){this.length=m||1;this.radius=l||1;k.call(this,k.CAPSULE)}e.prototype=new k();e.prototype.computeMomentOfInertia=function(m){var o=this.radius,l=this.length+o,n=o*2;return m*(n*n+l*l)/12};e.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};e.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var j=i.create();e.prototype.computeAABB=function(n,m,o){var l=this.radius;i.set(j,this.length,0);i.rotate(j,j,o);i.set(n.upperBound,Math.max(j[0]+l,-j[0]+l),Math.max(j[1]+l,-j[1]+l));i.set(n.lowerBound,Math.min(j[0]-l,-j[0]-l),Math.min(j[1]-l,-j[1]-l));i.add(n.lowerBound,n.lowerBound,m);i.add(n.upperBound,n.upperBound,m)}},{"../math/vec2":30,"./Shape":42}],35:[function(f,g,e){var j=f("./Shape"),i=f("../math/vec2");g.exports=h;function h(k){this.radius=k||1;j.call(this,j.CIRCLE)}h.prototype=new j();h.prototype.computeMomentOfInertia=function(k){var l=this.radius;return k*l*l/2};h.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};h.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};h.prototype.computeAABB=function(l,k,n){var m=this.radius;i.set(l.upperBound,m,m);i.set(l.lowerBound,-m,-m);if(k){i.add(l.lowerBound,l.lowerBound,k);i.add(l.upperBound,l.upperBound,k)}}},{"../math/vec2":30,"./Shape":42}],36:[function(h,f,m){var l=h("./Shape"),p=h("../math/vec2"),e=h("../math/polyk"),n=h("poly-decomp");f.exports=i;function i(x){this.vertices=[];for(var y=0;y<x.length;y++){var w=p.create();p.copy(w,x[y]);this.vertices.push(w)}this.centerOfMass=p.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;l.call(this,l.CONVEX);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}i.prototype=new l();i.prototype.updateTriangles=function(){this.triangles.length=0;var C=[];for(var z=0;z<this.vertices.length;z++){var w=this.vertices[z];C.push(w[0],w[1])}var B=e.Triangulate(C);for(var z=0;z<B.length;z+=3){var A=B[z],y=B[z+1],x=B[z+2];this.triangles.push([A,y,x])}};var k=p.create(),j=p.create(),s=p.create(),r=p.create(),q=p.create(),o=p.create(),u=p.create(),t=p.create(),g=p.create();i.prototype.updateCenterOfMass=function(){var z=this.triangles,G=this.vertices,H=this.centerOfMass,v=k,w=g,F=s,E=r,D=q,K=o,A=u,y=t,C=j;p.set(H,0,0);var J=0;for(var B=0;B!==z.length;B++){var I=z[B],F=G[I[0]],E=G[I[1]],D=G[I[2]];p.centroid(v,F,E,D);var x=i.triangleArea(F,E,D);J+=x;p.scale(C,v,x);p.add(H,H,C)}p.scale(H,H,1/J)};i.prototype.computeMomentOfInertia=function(A){var y=0,x=0,z=this.vertices.length;for(var v=z-1,w=0;w<z;v=w,w++){var E=this.vertices[v];var D=this.vertices[w];var C=Math.abs(p.crossLength(E,D));var B=p.dot(D,D)+p.dot(D,E)+p.dot(E,E);y+=C*B;x+=C}return(A/6)*(y/x)};i.prototype.updateBoundingRadius=function(){var y=this.vertices,w=0;for(var x=0;x!==y.length;x++){var v=p.squaredLength(y[x]);if(v>w){w=v}}this.boundingRadius=Math.sqrt(w)};i.triangleArea=function(w,v,x){return(((v[0]-w[0])*(x[1]-w[1]))-((x[0]-w[0])*(v[1]-w[1])))*0.5};i.prototype.updateArea=function(){this.updateTriangles();this.area=0;var A=this.triangles,C=this.vertices;for(var z=0;z!==A.length;z++){var y=A[z],x=C[y[0]],w=C[y[1]],B=C[y[2]];var v=i.triangleArea(x,w,B);this.area+=v}};i.prototype.computeAABB=function(w,v,x){w.setFromPoints(this.vertices,v,x)}},{"../math/polyk":29,"../math/vec2":30,"./Shape":42,"poly-decomp":6}],37:[function(f,h,e){var k=f("./Shape"),i=f("../math/vec2"),j=f("../utils/Utils");h.exports=g;function g(o,m){m=j.defaults(m,{maxValue:null,minValue:null,elementWidth:0.1});if(m.minValue===null||m.maxValue===null){m.maxValue=o[0];m.minValue=o[0];for(var n=0;n!==o.length;n++){var l=o[n];if(l>m.maxValue){m.maxValue=l}if(l<m.minValue){m.minValue=l}}}this.data=o;this.maxValue=m.maxValue;this.minValue=m.minValue;this.elementWidth=m.elementWidth;k.call(this,k.HEIGHTFIELD)}g.prototype=new k();g.prototype.computeMomentOfInertia=function(l){return Number.MAX_VALUE};g.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};g.prototype.updateArea=function(){var n=this.data,m=0;for(var l=0;l<n.length-1;l++){m+=(n[l]+n[l+1])/2*this.elementWidth}this.area=m};g.prototype.computeAABB=function(m,l,n){m.upperBound[0]=this.elementWidth*this.data.length+l[0];m.upperBound[1]=this.maxValue+l[1];m.lowerBound[0]=l[0];m.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],38:[function(f,g,e){var j=f("./Shape"),i=f("../math/vec2");g.exports=k;function k(l){this.length=l||1;j.call(this,j.LINE)}k.prototype=new j();k.prototype.computeMomentOfInertia=function(l){return l*Math.pow(this.length,2)/12};k.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var h=[i.create(),i.create()];k.prototype.computeAABB=function(o,m,p){var n=this.length;i.set(h[0],-n/2,0);i.set(h[1],n/2,0);o.setFromPoints(h,m,p)}},{"../math/vec2":30,"./Shape":42}],39:[function(g,h,f){var j=g("./Shape"),i=g("../math/vec2");h.exports=e;function e(){j.call(this,j.PARTICLE)}e.prototype=new j();e.prototype.computeMomentOfInertia=function(k){return 0};e.prototype.updateBoundingRadius=function(){this.boundingRadius=0};e.prototype.computeAABB=function(n,k,o){var m=this.length;i.copy(n.lowerBound,k);i.copy(n.upperBound,k)}},{"../math/vec2":30,"./Shape":42}],40:[function(f,g,e){var k=f("./Shape"),h=f("../math/vec2"),j=f("../utils/Utils");g.exports=i;function i(){k.call(this,k.PLANE)}i.prototype=new k();i.prototype.computeMomentOfInertia=function(l){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.computeAABB=function(n,l,o){var m=0,p=h.set;if(typeof(o)=="number"){m=o%(2*Math.PI)}if(m==0){p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,0)}else{if(m==Math.PI/2){p(n.lowerBound,0,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(m==Math.PI){p(n.lowerBound,-Number.MAX_VALUE,0);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}else{if(m==3*Math.PI/2){p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,0,Number.MAX_VALUE)}else{p(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE);p(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)}}}}h.add(n.lowerBound,n.lowerBound,l);h.add(n.upperBound,n.upperBound,l)};i.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":30,"../utils/Utils":47,"./Shape":42}],41:[function(h,e,m){var n=h("../math/vec2"),l=h("./Shape"),j=h("./Convex");e.exports=o;function o(q,p){q=q||1;p=p||1;var r=[n.fromValues(-q/2,-p/2),n.fromValues(q/2,-p/2),n.fromValues(q/2,p/2),n.fromValues(-q/2,p/2)];this.width=q;this.height=p;j.call(this,r);this.type=l.RECTANGLE}o.prototype=new j([]);o.prototype.computeMomentOfInertia=function(q){var p=this.width,r=this.height;return q*(r*r+p*p)/12};o.prototype.updateBoundingRadius=function(){var p=this.width,q=this.height;this.boundingRadius=Math.sqrt(p*p+q*q)/2};var k=n.create(),i=n.create(),g=n.create(),f=n.create();o.prototype.computeAABB=function(q,p,r){q.setFromPoints(this.vertices,p,r)};o.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":36,"./Shape":42}],42:[function(f,g,e){g.exports=h;function h(i){this.type=i;this.id=h.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionMask=1;if(i){this.updateBoundingRadius()}this.material=null;this.area=0;this.sensor=false;this.updateArea()}h.idCounter=0;h.CIRCLE=1;h.PARTICLE=2;h.PLANE=4;h.CONVEX=8;h.LINE=16;h.RECTANGLE=32;h.CAPSULE=64;h.HEIGHTFIELD=128;h.prototype.computeMomentOfInertia=function(i){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")};h.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")};h.prototype.updateArea=function(){};h.prototype.computeAABB=function(j,i,k){}},{}],43:[function(g,e,h){var j=g("../math/vec2"),f=g("./Solver"),k=g("../utils/Utils"),m=g("../equations/FrictionEquation");e.exports=i;function i(n){f.call(this,n,f.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-10;this.arrayStep=30;this.lambda=new k.ARRAY_TYPE(this.arrayStep);this.Bs=new k.ARRAY_TYPE(this.arrayStep);this.invCs=new k.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}i.prototype=new f();function l(o){var n=o.length;while(n--){o[n]=+0}}i.prototype.solve=function(J,C){this.sortEquations();var G=0,r=this.iterations,y=this.frictionIterations,u=this.equations,p=u.length,F=Math.pow(this.tolerance*p,2),t=C.bodies,s=C.bodies.length,x=j.add,w=j.set,o=this.useZeroRHS,v=this.lambda;this.usedIterations=0;if(v.length<p){v=this.lambda=new k.ARRAY_TYPE(p+this.arrayStep);this.Bs=new k.ARRAY_TYPE(p+this.arrayStep);this.invCs=new k.ARRAY_TYPE(p+this.arrayStep)}l(v);var K=this.invCs,n=this.Bs,v=this.lambda;for(var H=0;H!==u.length;H++){var M=u[H];if(M.timeStep!==J||M.needsUpdate){M.timeStep=J;M.update()}n[H]=M.computeB(M.a,M.b,J);K[H]=M.computeInvC(M.epsilon)}var A,z,M,I,H,E;if(p!==0){for(H=0;H!==s;H++){t[H].resetConstraintVelocity()}if(y){for(G=0;G!==y;G++){I=0;for(E=0;E!==p;E++){M=u[E];if(M instanceof m){}var D=i.iterateEquation(E,M,M.epsilon,n,K,v,o,J,G);I+=Math.abs(D)}this.usedIterations++;if(I*I<=F){break}}i.updateMultipliers(u,v,1/J);for(E=0;E!==p;E++){var N=u[E];if(N instanceof m){var L=N.contactEquation.multiplier*N.frictionCoefficient;N.maxForce=L;N.minForce=-L}}}for(G=0;G!==r;G++){I=0;for(E=0;E!==p;E++){M=u[E];var D=i.iterateEquation(E,M,M.epsilon,n,K,v,o,J,G);I+=Math.abs(D)}this.usedIterations++;if(I*I<=F){break}}for(H=0;H!==s;H++){t[H].addConstraintVelocity()}i.updateMultipliers(u,v,1/J)}};i.updateMultipliers=function(n,q,p){var o=n.length;while(o--){n[o].multiplier=q[o]*p}};i.iterateEquation=function(t,D,E,n,u,x,C,r,y){var q=n[t],w=u[t],v=x[t],p=D.computeGWlambda();var A=D.maxForce,o=D.minForce;if(C){q=0}var s=w*(q-p-E*v);var z=v+s;if(z<o*r){s=o*r-v}else{if(z>A*r){s=A*r-v}}x[t]+=s;D.addToWlambda(s);return s}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":47,"./Solver":44}],44:[function(f,g,e){var j=f("../utils/Utils"),i=f("../events/EventEmitter");g.exports=k;function k(l,m){l=l||{};i.call(this);this.type=m;this.equations=[];this.equationSortFunction=l.equationSortFunction||false}k.prototype=new i();k.prototype.solve=function(l,m){throw new Error("Solver.solve should be implemented by subclasses!")};var h={bodies:[]};k.prototype.solveIsland=function(m,l){this.removeAllEquations();if(l.equations.length){this.addEquations(l.equations);h.bodies.length=0;l.getBodies(h.bodies);if(h.bodies.length){this.solve(m,h)}}};k.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};k.prototype.addEquation=function(l){if(l.enabled){this.equations.push(l)}};k.prototype.addEquations=function(m){for(var n=0,o=m.length;n!==o;n++){var l=m[n];if(l.enabled){this.equations.push(l)}}};k.prototype.removeEquation=function(l){var m=this.equations.indexOf(l);if(m!==-1){this.equations.splice(m,1)}};k.prototype.removeAllEquations=function(){this.equations.length=0};k.GS=1;k.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":47}],45:[function(g,h,e){var i=g("./TupleDictionary");var j=g("./Utils");h.exports=f;function f(){this.overlappingLastState=new i();this.overlappingCurrentState=new i();this.recordPool=[];this.tmpDict=new i();this.tmpArray1=[]}f.prototype.tick=function(){var o=this.overlappingLastState;var p=this.overlappingCurrentState;var m=p.keys.length;while(m--){var n=p.keys[m];this.recordPool.push(p.getByKey(n))}o.reset();o.copy(p);p.reset()};f.prototype.setOverlapping=function(r,o,q,m){var l=this.overlappingLastState;var p=this.overlappingCurrentState;if(!p.get(o.id,m.id)){var n;if(this.recordPool.length){n=this.recordPool.pop()}else{n=new k(r,o,q,m)}p.set(o.id,m.id,n)}};f.prototype.getNewOverlaps=function(l){return this.getDiff(this.overlappingLastState,this.overlappingCurrentState,l)};f.prototype.getEndOverlaps=function(l){return this.getDiff(this.overlappingCurrentState,this.overlappingLastState,l)};f.prototype.getDiff=function(o,m,u){var u=u||[];var s=o;var r=m;u.length=0;var p=r.keys.length;while(p--){var t=r.keys[p];var q=r.data[t];if(!q){throw new Error("Key "+t+" had no data!")}var n=s.data[t];if(!n){u.push(q)}}return u};f.prototype.isNewOverlap=function(n,m){var l=n.id|0,o=m.id|0;return !!!this.overlappingLastState.get(l,o)&&!!this.overlappingCurrentState.get(l,o)};f.prototype.getNewBodyOverlaps=function(l){this.tmpArray1.length=0;var m=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(m,l)};f.prototype.getEndBodyOverlaps=function(l){this.tmpArray1.length=0;var m=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(m,l)};f.prototype.getBodyDiff=function(q,m){m=m||[];var o=this.tmpDict;var n=q.length;while(n--){var p=q[n];o.set(p.bodyA.id|0,p.bodyB.id|0,p)}n=o.keys.length;while(n--){var p=o.keys[n];m.push(p.bodyA,p.bodyB)}o.reset();return m};function k(o,m,n,l){this.shapeA=m;this.shapeB=l;this.bodyA=o;this.bodyB=n}k.prototype.set=function(o,m,n,l){k.call(this,o,m,n,l)}},{"./TupleDictionary":46,"./Utils":47}],46:[function(f,g,e){var i=f("./Utils");g.exports=h;function h(){this.data=[];this.keys=[]}h.prototype.getKey=function(k,j){k=k|0;j=j|0;if((k|0)===(j|0)){return -1}return((k|0)>(j|0)?(k<<16)|(j&65535):(j<<16)|(k&65535))|0};h.prototype.getByKey=function(j){j=j|0;return this.data[j]};h.prototype.get=function(m,k){m=m|0;k=k|0;var l=this.getKey(m,k)|0;return this.data[l]};h.prototype.set=function(m,k,n){if(!n){throw new Error("No data!")}m=m|0;k=k|0;var l=this.getKey(m,k)|0;if(!this.get(m,k)){this.keys.push(l)}this.data[l]=n;return l};h.prototype.reset=function(){var n=this.data,m=this.keys;var j=m.length|0;while(j--){var k=m[j]|0;n[k]=undefined}m.length=0};h.prototype.copy=function(m){this.reset();i.appendArray(this.keys,m.keys);var j=m.keys.length|0;while(j--){var k=m.keys[j]|0;this.data[k]=m.data[k]}}},{"./Utils":47}],47:[function(f,g,e){g.exports=h;function h(){}h.appendArray=function(l,k){if(k.length<150000){l.push.apply(l,k)}else{for(var m=0,j=k.length;m!==j;++m){l.push(k[m])}}};h.splice=function(n,k,m){m=m||1;for(var l=k,j=n.length-m;l<j;l++){n[l]=n[l+m]}n.length=j};h.ARRAY_TYPE=window.Float32Array||Array;h.extend=function(j,i){for(var k in i){j[k]=i[k]}};h.defaults=function(i,k){i=i||{};for(var j in k){if(!(j in i)){i[j]=k[j]}}return i}},{}],48:[function(g,i,f){var j=g("../objects/Body");i.exports=h;function h(){this.equations=[];this.bodies=[]}h.prototype.reset=function(){this.equations.length=this.bodies.length=0};var e=[];h.prototype.getBodies=function(l){var m=l||[],n=this.equations;e.length=0;for(var o=0;o!==n.length;o++){var k=n[o];if(e.indexOf(k.bodyA.id)===-1){m.push(k.bodyA);e.push(k.bodyA.id)}if(e.indexOf(k.bodyB.id)===-1){m.push(k.bodyB);e.push(k.bodyB.id)}}return m};h.prototype.wantsToSleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];if(k.motionState===j.DYNAMIC&&!k.wantsToSleep){return false}}return true};h.prototype.sleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];k.sleep()}return true}},{"../objects/Body":31}],49:[function(f,h,e){var k=f("../math/vec2"),g=f("./Island"),j=f("./IslandNode"),l=f("../objects/Body");h.exports=i;function i(m){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}i.getUnvisitedNode=function(m){var n=m.length;for(var o=0;o!==n;o++){var p=m[o];if(!p.visited&&p.body.motionState===l.DYNAMIC){return p}}return false};i.prototype.visit=function(r,o,p){o.push(r.body);var n=r.equations.length;for(var q=0;q!==n;q++){var m=r.equations[q];if(p.indexOf(m)===-1){p.push(m)}}};i.prototype.bfs=function(o,n,p){var m=this.queue;m.length=0;m.push(o);o.visited=true;this.visit(o,n,p);while(m.length){var q=m.pop();var r;while((r=i.getUnvisitedNode(q.neighbors))){r.visited=true;this.visit(r,n,p);if(r.body.motionState===l.DYNAMIC){m.push(r)}}}};i.prototype.split=function(y){var m=y.bodies,o=this.nodes,n=this.equations;while(o.length){this._nodePool.push(o.pop())}for(var v=0;v!==m.length;v++){if(this._nodePool.length){var s=this._nodePool.pop();s.reset();s.body=m[v];o.push(s)}else{o.push(new j(m[v]))}}for(var t=0;t!==n.length;t++){var z=n[t],v=m.indexOf(z.bodyA),u=m.indexOf(z.bodyB),r=o[v],p=o[u];r.neighbors.push(p);p.neighbors.push(r);r.equations.push(z);p.equations.push(z)}var x=this.islands;while(x.length){var w=x.pop();w.reset();this._islandPool.push(w)}var q;while((q=i.getUnvisitedNode(o))){var w=this._islandPool.length?this._islandPool.pop():new g();this.bfs(q,w.bodies,w.equations);x.push(w)}return x}},{"../math/vec2":30,"../objects/Body":31,"./Island":48,"./IslandNode":50}],50:[function(f,g,e){g.exports=h;function h(i){this.body=i;this.neighbors=[];this.equations=[];this.visited=false}h.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],51:[function(n,l,U){var O=n("../solver/GSSolver"),af=n("../solver/Solver"),S=n("../collision/NaiveBroadphase"),ab=n("../math/vec2"),X=n("../shapes/Circle"),E=n("../shapes/Rectangle"),G=n("../shapes/Convex"),m=n("../shapes/Line"),w=n("../shapes/Plane"),ae=n("../shapes/Capsule"),ac=n("../shapes/Particle"),D=n("../events/EventEmitter"),C=n("../objects/Body"),q=n("../shapes/Shape"),Y=n("../objects/Spring"),F=n("../material/Material"),v=n("../material/ContactMaterial"),N=n("../constraints/DistanceConstraint"),B=n("../constraints/Constraint"),M=n("../constraints/LockConstraint"),I=n("../constraints/RevoluteConstraint"),u=n("../constraints/PrismaticConstraint"),ad=n("../constraints/GearConstraint"),j=n("../../package.json"),i=n("../collision/Broadphase"),s=n("../collision/SAPBroadphase"),L=n("../collision/Narrowphase"),P=n("../utils/Utils"),e=n("../utils/OverlapKeeper"),f=n("./IslandManager");l.exports=z;if(typeof performance==="undefined"){performance={}}if(!performance.now){var k=Date.now();if(performance.timing&&performance.timing.navigationStart){k=performance.timing.navigationStart}performance.now=function(){return Date.now()-k}}function z(ah){D.apply(this);ah=ah||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=ah.solver||new O();this.narrowphase=new L(this);this.islandManager=new f();this.gravity=ab.fromValues(0,-9.78);if(ah.gravity){ab.copy(this.gravity,ah.gravity)}this.frictionGravity=ab.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.doProfiling=ah.doProfiling||false;this.lastStepTime=0;this.broadphase=ah.broadphase||new S();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new F();this.defaultContactMaterial=new v(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.stepping=false;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof(ah.islandSplit)!=="undefined"?!!ah.islandSplit:false;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep",};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null,};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null,};this.postBroadphaseEvent={type:"postBroadphase",pairs:null,};this.enableBodySleeping=false;this.enableIslandSleeping=false;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[],};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null,};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new e()}z.prototype=new Object(D.prototype);z.prototype.addConstraint=function(ah){this.constraints.push(ah)};z.prototype.addContactMaterial=function(ah){this.contactMaterials.push(ah)};z.prototype.removeContactMaterial=function(ai){var ah=this.contactMaterials.indexOf(ai);if(ah!==-1){P.splice(this.contactMaterials,ah,1)}};z.prototype.getContactMaterial=function(al,ak){var aj=this.contactMaterials;for(var ai=0,am=aj.length;ai!==am;ai++){var ah=aj[ai];if((ah.materialA===al)&&(ah.materialB===ak)||(ah.materialA===ak)&&(ah.materialB===al)){return ah}}return false};z.prototype.removeConstraint=function(ai){var ah=this.constraints.indexOf(ai);if(ah!==-1){P.splice(this.constraints,ah,1)}};var aa=ab.create(),p=ab.create(),Z=ab.create(),h=ab.create(),T=ab.create(),t=ab.create(),W=ab.create(),K=ab.fromValues(0,0),y=ab.fromValues(0,0),g=ab.fromValues(0,0),H=ab.fromValues(0,0);z.prototype.step=function(ah,an,ai){ai=ai||10;an=an||0;if(an===0){this.internalStep(ah);this.time+=ah}else{var ap=Math.floor((this.time+an)/ah)-Math.floor(this.time/ah);ap=Math.min(ap,ai);for(var ak=0;ak!==ap;ak++){this.internalStep(ah)}this.time+=an;var al=this.time%ah;var am=al/ah;for(var aj=0;aj!==this.bodies.length;aj++){var ao=this.bodies[aj];if(ao.motionState!==C.STATIC&&ao.sleepState!==C.SLEEPING){ab.sub(H,ao.position,ao.previousPosition);ab.scale(H,H,am);ab.add(ao.interpolatedPosition,ao.position,H);ao.interpolatedAngle=ao.angle+(ao.angle-ao.previousAngle)*am}else{ab.copy(ao.interpolatedPosition,ao.position);ao.interpolatedAngle=ao.angle}}}};var A=[];z.prototype.internalStep=function(ap){this.stepping=true;var aN=this,an=this.doProfiling,aH=this.springs.length,aA=this.springs,a5=this.bodies,a2=this.gravity,aD=this.solver,ao=this.bodies.length,aM=this.broadphase,a6=this.narrowphase,al=this.constraints,aL,aK,aE=T,aY=t,aw=W,aJ=ab.scale,am=ab.add,a4=ab.rotate,aB=this.islandManager;this.lastTimeStep=ap;if(an){aL=performance.now()}if(this.useWorldGravityAsFrictionGravity){var ah=ab.length(this.gravity);if(ah===0&&this.useFrictionGravityOnZeroGravity){}else{this.frictionGravity=ah}}if(this.applyGravity){for(var a0=0;a0!==ao;a0++){var ba=a5[a0],aI=ba.force;if(ba.motionState!==C.DYNAMIC||ba.sleepState===C.SLEEPING){continue}ab.scale(aw,a2,ba.mass*ba.gravityScale);am(aI,aI,aw)}}if(this.applySpringForces){for(var a0=0;a0!==aH;a0++){var aQ=aA[a0];aQ.applyForce()}}if(this.applyDamping){for(var a0=0;a0!==ao;a0++){var ba=a5[a0];if(ba.motionState===C.DYNAMIC){ba.applyDamping(ap)}}}var az=aM.getCollisionPairs(this);var aT=this.disabledBodyCollisionPairs;for(var a0=aT.length-2;a0>=0;a0-=2){for(var aZ=az.length-2;aZ>=0;aZ-=2){if((aT[a0]===az[aZ]&&aT[a0+1]===az[aZ+1])||(aT[a0+1]===az[aZ]&&aT[a0]===az[aZ+1])){az.splice(aZ,2)}}}var ak=al.length;for(a0=0;a0!==ak;a0++){var a9=al[a0];if(!a9.collideConnected){for(var aZ=az.length-2;aZ>=0;aZ-=2){if((a9.bodyA===az[aZ]&&a9.bodyB===az[aZ+1])||(a9.bodyB===az[aZ]&&a9.bodyA===az[aZ+1])){az.splice(aZ,2)}}}}this.postBroadphaseEvent.pairs=az;this.emit(this.postBroadphaseEvent);a6.reset(this);for(var a0=0,aF=az.length;a0!==aF;a0+=2){var a3=az[a0],a1=az[a0+1];for(var aX=0,at=a3.shapes.length;aX!==at;aX++){var ay=a3.shapes[aX],aP=a3.shapeOffsets[aX],av=a3.shapeAngles[aX];for(var aV=0,ar=a1.shapes.length;aV!==ar;aV++){var ax=a1.shapes[aV],aO=a1.shapeOffsets[aV],au=a1.shapeAngles[aV];var aG=this.defaultContactMaterial;if(ay.material&&ax.material){var aS=this.getContactMaterial(ay.material,ax.material);if(aS){aG=aS}}this.runNarrowphase(a6,a3,ay,aP,av,a1,ax,aO,au,aG,this.frictionGravity)}}}for(var a0=0;a0!==ao;a0++){var aC=a5[a0];if(aC._wakeUpAfterNarrowphase){aC.wakeUp();aC._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(A);var a7=this.endContactEvent;var aV=A.length;while(aV--){var a8=A[aV];a7.shapeA=a8.shapeA;a7.shapeB=a8.shapeB;a7.bodyA=a8.bodyA;a7.bodyB=a8.bodyA;this.emit(a7)}}this.overlapKeeper.tick();var aq=this.preSolveEvent;aq.contactEquations=a6.contactEquations;aq.frictionEquations=a6.frictionEquations;this.emit(aq);var ak=al.length;for(a0=0;a0!==ak;a0++){al[a0].update()}if(a6.contactEquations.length||a6.frictionEquations.length||al.length){if(this.islandSplit){aB.equations.length=0;P.appendArray(aB.equations,a6.contactEquations);P.appendArray(aB.equations,a6.frictionEquations);for(a0=0;a0!==ak;a0++){P.appendArray(aB.equations,al[a0].equations)}aB.split(this);for(var a0=0;a0!==aB.islands.length;a0++){var aW=aB.islands[a0];if(aW.equations.length){aD.solveIsland(ap,aW)}}}else{aD.addEquations(a6.contactEquations);aD.addEquations(a6.frictionEquations);for(a0=0;a0!==ak;a0++){aD.addEquations(al[a0].equations)}if(this.solveConstraints){aD.solve(ap,this)}aD.removeAllEquations()}}for(var a0=0;a0!==ao;a0++){var aC=a5[a0];if(aC.sleepState!==C.SLEEPING&&aC.motionState!==C.STATIC){z.integrateBody(aC,ap)}}for(var a0=0;a0!==ao;a0++){a5[a0].setZeroForce()}if(an){aK=performance.now();aN.lastStepTime=aK-aL}if(this.emitImpactEvent&&this.has("impact")){var aR=this.impactEvent;for(var a0=0;a0!==a6.contactEquations.length;a0++){var aU=a6.contactEquations[a0];if(aU.firstImpact){aR.bodyA=aU.bodyA;aR.bodyB=aU.bodyB;aR.shapeA=aU.shapeA;aR.shapeB=aU.shapeB;aR.contactEquation=aU;this.emit(aR)}}}if(this.enableBodySleeping){for(a0=0;a0!==ao;a0++){a5[a0].sleepTick(this.time,false,ap)}}else{if(this.enableIslandSleeping&&this.islandSplit){for(a0=0;a0!==ao;a0++){a5[a0].sleepTick(this.time,true,ap)}for(var a0=0;a0<this.islandManager.islands.length;a0++){var aW=this.islandManager.islands[a0];if(aW.wantsToSleep()){aW.sleep()}}}}this.stepping=false;if(this.bodiesToBeRemoved.length){for(var a0=0;a0!==this.bodiesToBeRemoved.length;a0++){this.removeBody(this.bodiesToBeRemoved[a0])}this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var o=ab.create();var J=ab.create();z.integrateBody=function(ah,ak){var ai=ah.invMass,al=ah.force,am=ah.position,aj=ah.velocity;ab.copy(ah.previousPosition,ah.position);ah.previousAngle=ah.angle;if(!ah.fixedRotation){ah.angularVelocity+=ah.angularForce*ah.invInertia*ak;ah.angle+=ah.angularVelocity*ak}ab.scale(o,al,ak*ai);ab.add(aj,o,aj);ab.scale(J,aj,ak);ab.add(am,am,J);ah.aabbNeedsUpdate=true};z.prototype.runNarrowphase=function(ah,am,aH,ax,aA,ak,aG,aw,az,ar,al){if(!((aH.collisionGroup&aG.collisionMask)!==0&&(aG.collisionGroup&aH.collisionMask)!==0)){return}ab.rotate(K,ax,am.angle);ab.rotate(y,aw,ak.angle);ab.add(K,K,am.position);ab.add(y,y,ak.position);var aF=aA+am.angle;var ao=az+ak.angle;ah.enableFriction=ar.friction>0;ah.frictionCoefficient=ar.friction;var an;if(am.motionState===C.STATIC||am.motionState===C.KINEMATIC){an=ak.mass}else{if(ak.motionState===C.STATIC||ak.motionState===C.KINEMATIC){an=am.mass}else{an=(am.mass*ak.mass)/(am.mass+ak.mass)}}ah.slipForce=ar.friction*al*an;ah.restitution=ar.restitution;ah.surfaceVelocity=ar.surfaceVelocity;ah.frictionStiffness=ar.frictionStiffness;ah.frictionRelaxation=ar.frictionRelaxation;ah.stiffness=ar.stiffness;ah.relaxation=ar.relaxation;var ap=ah[aH.type|aG.type],aJ=0;if(ap){var aB=aH.sensor||aG.sensor;var aE=ah.frictionEquations.length;if(aH.type<aG.type){aJ=ap.call(ah,am,aH,K,aF,ak,aG,y,ao,aB)}else{aJ=ap.call(ah,ak,aG,y,ao,am,aH,K,aF,aB)}var aI=ah.frictionEquations.length-aE;if(aJ){if(am.allowSleep&&am.motionState===C.DYNAMIC&&am.sleepState===C.SLEEPING&&ak.sleepState===C.AWAKE&&ak.motionState!==C.STATIC){var aq=ab.squaredLength(ak.velocity)+Math.pow(ak.angularVelocity,2);var au=Math.pow(ak.sleepSpeedLimit,2);if(aq>=au*2){am._wakeUpAfterNarrowphase=true}}if(ak.allowSleep&&ak.motionState===C.DYNAMIC&&ak.sleepState===C.SLEEPING&&am.sleepState===C.AWAKE&&am.motionState!==C.STATIC){var at=ab.squaredLength(am.velocity)+Math.pow(am.angularVelocity,2);var av=Math.pow(am.sleepSpeedLimit,2);if(at>=av*2){ak._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(am,aH,ak,aG);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(aH,aG)){var aD=this.beginContactEvent;aD.shapeA=aH;aD.shapeB=aG;aD.bodyA=am;aD.bodyB=ak;aD.contactEquations.length=0;if(typeof(aJ)==="number"){for(var ay=ah.contactEquations.length-aJ;ay<ah.contactEquations.length;ay++){aD.contactEquations.push(ah.contactEquations[ay])}}this.emit(aD)}if(typeof(aJ)==="number"&&aI>1){for(var ay=ah.frictionEquations.length-aI;ay<ah.frictionEquations.length;ay++){var aC=ah.frictionEquations[ay];aC.setSlipForce(aC.getSlipForce()/aI)}}}}};z.prototype.addSpring=function(ah){this.springs.push(ah);this.addSpringEvent.spring=ah;this.emit(this.addSpringEvent)};z.prototype.removeSpring=function(ai){var ah=this.springs.indexOf(ai);if(ah===-1){P.splice(this.springs,ah,1)}};z.prototype.addBody=function(ah){if(this.bodies.indexOf(ah)===-1){this.bodies.push(ah);ah.world=this;this.addBodyEvent.body=ah;this.emit(this.addBodyEvent)}};z.prototype.removeBody=function(ai){if(this.stepping){this.bodiesToBeRemoved.push(ai)}else{ai.world=null;var ah=this.bodies.indexOf(ai);if(ah!==-1){P.splice(this.bodies,ah,1);this.removeBodyEvent.body=ai;ai.resetConstraintVelocity();this.emit(this.removeBodyEvent)}}};z.prototype.getBodyById=function(ak){var ai=this.bodies;for(var aj=0;aj<ai.length;aj++){var ah=ai[aj];if(ah.id===ak){return ah}}return false};z.prototype.disableBodyCollision=function(ai,ah){this.disabledBodyCollisionPairs.push(ai,ah)};z.prototype.enableBodyCollision=function(ak,aj){var ai=this.disabledBodyCollisionPairs;for(var ah=0;ah<ai.length;ah+=2){if((ai[ah]===ak&&ai[ah+1]===aj)||(ai[ah+1]===ak&&ai[ah]===aj)){ai.splice(ah,2);return}}};function ag(ah){if(!ah){return ah}return[ah[0],ah[1]]}function x(ai,ah){for(var aj in ah){ai[aj]=ah[aj]}}function r(ah){return{id:ah.id,materialA:ah.materialA.id,materialB:ah.materialB.id,friction:ah.friction,restitution:ah.restitution,stiffness:ah.stiffness,relaxation:ah.relaxation,frictionStiffness:ah.frictionStiffness,frictionRelaxation:ah.frictionRelaxation,}}z.prototype.toJSON=function(){var an=this;var av={p2:j.version,bodies:[],springs:[],solver:{},gravity:ag(an.gravity),broadphase:{},distanceConstraints:[],revoluteConstraints:[],prismaticConstraints:[],lockConstraints:[],gearConstraints:[],contactMaterials:[],materials:[],defaultContactMaterial:r(an.defaultContactMaterial),islandSplit:an.islandSplit,enableIslandSleeping:an.enableIslandSleeping,enableBodySleeping:an.enableBodySleeping,};var am=av.solver,aj=an.solver;if(aj.type===af.GS){am.type="GSSolver";am.iterations=aj.iterations}var aB=av.broadphase,ai=an.broadphase;if(ai.type===i.NAIVE){aB.type="NaiveBroadphase"}else{if(ai.type===i.SAP){aB.type="SAPBroadphase"}else{console.error("Broadphase not supported: "+ai.type)}}for(var au=0;au!==an.springs.length;au++){var aj=an.springs[au];av.springs.push({bodyA:an.bodies.indexOf(aj.bodyA),bodyB:an.bodies.indexOf(aj.bodyB),stiffness:aj.stiffness,damping:aj.damping,restLength:aj.restLength,localAnchorA:ag(aj.localAnchorA),localAnchorB:ag(aj.localAnchorB),})}for(var au=0;au<an.constraints.length;au++){var aw=an.constraints[au];var aA={bodyA:an.bodies.indexOf(aw.bodyA),bodyB:an.bodies.indexOf(aw.bodyB),collideConnected:aw.collideConnected};switch(aw.type){case B.DISTANCE:x(aA,{distance:aw.distance,maxForce:aw.getMaxForce(),});av.distanceConstraints.push(aA);break;case B.REVOLUTE:x(aA,{pivotA:ag(aw.pivotA),pivotB:ag(aw.pivotB),maxForce:aw.maxForce,motorSpeed:aw.getMotorSpeed()||0,motorEnabled:!!aw.getMotorSpeed(),lowerLimit:aw.lowerLimit,lowerLimitEnabled:aw.lowerLimitEnabled,upperLimit:aw.upperLimit,upperLimitEnabled:aw.upperLimitEnabled,});av.revoluteConstraints.push(aA);break;case B.PRISMATIC:x(aA,{localAxisA:ag(aw.localAxisA),localAnchorA:ag(aw.localAnchorA),localAnchorB:ag(aw.localAnchorB),maxForce:aw.maxForce,upperLimitEnabled:aw.upperLimitEnabled,lowerLimitEnabled:aw.lowerLimitEnabled,upperLimit:aw.upperLimit,lowerLimit:aw.lowerLimit,motorEnabled:aw.motorEnabled,motorSpeed:aw.motorSpeed,});av.prismaticConstraints.push(aA);break;case B.LOCK:x(aA,{localOffsetB:ag(aw.localOffsetB),localAngleB:aw.localAngleB,maxForce:aw.getMaxForce(),});av.lockConstraints.push(aA);break;case B.GEAR:x(aA,{angle:aw.angle,ratio:aw.ratio,maxForce:aw.maxForce||1000000,});av.gearConstraints.push(aA);break;default:console.error("Constraint not supported yet: ",aw.type);break}}for(var au=0;au!==an.bodies.length;au++){var ax=an.bodies[au],aq=ax.shapes,ap={id:ax.id,mass:ax.mass,angle:ax.angle,position:ag(ax.position),velocity:ag(ax.velocity),angularVelocity:ax.angularVelocity,force:ag(ax.force),motionState:ax.motionState,fixedRotation:ax.fixedRotation,circleShapes:[],planeShapes:[],particleShapes:[],lineShapes:[],rectangleShapes:[],convexShapes:[],capsuleShapes:[],};if(ax.concavePath){ap.concavePath=ax.concavePath}for(var at=0;at<aq.length;at++){var aj=aq[at],ak={};ak.offset=ag(ax.shapeOffsets[at]);ak.angle=ax.shapeAngles[at];ak.collisionGroup=aj.collisionGroup;ak.collisionMask=aj.collisionMask;ak.material=aj.material?aj.material.id:null;switch(aj.type){case q.CIRCLE:x(ak,{radius:aj.radius,});ap.circleShapes.push(ak);break;case q.PLANE:ap.planeShapes.push(ak);break;case q.PARTICLE:ap.particleShapes.push(ak);break;case q.LINE:ak.length=aj.length;ap.lineShapes.push(ak);break;case q.RECTANGLE:x(ak,{width:aj.width,height:aj.height});ap.rectangleShapes.push(ak);break;case q.CONVEX:var az=[];for(var ar=0;ar<aj.vertices.length;ar++){az.push(ag(aj.vertices[ar]))}x(ak,{vertices:az});ap.convexShapes.push(ak);break;case q.CAPSULE:x(ak,{length:aj.length,radius:aj.radius});ap.capsuleShapes.push(ak);break;default:console.error("Shape type not supported yet!");break}}av.bodies.push(ap)}for(var au=0;au<an.contactMaterials.length;au++){var ah=an.contactMaterials[au];av.contactMaterials.push(r(ah))}var ay={};for(var au=0;au<an.contactMaterials.length;au++){var ah=an.contactMaterials[au];ay[ah.materialA.id+""]=ah.materialA;ay[ah.materialB.id+""]=ah.materialB}for(var al in ay){var ao=ay[parseInt(al)];av.materials.push({id:ao.id,})}return av};z.prototype.fromJSON=function(ax){this.clear();if(!ax.p2){return false}var am=this;ab.copy(am.gravity,ax.gravity);am.islandSplit=ax.islandSplit;am.enableIslandSleeping=ax.enableIslandSleeping;am.enableBodySleeping=ax.enableBodySleeping;switch(ax.solver.type){case"GSSolver":var aq=ax.solver,an=new O();am.solver=an;an.iterations=aq.iterations;break;default:throw new Error("Solver type not recognized: "+ax.solver.type)}switch(ax.broadphase.type){case"NaiveBroadphase":am.broadphase=new S();break;case"SAPBroadphase":am.broadphase=new s();break}am.broadphase.setWorld(am);var ak=am.bodies;var ar={};for(var av=0;av!==ax.materials.length;av++){var aw=ax.materials[av];var at=new F();ar[aw.id+""]=at;at.id=aw.id}am.defaultMaterial.id=ax.defaultContactMaterial.materialA;for(var av=0;av!==ax.bodies.length;av++){var aB=ax.bodies[av];var az=new C({mass:aB.mass,position:aB.position,angle:aB.angle,velocity:aB.velocity,angularVelocity:aB.angularVelocity,force:aB.force,fixedRotation:aB.fixedRotation,});az.id=aB.id;az.motionState=aB.motionState;for(var au=0;au<aB.circleShapes.length;au++){var an=aB.circleShapes[au];ah(az,new X(an.radius),an)}for(var au=0;au<aB.planeShapes.length;au++){var an=aB.planeShapes[au];ah(az,new w(),an)}for(var au=0;au<aB.particleShapes.length;au++){var an=aB.particleShapes[au];ah(az,new ac(),an)}for(var au=0;au<aB.lineShapes.length;au++){var an=aB.lineShapes[au];ah(az,new m(an.length),an)}for(var au=0;au<aB.rectangleShapes.length;au++){var an=aB.rectangleShapes[au];ah(az,new E(an.width,an.height),an)}for(var au=0;au<aB.convexShapes.length;au++){var an=aB.convexShapes[au];ah(az,new G(an.vertices),an)}for(var au=0;au<aB.capsuleShapes.length;au++){var an=aB.capsuleShapes[au];ah(az,new ae(an.length,an.radius),an)}function ah(aD,aF,aE){aF.collisionMask=aE.collisionMask;aF.collisionGroup=aE.collisionGroup;if(aE.material){aF.material=ar[aE.material+""]}aD.addShape(aF,aE.offset,aE.angle)}if(aB.concavePath){az.concavePath=aB.concavePath}am.addBody(az)}for(var av=0;av<ax.springs.length;av++){var aq=ax.springs[av];var aj=ak[aq.bodyA],ai=ak[aq.bodyB];if(!aj){this.error="instance.springs["+av+"] references instance.body["+aq.bodyA+"], which does not exist.";return false}if(!ai){this.error="instance.springs["+av+"] references instance.body["+aq.bodyB+"], which does not exist.";return false}var an=new Y(aj,ai,{stiffness:aq.stiffness,damping:aq.damping,restLength:aq.restLength,localAnchorA:aq.localAnchorA,localAnchorB:aq.localAnchorB,});am.addSpring(an)}for(var av=0;av<ax.contactMaterials.length;av++){var aw=ax.contactMaterials[av],aC=ar[aw.materialA+""],aA=ar[aw.materialB+""];if(!aC){this.error="Reference to material id "+aw.materialA+": material not found";return false}if(!aA){this.error="Reference to material id "+aw.materialB+": material not found";return false}var al=new v(aC,aA,{friction:aw.friction,restitution:aw.restitution,stiffness:aw.stiffness,relaxation:aw.relaxation,frictionStiffness:aw.frictionStiffness,frictionRelaxation:aw.frictionRelaxation,});al.id=aw.id;am.addContactMaterial(al)}var aw=ax.defaultContactMaterial,aC=am.defaultMaterial,aA=am.defaultMaterial;var al=new v(aC,aA,{friction:aw.friction,restitution:aw.restitution,stiffness:aw.stiffness,relaxation:aw.relaxation,frictionStiffness:aw.frictionStiffness,frictionRelaxation:aw.frictionRelaxation,});al.id=aw.id;am.defaultContactMaterial=al;for(var av=0;av<ax.distanceConstraints.length;av++){var ay=ax.distanceConstraints[av];am.addConstraint(new N(ak[ay.bodyA],ak[ay.bodyB],ay.distance,{maxForce:ay.maxForce,collideConnected:ay.collideConnected}))}for(var av=0;av<ax.revoluteConstraints.length;av++){var ay=ax.revoluteConstraints[av];var ao=new I(ak[ay.bodyA],ay.pivotA,ak[ay.bodyB],ay.pivotB,{maxForce:ay.maxForce,collideConnected:ay.collideConnected});if(ay.motorEnabled){ao.enableMotor()}ao.setMotorSpeed(ay.motorSpeed);ao.lowerLimit=ay.lowerLimit;ao.upperLimit=ay.upperLimit;ao.lowerLimitEnabled=ay.lowerLimitEnabled;ao.upperLimitEnabled=ay.upperLimitEnabled;am.addConstraint(ao)}for(var av=0;av<ax.prismaticConstraints.length;av++){var ay=ax.prismaticConstraints[av],ap=new u(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,localAxisA:ay.localAxisA,localAnchorA:ay.localAnchorA,localAnchorB:ay.localAnchorB,collideConnected:ay.collideConnected});ap.motorSpeed=ay.motorSpeed;am.addConstraint(ap)}for(var av=0;av<ax.lockConstraints.length;av++){var ay=ax.lockConstraints[av];am.addConstraint(new M(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,localOffsetB:ay.localOffsetB,localAngleB:ay.localAngleB,collideConnected:ay.collideConnected}))}for(var av=0;av<ax.gearConstraints.length;av++){var ay=ax.gearConstraints[av];am.addConstraint(new ad(ak[ay.bodyA],ak[ay.bodyB],{maxForce:ay.maxForce,angle:ay.angle,ratio:ay.ratio,collideConnected:ay.collideConnected}))}return true};z.prototype.clear=function(){this.time=0;this.fixedStepTime=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var al=this.constraints;for(var ak=al.length-1;ak>=0;ak--){this.removeConstraint(al[ak])}var ah=this.bodies;for(var ak=ah.length-1;ak>=0;ak--){this.removeBody(ah[ak])}var aj=this.springs;for(var ak=aj.length-1;ak>=0;ak--){this.removeSpring(aj[ak])}var ai=this.contactMaterials;for(var ak=ai.length-1;ak>=0;ak--){this.removeContactMaterial(ai[ak])}z.apply(this)};z.prototype.clone=function(){var ah=new z();ah.fromJSON(this.toJSON());return ah};var R=ab.create(),V=ab.fromValues(0,0),Q=ab.fromValues(0,0);z.prototype.hitTest=function(aj,am,ay){ay=ay||0;var ah=new C({position:aj}),au=new ac(),ar=aj,ai=0,an=R,ap=V,aA=Q;ah.addShape(au);var at=this.narrowphase,ao=[];for(var aw=0,al=am.length;aw!==al;aw++){var aB=am[aw];for(var av=0,ax=aB.shapes.length;av!==ax;av++){var aq=aB.shapes[av],ak=aB.shapeOffsets[av]||ap,az=aB.shapeAngles[av]||0;ab.rotate(an,ak,aB.angle);ab.add(an,an,aB.position);var aC=az+aB.angle;if((aq instanceof X&&at.circleParticle(aB,aq,an,aC,ah,au,ar,ai,true))||(aq instanceof G&&at.particleConvex(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof w&&at.particlePlane(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof ae&&at.particleCapsule(ah,au,ar,ai,aB,aq,an,aC,true))||(aq instanceof ac&&ab.squaredLength(ab.sub(aA,an,aj))<ay*ay)){ao.push(aB)}}}return ao};z.prototype.setGlobalEquationParameters=function(ak){ak=ak||{};for(var aj=0;aj!==this.constraints.length;aj++){var al=this.constraints[aj];for(var ai=0;ai!==al.equations.length;ai++){var ah=al.equations[ai];if(typeof(ak.stiffness)!=="undefined"){ah.stiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){ah.relaxation=ak.relaxation}ah.needsUpdate=true}}for(var aj=0;aj!==this.contactMaterials.length;aj++){var al=this.contactMaterials[aj];if(typeof(ak.stiffness)!=="undefined"){al.stiffness=ak.stiffness;al.frictionStiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){al.relaxation=ak.relaxation;al.frictionRelaxation=ak.relaxation}}var al=this.defaultContactMaterial;if(typeof(ak.stiffness)!=="undefined"){al.stiffness=ak.stiffness;al.frictionStiffness=ak.stiffness}if(typeof(ak.relaxation)!=="undefined"){al.relaxation=ak.relaxation;al.frictionRelaxation=ak.relaxation}};z.prototype.setGlobalStiffness=function(ah){this.setGlobalEquationParameters({stiffness:ah})};z.prototype.setGlobalRelaxation=function(ah){this.setGlobalEquationParameters({relaxation:ah})}},{"../../package.json":7,"../collision/Broadphase":9,"../collision/NaiveBroadphase":11,"../collision/Narrowphase":12,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/Spring":32,"../shapes/Capsule":34,"../shapes/Circle":35,"../shapes/Convex":36,"../shapes/Line":38,"../shapes/Particle":39,"../shapes/Plane":40,"../shapes/Rectangle":41,"../shapes/Shape":42,"../solver/GSSolver":43,"../solver/Solver":44,"../utils/OverlapKeeper":45,"../utils/Utils":47,"./IslandManager":49}]},{},[33])(33)});p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;Phaser.Physics.P2=function(a,b){this.game=a;if(typeof b==="undefined"||!b.hasOwnProperty("gravity")||!b.hasOwnProperty("broadphase")){b={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}this.world=new p2.World(b);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new Phaser.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new Phaser.Signal();this.onBodyRemoved=new Phaser.Signal();this.onSpringAdded=new Phaser.Signal();this.onSpringRemoved=new Phaser.Signal();this.onConstraintAdded=new Phaser.Signal();this.onConstraintRemoved=new Phaser.Signal();this.onContactMaterialAdded=new Phaser.Signal();this.onContactMaterialRemoved=new Phaser.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new Phaser.Signal();this.onEndContact=new Phaser.Signal();if(b.hasOwnProperty("mpx")&&b.hasOwnProperty("pxm")&&b.hasOwnProperty("mpxi")&&b.hasOwnProperty("pxmi")){this.mpx=b.mpx;this.mpxi=b.mpxi;this.pxm=b.pxm;this.pxmi=b.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)};Phaser.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){var a=this._toRemove.length;while(a--){this.removeBody(this._toRemove[a])}this._toRemove.length=0},enable:function(b,a,d){if(typeof a==="undefined"){a=false}if(typeof d==="undefined"){d=true}var c=1;if(Array.isArray(b)){c=b.length;while(c--){if(b[c] instanceof Phaser.Group){this.enable(b[c].children,a,d)}else{this.enableBody(b[c],a);if(d&&b[c].hasOwnProperty("children")&&b[c].children.length>0){this.enable(b[c],a,true)}}}}else{if(b instanceof Phaser.Group){this.enable(b.children,a,d)}else{this.enableBody(b,a);if(d&&b.hasOwnProperty("children")&&b.children.length>0){this.enable(b.children,a,true)}}}},enableBody:function(b,a){if(b.hasOwnProperty("body")&&b.body===null){b.body=new Phaser.Physics.P2.Body(this.game,b,b.x,b.y,1);b.body.debug=a;b.anchor.set(0.5)}},setImpactEvents:function(a){if(a){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(b,a){this.postBroadphaseCallback=b;this.callbackContext=a;if(b!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(b){if(this.postBroadphaseCallback){var a=b.pairs.length;while(a-=2){if(b.pairs[a].parent&&b.pairs[a+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,b.pairs[a].parent,b.pairs[a+1].parent)){b.pairs.splice(a,2)}}}},impactHandler:function(e){if(e.bodyA.parent&&e.bodyB.parent){var d=e.bodyA.parent;var c=e.bodyB.parent;if(d._bodyCallbacks[e.bodyB.id]){d._bodyCallbacks[e.bodyB.id].call(d._bodyCallbackContext[e.bodyB.id],d,c,e.shapeA,e.shapeB)}if(c._bodyCallbacks[e.bodyA.id]){c._bodyCallbacks[e.bodyA.id].call(c._bodyCallbackContext[e.bodyA.id],c,d,e.shapeB,e.shapeA)}if(d._groupCallbacks[e.shapeB.collisionGroup]){d._groupCallbacks[e.shapeB.collisionGroup].call(d._groupCallbackContext[e.shapeB.collisionGroup],d,c,e.shapeA,e.shapeB)}if(c._groupCallbacks[e.shapeA.collisionGroup]){c._groupCallbacks[e.shapeA.collisionGroup].call(c._groupCallbackContext[e.shapeA.collisionGroup],c,d,e.shapeB,e.shapeA)}}},beginContactHandler:function(a){this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations);if(a.bodyA.parent){a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB,a.contactEquations)}if(a.bodyB.parent){a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA,a.contactEquations)}},endContactHandler:function(a){this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB);if(a.bodyA.parent){a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.shapeA,a.shapeB)}if(a.bodyB.parent){a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.shapeB,a.shapeA)}},setBoundsToWorld:function(e,b,d,a,c){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,e,b,d,a,c)},setWorldMaterial:function(c,e,b,d,a){if(typeof e==="undefined"){e=true}if(typeof b==="undefined"){b=true}if(typeof d==="undefined"){d=true}if(typeof a==="undefined"){a=true}if(e&&this.walls.left){this.walls.left.shapes[0].material=c}if(b&&this.walls.right){this.walls.right.shapes[0].material=c}if(d&&this.walls.top){this.walls.top.shapes[0].material=c}if(a&&this.walls.bottom){this.walls.bottom.shapes[0].material=c}},updateBoundsCollisionGroup:function(b){var a=this.everythingCollisionGroup.mask;if(typeof b==="undefined"){a=this.boundsCollisionGroup.mask}if(this.walls.left){this.walls.left.shapes[0].collisionGroup=a}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=a}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=a}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=a}},setBounds:function(g,e,b,i,c,h,f,a,d){if(typeof c==="undefined"){c=true}if(typeof h==="undefined"){h=true}if(typeof f==="undefined"){f=true}if(typeof a==="undefined"){a=true}if(typeof d==="undefined"){d=true}if(this.walls.left){this.world.removeBody(this.walls.left)}if(this.walls.right){this.world.removeBody(this.walls.right)}if(this.walls.top){this.world.removeBody(this.walls.top)}if(this.walls.bottom){this.world.removeBody(this.walls.bottom)}if(c){this.walls.left=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(e)],angle:1.5707963267948966});this.walls.left.addShape(new p2.Plane());if(d){this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.left)}if(h){this.walls.right=new p2.Body({mass:0,position:[this.pxmi(g+b),this.pxmi(e)],angle:-1.5707963267948966});this.walls.right.addShape(new p2.Plane());if(d){this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.right)}if(f){this.walls.top=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(e)],angle:-3.141592653589793});this.walls.top.addShape(new p2.Plane());if(d){this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.top)}if(a){this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(g),this.pxmi(i)]});this.walls.bottom.addShape(new p2.Plane());if(d){this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask}this.world.addBody(this.walls.bottom)}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},clear:function(){this.world.clear();this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this._collisionGroupID=2;this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(a){if(a.data.world){return false}else{this.world.addBody(a.data);this.onBodyAdded.dispatch(a);return true}},removeBody:function(a){if(a.data.world==this.world){this.world.removeBody(a.data);this.onBodyRemoved.dispatch(a)}return a},addSpring:function(a){this.world.addSpring(a);this.onSpringAdded.dispatch(a);return a},removeSpring:function(a){this.world.removeSpring(a);this.onSpringRemoved.dispatch(a);return a},createDistanceConstraint:function(c,b,d,a){c=this.getBody(c);b=this.getBody(b);if(!c||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.DistanceConstraint(this,c,b,d,a))}},createGearConstraint:function(d,b,c,a){d=this.getBody(d);b=this.getBody(b);if(!d||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.GearConstraint(this,d,b,c,a))}},createRevoluteConstraint:function(e,d,c,b,a){e=this.getBody(e);c=this.getBody(c);if(!e||!c){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.RevoluteConstraint(this,e,d,c,b,a))}},createLockConstraint:function(e,b,d,c,a){e=this.getBody(e);b=this.getBody(b);if(!e||!b){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.LockConstraint(this,e,b,d,c,a))}},createPrismaticConstraint:function(g,f,c,b,a,d,e){g=this.getBody(g);f=this.getBody(f);if(!g||!f){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new Phaser.Physics.P2.PrismaticConstraint(this,g,f,c,b,a,d,e))}},addConstraint:function(a){this.world.addConstraint(a);this.onConstraintAdded.dispatch(a);return a},removeConstraint:function(a){this.world.removeConstraint(a);this.onConstraintRemoved.dispatch(a);return a},addContactMaterial:function(a){this.world.addContactMaterial(a);this.onContactMaterialAdded.dispatch(a);return a},removeContactMaterial:function(a){this.world.removeContactMaterial(a);this.onContactMaterialRemoved.dispatch(a);return a},getContactMaterial:function(b,a){return this.world.getContactMaterial(b,a)},setMaterial:function(c,a){var b=a.length;while(b--){a[b].setMaterial(c)}},createMaterial:function(b,a){b=b||"";var c=new Phaser.Physics.P2.Material(b);this.materials.push(c);if(typeof a!=="undefined"){a.setMaterial(c)}return c},createContactMaterial:function(d,c,b){if(typeof d==="undefined"){d=this.createMaterial()}if(typeof c==="undefined"){c=this.createMaterial()}var a=new Phaser.Physics.P2.ContactMaterial(d,c,b);return this.addContactMaterial(a)},getBodies:function(){var a=[];var b=this.world.bodies.length;while(b--){a.push(this.world.bodies[b].parent)}return a},getBody:function(a){if(a instanceof p2.Body){return a}else{if(a instanceof Phaser.Physics.P2.Body){return a.data}else{if(a.body&&a.body.type===Phaser.Physics.P2JS){return a.body.data}}}return null},getSprings:function(){var a=[];var b=this.world.springs.length;while(b--){a.push(this.world.springs[b].parent)}return a},getConstraints:function(){var a=[];var b=this.world.constraints.length;while(b--){a.push(this.world.constraints[b].parent)}return a},hitTest:function(e,c,b,g){if(typeof c==="undefined"){c=this.world.bodies}if(typeof b==="undefined"){b=5}if(typeof g==="undefined"){g=false}var a=[this.pxmi(e.x),this.pxmi(e.y)];var f=[];var d=c.length;while(d--){if(c[d] instanceof Phaser.Physics.P2.Body&&!(g&&c[d].data.motionState===p2.Body.STATIC)){f.push(c[d].data)}else{if(c[d] instanceof p2.Body&&c[d].parent&&!(g&&c[d].motionState===p2.Body.STATIC)){f.push(c[d])}else{if(c[d] instanceof Phaser.Sprite&&c[d].hasOwnProperty("body")&&!(g&&c[d].body.data.motionState===p2.Body.STATIC)){f.push(c[d].body.data)}}}}return this.world.hitTest(a,f,b)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(b){var a=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|a}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|a}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|a}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|a}this._collisionGroupID++;var c=new Phaser.Physics.P2.CollisionGroup(a);this.collisionGroups.push(c);if(b){this.setCollisionGroup(b,c)}return c},setCollisionGroup:function(a,c){if(a instanceof Phaser.Group){for(var b=0;b<a.total;b++){if(a.children[b]["body"]&&a.children[b]["body"].type===Phaser.Physics.P2JS){a.children[b].body.setCollisionGroup(c)}}}else{a.body.setCollisionGroup(c)}},createSpring:function(d,c,a,g,e,i,h,f,b){d=this.getBody(d);c=this.getBody(c);if(!d||!c){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new Phaser.Physics.P2.Spring(this,d,c,a,g,e,i,h,f,b))}},createBody:function(c,h,e,f,d,g){if(typeof f==="undefined"){f=false}var b=new Phaser.Physics.P2.Body(this.game,null,c,h,e);if(g){var a=b.addPolygon(d,g);if(!a){return false}}if(f){this.world.addBody(b.data)}return b},createParticle:function(c,h,e,f,d,g){if(typeof f==="undefined"){f=false}var b=new Phaser.Physics.P2.Body(this.game,null,c,h,e);if(g){var a=b.addPolygon(d,g);if(!a){return false}}if(f){this.world.addBody(b.data)}return b},convertCollisionObjects:function(h,f,g){if(typeof g==="undefined"){g=true}var c=[];for(var e=0,b=h.collision[f].length;e<b;e++){var d=h.collision[f][e];var a=this.createBody(d.x,d.y,0,g,{},d.polyline);if(a){c.push(a)}}return c},clearTilemapLayerBodies:function(c,b){b=c.getLayer(b);var a=c.layers[b].bodies.length;while(a--){c.layers[b].bodies[a].destroy()}c.layers[b].bodies.length=0},convertTilemap:function(a,f,c,j){f=a.getLayer(f);if(typeof c==="undefined"){c=true}if(typeof j==="undefined"){j=true}this.clearTilemapLayerBodies(a,f);var b=0;var m=0;var k=0;for(var i=0,d=a.layers[f].height;i<d;i++){b=0;for(var l=0,n=a.layers[f].width;l<n;l++){var g=a.layers[f].data[i][l];if(g&&g.index>-1&&g.collides){if(j){var o=a.getTileRight(f,l,i);if(b===0){m=g.x*g.width;k=g.y*g.height;b=g.width}if(o&&o.collides){b+=g.width}else{var e=this.createBody(m,k,0,false);e.addRectangle(b,g.height,b/2,g.height/2,0);if(c){this.addBody(e)}a.layers[f].bodies.push(e);b=0}}else{var e=this.createBody(g.x*g.width,g.y*g.height,0,false);e.addRectangle(g.width,g.height,g.width/2,g.height/2,0);if(c){this.addBody(e)}a.layers[f].bodies.push(e)}}}}return a.layers[f].bodies},mpx:function(a){return a*=20},pxm:function(a){return a*0.05},mpxi:function(a){return a*=-20},pxmi:function(a){return a*-0.05}};Object.defineProperty(Phaser.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"defaultFriction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"defaultRestitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(Phaser.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"enableBodySleeping",{get:function(){return this.world.enableBodySleeping},set:function(a){this.world.enableBodySleeping=a}});Object.defineProperty(Phaser.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});Phaser.Physics.P2.FixtureList=function(a){if(!Array.isArray(a)){a=[a]}this.rawList=a;this.init();this.parse(this.rawList)};Phaser.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(b,a){var c=function(d){d.collisionGroup=b};this.getFixtures(a).forEach(c)},setMask:function(b,a){var c=function(d){d.collisionMask=b};this.getFixtures(a).forEach(c)},setSensor:function(b,a){var c=function(d){d.sensor=b};this.getFixtures(a).forEach(c)},setMaterial:function(b,a){var c=function(d){d.material=b};this.getFixtures(a).forEach(c)},getFixtures:function(c){var b=[];if(c){if(!(c instanceof Array)){c=[c]}var a=this;c.forEach(function(d){if(a.namedFixtures[d]){b.push(a.namedFixtures[d])}});return this.flatten(b)}else{return this.allFixtures}},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var b,d,c,a;c=this.rawList;a=[];for(b in c){d=c[b];if(!isNaN(b-0)){this.groupedFixtures[b]=this.groupedFixtures[b]||[];this.groupedFixtures[b]=this.groupedFixtures[b].concat(d)}else{this.namedFixtures[b]=this.flatten(d)}a.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(c){var a,b;a=[];b=arguments.callee;c.forEach(function(d){return Array.prototype.push.apply(a,(Array.isArray(d)?b(d):[d]))});return a}};Phaser.Physics.P2.PointProxy=function(b,a){this.world=b;this.destination=a};Phaser.Physics.P2.PointProxy.prototype.constructor=Phaser.Physics.P2.PointProxy;Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(a)}});Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(a)}});Phaser.Physics.P2.InversePointProxy=function(b,a){this.world=b;this.destination=a};Phaser.Physics.P2.InversePointProxy.prototype.constructor=Phaser.Physics.P2.InversePointProxy;Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.destination[0]},set:function(a){this.destination[0]=this.world.pxm(-a)}});Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.destination[1]},set:function(a){this.destination[1]=this.world.pxm(-a)}});Phaser.Physics.P2.Body=function(b,d,a,e,c){d=d||null;a=a||0;e=e||0;if(typeof c==="undefined"){c=1}this.game=b;this.world=b.physics.p2;this.sprite=d;this.type=Phaser.Physics.P2JS;this.offset=new Phaser.Point();this.data=new p2.Body({position:[this.world.pxmi(a),this.world.pxmi(e)],mass:c});this.data.parent=this;this.velocity=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new Phaser.Point();this.onBeginContact=new Phaser.Signal();this.onEndContact=new Phaser.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(d){this.setRectangleFromSprite(d);if(d.exists){this.game.physics.p2.addBody(this)}}};Phaser.Physics.P2.Body.prototype={createBodyCallback:function(b,d,a){var c=-1;if(b.id){c=b.id}else{if(b.body){c=b.body.id}}if(c>-1){if(d===null){delete (this._bodyCallbacks[c]);delete (this._bodyCallbackContext[c])}else{this._bodyCallbacks[c]=d;this._bodyCallbackContext[c]=a}}},createGroupCallback:function(b,c,a){if(c===null){delete (this._groupCallbacks[b.mask]);delete (this._groupCallbacksContext[b.mask])}else{this._groupCallbacks[b.mask]=c;this._groupCallbackContext[b.mask]=a}},getCollisionMask:function(){var a=0;if(this._collideWorldBounds){a=this.game.physics.p2.boundsCollisionGroup.mask}for(var b=0;b<this.collidesWith.length;b++){a=a|this.collidesWith[b].mask}return a},updateCollisionMask:function(b){var a=this.getCollisionMask();if(typeof b==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){this.data.shapes[c].collisionMask=a}}else{b.collisionMask=a}},setCollisionGroup:function(d,b){var a=this.getCollisionMask();if(typeof b==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){this.data.shapes[c].collisionGroup=d.mask;this.data.shapes[c].collisionMask=a}}else{b.collisionGroup=d.mask;b.collisionMask=a}},clearCollision:function(b,d,a){if(typeof a==="undefined"){for(var c=this.data.shapes.length-1;c>=0;c--){if(b){this.data.shapes[c].collisionGroup=null}if(d){this.data.shapes[c].collisionMask=null}}}else{if(b){a.collisionGroup=null}if(d){a.collisionMask=null}}if(b){this.collidesWith.length=0}},collides:function(e,f,c,b){if(Array.isArray(e)){for(var d=0;d<e.length;d++){if(this.collidesWith.indexOf(e[d])===-1){this.collidesWith.push(e[d]);if(f){this.createGroupCallback(e[d],f,c)}}}}else{if(this.collidesWith.indexOf(e)===-1){this.collidesWith.push(e);if(f){this.createGroupCallback(e,f,c)}}}var a=this.getCollisionMask();if(typeof b==="undefined"){for(var d=this.data.shapes.length-1;d>=0;d--){this.data.shapes[d].collisionMask=a}}else{b.collisionMask=a}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass()},applyDamping:function(a){this.data.applyDamping(a)},applyForce:function(c,b,a){this.data.applyForce(c,[this.world.pxmi(b),this.world.pxmi(a)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=a*Math.cos(c);this.data.velocity[1]=a*Math.sin(c)},moveBackward:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=-(a*Math.cos(c));this.data.velocity[1]=-(a*Math.sin(c))},thrust:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.force[0]+=a*Math.cos(c);this.data.force[1]+=a*Math.sin(c)},reverse:function(b){var a=this.world.pxmi(-b);var c=this.data.angle+Math.PI/2;this.data.force[0]-=a*Math.cos(c);this.data.force[1]-=a*Math.sin(c)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},preUpdate:function(){if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);if(!this.fixedRotation){this.sprite.rotation=this.data.angle}},reset:function(a,d,c,b){if(typeof c==="undefined"){c=false}if(typeof b==="undefined"){b=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(c){this.setZeroDamping()}if(b){this.mass=1}this.x=a;this.y=d},addToWorld:function(){if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy()}this.debugBody=null;this.sprite=null},clearShapes:function(){var a=this.data.shapes.length;while(a--){this.data.removeShape(this.data.shapes[a])}this.shapeChanged()},addShape:function(b,a,d,c){if(typeof a==="undefined"){a=0}if(typeof d==="undefined"){d=0}if(typeof c==="undefined"){c=0}this.data.addShape(b,[this.world.pxmi(a),this.world.pxmi(d)],c);this.shapeChanged();return b},addCircle:function(b,a,e,d){var c=new p2.Circle(this.world.pxm(b));return this.addShape(c,a,e,d)},addRectangle:function(e,b,a,f,d){var c=new p2.Rectangle(this.world.pxm(e),this.world.pxm(b));return this.addShape(c,a,f,d)},addPlane:function(a,d,c){var b=new p2.Plane();return this.addShape(b,a,d,c)},addParticle:function(a,d,c){var b=new p2.Particle();return this.addShape(b,a,d,c)},addLine:function(d,a,e,c){var b=new p2.Line(this.world.pxm(d));return this.addShape(b,a,e,c)},addCapsule:function(e,b,a,f,d){var c=new p2.Capsule(this.world.pxm(e),b);return this.addShape(c,a,f,d)},addPolygon:function(d,f){d=d||{};f=Array.prototype.slice.call(arguments,1);var h=[];if(f.length===1&&Array.isArray(f[0])){h=f[0].slice(0)}else{if(Array.isArray(f[0])){h=f[0].slice(0)}else{if(typeof f[0]==="number"){for(var e=0,c=f.length;e<c;e+=2){h.push([f[e],f[e+1]])}}}}var b=h.length-1;if(h[b][0]===h[0][0]&&h[b][1]===h[0][1]){h.pop()}for(var g=0;g<h.length;g++){h[g][0]=this.world.pxmi(h[g][0]);h[g][1]=this.world.pxmi(h[g][1])}var a=this.data.fromPolygon(h,d);this.shapeChanged();return a},removeShape:function(a){return this.data.removeShape(a)},setCircle:function(b,a,d,c){this.clearShapes();return this.addCircle(b,a,d,c)},setRectangle:function(d,b,a,e,c){if(typeof d==="undefined"){d=16}if(typeof b==="undefined"){b=16}this.clearShapes();return this.addRectangle(d,b,a,e,c)},setRectangleFromSprite:function(a){if(typeof a==="undefined"){a=this.sprite}this.clearShapes();return this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(c,a){if(typeof a==="undefined"){for(var b=this.data.shapes.length-1;b>=0;b--){this.data.shapes[b].material=c}}else{a.material=c}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(d,b){var f=this.game.cache.getPhysicsData(d,b);var g=[];for(var c=0;c<f.length;c++){var e=f[c];var a=this.addFixture(e);g[e.filter.group]=g[e.filter.group]||[];g[e.filter.group]=g[e.filter.group].concat(a);if(e.fixtureKey){g[e.fixtureKey]=a}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return g},addFixture:function(a){var e=[];if(a.circle){var h=new p2.Circle(this.world.pxm(a.circle.radius));h.collisionGroup=a.filter.categoryBits;h.collisionMask=a.filter.maskBits;h.sensor=a.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);d[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);this.data.addShape(h,d);e.push(h)}else{var k=a.polygons;var l=p2.vec2.create();for(var f=0;f<k.length;f++){var b=k[f];var g=[];for(var n=0;n<b.length;n+=2){g.push([this.world.pxmi(b[n]),this.world.pxmi(b[n+1])])}var h=new p2.Convex(g);for(var c=0;c!==h.vertices.length;c++){var m=h.vertices[c];p2.vec2.sub(m,m,h.centerOfMass)}p2.vec2.scale(l,h.centerOfMass,1);l[0]-=this.world.pxmi(this.sprite.width/2);l[1]-=this.world.pxmi(this.sprite.height/2);h.updateTriangles();h.updateCenterOfMass();h.updateBoundingRadius();h.collisionGroup=a.filter.categoryBits;h.collisionMask=a.filter.maskBits;h.sensor=a.isSensor;this.data.addShape(h,l);e.push(h)}}return e},loadPolygon:function(l,a){var d=this.game.cache.getPhysicsData(l,a);var h=p2.vec2.create();for(var e=0;e<d.length;e++){var f=[];for(var m=0;m<d[e].shape.length;m+=2){f.push([this.world.pxmi(d[e].shape[m]),this.world.pxmi(d[e].shape[m+1])])}var g=new p2.Convex(f);for(var b=0;b!==g.vertices.length;b++){var k=g.vertices[b];p2.vec2.sub(k,k,g.centerOfMass)}p2.vec2.scale(h,g.centerOfMass,1);h[0]-=this.world.pxmi(this.sprite.width/2);h[1]-=this.world.pxmi(this.sprite.height/2);g.updateTriangles();g.updateCenterOfMass();g.updateBoundingRadius();this.data.addShape(g,h)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true},loadData:function(b,a){var c=this.game.cache.getPhysicsData(b,a);if(c&&c.shape){this.mass=c.density;return this.loadPolygon(b,a)}}};Phaser.Physics.P2.Body.prototype.constructor=Phaser.Physics.P2.Body;Phaser.Physics.P2.Body.DYNAMIC=1;Phaser.Physics.P2.Body.STATIC=2;Phaser.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(Phaser.Physics.P2.Body.prototype,"static",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.STATIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.STATIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.STATIC){this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"dynamic",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.DYNAMIC){this.data.motionState=Phaser.Physics.P2.Body.DYNAMIC;if(this.mass===0){this.mass=1}}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.DYNAMIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"kinematic",{get:function(){return(this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC)},set:function(a){if(a&&this.data.motionState!==Phaser.Physics.P2.Body.KINEMATIC){this.data.motionState=Phaser.Physics.P2.Body.KINEMATIC;this.mass=4}else{if(!a&&this.data.motionState===Phaser.Physics.P2.Body.KINEMATIC){this.data.motionState=Phaser.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(a){if(a!==this.data.allowSleep){this.data.allowSleep=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=Phaser.Math.degToRad(Phaser.Math.wrapAngle(a))}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(a){this.data.damping=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(a){if(a!==this.data.fixedRotation){this.data.fixedRotation=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(a){if(a!==this.data.mass){this.data.mass=a;this.data.updateMassProperties()}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.motionState},set:function(a){if(a!==this.data.motionState){this.data.motionState=a}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(a){this.data.angle=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"debug",{get:function(){return(!this.debugBody)},set:function(a){if(a&&!this.debugBody){this.debugBody=new Phaser.Physics.P2.BodyDebug(this.game,this.data)}else{if(!a&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(a){if(a&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else{if(!a&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}}});Phaser.Physics.P2.BodyDebug=function(b,a,d){Phaser.Group.call(this,b);var c={pixelsPerLengthUnit:20,debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=Phaser.Utils.extend(c,d);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=a;this.canvas=new Phaser.Graphics(b);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw()};Phaser.Physics.P2.BodyDebug.prototype=Object.create(Phaser.Group.prototype);Phaser.Physics.P2.BodyDebug.prototype.constructor=Phaser.Physics.P2.BodyDebug;Phaser.Utils.extend(Phaser.Physics.P2.BodyDebug.prototype,{update:function(){this.updateSpriteTransform()},updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;return this.rotation=this.body.angle},draw:function(){var d,a,h,o,m,p,b,n,k,s,r,q,g,f,e;n=this.body;s=this.canvas;s.clear();h=parseInt(this.randomPastelHex(),16);p=16711680;b=this.lineWidth;if(n instanceof p2.Body&&n.shapes.length){var c=n.shapes.length;o=0;while(o!==c){a=n.shapes[o];k=n.shapeOffsets[o];d=n.shapeAngles[o];k=k||0;d=d||0;if(a instanceof p2.Circle){this.drawCircle(s,k[0]*this.ppu,k[1]*this.ppu,d,a.radius*this.ppu,h,b)}else{if(a instanceof p2.Convex){q=[];g=p2.vec2.create();for(m=f=0,e=a.vertices.length;0<=e?f<e:f>e;m=0<=e?++f:--f){r=a.vertices[m];p2.vec2.rotate(g,r,d);q.push([(g[0]+k[0])*this.ppu,-(g[1]+k[1])*this.ppu])}this.drawConvex(s,q,a.triangles,p,h,b,this.settings.debugPolygons,[k[0]*this.ppu,-k[1]*this.ppu])}else{if(a instanceof p2.Plane){this.drawPlane(s,k[0]*this.ppu,-k[1]*this.ppu,h,p,b*5,b*10,b*10,this.ppu*100,d)}else{if(a instanceof p2.Line){this.drawLine(s,a.length*this.ppu,p,b)}else{if(a instanceof p2.Rectangle){this.drawRectangle(s,k[0]*this.ppu,-k[1]*this.ppu,d,a.width*this.ppu,a.height*this.ppu,p,h,b)}}}}}o++}}},drawRectangle:function(f,j,i,b,k,d,c,a,e){if(typeof e==="undefined"){e=1}if(typeof c==="undefined"){c=0}f.lineStyle(e,c,1);f.beginFill(a);f.drawRect(j-k/2,i-d/2,k,d)},drawCircle:function(e,c,h,f,b,d,a){if(typeof a==="undefined"){a=1}if(typeof d==="undefined"){d=16777215}e.lineStyle(a,0,1);e.beginFill(d,1);e.drawCircle(c,h,-b);e.endFill();e.moveTo(c,h);e.lineTo(c+b*Math.cos(-f),h+b*Math.sin(-f))},drawLine:function(d,b,c,a){if(typeof a==="undefined"){a=1}if(typeof c==="undefined"){c=0}d.lineStyle(a*5,c,1);d.moveTo(-b/2,0);d.lineTo(b/2,0)},drawConvex:function(r,u,o,p,f,a,n,h){var k,q,m,d,b,l,t,s,j,e,c;if(typeof a==="undefined"){a=1}if(typeof p==="undefined"){p=0}if(!n){r.lineStyle(a,p,1);r.beginFill(f);q=0;while(q!==u.length){m=u[q];l=m[0];j=m[1];if(q===0){r.moveTo(l,-j)}else{r.lineTo(l,-j)}q++}r.endFill();if(u.length>2){r.moveTo(u[u.length-1][0],-u[u.length-1][1]);return r.lineTo(u[0][0],-u[0][1])}}else{k=[16711680,65280,255];q=0;while(q!==u.length+1){d=u[q%u.length];b=u[(q+1)%u.length];t=d[0];e=d[1];s=b[0];c=b[1];r.lineStyle(a,k[q%k.length],1);r.moveTo(t,-e);r.lineTo(s,-c);r.drawCircle(t,-e,a*2);q++}r.lineStyle(a,0,1);return r.drawCircle(h[0],h[1],a*2)}},drawPath:function(s,l,o,d,a){var t,q,n,m,c,b,h,e,r,p,k,j,f;if(typeof a==="undefined"){a=1}if(typeof o==="undefined"){o=0}s.lineStyle(a,o,1);if(typeof d==="number"){s.beginFill(d)}n=null;m=null;q=0;while(q<l.length){k=l[q];j=k[0];f=k[1];if(j!==n||f!==m){if(q===0){s.moveTo(j,f)}else{c=n;b=m;h=j;e=f;r=l[(q+1)%l.length][0];p=l[(q+1)%l.length][1];t=((h-c)*(p-b))-((r-c)*(e-b));if(t!==0){s.lineTo(j,f)}}n=j;m=f}q++}if(typeof d==="number"){s.endFill()}if(l.length>2&&typeof d==="number"){s.moveTo(l[l.length-1][0],l[l.length-1][1]);s.lineTo(l[0][0],l[0][1])}},drawPlane:function(i,d,c,f,m,j,h,a,b,e){var l,n,k;if(typeof j==="undefined"){j=1}if(typeof f==="undefined"){f=16777215}i.lineStyle(j,m,11);i.beginFill(f);l=b;i.moveTo(d,-c);n=d+Math.cos(e)*this.game.width;k=c+Math.sin(e)*this.game.height;i.lineTo(n,-k);i.moveTo(d,-c);n=d+Math.cos(e)*-this.game.width;k=c+Math.sin(e)*-this.game.height;i.lineTo(n,-k)},randomPastelHex:function(){var a,c,b,d;b=[255,255,255];d=Math.floor(Math.random()*256);c=Math.floor(Math.random()*256);a=Math.floor(Math.random()*256);d=Math.floor((d+3*b[0])/4);c=Math.floor((c+3*b[1])/4);a=Math.floor((a+3*b[2])/4);return this.rgbToHex(d,c,a)},rgbToHex:function(d,c,a){return this.componentToHex(d)+this.componentToHex(c)+this.componentToHex(a)},componentToHex:function(b){var a;a=b.toString(16);if(a.len===2){return a}else{return a+"0"}}});Phaser.Physics.P2.Spring=function(g,e,c,a,h,f,j,i,d,b){this.game=g.game;this.world=g;if(typeof a==="undefined"){a=1}if(typeof h==="undefined"){h=100}if(typeof f==="undefined"){f=1}a=g.pxm(a);var k={restLength:a,stiffness:h,damping:f};if(typeof j!=="undefined"&&j!==null){k.worldAnchorA=[g.pxm(j[0]),g.pxm(j[1])]}if(typeof i!=="undefined"&&i!==null){k.worldAnchorB=[g.pxm(i[0]),g.pxm(i[1])]}if(typeof d!=="undefined"&&d!==null){k.localAnchorA=[g.pxm(d[0]),g.pxm(d[1])]}if(typeof b!=="undefined"&&b!==null){k.localAnchorB=[g.pxm(b[0]),g.pxm(b[1])]}p2.Spring.call(this,e,c,k)};Phaser.Physics.P2.Spring.prototype=Object.create(p2.Spring.prototype);Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring;Phaser.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)};Phaser.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);Phaser.Physics.P2.Material.prototype.constructor=Phaser.Physics.P2.Material;Phaser.Physics.P2.ContactMaterial=function(c,b,a){p2.ContactMaterial.call(this,c,b,a)};Phaser.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);Phaser.Physics.P2.ContactMaterial.prototype.constructor=Phaser.Physics.P2.ContactMaterial;Phaser.Physics.P2.CollisionGroup=function(a){this.mask=a};Phaser.Physics.P2.DistanceConstraint=function(a,d,c,e,b){if(typeof e==="undefined"){e=100}this.game=a.game;this.world=a;e=a.pxm(e);p2.DistanceConstraint.call(this,d,c,e,{maxForce:b})};Phaser.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);Phaser.Physics.P2.DistanceConstraint.prototype.constructor=Phaser.Physics.P2.DistanceConstraint;Phaser.Physics.P2.GearConstraint=function(c,f,d,e,b){if(typeof e==="undefined"){e=0}if(typeof b==="undefined"){b=1}this.game=c.game;this.world=c;var a={angle:e,ratio:b};p2.GearConstraint.call(this,f,d,a)};Phaser.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);Phaser.Physics.P2.GearConstraint.prototype.constructor=Phaser.Physics.P2.GearConstraint;Phaser.Physics.P2.LockConstraint=function(b,g,d,f,e,c){if(typeof f==="undefined"){f=[0,0]}if(typeof e==="undefined"){e=0}if(typeof c==="undefined"){c=Number.MAX_VALUE}this.game=b.game;this.world=b;f=[b.pxm(f[0]),b.pxm(f[1])];var a={localOffsetB:f,localAngleB:e,maxForce:c};p2.LockConstraint.call(this,g,d,a)};Phaser.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);Phaser.Physics.P2.LockConstraint.prototype.constructor=Phaser.Physics.P2.LockConstraint;Phaser.Physics.P2.PrismaticConstraint=function(g,e,d,f,c,a,b,h){if(typeof f==="undefined"){f=true}if(typeof c==="undefined"){c=[0,0]}if(typeof a==="undefined"){a=[0,0]}if(typeof b==="undefined"){b=[0,0]}if(typeof h==="undefined"){h=Number.MAX_VALUE}this.game=g.game;this.world=g;c=[g.pxmi(c[0]),g.pxmi(c[1])];a=[g.pxmi(a[0]),g.pxmi(a[1])];var i={localAnchorA:c,localAnchorB:a,localAxisA:b,maxForce:h,disableRotationalLock:!f};p2.PrismaticConstraint.call(this,e,d,i)};Phaser.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);Phaser.Physics.P2.PrismaticConstraint.prototype.constructor=Phaser.Physics.P2.PrismaticConstraint;Phaser.Physics.P2.RevoluteConstraint=function(a,f,e,d,c,b){if(typeof b==="undefined"){b=Number.MAX_VALUE}this.game=a.game;this.world=a;e=[a.pxmi(e[0]),a.pxmi(e[1])];c=[a.pxmi(c[0]),a.pxmi(c[1])];p2.RevoluteConstraint.call(this,f,e,d,c,{maxForce:b})};Phaser.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);Phaser.Physics.P2.RevoluteConstraint.prototype.constructor=Phaser.Physics.P2.RevoluteConstraint;